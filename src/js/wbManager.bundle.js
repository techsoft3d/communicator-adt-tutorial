var wbManager;(()=>{var e={287:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=287,e.exports=t}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";i.r(n),i.d(n,{addItem:()=>q,addLine:()=>J,itemShape:()=>Y,itemType:()=>X,lineSnapPosition:()=>G,start:()=>j});let e=new function(){var t=[];return{menudiv:"",initialize:function(t){e.menudiv="#"+t},addMenu:function(e){t.push(e)},getByName(e){for(var i=0;i<t.length;i++)if(t[i].getName()==e)return t[i]},hideAll(){for(var e=0;e<t.length;e++)null!=t[e].parent&&t[e].hide(!0)}}};class t{static mouseEnter(e){$(e).css({"background-color":"rgba(200,200,255,.5)","background-blend-mode":"multiply"})}static mouseLeave(e){$(e).css({"background-color":"","background-blend-mode":""})}static mouseClick(t){var i=t.id.split("_"),n=e.getByName(i[0]);if(null!=n){var r=n.getItemByName(i[1]);if(1==r.isToggle&&(r._toggled=!r._toggled,r._toggled?$(t).css({"border-color":"black"}):$(t).css({"border-color":"white"}),null!=r.submenu))if(r._toggled){n._hideSubmenus(),r._toggled=!0,n._updateToggled();var o=$(t).offset(),a=$(e.menudiv).offset(),d={left:o.left-a.left,top:o.top-a.top};r.submenu.setParent(n,r),n.getOrientation()==s.vertical?(r.submenu.setPosition(d.left+50,d.top),r.submenu.display(!0)):(r.submenu.setPosition(d.left,d.top+50),r.submenu.display(!0))}else r.submenu.hide();null==r.submenu&&(null!=r.action?r.action(r,n.getParentItem(),n.getParentMenu()):null!=n.getAction()?n.getAction()(r,n.getParentItem(),n.getParentMenu()):null!=n.getParentItem()&&null!=n.getParentItem().action?n.getParentItem().action(r,n.getParentItem(),n.getParentMenu()):null!=n.getParentMenu()&&null!=n.getParentMenu().getAction()&&n.getParentMenu().getAction()(r,n.getParentItem(),n.getParentMenu())),r.isToggle||null==n.parent||n.hide(!0)}}constructor(e,t,i,n,s,r,o){this.name=e,this.imagename=t,this.action=i,this.extraData=n,this.isToggle=null!=s&&s,this.submenu=r,this._toggled=!1,this._title=o,this.hidden=!1}isToggled(){return this._toggled}setToggled(e){this._toggled=e}getTitle(){return null!=this._title?this._title:this.name}setImage(e,t){this.imagename=e,$("#"+t.getName()+"_"+this.name).css("background-image","url(js/wbManager/menuimages/"+e+")")}createDiv(e,t){return this.hidden||(this.imagename.indexOf("rgb")>-1?(e+='<div title="'+this.getTitle()+'" id="'+t.getName()+"_"+this.name+"\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuItem.mouseClick(this)' style=\"width:"+t._imageSizeX+"px; height:"+t._imageSizeY+"px;background-size:"+t._imageSizeX+"px "+t._imageSizeY+'px;border-style:solid;border-color:white;border-width:1px">',e+='<div style="border-radius:50%;top:5px;left:5px;position:relative;background:'+this.imagename+";width:"+(t._imageSizeX-10)+"px; height:"+(t._imageSizeY-10)+"px;background-size:"+(t._imageSizeX-10)+"px "+(t._imageSizeY-10)+'px;"></div></div>'):e+='<div title="'+this.getTitle()+'" id="'+t.getName()+"_"+this.name+"\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='console.log(\"click\"); menuItem.mouseClick(this)' style=\"background: url(js/wbManager/menuimages/"+this.imagename+") no-repeat top left;width:"+t._imageSizeX+"px; height:"+t._imageSizeY+"px;background-size:"+t._imageSizeX+"px "+t._imageSizeY+'px;border-style:solid;border-color:white;border-width:1px"></div>'),e}}window.menuItem=t;const s={vertical:0,horizontal:1,box:2};class r{static menuidCounter=0;static fadeIn(e){setTimeout((function(){var t=parseFloat($(e).css("opacity"));t+=.05,$(e).css({opacity:t}),t<1&&r.fadeIn(e)}),10)}constructor(e){this._name=e,this._orientation=s.vertical,this._items=[],this._pos=new Communicator.Point2(0,0),this.active=!1,this._box_x=0,this._box_y=0,this._imageSizeX=32,this._imageSizeY=32,this.parent=void 0,this.action=void 0}getItemByName(e){for(var t=0;t<this._items.length;t++)if(this._items[t].name==e)return this._items[t]}addItem(e,i,n,s,r,o,a){var d=new t(e,i,n,s,r,o,a);return this._items.push(d),d}setPosition(e,t){this._pos.x=e,this._pos.y=t}getParentItem(){return null!=this.parent?this.parent.parentitem:void 0}getParentMenu(){return null!=this.parent?this.parent.parentmenu:void 0}setAction(e){this.action=e}getAction(){return this.action}setBoxDimensions(e,t){this._box_x=e,this._box_y=t}setOrientation(e){this._orientation=e}getName(){return this._name}getOrientation(){return this._orientation}setImageSize(e,t){this._imageSizeX=e,this._imageSizeY=t}display(t){if(!this._active){this._active=!0;var i="";if(this._orientation==s.horizontal||this._orientation==s.vertical){var n="";this._orientation==s.horizontal&&(n="display:inline-flex;"),i+='<div id="wbmenu_'+this._name+'" style="'+n+"opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:"+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000001">';for(var o=0;o<this._items.length;o++)i=this._items[o].createDiv(i,this);if(i+="</div>",$(e.menudiv).prepend(i),null==t)if(this._orientation==s.vertical){var a=$("#wbmenu_"+this._name).height();$("#wbmenu_"+this._name).css({top:this._pos.y-a/2})}else{var d=$("#wbmenu_"+this._name).width();$("#wbmenu_"+this._name).css({left:this._pos.x-d/2})}}else{n="display:inline-flex;",i+='<div id="wbmenu_'+this._name+'" style="'+n+"opacity:0;background-color:white; box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:"+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000001">',o=0;for(var h=0;h<this._box_y;h++){i+="<div>";for(var l=0;l<this._box_x&&!(o>=this._items.length);l++)i=this._items[o].createDiv(i,this),o++;if(i+="</div>",o>=this._items.length)break}i+="</div>",$(e.menudiv).prepend(i)}this._updateToggled(),r.fadeIn("#wbmenu_"+this._name)}}_updateToggled(){for(var e=0;e<this._items.length;e++)this._items[e]._toggled?$("#"+this._name+"_"+this._items[e].name).css({"border-color":"black"}):$("#"+this._name+"_"+this._items[e].name).css({"border-color":"white"})}_hideSubmenus(){for(var e=0;e<this._items.length;e++)null!=this._items[e].submenu&&(this._items[e].submenu.hide(),this._items[e].submenu._hideSubmenus(),this._items[e]._toggled=!1)}hide(e){if(this._active&&(this._active=!1,$("#wbmenu_"+this._name).remove()),this._hideSubmenus(),null!=e&&null!=this.parent)for(var t=this.parent.parentmenu,i=this;null!=t;){t._updateToggled();for(var n=0;n<t._items.length;n++)null!=t._items[n].submenu&&t._items[n].submenu._name==i._name&&(t._items[n]._toggled=!1,t._updateToggled(),null!=t.parent&&t.hide());if(null==t.parent)break;i=t,t=t.parent.parentmenu}}setParent(e,t){this.parent={parentmenu:e,parentitem:t}}}class o extends r{static mouseClick(e){var t=e.id.split("-"),i=menuManager.getByName(t[0]);i.action(t[0],t[1]),i.hide(!0)}constructor(e){super(e),this.action=a.setEditorTextStyles}display(){if(!this._active){this._active=!0;var e="";e+='<div id="wbmenu_'+this.getName()+'" style="opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000001">',e+='<div id="'+this.getName()+"-5\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">5px</div>",e+='<div id="'+this.getName()+"-10\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">10px</div>",e+='<div id="'+this.getName()+"-20\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">20px</div>",e+='<div id="'+this.getName()+"-30\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">30px</div>",e+='<div id="'+this.getName()+"-40\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">40px</div>",e+='<div id="'+this.getName()+"-50\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">50px</div>",e+='<div id="'+this.getName()+"-100\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextSize.mouseClick(this)' style=\"border-color:white;border-width:1px\">100px</div>",e+="</div>",$(menuManager.menudiv).prepend(e),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}}class a extends r{static mouseClick(e){var t=e.id.split("-"),i=menuManager.getByName(t[0]);i.action(t[0],t[1]),i.hide(!0)}static setEditorTextStyles(e,t){wbMain.carotaEditor.selectedRange().setFormatting(e,t)}constructor(e){super(e),this.action=a.setEditorTextStyles}display(){if(!this._active){this._active=!0;var e="";e+='<div id="wbmenu_'+this.getName()+'" style="opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000001">',e+='<div id="'+this.getName()+"-Arial\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextFont.mouseClick(this)' style=\"border-color:white;border-width:1px;font-family: Arial\">Arial</div>",e+='<div id="'+this.getName()+"-Verdana\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextFont.mouseClick(this)' style=\"border-color:white;border-width:1px;font-family: Verdana\">Verdana</div>",e+='<div id="'+this.getName()+"-Fantasy\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextFont.mouseClick(this)' style=\"border-color:white;border-width:1px;font-family: Fantasy\">Fantasy</div>",e+='<div id="'+this.getName()+"-Monospace\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuTextFont.mouseClick(this)' style=\"border-color:white;border-width:1px;font-family: Monospace\">Monospace</div>",e+="</div>",$(menuManager.menudiv).prepend(e),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}}class d extends r{static mouseClick(e){var t=e.id.split("_"),i=menuManager.getByName(t[0]);i.action(t[0],t[1]),i.hide(!0)}static deleteTag(){var e=menuManager.getByName("tags"),t=$("#tagtext")[0].value;wbTags.deleteTag(t),e.hideSimple(),e.mode=0,e.display()}static newTag(){for(var e=menuManager.getByName("tags"),t=$("#tagtext")[0].value,i=wbMain.getSelectedItems(),n=0;n<i.length;n++)i[n].getTags().addTag(t,e.currentTagColor),i[n].setDirty();$("#tagtext")[0].value="",e.generateTagDiv()}static cancelEdit(){var e=menuManager.getByName("tags");e.hideSimple(),e.mode=0,e.display()}static activateTag(e){if(1!=(t=menuManager.getByName("tags")).mode){for(var t=menuManager.getByName("tags"),i=wbMain.getSelectedItems(),n=0,s=0;s<i.length;s++)i[s].getTags().hasTag(e)&&n++;if(n==i.length)for(s=0;s<i.length;s++)i[s].getTags().removeTag(e),i[s].setDirty();else for(s=0;s<i.length;s++)i[s].getTags().addTag(e),i[s].setDirty();t.generateTagDiv()}}static editTag(){var e=menuManager.getByName("tags"),t=e.getEditTag(),i=$("#tagtext")[0].value;wbTags.renameTag(t,i,e.currentTagColor),e.hideSimple(),e.mode=0,e.display()}static editTagMode(e){var t=menuManager.getByName("tags"),i=wbTags.allTags.getTagsHash();t.currentTagColor=i[e],t.setEditTag(e),t.hideSimple(),t.mode=1,t.display(),$("#tagtext")[0].value=e,t.setEditTag((" "+e).slice(1))}static showColorMenu(e){var t=menuManager.getByName("tags"),i=menuManager.getByName("tagcolors");i.setParent(t,void 0);var n=$(e).offset();i.setPosition(n.left,n.top),i.display()}static keyDown(){$("#tagtext")[0].value,menuManager.getByName("tags").generateTagDiv()}static action(e,t){var i=menuManager.getByName("tags");i.currentTagColor=e.imagename,$("#tagcolor").css({background:i.currentTagColor})}constructor(e){super(e),this.mode=0,this.editTagName=void 0,this.action=d.action,this.currentTagColor="rgb(255,0,0)"}generateTagDiv(){var e=void 0,t=$("#tagtext")[0].value;""!=t&&(e=t),$("#alltags").empty();var i=[],n=wbTags.allTags.getTagsHash();for(var s in n)i[s]=!1;var r=wbMain.getSelectedItems();for(s=0;s<r.length;s++){var o=r[s].getTags().getTagsHash();for(var a in o)i[a]=!0}var d="";for(var s in i){var h="";0==i[s]&&(h="opacity:0.15;"),(null==e||s.substring(0,e.length)==e)&&(d+="<div onclick='menuTags.activateTag(\""+s+'")\' style="'+h+"margin-bottom:2px; color:white;background:"+n[s]+';margin-left:3px;padding:2px;display:inline-flex">'+s+"<div onclick='menuTags.editTagMode(\""+s+'")\' style="background: url(menuimages/editicon.png) no-repeat top left;width:10px;height:15px;background-size:10px 15px"></div></div>')}$("#alltags").append(d),wbMain.redraw()}display(){if(!this._active){wbMain.redraw(),this._active=!0;var e="";e+='<div id="wbmenu_'+this.getName()+'" style="opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000000;width:270px">',e+='<div id="tagcolor" onclick="menuTags.showColorMenu(this)" style="border-radius:50%;top:5px;left:5px;position:relative;background:'+this.currentTagColor+';width:20px; height:20px;background-size:20px 20px;"></div>',e+='<input onkeyup="menuTags.keyDown()" id="tagtext" type="text" placeholder="Enter Tag" style="position:relative;left:30px;top:-15px;width:150px"></Input>',0==this.mode?(e+='<button type="button" style="background-color:white;border-style:none;position:relative; top:-15px;left:40px" onclick="menuTags.newTag(this)">Create</button>',e+='<div id="alltags">',e+="</div>"):(e+='<button type="button" style="background-color:white;border-style:none;position:relative; top:-15px;left:40px" onclick="menuTags.editTag(this)">Done</button>',e+='<div style="position:relative;left:150px">',e+='<button type="button" style="background-color:white;border-style:none; position:relative;" onclick="menuTags.deleteTag(this)">Delete</button>',e+='<button type="button" style="background-color:white;border-style:none;position:relative;" onclick="menuTags.cancelEdit(this)">Cancel</button>',e+="</div>"),e+="</div>",$(menuManager.menudiv).prepend(e),0==this.mode&&($("#tagtext").keydown((function(e){13==e.keyCode&&d.newTag(this)})),$("#tagtext").focus(),this.generateTagDiv()),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}hideSimple(){this._active&&(this._active=!1,$("#wbmenu_"+this._name).remove())}hide(){super.hide(!0),this.mode=0}setEditTag(e){this.editTagName=e}getEditTag(){return this.editTagName}}class h{static allTags;static allowedTagColors=[];static initialize(){h.allTags=new h,h.allowedTagColors.push("rgb(255,0,0)"),h.allowedTagColors.push("rgb(255,128,0)"),h.allowedTagColors.push("rgb(0,255,0)"),h.allowedTagColors.push("rgb(128,255,0)"),h.allowedTagColors.push("rgb(0,0,255)"),h.allowedTagColors.push("rgb(0,128,255)")}static deleteTag(e){h.allTags.removeTag(e);for(var t=wbMain.getItems(),i=0;i<t.length;i++)t[i].getTags().removeTag(e)}static renameTag(e,t,i){h.allTags.renameTag(e,t,i);for(var n=wbMain.getItems(),s=0;s<n.length;s++)n[s].getTags().renameTag(e,t)}static getTagColor(e){return h.allTags.getTag(e)}static setTagColor(e,t){h.allTags.addTag(e,t)}constructor(){this.tagsHash=[]}setFromJSON(e){if(null!=e)for(var t=e.key,i=e.value,n=0;n<t.length;n++)this.tagsHash[t[n]]=i[n]}serialize(){var e=new Array,t=new Array;for(var i in this.tagsHash)e.push(i),t.push(this.tagsHash[i]);return{key:e,value:t}}addTag(e,t){wbMain.setDirty(),this!=h.allTags&&h.allTags.addTag(e,t),this.hasTag(e)&&null==t||(this.tagsHash[e]=null==t?"rgb(255,0,64)":t)}renameTag(e,t,i){wbMain.setDirty(),this.hasTag(e)&&(this.removeTag(e),this.addTag(t,i))}removeTag(e){wbMain.setDirty();var t=[];for(var i in this.tagsHash)i!=e&&(t[i]=this.tagsHash[i]);this.tagsHash=t}hasTag(e){return null!=this.tagsHash[e]}hasTags(e){for(var t=0;t<e.length;t++)if(this.hasTag(e[t]))return!0}getTag(e){return this.tagsHash[e]}getTagsHash(){return this.tagsHash}}const l={wbItem:0,wbItemHC:1,wbItemTextEditor:2,wbItemTextEditorNote:3,wbItemTextEditorText:4,wbItemContainer:5,wbItemModelTree:6,wbLine:7},c={rectangle:0,roundedCornerRectangle:1,circle:2};window.wbItemShape=c;class g{static borderPatterns=[[1,1],[5,15],[20,5]];static container="newdialogwindow";constructor(){this._type=l.wbItem,this._active=!1,this._locked=!1,this._dimensions={left:600,top:200,width:500,height:500},this._tempcanvasimagedimensions,this._isSelected=!1,this._shape=c.rectangle,this._backgroundColor="rgb(255,255,255)",this._groupid,this._image,this._targetdiv,this.containedIn=void 0,this._connectedWindows=[],this._tags=new h,this.backgroundOpacity=1,this.borderColor="rgb(0,0,0)",this.borderWidth=1,this.shadowWidth=2,this.borderPattern=void 0,this._guid=this._generateGUID(),this.isLineSnapItem=!1,this.dirty=!0,this.imageDirty=!1,this.order=U.getTopOrder()}setFromJSON(e){this._type=e._type,this._guid=e._guid,this._locked=e._locked,this._dimensions=e._dimensions,this._shape=e._shape,this._backgroundColor=e._backgroundColor,null!=e._groupid&&(this._groupid=e._groupid),this.backgroundOpacity=e.backgroundOpacity,this.borderColor=e.borderColor,this.borderWidth=e.borderWidth,this.shadowWidth=e.shadowWidth,this.order=e.order,null!=e.borderPattern&&(this.borderPattern=e.borderPattern),this.isLineSnapItem=e.isLineSnapItem,this.dirty=!1,this._tags.setFromJSON(e.tags)}serialize(){return{_type:this._type,_guid:this._guid,_locked:this._locked,_dimensions:this._dimensions,_shape:this._shape,_backgroundColor:this._backgroundColor,_groupid:this._groupid,backgroundOpacity:this.backgroundOpacity,borderColor:this.borderColor,borderWidth:this.borderWidth,shadowWidth:this.shadowWidth,borderPattern:this.borderPattern,isLineSnapItem:this.isLineSnapItem,order:this.order,hasImage:null!=this._image,tags:this._tags.serialize()}}_generateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}setDirty(){this.dirty=!0}getDirty(){return this.dirty}clearDirty(){this.dirty=!1}fetchImage(e){var t=this;fetch("api/Image/"+e+"/"+this._guid).then((function(e){200===e.status?e.json().then((function(e){var i=JSON.parse(e);let n=document.createElement("img");n.src=i.test,t.setImage(n),setTimeout((function(){U.redraw()}),200)})):console.log("Looks like there was a problem. Status Code: "+e.status)})).catch((function(e){console.log("Fetch Error :-S",e)}))}postImage(e){fetch("api/Image/"+e+"/"+this._guid,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({test:this._image.src})})}setupDiv(e){this._targetdiv="wdiv-"+this.getGUID();var t='<div id="'+this._targetdiv+'" style="display:none;border-width:1px; border-color:black;overflow:hidden;box-shadow: 0px 0px 40px grey;">';$("#"+e).append(t)}move(e,t,i){i?(this._dimensions.left+=e,this._dimensions.top+=t):(this._dimensions.left=e,this._dimensions.top=t),this.dirty=!0,this.refreshPositioning()}scale(e){this._dimensions=e,this.dirty=!0}deselectGroup(){if(null!=this._groupid)for(var e=U.getItems(),t=0;t<e.length;t++)e[t].getGroup()==this._groupid&&e[t].setSelected(!1)}disableInput(){}enableInput(){}setLocked(e){this._locked=e}getLocked(){return this._locked}duplicate(){var e=new g;return this._duplicate(e),e}_duplicate(e){for(var t in e.initialize(),e._dimensions={left:this._dimensions.left,top:this._dimensions.top,width:this._dimensions.width,height:this._dimensions.height},e._shape=this._shape,this._tags)e._tags[t]=!0;if(null==this._backgroundColor?e._backgroundColor=void 0:e._backgroundColor=(" "+this._backgroundColor).slice(1),null!=this._image){var i=(" "+this._image.src).slice(1),n=new Image;n.src=i,e._image=n}e.setupDiv(g.container),U.addItem(e)}initialize(){}getGUID(){return this._guid}getType(){return this._type}setBackgroundColor(e){this._backgroundColor=e,null!=this.getDiv()&&(null==e&&(e="transparent"),$("#"+this.getDiv()).css({"background-color":e}))}setGroup(e){this._groupid=e}getGroup(){return this._groupid}getTags(){return this._tags}hasTags(e){return this._tags.hasTags(e)}findConnectedItems(){return[this]}getBackgroundColor(){return this._backgroundColor}getDimensions(){return this._dimensions}setDimensions(e){this._dimensions=e,this.dirty=!0,this.refreshPositioning()}findConnectedContainer(){for(var e=U.getItems(),t=0;t<e.length;t++)if(e[t].getType()==l.wbItemContainer)for(var i=e[t].getContainedItems(),n=0;n<i.length;n++)if(i[n].getGUID()==this.getGUID())return e[t]}findGroupItems(){var e=[];if(null!=this.getGroup())for(var t=U.getItems(),i=0;i<t.length;i++)t[i].getGroup()==this._groupid&&e.push(t[i]);return e}refreshPositioning(){if(null!=this._targetdiv){var e=U.convertCanvasToWindowCoordinates(this.getDimensions());$("#"+this.getDiv()).css({width:e.width,height:e.height,top:e.top,left:e.left})}}refreshImage(e){}getSelected(){return this._isSelected}setSelected(e){this._isSelected=e}getTempDimensions(){return this._tempcanvasimagedimensions}storeTempDimensions(){this._tempcanvasimagedimensions={left:this._dimensions.left,top:this._dimensions.top,width:this._dimensions.width,height:this._dimensions.height}}clearTempDimensions(){this._tempcanvasimagedimensions=void 0}setShape(e){this._shape=e,this.dirty=!0,this.updateCircular()}updateCircular(){null!=this.getDiv()&&this.getShape()==c.circle?$("#"+this.getDiv()).css({"border-radius":"50%"}):$("#"+this.getDiv()).css({"border-radius":"0%"})}getShape(){return this._shape}setImage(e){this._image=e}getImage(){return this._image}setDiv(e){this._targetdiv=e}getDiv(){return this._targetdiv}setActive(e){this._active=e}getActive(){return this._active}activate(e){0==this._active&&(this.refreshPositioning(),this._active=!0,null!=this.getDiv()&&$("#"+this.getDiv()).css({display:"block"}))}deactivate(){this._active&&(this.setActive(!1),null!=this.getDiv()&&$("#"+this.getDiv()).css({display:"none"}))}pointInsideItem(e){var t=this.getDimensions();return e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height}pointInsideItemWithTolerance(e,t){var i=this.getDimensions();return e.x>=i.left-t&&e.x<=i.left+i.width+t&&e.y>=i.top-t&&e.y<=i.top+i.height+t}renderPre(e,t){var i=this.getBackgroundColor(),n=this.getDimensions();if(e.fillStyle=i,e.strokeStyle=this.borderColor,e.shadowColor="#898",e.shadowBlur=2.5*this.shadowWidth,e.shadowOffsetX=0,e.shadowOffsetY=this.shadowWidth,e.lineWidth=this.borderWidth,null!=this.borderPattern?e.setLineDash(g.borderPatterns[this.borderPattern]):e.setLineDash([]),e.globalAlpha=this.backgroundOpacity,this.getShape()!=c.rectangle){if(e.save(),n=this.getDimensions(),this.getShape()==c.roundedCornerRectangle)this.roundRect(e,n.left,n.top,n.width,n.height,50,!0,!0);else{e.beginPath();var s=Math.sqrt(n.width*n.width+n.height*n.height);s=n.width>n.height?n.height/2:n.width/2,e.arc(n.left+n.width/2,n.top+n.height/2,s,0,2*Math.PI,!0),e.stroke(),e.closePath()}e.clip()}}drawPoint(e,t,i){e.save(),e.beginPath(),e.lineWidth=1,e.arc(t.x,t.y,i,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.fill(),e.restore()}renderPost(e,t){var i=this.getDimensions();this.isLineSnapItem&&(t.setLineDash([]),t.fillStyle="rgb(128,128,255)",t.strokeStyle="rgb(255,255,255)",this.drawPoint(t,{x:i.left+i.width/2,y:i.top+i.height/2},5/e.getTransform().a),this.drawPoint(t,{x:i.left,y:i.top+i.height/2},5/e.getTransform().a),this.drawPoint(t,{x:i.left+i.width,y:i.top+i.height/2},5/e.getTransform().a),this.drawPoint(t,{x:i.left+i.width/2,y:i.top},5/e.getTransform().a),this.drawPoint(t,{x:i.left+i.width/2,y:i.top+i.height},5/e.getTransform().a)),this.getShape()!=c.rectangle&&e.restore(),this.getSelected()&&(this.getLocked()?t.strokeStyle="rgb(255,64,64)":t.strokeStyle="rgb(64,64,255)",t.lineWidth=1/e.getTransform().a,t.strokeRect(i.left,i.top,i.width,i.height));var n=this.getTags().getTagsHash(),s=h.allTags.getTagsHash();if(U.convertCanvasToWindowCoordinates(i).height>100){var r=5/e.getTransform().a,o=11/e.getTransform().a;e.textAlign="right",e.font=10/e.getTransform().a+"px monospace";var a=i.top+o;for(var d in n){var l=e.measureText(d),g=o,u=i.left-r+20/e.getTransform().a;e.fillStyle=s[d],e.fillRect(u-l.width-2/e.getTransform().a,a-g/1.5,l.width+4/e.getTransform().a,g/1.2),e.fillStyle="rgb(255,255,255)",e.fillText(d,u,a),a+=g}}else for(var d in r=5/e.getTransform().a,o=5/e.getTransform().a,a=i.top+o,n)g=o,e.fillStyle=s[d],e.fillRect(i.left-5/e.getTransform().a,a-g/1.5,10/e.getTransform().a,g/1.2),a+=g;e.shadowColor="#898",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.globalAlpha=1}render(e,t){this.renderPre(e,t);var i=this.getBackgroundColor(),n=this.getDimensions();null!=i&&this.backgroundOpacity>0&&e.fillRect(n.left,n.top,n.width,n.height),this.borderWidth>0&&this.getShape()==c.rectangle&&e.strokeRect(n.left+(this.borderWidth-1)/2,n.top+(this.borderWidth-1)/2,n.width-(this.borderWidth-1),n.height-(this.borderWidth-1)),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0;var s=this.getImage();null!=s&&e.drawImage(s,n.left,n.top,n.width,n.height),this.renderPost(e,t)}roundRect(e,t,i,n,s,r,o,a){if(void 0===a&&(a=!0),void 0===r&&(r=5),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var d={tl:0,tr:0,br:0,bl:0};for(var h in d)r[h]=r[h]||d[h]}e.beginPath(),e.moveTo(t+r.tl,i),e.lineTo(t+n-r.tr,i),e.quadraticCurveTo(t+n,i,t+n,i+r.tr),e.lineTo(t+n,i+s-r.br),e.quadraticCurveTo(t+n,i+s,t+n-r.br,i+s),e.lineTo(t+r.bl,i+s),e.quadraticCurveTo(t,i+s,t,i+s-r.bl),e.lineTo(t,i+r.tl),e.quadraticCurveTo(t,i,t+r.tl,i),e.closePath(),o&&e.fill(),a&&e.stroke()}connectWindow(e){this._connectedWindows.push({whiteboarditem:e,position:void 0,type:void 0}),this.dirty=!0}getConnectedWindows(){return this._connectedWindows}}class u extends r{static mouseClick(t){var i=t.id.split("_");if("backgroundcolor"==i[0]){for(var n=U.getSelectedItems(),s=0;s<n.length;s++)"0"==i[1]?n[s].setBackgroundColor():n[s].setBackgroundColor(u.colorChoices[parseInt(i[1])]),n[s].setDirty();U.redraw()}else{for(n=U.getSelectedItems(),s=0;s<n.length;s++)n[s].borderColor=u.colorChoices[parseInt(i[1])];U.redraw()}e.getByName("menuAppearance").refresh()}static setBorderShape(t){U.setShape(t),e.getByName("menuAppearance").refresh()}static setBorderPattern(t){for(var i=U.getSelectedItems(),n=0;n<i.length;n++)i[n].borderPattern=t,i[n].setDirty();var s=e.getByName("menuAppearance");U.redraw(),s.refresh()}static colorChoices=["rgb(255,255,255)","rgb(255,255,255)","rgb(230,230,230)","rgb(210,210,210)","rgb(150,150,150)","rgb(64,64,64)","rgb(0,0,0)","rgb(255,128,128)","rgb(255,0,0)","rgb(170,0,0)","rgb(130,0,0)","rgb(64,0,0)","rgb(128,255,128)","rgb(0,255,0)","rgb(0,210,0)","rgb(0,170,0)","rgb(0,130,0)","rgb(0,64,0)","rgb(128,128,255)","rgb(0,0,255)","rgb(0,0,210)","rgb(0,0,170)","rgb(0,0,130)","rgb(0,0,64)","rgb(255,241,170)","rgb(255,255,0)","rgb(210,210,0)","rgb(170,170,0)","rgb(130,130,0)","rgb(64,64,0)","rgb(32,32,0)"];static backgroundOpacityChanged(){e.getByName("menuAppearance");for(var t=$("#backgroundopacityslider")[0].value,i=U.getSelectedItems(),n=0;n<i.length;n++)i[n].backgroundOpacity=parseInt(t)/100;U.redraw()}static shadowChanged(){e.getByName("menuAppearance");for(var t=$("#shadowslider")[0].value,i=U.getSelectedItems(),n=0;n<i.length;n++)i[n].shadowWidth=parseInt(t);U.redraw()}static borderThicknessChanged(){e.getByName("menuAppearance");for(var t=$("#borderthicknesslider")[0].value,i=U.getSelectedItems(),n=0;n<i.length;n++)i[n].borderWidth=parseInt(t)/200*20;U.redraw()}constructor(e){super(e)}refresh(){var e=U.getSelectedItems()[0],t="";if(e.getType()!=l.wbLine){t+='<div style="position:absolute;top:0px;">',t+='<div style="background: url(js/wbManager/menuimages/transparent2.png) no-repeat top left;width:20px; height:20px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+='<input id="backgroundopacityslider" oninput="menuAppearance.backgroundOpacityChanged()" style="position:absolute; top:0px; left:22px;"type="range" min="0" max="100" step="10" value="'+100*e.backgroundOpacity+'" class="myslider">',t+='<div style="background: url(js/wbManager/menuimages/nontransparent2.png) no-repeat top left;position:absolute;width:20px; height:20px;left:127px;top:0px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+='<div style="position:absolute;top:20px;background: url(js/wbManager/menuimages/noshadow.png) no-repeat top left;width:20px; height:20px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+='<input id="shadowslider" oninput="menuAppearance.shadowChanged()" style="position:absolute; top:20px; left:22px;"type="range" min="0" max="20" step="1" value="'+e.shadowWidth+'" class="myslider">',t+='<div style="background: url(js/wbManager/menuimages/heavyshadow.png) no-repeat top left;position:absolute;width:20px; height:20px;left:127px;top:20px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderShape(wbItemShape.rectangle)' style=\"background: url(js/wbManager/menuimages/rectangleshape.png) no-repeat top left;position:absolute;width:20px; height:20px;left:200px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(e.getShape()==c.rectangle?"black":"white")+';border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderShape(wbItemShape.circle)' style=\"background: url(js/wbManager/menuimages/circleshape.png) no-repeat top left;position:absolute;width:20px; height:20px;left:222px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(e.getShape()==c.circle?"black":"white")+';border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderShape(wbItemShape.roundedCornerRectangle)' style=\"background: url(js/wbManager/menuimages/roundedrectangleshape.png) no-repeat top left;position:absolute;width:20px; height:20px;left:245px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(e.getShape()==c.roundedCornerRectangle?"black":"white")+';border-width:1px"></div>';for(var i=0,n=24,s=0;s<5;s++){for(var r=0;r<10;r++){var o="white";if((null==(a=e.getBackgroundColor())&&0==s&&0==r||a==u.colorChoices[i]&&i>0)&&(o="black"),0==s&&0==r?t+="<div id=\"backgroundcolor_0\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.mouseClick(this)' style=\"position:absolute;top:"+(s+2)*(n+2)+"px;background: url(js/wbManager/menuimages/transparent2.png) no-repeat center;width:"+n+"px; height:"+(n-1)+"px;background-size:"+(n+4)+"px "+(n+4)+"px;border-style:solid;border-color:"+o+';border-width:1px"></div>':(t+='<div id="backgroundcolor_'+i+"\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.mouseClick(this)' style=\"position:absolute; left:"+r*(n+2)+"px;top:"+(s+2)*(n+2)+"px;width:"+n+"px; height:"+n+"px;background-size:"+n+"px "+n+"px;border-style:solid;border-color:"+o+';border-width:1px">',t+='<div style="border-radius:50%;position:relative;background:'+u.colorChoices[i]+";width:"+n+"px; height:"+n+"px;background-size:"+n+"px "+n+'px;"></div></div>'),++i>=u.colorChoices.length-1)break}if(i>=u.colorChoices.length-1)break}t+="</div>",t+='<div style="position:absolute;top:130px;width:100%">',t+="<hr>",t+="</div>",t+='<div style="position:absolute;top:145px;width:100%">'}else t+='<div style="position:absolute;top:0px;width:100%">';for(t+='<div style="background: url(js/wbManager/menuimages/linethicknessthin.png) no-repeat top left;width:20px; height:20px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+='<input id="borderthicknesslider" oninput="menuAppearance.borderThicknessChanged()" style="position:absolute; top:0px; left:22px;"type="range" min="0" max="200" step="10" value="'+e.borderWidth/20*200+'" class="myslider">',t+='<div style="background: url(js/wbManager/menuimages/linethicknessthick.png) no-repeat top left;position:absolute;width:20px; height:20px;left:127px;top:0px;background-size:20px 20px;border-style:solid;border-color:white;border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderPattern()' style=\"background: url(js/wbManager/menuimages/solidline.png) no-repeat top left;position:absolute;width:20px; height:20px;left:170px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(null==e.borderPattern?"black":"white")+';border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderPattern(0)' style=\"background: url(js/wbManager/menuimages/dashedline1.png) no-repeat top left;position:absolute;width:20px; height:20px;left:192px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(0==e.borderPattern?"black":"white")+';border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderPattern(1)' style=\"background: url(js/wbManager/menuimages/dashedline2.png) no-repeat top left;position:absolute;width:20px; height:20px;left:214px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(1==e.borderPattern?"black":"white")+';border-width:1px"></div>',t+="<div onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.setBorderPattern(2)' style=\"background: url(js/wbManager/menuimages/dashedline3.png) no-repeat top left;position:absolute;width:20px; height:20px;left:236px;top:0px;background-size:20px 20px;border-style:solid;border-color:"+(2==e.borderPattern?"black":"white")+';border-width:1px"></div>',i=1,n=24,s=0;s<5;s++){for(r=0;r<10;r++){var a;if(o="white",(a=e.borderColor)==u.colorChoices[i]&&(o="black"),t+='<div id="bordercolor_'+i+"\" onmouseenter='menuItem.mouseEnter(this)' onmouseleave='menuItem.mouseLeave(this)' onclick='menuAppearance.mouseClick(this)' style=\"position:absolute; left:"+r*(n+2)+"px;top:"+(s+1)*(n+2)+"px;width:"+n+"px; height:"+n+"px;background-size:"+n+"px "+n+"px;border-style:solid;border-color:"+o+';border-width:1px">',t+='<div style="border-radius:50%;position:relative;background:'+u.colorChoices[i]+";width:"+n+"px; height:"+n+"px;background-size:"+n+"px "+n+'px;"></div></div>',++i>=u.colorChoices.length)break}if(i>=u.colorChoices.length)break}t+="</div>",$("#wbmenu_"+this.getName()).empty(),$("#wbmenu_"+this.getName()).append(t)}display(){if(!this._active){U.redraw();var t=U.getSelectedItems()[0];this._active=!0;var i="",n=250;t.getType()==l.wbLine&&(n=106),i+='<div id="wbmenu_'+this.getName()+'" style="opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+"px ;z-index:1000000000;width:270px;height:"+n+'px">',i+="</div>",$(e.menudiv).prepend(i),this.refresh(),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}}window.menuAppearance=u;class m extends r{static mouseClick(t){var i=t.id.split("_"),n=e.getByName(i[0]);n.action(i[0],i[1]),n.hide(!0)}static keyDown(){$("#tagsearchtext")[0].value,e.getByName("searchmenu").generateTagDiv()}static zoomToFoundItem(t){var i=U.getItemByGUID(t);U.ctrlPressed?i.setSelected(!i.getSelected()):(U.clearSelection(),i.setSelected(!0));var n=U.calculateSelectionBounding().bounding;U.fitSelection(1,n),e.getByName("searchmenu").generateTagDiv()}constructor(e){super(e),this.action=d.action}generateTagDiv(){$("#allsearchtags").empty();var e=$("#tagsearchtext")[0].value;if(""!=e){for(var t=[],i=U.getItems(),n=0;n<i.length;n++){var s=i[n].getTags().getTagsHash();for(var r in s)if(r.substring(0,e.length)==e){t.push({guid:i[n].getGUID(),tag:r});break}}var o=wbTags.allTags.getTagsHash(),a="",d=0;for(n=0;n<t.length;n++)U.getItemByGUID(t[n].guid).getSelected()?a+="<div onclick='wbMenuSearch.zoomToFoundItem(\""+t[n].guid+'")\' style="border-style:solid;border-width:2px;border-color:black;position:absolute; top:'+27*d+"px;margin-bottom:2px; color:white;background:"+o[t[n].tag]+';margin-left:3px;padding:2px;display:inline-flex">'+t[n].tag+"</div>":a+="<div onclick='wbMenuSearch.zoomToFoundItem(\""+t[n].guid+'")\' style="border-style:solid;border-width:2px;border-color:white;position:absolute; top:'+27*d+"px;margin-bottom:2px; color:white;background:"+o[t[n].tag]+';margin-left:3px;padding:2px;display:inline-flex">'+t[n].tag+"</div>",d++;$("#allsearchtags").append(a),U.redraw()}}display(){if(!this._active){U.redraw(),this._active=!0;var t="";t+='<div id="wbmenu_'+this.getName()+'" style="overflow-x:hidden;overflow-y:auto;height:300px;opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000000;width:240px">',t+='<input onkeyup="wbMenuSearch.keyDown()" id="tagsearchtext" type="text" placeholder="Enter Tag" style="position:relative;left:5px;top:0px;width:200px"></Input>',t+='<div id="allsearchtags" style="position:relative; left:2px;top:5px">',t+="</div>",t+="</div>",$(e.menudiv).prepend(t),this.generateTagDiv(),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}hideSimple(){this._active&&(this._active=!1,$("#wbmenu_"+this._name).remove())}setEditTag(e){this.editTagName=e}getEditTag(){return this.editTagName}}class p extends r{static arrange(){for(var e=wbMain.getSelectedItems(),t=0;t<e.length;t++)e[t].arrangeItems();wbMain.redraw(),wbItemContainer.assignItemsToContainer(),menuManager.getByName("tagscontainermenu").hide(!0)}static activateTag(e){for(var t=menuManager.getByName("tagscontainermenu"),i=wbMain.getSelectedItems(),n=0,s=0;s<i.length;s++)i[s].getTargetTags().hasTag(e)&&n++;if(n==i.length)for(s=0;s<i.length;s++)i[s].getTargetTags().removeTag(e);else for(s=0;s<i.length;s++)i[s].getTargetTags().addTag(e);t.generateTagDiv()}constructor(e){super(e)}generateTagDiv(){$("#alltagscontainer").empty();var e=[],t=wbTags.allTags.getTagsHash();for(var i in t)e[i]=!1;var n=wbMain.getSelectedItems();for(i=0;i<n.length;i++){var s=n[i].getTargetTags().getTagsHash();for(var r in s)e[r]=!0}var o="";for(var i in e){var a="";0==e[i]&&(a="opacity:0.15;"),o+="<div onclick='menuTagsContainer.activateTag(\""+i+'")\' style="'+a+"margin-bottom:2px; color:white;background:"+t[i]+';margin-left:3px;padding:2px;display:inline-flex">'+i+"</div>"}$("#alltagscontainer").append(o),wbMain.redraw()}display(){if(!this._active){wbMain.redraw(),this._active=!0;var e="";e+='<div id="wbmenu_'+this.getName()+'" style="opacity:0;background-color:white;box-shadow: grey 0px 0px 10px;border-radius: 5px;border: 5px solid white;position:absolute; left:'+this._pos.x+"px; top:"+this._pos.y+'px ;z-index:1000000000;width:270px">',e+='<div id="alltagscontainer">',e+="</div>",e+='<button type="button" style="background-color:white;border-style:none;position:relative; top:0px;left:0px" onclick="menuTagsContainer.arrange(this)">Arrange</button>',e+="</div>",$(menuManager.menudiv).prepend(e),this.generateTagDiv(),$("#wbmenu_"+this.getName()).height(),$("#wbmenu_"+this.getName()).css({top:this._pos.y}),r.fadeIn("#wbmenu_"+this._name)}}hideSimple(){this._active&&(this._active=!1,$("#wbmenu_"+this._name).remove())}hide(){super.hide(!0),this.mode=0}setEditTag(e){this.editTagName=e}getEditTag(){return this.editTagName}}function f(){return{camera:void 0,isolateNode:void 0,cadView:void 0,sheet:void 0,explode:void 0,drawMode:void 0,ambientOcclusion:void 0,bloom:void 0,projectionMode:void 0,measureData:void 0,selectedNodes:void 0,initialize:function(){},duplicate:function(){var e=new f;return e.copy(this),e.camera=this.camera.copy(),e},saveStatesFromHWV:function(e){this.camera=e.view.getCamera().copy(),this.drawMode=e.view.getDrawMode(),this.ambientOcclusion=e.view.getAmbientOcclusionEnabled(),this.bloom=e.view.getBloomEnabled(),this.projectionMode=e.view.getProjectionMode(),this.measureData=JSON.stringify(e.measureManager.exportMarkup()),this.selectedNodes=function(e){for(var t=[],i=e.selectionManager.getResults(),n=0;n<i.length;n++)t.push(i[n].getNodeId());return t}(e)},copy:function(e){this.isolateNode=e.isolateNode,this.cadView=e.cadView,this.sheet=e.sheet,this.explode=e.explode,this.drawMode=e.drawMode,this.ambientOcclusion=e.ambientOcclusion,this.bloom=e.bloom,this.projectionMode=e.projectionMode,this.selectedNodes=e.selectedNodes},serialize:function(){return{isolateNode:this.isolateNode,cadView:this.cadView,sheet:this.sheet,explode:this.explode,drawMode:this.drawMode,ambientOcclusion:this.ambientOcclusion,bloom:this.bloom,projectionMode:this.projectionMode,selectedNodes:this.selectedNodes,camera:null!=this.camera?this.camera.toJson():void 0}},saveCamera:function(e){this.camera=e},getCamera:function(){return this.camera},apply:function(e){var t=this;return new Promise((function(i,n){null!=t.explode?e.explodeManager.setMagnitude(t.explode).then((function(){i()})):null!=t.isolateNode?"number"==typeof t.isolateNode?e.view.isolateNodes([t.isolateNode],0).then((function(){i()})):e.view.isolateNodes(t.isolateNode,0).then((function(){i()})):null!=t.cadView?e.model.activateCadView(t.cadView,0).then((function(){i()})):null!=t.sheet?e.view.isolateNodes([t.sheet],0).then((function(){i()})):i()}))},activate:function(e){var t=this;return new Promise((function(i,n){e.selectionManager.setNodeSelectionColor(new Communicator.Color(255,0,0)),e.selectionManager.setNodeElementSelectionColor(new Communicator.Color(255,0,0)),e.selectionManager.setNodeSelectionOutlineColor(new Communicator.Color(255,0,0)),e.view.setAmbientOcclusionEnabled(!1),e.view.setBloomEnabled(!1),e.view.setBackfacesVisible(!0),e.explodeManager.setMagnitude(0);var s=e.view.getHiddenLineSettings();e.sheetManager.setBackgroundSheetEnabled(!1),s.setObscuredLineOpacity(0),e.view.setDrawMode(Communicator.DrawMode.WireframeOnShaded),e.measureManager.removeAllMeasurements(),e.setMinimumFramerate(S.minFramerate),e.selectionManager.clear(),e.reset(0).then((function(){if(null!=t.drawMode&&e.view.setDrawMode(t.drawMode),null!=t.ambientOcclusion&&e.view.setAmbientOcclusionEnabled(t.ambientOcclusion),null!=t.bloom&&e.view.setBloomEnabled(t.bloom),null!=t.projectionMode&&e.view.setProjectionMode(t.projectionMode),null!=t.measureData&&e.measureManager.loadData(JSON.parse(t.measureData)),null!=t.selectedNodes)for(var n=0;n<t.selectedNodes.length;n++)e.selectionManager.selectNode(t.selectedNodes[n],Communicator.SelectionMode.Add);null!=t.isolateNode?"number"==typeof t.isolateNode?e.view.isolateNodes([t.isolateNode],0).then((function(){e.view.setCamera(t.camera,0),i()})):e.view.isolateNodes(t.isolateNode,0).then((function(){e.view.setCamera(t.camera,0),i()})):null!=t.sheet?e.view.isolateNodes([t.sheet],0).then((function(){e.view.setCamera(t.camera,0),i()})):null!=t.cadView?e.model.activateCadView(t.cadView,0).then((function(){e.view.setCamera(t.camera,0),i()})):null!=t.explode?e.explodeManager.setMagnitude(t.explode).then((function(){e.view.setCamera(t.camera,0),i()})):(null!=t.camera&&e.view.setCamera(t.camera,0),i())}))}))}}}class v{constructor(e){this._viewer=e,this._bounding=null,this._mouseDownSelection=null,this._mouseButton=null,this._partinfo=[],this._click=!1,this._whiteboarditem=null,this._factor=4,this._connectedWindow=void 0,this._magDone=void 0}setItem(e){this._whiteboarditem=e}onMouseDown(e){if(this._click=!0,this._magDone=void 0,this._connectedWindow=void 0,this._mouseButton=e.getButton(),this._mouseButton===Communicator.Button.Left&&e.shiftDown())for(var t=this._whiteboarditem.getConnectedWindows(),i=e.getPosition(),n=wbMain.getZoomFactor(),s=0;s<t.length;s++){var r=t[s].position,o=void 0;if(null!=r&&(o={left:r.left*n,top:r.top*n,radius:r.radius*n}),null==o||i.x>o.left-o.radius&&i.x<o.left+o.radius&&i.y>o.top-o.radius&&i.y<o.top+o.radius){this._connectedWindow=s,this._magDone=!0;break}}}onMouseUp(e){null!=this._magDone&&(e.setHandled(!0),this._magDone=void 0,this._click=!1)}onMousewheel(e){e.shiftDown()&&(e.getWheelDelta()>0?this._factor-=2:this._factor+=2,this._factor<1&&(this._factor=1),this.doPick(e),e.setHandled(!0))}doPick(e){var t=this,i=(e.getPosition().copy(),new Communicator.PickConfig(Communicator.SelectionMask.All));this._viewer.view.pickFromPoint(e.getPosition(),i).then((function(e){var i=e.getPosition();if(null!=i){var n=t._viewer.view.getCamera().copy(),s=n.getPosition().copy(),r=n.getTarget().copy(),o=n.getUp().copy(),a=n.getWidth(),d=n.getHeight(),h=Communicator.Point3.subtract(r,s),l=h.length();h.normalize();var c=Communicator.Point3.cross(o,h);l/=t._factor;var g=new Communicator.Point3(s.x-h.x*l,s.y-h.y*l,s.z-h.z*l),u=Communicator.Point3.subtract(s,i);n.setTarget(i),n.setPosition(new Communicator.Point3(g.x-u.x,g.y-u.y,g.z-u.z)),a/=t._factor,d/=t._factor,n.setWidth(a),n.setHeight(d),c.scale(a/2),o.scale(d/2);var m=Communicator.Point3.add(i,c),p=Communicator.Point3.add(i,o),f=t._viewer.view.projectPoint(m),v=(t._viewer.view.projectPoint(p),t._viewer.view.projectPoint(i)),w=wbMain.getZoomFactor(),x=t._whiteboarditem.getConnectedWindows();x[t._connectedWindow].position={left:v.x/w,top:v.y/w,radius:(v.x-f.x)/w};var y=x[t._connectedWindow].whiteboarditem.getHWV();null!=y&&y.view.setCamera(n,0),wbMain.redraw()}}))}onMouseMove(e){e.shiftDown()&&this._mouseButton===Communicator.Button.Left&&null!=this._connectedWindow&&null!=this._magDone&&(this.doPick(e),e.setHandled(!0))}onTouchStart(e){}onTouchMove(e){}onTouchEnd(e){}onKeyDown(e){}onKeyUp(e){}onDeactivate(){}onActivate(){}onViewOrientationChange(){}stopInteraction(){}}function w(){var e,t,i,n;function s(t,i,n){var r=e.model.getNodeChildren(t);0==r.length&&i.push(function(t,i){return new Promise((function(n,s){e.model.getMeshIds([t]).then((function(e){e.length>0&&(i[e[0][1]]=t),n()}))}))}(t,n));for(var o=0;o<r.length;o++)s(r[o],i,n)}return{initialize:function(e,n){t=e,i=n;var s='<div id="'+this.getDiv()+'" style="overflow:hidden"></div>\n';$("#"+x.getOffscreenContainer()).append(s)},activateHWV:function(i,s,r){if($("#"+i).append($("#"+this.getDiv())),null==e){var o=this.getDiv();if($("#"+o).empty(),0==x.getSCSLoading())a={containerId:o,endpointUri:"ws://localhost:11180?renderingLocation=csr",model:t,rendererType:0,streamingMode:1,memoryLimit:0,boundingPreviewMode:Communicator.BoundingPreviewMode.None};else var a={containerId:o,endpointUri:"models\\"+t+".scs"};Sample._applyExtraProperties(a),e=new Communicator.WebViewer(a);var d=this;e.setCallbacks({sceneReady:function(){var t=new v(d.getHWV());t.setItem(s),d.sethcMagnifierOperatorHandle(t),e.operatorManager.push(n)},modelStructureReady:r}),e.start()}else e.operatorManager.getOperator(n).setItem(s),e.resizeCanvas(),r()},sethcMagnifierOperatorHandle:function(e){n=this.getHWV().registerCustomOperator(e)},findUniqueMeshes:function(){return new Promise((function(t,i){var n=[],r=[];s(e.model.getRootNode(),n,r),Promise.all(n).then((function(){t(r)}))}))},deactivateHWV:function(){$("#"+x.getOffscreenContainer()).append($("#"+this.getDiv()))},getHWV:function(){return e},getDiv:function(){return null==i?"hc-"+t:"hc-"+t+i}}}let x=new function(){var e,t=[],i=!0;return{initialize:function(t){e=t},getModel:function(e,i){return null!=t[e+i]?t[e+i]:null==t[e]?(t[e]=new w,t[e].initialize(e),t[e]):function(e,t){for(var i=U.getItems(),n=0;n<i.length;n++)if(i[n].getType()==l.wbItemHC&&1==i[n].getActive()&&i[n].getGUID()!=t&&i[n].getModelName()==e)return!0;return!1}(e,i)?(t[e+i]=new w,t[e+i].initialize(e,i),t[e+i]):t[e]},getOffscreenContainer:function(){return e},setSCSLoading(e){i=e},getSCSLoading:()=>i}};const y={left:0,right:1,top:2,bottom:3,center:4};function b(e){return e*e}function _(e,t){return b(e.x-t.x)+b(e.y-t.y)}class I extends g{static lineSnapItem=void 0;static newLineMode=void 0;static pickTolerance=15;static setNewLineMode(e){I.newLineMode=e}static distToSegment(e,t,i){return Math.sqrt(function(e,t,i){var n=_(t,i);if(0==n)return _(e,t);var s=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return s=Math.max(0,Math.min(1,s)),_(e,{x:t.x+s*(i.x-t.x),y:t.y+s*(i.y-t.y)})}(e,t,i))}static checkAndStartNewLine(e,t){if(null!=I.newLineMode){var i;(i=0==I.newLineMode?new I(new Communicator.Point2(e.x,e.y),new Communicator.Point2(e.x,e.y)):1==I.newLineMode?new C(new Communicator.Point2(e.x,e.y),new Communicator.Point2(e.x,e.y)):new T(new Communicator.Point2(e.x,e.y),new Communicator.Point2(e.x,e.y))).initialize(),null!=t&&i.setSnapItem(0,t,y.center);var n=new P(D.dragLinePoint);return I.addLine(i),n.extra={line:i,pointinfo:{id:1,isCandidate:!1}},I.newLineMode=void 0,n}}static addLine(e){U.getItems().push(e)}static deletePointFromDoubleClick(e){var t=I.pickTolerance/U.getZoomFactor(),i=I.getSingleSelectedLine();if(null!=i){var n=i.findSelection(e,t);if(null!=n&&(null==n.isCandidate||0==n.isCandidate))return i.deletePoint(n.id),!0}return!1}static getSingleSelectedLine(){var e=U.getCachedSelectedItems();return 1==e.length&&e[0].getType()==l.wbLine?e[0]:void 0}static checkAndStartLinePointSelection(e){var t=I.pickTolerance/U.getZoomFactor(),i=I.getSingleSelectedLine();if(null!=i){var n=i.findSelection(e,t);if(null!=n){var s=new P(D.dragLinePoint);return s.extra={line:i,pointinfo:n},s}}}static dragLinePointSelection(e,t){return null!=t&&t.type==D.dragLinePoint&&(t.extra.line.dragPoint(t.extra.pointinfo,e,U.getZoomFactor(),!0),U.redraw(),!0)}static finalizePointDrag(e){null!=e&&e.type==D.dragLinePoint&&e.extra.line.finalizePointDrag(e)}static updateAllSnappedLinePoints(){for(var e=U.getCachedLineItems(),t=0;t<e.length;t++)null!=e[t].snapItems[0]&&e[t].updateSnappedLinePoints(0),null!=e[t].snapItems[1]&&e[t].updateSnappedLinePoints(1)}static updateAllLineData(){for(var e=U.getCachedLineItems(),t=0;t<e.length;t++)e[t].recalculateLineData()}constructor(e,t){super(),this.shadowWidth=0,this._type=l.wbLine,this.lineType=0,this.points=[],this.pointCandidates=[],this.points.push(e),this.points.push(t),this.drawStartArrow=!1,this.drawEndArrow=!0,this.borderWidth=3,this.snapItems=[void 0,void 0]}initialize(){this.recalculateLineData()}finalizePointDrag(e){}setDrawArrows(e,t){this.drawStartArrow=e,this.drawEndArrow=t}setFromJSON(e){super.setFromJSON(e),this.lineType=e.lineType,this.points=e.points,this.drawStartArrow=e.drawStartArrow,this.drawEndArrow=e.drawEndArrow,this.snapItems=e.snapItems,null==this.snapItems[0]&&(this.snapItems[0]=void 0),null==this.snapItems[1]&&(this.snapItems[1]=void 0)}serialize(){var e=super.serialize();return e.points=this.points,e.drawStartArrow=this.drawStartArrow,e.drawEndArrow=this.drawEndArrow,e.lineType=this.lineType,e.snapItems=[void 0,void 0],e.snapItems[0]=null!=this.snapItems[0]?{item:this.snapItems[0].item._guid,position:this.snapItems[0].position}:void 0,e.snapItems[1]=null!=this.snapItems[1]?{item:this.snapItems[1].item._guid,position:this.snapItems[1].position}:void 0,e}setSnapItem(e,t,i){this.snapItems[e]={item:t,position:i}}move(e,t,i){var n=this.getDimensions();if(i)for(var s=0;s<this.points.length;s++)this.points[s].x+=e,this.points[s].y+=t;else{var r=n.left-e,o=n.top-t;for(s=0;s<this.points.length;s++)this.points[s].x-=r,this.points[s].y-=o}super.move(e,t,i)}scale(e){for(var t=this.getDimensions(),i=t.width/e.width,n=t.height/e.height,s=t.left-e.left,r=t.top-e.top,o=0;o<this.points.length;o++){var a=this.points[o].x-t.left,d=this.points[o].y-t.top;this.points[o].x=t.left+a/i,this.points[o].y=t.top+d/n,this.points[o].x-=s,this.points[o].y-=r}this.recalculateLineData(),this._dimensions=e}recalculateBounding(){for(var e=this.getDimensions(),t={x1:Number.MAX_VALUE,y1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=0;i<this.points.length;i++)t.x1>this.points[i].x&&(t.x1=this.points[i].x),t.x2<this.points[i].x&&(t.x2=this.points[i].x),t.y1>this.points[i].y&&(t.y1=this.points[i].y),t.y2<this.points[i].y&&(t.y2=this.points[i].y);e.left=t.x1-25,e.top=t.y1-25,e.width=t.x2-t.x1+50,e.height=t.y2-t.y1+50}recalculateLineData(){this.recalculateBounding(),this.calculatePointCandidates()}calculatePointCandidates(){this.pointCandidates=[];for(var e=0;e<this.points.length-1;e++)this.pointCandidates.push(new Communicator.Point2((this.points[e].x+this.points[e+1].x)/2,(this.points[e].y+this.points[e+1].y)/2))}addPoint(e){this.points.push(e)}deletePoint(e){this.points.length>2&&(this.points.splice(e,1),this.recalculateLineData())}findSelection(e,t){for(var i=0;i<this.points.length;i++)if(e.x>=this.points[i].x-t&&e.x<=this.points[i].x+t&&e.y>=this.points[i].y-t&&e.y<=this.points[i].y+t)return{id:i,isCandidate:!1,hor:this.points[i].hor,pt:this.points[i]};for(i=0;i<this.pointCandidates.length;i++)if(e.x>=this.pointCandidates[i].x-t&&e.x<=this.pointCandidates[i].x+t&&e.y>=this.pointCandidates[i].y-t&&e.y<=this.pointCandidates[i].y+t)return null==this.pointCandidates[i].insertId?{id:i,isCandidate:!0,hor:this.pointCandidates[i].hor,pt:this.pointCandidates[i]}:{id:this.pointCandidates[i].insertId,isCandidate:!0,hor:this.pointCandidates[i].hor,pt:this.pointCandidates[i]}}dragPoint(e,t){if(1==e.isCandidate)this.points.splice(e.id+1,0,new Communicator.Point2(t.x,t.y)),e.isCandidate=!1,e.id=e.id+1;else{if(0==e.id||e.id==this.points.length-1){var i=this.snapToWindow(t,e.id);if(null!=i)return this.points[e.id].x=i.x,this.points[e.id].y=i.y,void this.recalculateLineData()}this.points[e.id].x=t.x,this.points[e.id].y=t.y}this.setDirty(),this.recalculateLineData()}checkClose(e,t,i,n,s){return e>=i-s&&e<=i+s&&t>=n-s&&t<=n+s}adjustEndPoint(e){}updateSnappedLinePoints(e){this.setDirty();var t,i,n=this.snapItems[e],s=n.item.getDimensions();if(n.position==y.left)t=s.left,i=s.top+s.height/2;else if(n.position==y.right)t=s.left+s.width,i=s.top+s.height/2;else if(n.position==y.top)t=s.left+s.width/2,i=s.top;else if(n.position==y.bottom)t=s.left+s.width/2,i=s.top+s.height;else if(n.position==y.center){var r=this.updateCenterSnap(e);t=r.x,i=r.y}0==e?(this.points[0].x=t,this.points[0].y=i,this.adjustEndPoint(0)):(this.points[this.points.length-1].x=t,this.points[this.points.length-1].y=i,this.adjustEndPoint(1))}updateCenterSnap(e){var t,i,n,s,r,o=this.snapItems[e].item;0==e?(n=this.points[1].x,s=this.points[1].y):(n=this.points[this.points.length-2].x,s=this.points[this.points.length-2].y);var a=o.getDimensions();t=a.left,i=a.top+a.height/2;var d=y.left;r=Math.sqrt(Math.pow(t-n,2)+Math.pow(i-s,2));var h=a.left+a.width,l=a.top+a.height/2,c=Math.sqrt(Math.pow(h-n,2)+Math.pow(l-s,2));return c<r&&(r=c,t=h,i=l,d=y.right),h=a.left+a.width/2,l=a.top,(c=Math.sqrt(Math.pow(h-n,2)+Math.pow(l-s,2)))<r&&(r=c,t=h,i=l,d=y.top),h=a.left+a.width/2,l=a.top+a.height,(c=Math.sqrt(Math.pow(h-n,2)+Math.pow(l-s,2)))<r&&(r=c,t=h,i=l,d=y.bottom),{x:t,y:i,position:d}}snapToWindow(e,t){var i,n=25/U.getZoomFactor();I.lineSnapItem&&(I.lineSnapItem.isLineSnapItem=!1,I.lineSnapItem=void 0),i=t==this.points.length-1?1:0,this.snapItems[i]=void 0;for(var s=U.getItems(),r=0;r<s.length;r++)if(s[r].getType()!=l.wbLine&&s[r].pointInsideItemWithTolerance(e,35)){I.lineSnapItem&&(I.lineSnapItem.isLineSnapItem=!1),s[r].isLineSnapItem=!0,I.lineSnapItem=s[r],s[r].isLineSnapItem=!0;var o=s[r].getDimensions(),a=o.left,d=o.top+o.height/2;if(this.checkClose(e.x,e.y,a,d,n))return this.snapItems[i]={item:s[r],position:y.left},{x:a,y:d};if(a=o.left+o.width,d=o.top+o.height/2,this.checkClose(e.x,e.y,a,d,n))return this.snapItems[i]={item:s[r],position:y.right},{x:a,y:d};if(a=o.left+o.width/2,d=o.top,this.checkClose(e.x,e.y,a,d,n))return this.snapItems[i]={item:s[r],position:y.top},{x:a,y:d};if(a=o.left+o.width/2,d=o.top+o.height,this.checkClose(e.x,e.y,a,d,n))return this.snapItems[i]={item:s[r],position:y.bottom},{x:a,y:d};if(a=o.left+o.width/2,d=o.top+o.height/2,this.checkClose(e.x,e.y,a,d,n))return this.snapItems[i]={item:s[r],position:y.center},{x:a,y:d}}}pointInsideItem(e){if(super.pointInsideItem(e))for(var t=0;t<this.points.length-1;t++)if(I.distToSegment(e,this.points[t],this.points[t+1])<5)return!0;return!1}arrowLine(e,t){var i=Communicator.Point2.subtract(t,e),n=Communicator.Point2.distance(t,e);return i.x/=n,i.y/=n,new Communicator.Point2(e.x+i.x*this.borderWidth,e.y+i.y*this.borderWidth)}render(e){if(this.renderPre(e),e.save(),e.lineJoin="round",e.fillStyle=this.borderColor,this.points.length,e.beginPath(),this.drawStartArrow){var t=this.arrowLine(this.points[0],this.points[1]);e.moveTo(t.x,t.y)}else e.moveTo(this.points[0].x,this.points[0].y);for(var i=1;i<this.points.length-1;i++)e.lineTo(this.points[i].x,this.points[i].y);this.drawEndArrow?(t=this.arrowLine(this.points[this.points.length-1],this.points[this.points.length-2]),e.lineTo(t.x,t.y)):e.lineTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y),e.stroke(),this.renderPost(e)}renderPost(e){this.drawPoints(e),this.drawArrows(e),e.restore()}drawPoints(e){if(this.getSelected()&&1==U.getCachedSelectedItems().length){e.save(),e.setLineDash([]),e.strokeStyle="rgb(0,0,0)",e.fillStyle="rgb(255,255,255)",this.drawPoint(e,this.points[0],5);for(var t=1;t<this.points.length;t++)this.drawPoint(e,this.points[t],5);for(e.strokeStyle="rgb(255,255,255)",e.fillStyle="rgb(160, 160, 255)",t=0;t<this.pointCandidates.length;t++)this.drawPoint(e,this.pointCandidates[t],5);e.restore()}}drawArrows(e){this.drawStartArrow&&this.drawLineWithArrows(e,this.points[1],this.points[0],7,13,!0,!1),this.drawEndArrow&&this.drawLineWithArrows(e,this.points[this.points.length-2],this.points[this.points.length-1],7,13,!0,!1)}drawLineWithArrows(e,t,i,n,s,r,o){this.borderWidth<4?(n=7,s=13):(n=2*this.borderWidth*.9,s=4*this.borderWidth*.9);var a=t.x-i.x,d=t.y-i.y,h=Math.atan2(d,a);Math.sqrt(a*a+d*d),e.save(),e.translate(i.x,i.y),e.rotate(h),e.beginPath(),e.moveTo(s,-n),e.lineTo(0,0),e.lineTo(s,n),e.lineTo(s,-n),e.fill(),e.restore()}}class C extends I{constructor(e,t){super(e,t),this.lineType=1,this.cp=[],this.curveSubdivisions=20}setFromJSON(e){super.setFromJSON(e),this.cp=e.cp}serialize(){var e=super.serialize();return e.cp=this.cp,e}recalculateLineData(){this.fitControlPoints(),super.recalculateLineData()}updateCenterSnap(e){var t=super.updateCenterSnap(e);return this.adjustSnapCurve(e,t.position),t}adjustSnapCurve(e,t){var i,n,s,r=100;1==e&&(i=this.snapItems[1],n=this.cp[this.cp.length-2]),0==e&&(i=this.snapItems[0],n=this.cp[1]),s=null!=t?t:i.position;var o=i.item.getDimensions(),a=o.left+o.width/2,d=o.top+o.height/2;s==y.left?(n.x=o.left-r,n.y=d):s==y.right?(n.x=o.left+o.width+r,n.y=d):s==y.top?(n.x=a,n.y=o.top-r):s==y.bottom&&(n.x=a,n.y=o.top+o.height+r)}fitControlPoints(){if(!U.ctrlPressed){this.cp=[];for(var e=0;e<this.points.length;e++)0==e?this.cp=this.cp.concat(this.fitControlPointSet(this.points[0],this.points[0],this.points[1],.3)):e==this.points.length-1?this.cp=this.cp.concat(this.fitControlPointSet(this.points[e-1],this.points[e],this.points[e],.3)):this.cp=this.cp.concat(this.fitControlPointSet(this.points[e-1],this.points[e],this.points[e+1],.3));null!=this.snapItems[1]&&(this.snapItems[1].position==y.center?this.updateCenterSnap(1):this.adjustSnapCurve(1)),null!=this.snapItems[0]&&(this.snapItems[0].position==y.center?this.updateCenterSnap(0):this.adjustSnapCurve(0))}}bezierCurveToTessellated(e,t,i,n,s,r,o,a){for(var d=[],h=[[e,t],[i,n],[s,r],[o,a]],l=0;l<=this.curveSubdivisions;l++){var c,g,u,m,p,f,v,w,x=l/this.curveSubdivisions;u=3*(h[1][0]-h[0][0]),g=3*(h[2][0]-h[1][0])-u,c=h[3][0]-h[0][0]-u-g,f=3*(h[1][1]-h[0][1]),p=3*(h[2][1]-h[1][1])-f,m=h[3][1]-h[0][1]-f-p;var y=c*(w=(v=x*x)*x)+g*v+u*x+h[0][0],b=m*w+p*v+f*x+h[0][1];d.push(new Communicator.Point2(y,b))}return d}calculatePointCandidates(){this.pointCandidates=[];for(var e=0;e<this.points.length-1;e++){var t=this.points[e],i=this.points[e+1];if(e<this.points.length-1){var n=this.bezierCurveToTessellated(t.x,t.y,this.cp[2*e+1].x,this.cp[2*e+1].y,this.cp[2*e+2].x,this.cp[2*e+2].y,i.x,i.y)[this.curveSubdivisions/2];n.insertId=e,this.pointCandidates.push(n)}}}pointInsideItem(e){var t=this.getDimensions();if(e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height)for(var i=0;i<this.points.length-1;i++){var n=this.points[i],s=this.points[i+1];if(i<this.points.length-1)for(var r=this.bezierCurveToTessellated(n.x,n.y,this.cp[2*i+1].x,this.cp[2*i+1].y,this.cp[2*i+2].x,this.cp[2*i+2].y,s.x,s.y),o=0;o<r.length-1;o++)if(I.distToSegment(e,r[o],r[o+1])<5)return!0}return!1}fitControlPointSet(e,t,i,n){var s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=n*s/(s+Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))),o=n-r,a=t.x+r*(e.x-i.x),d=t.y+r*(e.y-i.y),h=t.x-o*(e.x-i.x),l=t.y-o*(e.y-i.y);return[new Communicator.Point2(a,d),new Communicator.Point2(h,l)]}render(e){this.renderPre(e),e.save(),e.fillStyle=this.borderColor,this.points.length,e.beginPath();for(var t=0;t<this.points.length-1;t++){var i=this.points[t],n=this.points[t+1],s=i,r=n;if(0==t||t==this.points.length-2){if(0==t&&1==this.drawStartArrow){var o=Communicator.Point2.subtract(this.cp[1],i),a=Communicator.Point2.distance(this.cp[1],i);o.x/=a,o.y/=a,s=new Communicator.Point2(i.x+o.x*this.borderWidth,i.y+o.y*this.borderWidth)}t==this.points.length-2&&1==this.drawEndArrow&&(o=Communicator.Point2.subtract(this.cp[this.cp.length-2],n),a=Communicator.Point2.distance(this.cp[this.cp.length-2],n),o.x/=a,o.y/=a,r=new Communicator.Point2(n.x+o.x*this.borderWidth,n.y+o.y*this.borderWidth))}e.moveTo(s.x,s.y),t<this.points.length-1&&e.bezierCurveTo(this.cp[2*t+1].x,this.cp[2*t+1].y,this.cp[2*t+2].x,this.cp[2*t+2].y,r.x,r.y)}e.stroke(),e.closePath(),this.renderPost(e)}move(e,t,i){super.move(e,t,i),this.fitControlPoints()}updateSnappedLinePoints(e){super.updateSnappedLinePoints(e),this.fitControlPoints()}drawArrows(e){this.drawStartArrow&&this.drawLineWithArrows(e,this.cp[1],this.points[0],7,13,!0,!1),this.drawEndArrow&&this.drawLineWithArrows(e,this.cp[this.cp.length-2],this.points[this.points.length-1],7,13,!0,!1)}}class T extends I{constructor(e,t){super(e,t),this.lineType=2,this.segments=[],this.segments.push({point1:void 0,point2:void 0,pt:void 0,isCandidate:!0}),this.segments.push({point1:void 0,point2:void 0,pt:void 0,isCandidate:!0}),this.segments.push({point1:void 0,point2:void 0,pt:void 0,isCandidate:!0}),this.start=!0}setFromJSON(e){super.setFromJSON(e),this.segments=e.segments}serialize(){var e=super.serialize();return e.segments=this.segments,e}findSelection(e,t){for(var i=0;i<this.segments.length;i++)if(e.x>=this.segments[i].pt.x-t&&e.x<=this.segments[i].pt.x+t&&e.y>=this.segments[i].pt.y-t&&e.y<=this.segments[i].pt.y+t)return{id:i,isSegment:!0};for(i=0;i<this.points.length;i++)if(e.x>=this.points[i].x-t&&e.x<=this.points[i].x+t&&e.y>=this.points[i].y-t&&e.y<=this.points[i].y+t)return{id:i,isSegment:!1}}deletePoint(e){e>1&&(0==this.segments[e].hor?(this.segments[e-2].point2.x=this.segments[e].point2.x,this.segments[e+1].point1=this.segments[e-2].point2):(this.segments[e-2].point2.y=this.segments[e].point2.y,this.segments[e+1].point1=this.segments[e-2].point2)),this.segments.splice(e,1),this.segments.splice(e-1,1),this.recalculateLineData()}adjustEndPoint(e){if(1==e){var t=this.points[1];this.segments[this.segments.length-1].point2.x=t.x,this.segments[this.segments.length-1].point2.y=t.y,1==this.segments[this.segments.length-1].hor?this.segments[this.segments.length-1].point1.x=t.x:this.segments[this.segments.length-1].point1.y=t.y}else t=this.points[0],this.segments[0].point1.x=t.x,this.segments[0].point1.y=t.y,1==this.segments[0].hor?this.segments[0].point2.x=t.x:this.segments[0].point2.y=t.y}dragPoint(e,t){if(null==e.isCandidate&&1==this.segments[e.id].isCandidate&&1==e.isSegment){var i;this.segments[e.id].isCandidate=!1,e.id==this.segments.length-1&&((i={point1:void 0,point2:void 0,pt:void 0,isCandidate:!0}).point1=this.segments[this.segments.length-1].point2,i.point2=this.segments[this.segments.length-1].point2.copy(),i.hor=!this.segments[this.segments.length-1].hor,this.segments.push(i),this.segments[e.id].isCandidate=!1),0==e.id&&((i={point1:void 0,point2:void 0,pt:void 0,isCandidate:!0}).point1=this.segments[0].point1.copy(),i.point2=this.segments[0].point1,i.hor=!this.segments[0].hor,this.segments.splice(0,0,i),e.id=1),this.start=!1}else{if(null!=e.isCandidate||0==e.isSegment){var n=this.snapToWindow(t,e.id);null!=n&&(t=n),this.points[e.id].x=t.x,this.points[e.id].y=t.y,0==e.isSegment&&this.adjustEndPoint(e.id)}if(1==e.isSegment){var s=this.segments[e.id];1==s.hor?(s.pt.x=t.x,s.point1.x=t.x,s.point2.x=t.x):(s.pt.y=t.y,s.point1.y=t.y,s.point2.y=t.y)}}this.recalculateLineData()}calculateSteps(e){if(this.points[0].x,this.points[0].y,1==this.start){this.segments[0].point1=new Communicator.Point2(this.points[0].x,this.points[0].y),this.segments[0].point2=new Communicator.Point2((this.points[0].x+this.points[1].x)/2,this.points[0].y),this.segments[0].hor=!1,this.segments[1].point1=this.segments[0].point2,this.segments[1].point2=new Communicator.Point2((this.points[0].x+this.points[1].x)/2,this.points[1].y),this.segments[1].hor=!0,this.segments[2].point1=this.segments[1].point2,this.segments[2].point2=new Communicator.Point2(this.points[1].x,this.points[1].y),this.segments[2].hor=!1;for(var t=0;t<this.segments.length;t++)this.segments[t].pt=new Communicator.Point2((this.segments[t].point1.x+this.segments[t].point2.x)/2,(this.segments[t].point1.y+this.segments[t].point2.y)/2)}else{for(t=0;t<this.segments.length;t++)this.segments[t].pt=new Communicator.Point2((this.segments[t].point1.x+this.segments[t].point2.x)/2,(this.segments[t].point1.y+this.segments[t].point2.y)/2);this.points[0]=this.segments[0].point1.copy(),this.points[1]=this.segments[this.segments.length-1].point2.copy()}}addCandidate(e,t,i,n){var s=new Communicator.Point2((e.x+t.x)/2,(e.y+t.y)/2);s.insertId=n,s.hor=i,this.pointCandidates.push(s)}render(e){if(this.renderPre(e),e.save(),e.fillStyle=this.borderColor,this.points.length,this.calculateSteps(!1),e.beginPath(),this.drawStartArrow){var t=this.arrowLine(this.segments[0].point1,this.segments[1].point1);e.moveTo(t.x,t.y)}else e.moveTo(this.segments[0].point1.x,this.segments[0].point1.y);for(var i=1;i<this.segments.length;i++)e.lineTo(this.segments[i].point1.x,this.segments[i].point1.y);this.drawEndArrow?(t=this.arrowLine(this.segments[this.segments.length-1].point2,this.segments[this.segments.length-1].point1),e.lineTo(t.x,t.y)):e.lineTo(this.segments[this.segments.length-1].point2.x,this.segments[this.segments.length-1].point2.y),e.stroke(),e.closePath(),this.renderPost(e)}calculatePointCandidates(){this.calculateSteps(!0)}scale(e){for(var t=this.getDimensions(),i=t.width/e.width,n=t.height/e.height,s=t.left-e.left,r=t.top-e.top,o=0;o<this.points.length;o++){var a=this.points[o].x-t.left,d=this.points[o].y-t.top;this.points[o].x=t.left+a/i,this.points[o].y=t.top+d/n,this.points[o].x-=s,this.points[o].y-=r}var h=void 0;for(o=0;o<this.segments.length;o++)h!=this.segments[o].point1&&(a=this.segments[o].point1.x-t.left,d=this.segments[o].point1.y-t.top,this.segments[o].point1.x=t.left+a/i,this.segments[o].point1.y=t.top+d/n,this.segments[o].point1.x-=s,this.segments[o].point1.y-=r,h=this.segments[o].point1),h!=this.segments[o].point2&&(a=this.segments[o].point2.x-t.left,d=this.segments[o].point2.y-t.top,this.segments[o].point2.x=t.left+a/i,this.segments[o].point2.y=t.top+d/n,this.segments[o].point2.x-=s,this.segments[o].point2.y-=r,h=this.segments[o].point2);this.recalculateLineData(),this._dimensions=e}move(e,t,i){var n=this.getDimensions(),s=n.left-e,r=n.top-t;i&&(s=-e,r=-t);for(var o=0;o<this.points.length;o++)this.points[o].x-=s,this.points[o].y-=r;var a=void 0;for(o=0;o<this.segments.length;o++)a!=this.segments[o].point1&&(this.segments[o].point1.x-=s,this.segments[o].point1.y-=r,a=this.segments[o].point1),a!=this.segments[o].point2&&(this.segments[o].point2.x-=s,this.segments[o].point2.y-=r,a=this.segments[o].point2);i?(this._dimensions.left+=e,this._dimensions.top+=t):(this._dimensions.left=e,this._dimensions.top=t),this.refreshPositioning()}updateCenterSnap(e){var t,i,n,s,r,o=Number.MAX_VALUE,a=this.snapItems[e].item;0==e?(n=this.segments[0].point2.x,s=this.segments[0].point2.y,r=this.segments[0].hor):(n=this.segments[this.segments.length-1].point1.x,s=this.segments[this.segments.length-1].point1.y,r=this.segments[this.segments.length-1].hor),t=Number.MAX_VALUE,i=Number.MAX_VALUE;var d=a.getDimensions();if(r)l=d.left+d.width/2,c=d.top,(h=Math.sqrt(Math.pow(l-n,2)+Math.pow(c-s,2)))<o&&(o=h,t=l,i=c),l=d.left+d.width/2,c=d.top+d.height,(h=Math.sqrt(Math.pow(l-n,2)+Math.pow(c-s,2)))<o&&(o=h,t=l,i=c);else{l=d.left,c=d.top+d.height/2,(h=Math.sqrt(Math.pow(l-n,2)+Math.pow(c-s,2)))<o&&(o=h,t=l,i=c);var h,l=d.left+d.width,c=d.top+d.height/2;(h=Math.sqrt(Math.pow(l-n,2)+Math.pow(c-s,2)))<o&&(o=h,t=l,i=c)}return{x:t,y:i}}recalculateBounding(){for(var e=this.getDimensions(),t={x1:Number.MAX_VALUE,y1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=0;i<this.segments.length;i++)null!=this.segments[i].point1&&(t.x1>this.segments[i].point1.x&&(t.x1=this.segments[i].point1.x),t.x2<this.segments[i].point1.x&&(t.x2=this.segments[i].point1.x),t.y1>this.segments[i].point1.y&&(t.y1=this.segments[i].point1.y),t.y2<this.segments[i].point1.y&&(t.y2=this.segments[i].point1.y));null!=this.segments[0].point1&&(t.x1>this.segments[this.segments.length-1].point2.x&&(t.x1=this.segments[this.segments.length-1].point2.x),t.x2<this.segments[this.segments.length-1].point2.x&&(t.x2=this.segments[this.segments.length-1].point2.x),t.y1>this.segments[this.segments.length-1].point2.y&&(t.y1=this.segments[this.segments.length-1].point2.y),t.y2<this.segments[this.segments.length-1].point2.y&&(t.y2=this.segments[this.segments.length-1].point2.y)),e.left=t.x1-25,e.top=t.y1-25,e.width=t.x2-t.x1+50,e.height=t.y2-t.y1+50}pointInsideItem(e){var t=this.getDimensions();if(e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height)for(var i=0;i<this.segments.length;i++)if(I.distToSegment(e,this.segments[i].point1,this.segments[i].point2)<5)return!0;return!1}finalizePointDrag(e){for(var t=0;t<this.segments.length;t++)Math.abs(this.segments[t].point1.x-this.segments[t].point2.x)<5&&Math.abs(this.segments[t].point1.y-this.segments[t].point2.y)<5&&(t>1?(this.segments[t+1].point1=this.segments[t-1].point1,this.segments.splice(t,1),this.segments.splice(t-1,1)):(this.segments[t-1].point2=this.segments[t+1].point2,this.segments.splice(t,1),this.segments.splice(t,1)))}drawPoints(e){if(this.getSelected()&&1==U.getCachedSelectedItems().length){e.save(),e.strokeStyle="rgb(0,0,0)",e.fillStyle="rgb(255,255,255)",e.setLineDash([]);for(var t=0;t<this.segments.length;t++)0==this.segments[t].isCandidate&&this.drawPoint(e,this.segments[t].pt,3.5);for(t=0;t<this.points.length;t++)this.drawPoint(e,this.points[t],3.5);for(e.strokeStyle="rgb(255,255,255)",e.fillStyle="rgb(160, 160, 255)",t=0;t<this.segments.length;t++)1==this.segments[t].isCandidate&&this.drawPoint(e,this.segments[t].pt,3.5);e.restore()}}drawArrows(e){this.drawStartArrow&&this.drawLineWithArrows(e,this.segments[0].point2,this.segments[0].point1,7,13,!0,!1),this.drawEndArrow&&this.drawLineWithArrows(e,this.segments[this.segments.length-1].point1,this.segments[this.segments.length-1].point2,7,13,!0,!1)}}class S extends g{static keepAlive=!1;static activeHCItem;static minFramerate=10;static setDrawMode(e){U.findwbItemHCUnderMouse().getHWV().view.setDrawMode(e)}static setViewOrientation(e){U.findwbItemHCUnderMouse().getHWV().view.setViewOrientation(e)}static setAmbientOcclusion(e){U.findwbItemHCUnderMouse().getHWV().view.setAmbientOcclusionEnabled(e)}static setBloom(e){U.findwbItemHCUnderMouse().getHWV().view.setBloomEnabled(e)}static setProjectionMode(e){U.findwbItemHCUnderMouse().getHWV().view.setProjectionMode(e)}static setKeepAlive(e){S.keepAlive=e}static create(e,t){U.clearSelection(),null!=S.activeHCItem&&0==S.keepAlive?S.activeHCItem.deactivate().then((function(){S._create(e,t)})):S._create(e,t)}static async _replace(e,t){await t.shutdown(),t.setModelName(e),await t.activate()}static async replace(e,t){null!=S.activeHCItem&&0==S.keepAlive?(await S.activeHCItem.deactivate(),await S._replace(e,t)):await S._replace(e,t)}static _create(e,t){var i=U.findwbItemHCUnderMouse();if(null!=i&&null!=e&&null==t)return i.shutdown().then((function(){i.setModelName(e),i.activate()})),i;var n,s=new S;if(s.initialize(e),s.setupDiv(S.container),U.addItem(s),null!=t)n={left:t.left,top:t.top,width:t.width,height:t.height};else{var r={left:U.lastX,top:U.lastY,width:500,height:500};n=U.convertWindowToCanvasCoordinates(r)}return s.setDimensions(n),s.activate(),S.activeHCItem=s,U.redraw(),s}constructor(){super(),this._modelName="",this._hcmodel,this._type=l.wbItemHC,this._currentState=new f,this._savedoperator=1,this._inputDisabled=!1}initialize(e){super.initialize(),this.setModelName(e)}serialize(){var e=super.serialize();return e._modelName=this._modelName,e.hasImage=!0,e.currentState=this._currentState.serialize(),e}setModelName(e){this._modelName=e,this._tags[e]=!0}getModelName(){return this._modelName}getHCModel(){return this._hcmodel}setHCModel(e){this._hcmodel=e}getModelState(){return this._currentState}render(e,t){this.renderPre(e,t);var i=this.getImage(),n=this.getDimensions(),s=this.getBackgroundColor();null!=s&&this.backgroundOpacity>0&&(e.fillStyle=s,e.fillRect(n.left,n.top,n.width,n.height)),this.borderWidth>0&&this.getShape()==c.rectangle&&e.strokeRect(n.left+(this.borderWidth-1)/2,n.top+(this.borderWidth-1)/2,n.width-(this.borderWidth-1),n.height-(this.borderWidth-1)),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,null!=i&&e.drawImage(i,n.left,n.top,n.width,n.height);var r,o=this.getConnectedWindows();r=null==S.activeHCItem?e:t;for(var a=0;a<o.length;a++){var d=o[a].position;if(null!=d){r.lineWidth=1.5/e.getTransform().a,r.strokeStyle="rgb(200,200,0)",r.beginPath(),r.arc(n.left+d.left,n.top+d.top,d.radius,0,2*Math.PI),r.stroke();var h=o[a].whiteboarditem.getDimensions(),l=new Communicator.Point2(n.left+d.left,n.top+d.top),g=new Communicator.Point2(h.left+h.width/2,h.top+h.height/2),u=d.radius,m=h.width/2,p=Communicator.Point2.distance(g,l),f=Communicator.Point2.subtract(g,l);f.x/=p,f.y/=p;var v=f.copy().scale(u),w=f.copy().scale(m);r.beginPath(),r.moveTo(l.x-v.y,l.y+v.x),r.lineTo(g.x-w.y,g.y+w.x),r.stroke(),r.beginPath(),r.moveTo(l.x+v.y,l.y-v.x),r.lineTo(g.x+w.y,g.y-w.x),r.stroke()}}this.renderPost(e,t)}getHWV(){if(null!=this.getHCModel())return this.getHCModel().getHWV()}refreshPositioning(){super.refreshPositioning(),1==this.getActive()&&null!=this.getHWV()&&this.getHWV().resizeCanvas()}_setupDialog(){this.updateCircular();var e=this.getBackgroundColor();null==e&&(e="transparent");var t=U.convertCanvasToWindowCoordinates(this.getDimensions());if(null!=this.getImage()){this.getImage().width=t.width,this.getImage().height=t.height,$("#"+this.getDiv()).append(this.getImage());var i=this;setTimeout((function(){$("#"+i.getDiv()).find("img").remove()}),500)}$("#"+this.getDiv()).css({"background-color":e,display:"block",width:t.width,height:t.height,top:t.top,left:t.left,position:"absolute"})}_generateImage(){var e=this;return new Promise((function(t,i){var n=e.getDiv(),s=$("#"+n).find("canvas")[0],r=s.width,o=s.height,a=$("#"+n).width(),d=$("#"+n).height();s.width<200&&(r=s.width/(s.width/500),o=s.height/(s.width/500)),e.getHCModel().getHWV().setMinimumFramerate(0);var h=new Communicator.SnapshotConfig(r,o);if(e.getHCModel().getHWV().view.getAxisTriad().disable(),e.getHCModel().getHWV().view.getAxisTriad().disable(),e.getHCModel().getHWV().view.getNavCube().disable(),"[]"==e.getModelState().measureData){var l=$("#"+e.getDiv()).css("top");$("#"+e.getDiv()).css({width:r,height:o,top:-1e3}),e.getHCModel().getHWV().resizeCanvas(),e.getHCModel().getHWV().redraw((function(){var i=new Image;i.src=s.toDataURL({type:"image/jpeg"}),$("#"+e.getDiv()).css({width:a+"px",height:d+"px",top:l}),e.getHCModel().getHWV().resizeCanvas(),t(i)}))}else e.getHCModel().getHWV().takeSnapshot(h).then((function(e){t(e)}))}))}activate(){var e=this;return new Promise((function(t,i){1!=e.getActive()&&null!=e.getModelName()?(S.activeHCItem=e,e._setupDialog(),e.setActive(!0),e.setImage(void 0),U.redraw(),e.setHCModel(x.getModel(e.getModelName(),e.getGUID())),e.getHCModel().activateHWV(e.getDiv(),e,(function(){e.getModelState().activate(e.getHWV()).then((function(){t()}))}))):t()}))}async duplicate(){await this.deactivate();var e=new S;return super._duplicate(e),e._currentState=this._currentState.duplicate(),e._modelName=(" "+this._modelName).slice(1),e}shutdown(){var e=this;return new Promise((function(t,i){e.deactivate().then((function(){e._currentState=new f,e._connectedWindows=[],e.setImage(),t()}))}))}deactivate(){var e=this;return new Promise((function(t,i){0!=e.getActive()?(e.setActive(!1),e.getModelState().saveStatesFromHWV(e.getHWV()),e.setDirty(),e._generateImage().then((function(i){e.setImage(i),e.imageDirty=!0,e.getHCModel().deactivateHWV(),e.getGUID();var n=e.getDiv();$("#"+n).empty(),$("#"+e.getDiv()).css({display:"none"}),U.redraw(),t()}))):t()}))}setupFromState(e,t,i){var n=this;return new Promise((function(s,r){var o=e.getHWV().view.getCamera().copy();e.getModelState().saveStatesFromHWV(e.getHWV()),e.getHWV().measureManager.removeAllMeasurements(),i.apply(e.getHWV()).then((function(){var r=e.getHWV().view.getCamera().copy();e._generateImage().then((function(a){e.getHWV().reset(0).then((function(){$("#"+n.getDiv()).css({display:"none"}),null!=e.getModelState().measureData&&e.getHWV().measureManager.loadData(JSON.parse(e.getModelState().measureData)),e.getHWV().view.setCamera(o,0),e.getHWV().explodeManager.setMagnitude(0),n.setImage(a),n.imageDirty=!0,n.setDirty(),n.setDimensions(t),n.getModelState().saveCamera(r),i.drawMode=e.getHWV().view.getDrawMode(),i.ambientOcclusion=e.getHWV().view.getAmbientOcclusionEnabled(),i.bloom=e.getHWV().view.getBloomEnabled(),i.projectionMode=e.getHWV().view.getProjectionMode(),n.getModelState().copy(i),U.redraw(),n.setActive(!1),s()}))}))}))}))}_newViewerFromCurrent(e,t,i){var n=this;return new Promise((function(s,r){var o=new S;o.initialize(e),o.setupDiv(S.container),U.addItem(o),o.setupFromState(n,t,i).then((function(){s(o)}))}))}async isolateToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0),e.selectionManager.getLast().getNodeId();for(var t=[],i=e.selectionManager.getResults(),n=0;n<i.length;n++)t.push(i[n].getNodeId());e.selectionManager.clear();var s=this.getDimensions(),r=s.width/2*1.2*t.length;for(n=0;n<t.length;n++){var o={left:s.left+s.width/2-r/2+s.width/2*1.2*n,top:s.top+1.2*s.height,width:s.width/2,height:s.height/2},a=new f;a.isolateNode=t[n],await this._newViewerFromCurrent(this.getModelName(),o,a)}e.setMinimumFramerate(10)}async uniqueMeshesToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=this.getHCModel(),i=await t.findUniqueMeshes(),n=[];for(var s in i)n.push(i[s]);var r=this.getDimensions(),o=r.width/2*1.2*n.length;if(n.length>1e3)alert("Too many unique parts");else for(s=0;s<n.length;s++){var a={left:r.left+r.width/2-o/2+r.width/2*1.2*s,top:r.top+1.2*r.height,width:r.width/2,height:r.height/2},d=new f;d.isolateNode=n[s],await this._newViewerFromCurrent(this.getModelName(),a,d)}e.setMinimumFramerate(10)}async duplicateToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=this.getDimensions(),i={left:t.left+t.width+t.width/3,top:t.top,width:t.width,height:t.height},n=new f;n.camera=this.getHWV().getView().getCamera().copy(),this._newViewerFromCurrent(this.getModelName(),i,n),e.setMinimumFramerate(10)}async isolateAllToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0),e.selectionManager.getLast().getNodeId();for(var t=[],i=e.selectionManager.getResults(),n=0;n<i.length;n++)t.push(i[n].getNodeId());e.selectionManager.clear();var s=this.getDimensions(),r={left:s.left+s.width+s.width/3,top:s.top,width:s.width,height:s.height},o=new f;o.isolateNode=t,this._newViewerFromCurrent(this.getModelName(),r,o),e.setMinimumFramerate(10)}disableInput(){var e=this.getHWV();null!=e&&0==this._inputDisabled&&($("#"+g.container).css("pointer-events","none"),this._inputDisabled=!0,0!=e.operatorManager._operatorStack[0]&&(this._savedoperator=e.operatorManager._operatorStack[0]),e.operatorManager.set(Communicator.OperatorId.None,0),e.operatorManager.set(Communicator.OperatorId.Turntable,1))}enableInput(){var e=this.getHWV();null!=e&&1==this._inputDisabled&&($("#"+g.container).css("pointer-events","auto"),e.operatorManager.set(this._savedoperator,0),e.operatorManager.set(Communicator.OperatorId.Select,1),this._inputDisabled=!1)}setSelected(e){super.setSelected(e),0==e?this.disableInput():this.enableInput()}async magnifierToNewWindow(){await this.activate(),U.clearSelection();var e=this.getHWV();e.setMinimumFramerate(0);var t=this.getDimensions(),i={left:t.left+t.width+t.width/3,top:t.top,width:t.width,height:t.width},n=new f;n.camera=this.getHWV().getView().getCamera().copy();var s=await this._newViewerFromCurrent(this.getModelName(),i,n);e.setMinimumFramerate(10),this.connectWindow(s),s.activate(),s.setShape(c.circle)}mTreeToNewWindow(){var e=this.getDimensions(),t={left:e.left+e.width+e.width/3,top:e.top,width:e.width,height:e.width},i=new wbItemModelTree;i.initialize(),i.setDimensions(t),U.addItem(i),i.connectWindow(this),U.redraw()}async explodeToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=this.getDimensions(),i={left:t.left+t.width+t.width/3,top:t.top,width:t.width,height:t.height},n=new f;n.camera=this.getHWV().getView().getCamera().copy(),n.explode=1.5,this._newViewerFromCurrent(this.getModelName(),i,n),e.setMinimumFramerate(10)}async standardViewsToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=this.getDimensions(),i=t.width+t.width/50,n={left:i+t.left+t.width+t.width/50,top:t.top,width:t.width,height:t.height};await e.view.setViewOrientation(Communicator.ViewOrientation.Front,0);var s=new f;s.camera=this.getHWV().getView().getCamera().copy(),await this._newViewerFromCurrent(this.getModelName(),n,s),n={left:i+t.left+t.width+t.width/50,top:t.top+t.height+t.width/50,width:t.width,height:t.height},await e.view.setViewOrientation(Communicator.ViewOrientation.Right,0),(s=new f).camera=this.getHWV().getView().getCamera().copy(),await this._newViewerFromCurrent(this.getModelName(),n,s),n={left:i+t.left,top:t.top+t.height+t.width/50,width:t.width,height:t.height},await e.view.setViewOrientation(Communicator.ViewOrientation.Top,0),(s=new f).camera=this.getHWV().getView().getCamera().copy(),await this._newViewerFromCurrent(this.getModelName(),n,s),n={left:i+t.left,top:t.top,width:t.width,height:t.height},await e.view.setViewOrientation(Communicator.ViewOrientation.TopRight,0),(s=new f).camera=this.getHWV().getView().getCamera().copy(),await this._newViewerFromCurrent(this.getModelName(),n,s),e.setMinimumFramerate(10)}async CADViewstoNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=[],i=e.model.getCadViewMap();for(let[e,n]of i)t.push(e);for(var n=this.getDimensions(),s=n.width/2*1.2*t.length,r=0;r<t.length;r++){var o={left:n.left+n.width/2-s/2+n.width/2*1.2*r,top:n.top+1.2*n.height,width:n.width/2,height:n.height/2},a=new f;a.cadView=t[r],await this._newViewerFromCurrent(this.getModelName(),o,a)}e.setMinimumFramerate(10)}_buildDagreGraphRecursive(e,t,i,n,s,r,o,a,d){if(!(o>r)){var h=e.model.getNodeChildren(n);if(0!=h.length||1!=i[n].length||1!=i[s].length||i[n][0][1]!=i[s][0][1]){s=e.model.getNodeParent(n),t.setNode(n.toString(),{width:a,height:d}),e.model.getNodeName(n),n!=e.model.getRootNode()&&t.setEdge(e.model.getNodeParent(n).toString(),n.toString());for(var l=0;l<h.length;l++)this._buildDagreGraphRecursive(e,t,i,h[l],n,r,o+1,a,d)}}}_gatherMeshId(e,t,i){return new Promise((function(n,s){t.model.getMeshIds([e]).then((function(t){i[e]=t,n()}))}))}gatherMatchingNodesRecursive(e,t,i,n){if(-1!=i.model.getNodeName(t).toLowerCase().indexOf(e.toLowerCase())){var s=t,r=[];for(r.push(i.model.getNodeName(t));;){var o=i.model.getNodeParent(s);if(null==o||o==i.model.getRootNode())break;r.push(i.model.getNodeName(o)),s=o}for(var a="",d=r.length-1;d>=0;d--)a+=d>0?r[d]+"->":r[d];var h={name:i.model.getNodeName(t),chain:a,id:t,selected:i.selectionManager.isSelected(Communicator.Selection.SelectionItem.create(t))};n.push(h)}for(var l=i.model.getNodeChildren(t),c=0;c<l.length;c++)this.gatherMatchingNodesRecursive(e,l[c],i,n)}gatherMatchingNodes(e){var t=[];return this.gatherMatchingNodesRecursive(e,this.getHWV().model.getRootNode(),this.getHWV(),t),t}_gatherMeshidsRecursive(e,t,i,n,s,r){n.push(this._gatherMeshId(t,e,i));for(var o=e.model.getNodeChildren(t),a=0;a<o.length;a++)this._gatherMeshidsRecursive(e,o[a],i,n,s,r+1)}_gatherMeshids(e,t,i){var n=this;return new Promise((function(s,r){var o=[];n._gatherMeshidsRecursive(e,e.model.getRootNode(),t,o,i,0),Promise.all(o).then((function(){s()}))}))}_gatherMeshidsRecursive2(e,t,i,n,s,r){if(!(r>s)){var o=e.model.getNodeChildren(i);0==o.length&&t.setEdge(i.toString(),"@"+n[i][0][1]);for(var a=0;a<o.length;a++)this._gatherMeshidsRecursive2(e,t,o[a],n,s,r+1)}}async modelTreeToNewWindow(){await this.activate();var e=this.getHWV(),t=[],i=e.model.getRootNode();null!=e.selectionManager.getLast()&&(i=e.selectionManager.getLast().getNodeId()),e.selectionManager.clear(),await this._gatherMeshids(e,t,5);var n=new dagre.graphlib.Graph;n.setDefaultEdgeLabel((function(){return{}}));var s=this.getDimensions();n.setGraph({marginx:0,ranksep:s.height/4}),this._buildDagreGraphRecursive(e,n,t,i,i,5,0,s.width/2,s.height/2);var r,o,a=[];for(var d in t)1==t[d].length&&(a[t[d][0][1]]=d);for(var h of(dagre.layout(n),e.setMinimumFramerate(0),n.nodes()))null!=(c=n.node(h))&&parseInt(h)==i&&(r=c.x,o=c.y);var l=[];for(var h of n.nodes()){var c;if(null!=(c=n.node(h))){var g={left:c.x+s.left-r+s.width/4,top:c.y+s.top-o+s.height/2,width:s.width/2,height:s.height/2},u=new f;h.includes("@")&&(h=a[h=h.split("@")[1]]),u.isolateNode=parseInt(h);var m=await this._newViewerFromCurrent(this.getModelName(),g,u);l[parseInt(h)]={dims:g,wbitem:m}}}for(var d in l)for(var p=e.model.getNodeChildren(parseInt(d)),v=0;v<p.length;v++){var w=p[v].toString();if(null!=l[w]){var x=new I(new Communicator.Point2(l[d].dims.left+s.width/2/2,l[d].dims.top+s.height/2),new Communicator.Point2(l[w].dims.left+s.width/2/2,l[w].dims.top));x.initialize(),x.setDrawArrows(!1,!0),x.setSnapItem(0,l[d].wbitem,y.bottom),x.setSnapItem(1,l[w].wbitem,y.top),I.addLine(x)}}U.redraw()}async sheetsToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);for(var t=e.sheetManager.getSheetIds(),i=this.getDimensions(),n=i.width/2*1.2*t.length,s=0;s<t.length;s++){var r={left:i.left+i.width/2-n/2+i.width/2*1.2*s,top:i.top+1.2*i.height,width:i.width/2,height:i.height/2},o=new f;o.sheet=t[s],await this._newViewerFromCurrent(this.getModelName(),r,o)}e.setMinimumFramerate(0)}async floorsToNewWindow(){await this.activate();var e=this.getHWV();e.setMinimumFramerate(0);var t=e.model.getNodeChildren(e.model.getRootNode());t=e.model.getNodeChildren(t[0]),t=e.model.getNodeChildren(t[0]),t=e.model.getNodeChildren(t[0]);for(var i=e.model.getNodeChildren(t[0]),n=this.getDimensions(),s=n.width/2*1.2*i.length,r=0;r<i.length;r++){var o={left:n.left+n.width/2-s/2+n.width/2*1.2*r,top:n.top+1.2*n.height,width:n.width/2,height:n.height/2},a=new f;a.isolateNode=i[r],await this._newViewerFromCurrent(this.getModelName(),o,a)}e.setMinimumFramerate(10)}}let M=new function(){var t,i,n,c,g,f,v,w,x,y,b,_;return{menudiv:"",initialize:function(){var l=$(e.menudiv)[0].getBoundingClientRect(),I=new r("createcad");I.setPosition(l.width/2,l.height/2),I.addItem("arboleda","arboleda.png",this.addModelFromMenu),I.addItem("cfd","cfd.png",this.addModelFromMenu),I.addItem("drawing","drawing.png",this.addModelFromMenu),I.addItem("EnginePoints","EnginePoints.png",this.addModelFromMenu),I.addItem("hammer","hammer.png",this.addModelFromMenu),I.addItem("HotelFloorplan","HotelFloorplan.png",this.addModelFromMenu),I.addItem("Hospital","hospital.png",this.addModelFromMenu),I.addItem("landinggear","landinggear.png",this.addModelFromMenu),I.addItem("PartWithPMI","PartWithPMI.png",this.addModelFromMenu),I.addItem("microengine","microengine.png",this.addModelFromMenu),I.addItem("motorcycle","moto.png",this.addModelFromMenu),I.addItem("phone","phone.png",this.addModelFromMenu),I.addItem("QAV250","QAV250.png",this.addModelFromMenu,"Drone"),I.addItem("turbine","turbine.png",this.addModelFromMenu,"Drone"),I.addItem("racbasicsampleproject","rac_basic_sample_project.png",this.addModelFromMenu,"Revit"),I.addItem("MountainHome","MountainHome.png",this.addModelFromMenu),I.addItem("DamagedHelmet","DamagedHelmet.png",this.addModelFromMenu),I.addItem("emptymodel","emptymodel.png",this.addModelFromMenu),I.setOrientation(s.box),I.setBoxDimensions(5,5),I.setImageSize(64,50);var C=new r("colors");C.addItem("transparent","transparent.png"),C.addItem("grey2","rgb(255,255,255)"),C.addItem("grey3","rgb(210,210,210)"),C.addItem("grey4","rgb(150,150,150)"),C.addItem("grey5","rgb(64,64,64)"),C.addItem("grey6","rgb(0,0,0)"),C.addItem("red1","rgb(255,128,128)"),C.addItem("red2","rgb(255,0,0)"),C.addItem("red3","rgb(210,0,0)"),C.addItem("red4","rgb(170,0,0)"),C.addItem("red5","rgb(130,0,0)"),C.addItem("red6","rgb(64,0,0)"),C.addItem("green1","rgb(128,255,128)"),C.addItem("green2","rgb(0,255,0)"),C.addItem("green3","rgb(0,210,0)"),C.addItem("green4","rgb(0,170,0)"),C.addItem("green5","rgb(0,130,0)"),C.addItem("green6","rgb(0,64,0)"),C.addItem("blue1","rgb(128,128,255)"),C.addItem("blue2","rgb(0,0,255)"),C.addItem("blue3","rgb(0,0,210)"),C.addItem("blue4","rgb(0,0,170)"),C.addItem("blue5","rgb(0,0,130)"),C.addItem("blue6","rgb(0,0,64)"),C.addItem("yellow1","rgb(255,241,170)"),C.addItem("yellow2","rgb(255,255,0)"),C.addItem("yellow3","rgb(210,210,0)"),C.addItem("yellow4","rgb(170,170,0)"),C.addItem("yellow5","rgb(130,130,0)"),C.addItem("yellow6","rgb(64,64,0)"),C.setOrientation(s.box),C.setBoxDimensions(6,5);var T=new r("otheritems");T.addItem("createblank","blank.png",this.insertBlankItem,0,!0,C,"Create Blank"),T.addItem("createtexteditornote","text.png",this.insertBlankItem,1,!0,C,"Create Text Editor"),T.addItem("createcontainer","container.png",this.insertBlankItem,1,!0,C,"Create Container");var M=new r("derived");M.addItem("Duplicate","derived_duplicate.png",this.setDerived),M.addItem("Standard Views","derived_standard.png",this.setDerived),M.addItem("Isolate","derived_isolate.png",this.setDerived),M.addItem("Isolate2","derived_isolate2.png",this.setDerived),M.addItem("CAD Views","derived_cadviews.png",this.setDerived),M.addItem("Sheets","derived_sheets.png",this.setDerived),M.addItem("Floors","derived_floors.png",this.setDerived),M.addItem("Unique Meshes","derived_unique.png",this.setDerived),M.addItem("Explode","derived_explode.png",this.setDerived),M.addItem("Magnifier","derived_magnifier.png",this.setDerived),M.addItem("Model Tree","derived_modeltree.png",this.setDerived),M.addItem("MTree","mtree.png",this.setDerived),M.setOrientation(s.box),M.setImageSize(128,100),M.setBoxDimensions(4,4);var k=new o("size");k.setOrientation(s.vertical);var A=new a("font");A.setOrientation(s.vertical);var D=new r("rendermodes");D.addItem("Shaded with Lines","rm_shadedwithlines.png",this.setRendermode),D.addItem("Shaded","rm_shaded.png",this.setRendermode),D.addItem("Hidden Line","rm_hiddenline.png",this.setRendermode),D.addItem("Wireframe","rm_wireframe.png",this.setRendermode),D.addItem("XRay","rm_xray.png",this.setRendermode),D.addItem("AmbientOcclusion","ao.png",this.setRendermode,0,!0),D.addItem("Bloom","bloom.png",this.setRendermode,0,!0),D.setOrientation(s.vertical),D.setImageSize(28,28);var P=new r("standardviewmenu");P.addItem("Front View","view_front.png",this.setStandardViews),P.addItem("Back View","view_back.png",this.setStandardViews),P.addItem("Left View","view_left.png",this.setStandardViews),P.addItem("Right View","view_right.png",this.setStandardViews),P.addItem("Top View","view_up.png",this.setStandardViews),P.addItem("Down View","view_down.png",this.setStandardViews),P.addItem("Iso View","view_iso.png",this.setStandardViews),P.setOrientation(s.vertical),P.setImageSize(28,28);var N=new d("tags");N.setOrientation(s.horizontal);var E=new u("menuAppearance");E.setOrientation(s.horizontal);for(var L=new r("tagcolors"),O=0;O<h.allowedTagColors.length;O++)L.addItem("tagcolors"+O,h.allowedTagColors[O]);L.setOrientation(s.box),L.setBoxDimensions(4,3);var W=new m("searchmenu");W.setOrientation(s.horizontal);var H=new p("tagscontainermenu");H.setOrientation(s.horizontal);var V=new r("operatormenu");V.addItem("Orbit","orbitoperator.png",this.setOperator),V.addItem("Walk","walkoperator.png",this.setOperator),V.addItem("EdgeLength","edgelengthoperator.png",this.setOperator),V.addItem("PointPoint","pointpointoperator.png",this.setOperator),V.addItem("NoMeasure","nomeasure.png",this.setOperator);var z=new r("leftarrowmenu");z.addItem("Left Arrow","arrowleft.png",this.setEndArrows),z.addItem("No Arrow Left","arrownone.png",this.setEndArrows);var F=new r("rightarrowmenu");F.addItem("Right Arrow","arrowright.png",this.setEndArrows),F.addItem("No Arrow Right","arrownone.png",this.setEndArrows);var R=new r("selmenu");t=R.addItem("loadnewmodel","createmodel.png",void 0,0,!0,I,"Replace Model"),i=R.addItem("derived","derived.png",void 0,0,!0,M,"Derive from Model"),n=R.addItem("rendermodes","rendermodes.png",void 0,0,!0,D,"Render Modes"),f=R.addItem("standardviews","viewmenu.png",void 0,0,!0,P,"Standard Views"),v=R.addItem("Projection","projection.png",this.setProjection,0,!0,void 0,"Perspective/Orthographic"),y=R.addItem("Operators","operators.png",void 0,0,!0,V,"Perspective/Orthographic"),b=R.addItem("LeftArrowChoice","arrowleft.png",void 0,0,!0,z,"Set End Arrows"),R.addItem("appearancemenu","appearance.png",void 0,1,!0,E,"Set Appearance"),_=R.addItem("RightArrowChoice","arrowright.png",void 0,0,!0,F,"Set End Arrows"),c=R.addItem("textsize","textsize.png",void 0,1,!0,k,"Text Size"),g=R.addItem("textfont","textfont.png",void 0,1,!0,A,"Text Font"),R.setOrientation(s.horizontal),x=R.addItem("autoarrange","autoarrange.png",this.setAutoArrange,0,!0,void 0,"Enable/Disable Auto Arrange"),R.addItem("tagsmenu","tags.png",void 0,1,!0,N,"Define Tags"),w=R.addItem("containertagsmenu","containertags.png",void 0,1,!0,H,"Define Container Tags");var B=new r("curveitems");B.addItem("newcurveline","lineline.png",this.newCurve,1,!1,void 0,"New Curve"),B.addItem("newcurvecurve","linecurve.png",this.newCurve,1,!1,void 0,"New Curve"),B.addItem("newcurvestep","linestep.png",this.newCurve,1,!1,void 0,"New Curve");var j=new r("main");j.setPosition(10,l.height/2),j.addItem("search","search.png",void 0,1,!0,W,"Search"),j.addItem("createmodel","createmodel.png",void 0,1,!0,I,"Create Model Item"),j.addItem("creatitem","create.png",void 0,1,!0,T,"Create Item"),j.addItem("createtexteditortext","text2.png",this.insertBlankItem,1,!1,void 0,"Create Text Editor"),j.addItem("curveoptions","newcurve.png",void 0,1,!0,B,"Create Item");var X=new r("topright");X.setPosition(l.width-50,20),X.addItem("Back To Menu","coboard.png",this.mainMenu,1,!1,void 0,"Back To Menu"),e.addMenu(j),e.addMenu(C),e.addMenu(I),e.addMenu(T),e.addMenu(R),e.addMenu(M),e.addMenu(k),e.addMenu(A),e.addMenu(D),e.addMenu(P),e.addMenu(N),e.addMenu(L),e.addMenu(W),e.addMenu(H),e.addMenu(B),e.addMenu(V),e.addMenu(E),e.addMenu(z),e.addMenu(F),e.addMenu(X),j.setOrientation(s.vertical),j.display(),X.display();var Y=[{name:"Order & Locking",subMenu:[{name:"Bring To Front",fun:function(){wbManager.bringToFront()}},{name:"Send To Back",fun:function(){wbManager.sendToBack()}},{name:"Lock",fun:function(){wbManager.setLocked(!0)}},{name:"Unlock",fun:function(){var e=window.location.href.split("?")[1].split("=")[1];fetch("api/Items/"+e).then((function(e){200===e.status?e.json().then((function(e){console.log(e)})):console.log("Looks like there was a problem. Status Code: "+e.status)})).catch((function(e){console.log("Fetch Error :-S",e)}))}}]},{name:"Group",fun:function(){U.group()}},{name:"Ungroup",fun:function(){U.ungroup()}},{name:"Fit Selection",fun:function(){U.fitSelection(1.5)}},{name:"Fit All",fun:function(){U.fitAll()}},{name:"Toggle Multi-Active",fun:function(){S.setKeepAlive(!S.keepAlive)}},{name:"Delete Selected",fun:function(){U.handleDelete()}},{name:"Refresh Selected",fun:function(){U.refreshAll()}},{name:"Text Styles",subMenu:[{name:"Bold On",fun:function(){exampleEditor.selectedRange().setFormatting("bold",!0)}},{name:"Bold Off",fun:function(){exampleEditor.selectedRange().setFormatting("bold",!1)}},{name:"Italic On",fun:function(){exampleEditor.selectedRange().setFormatting("italic",!0)}},{name:"Italic Off",fun:function(){exampleEditor.selectedRange().setFormatting("italic",!1)}},{name:"Align Left",fun:function(){exampleEditor.selectedRange().setFormatting("align","left")}},{name:"Align Center",fun:function(){exampleEditor.selectedRange().setFormatting("align","center")}},{name:"Color Black",fun:function(){exampleEditor.selectedRange().setFormatting("color","black")}},{name:"Color Red",fun:function(){exampleEditor.selectedRange().setFormatting("color","red")}},{name:"Underline On",fun:function(){exampleEditor.selectedRange().setFormatting("underline",!0)}},{name:"Underline Off",fun:function(){exampleEditor.selectedRange().setFormatting("underline",!1)}},{name:"Vertical Alignment Top",fun:function(){exampleEditor.setVerticalAlignment("top")}},{name:"Vertical Alignment Middle",fun:function(){exampleEditor.setVerticalAlignment("middle")}},{name:"Vertical Alignment bottom",fun:function(){exampleEditor.setVerticalAlignment("bottom")}},{name:"1px",fun:function(){exampleEditor.selectedRange().setFormatting("size","1")}},{name:"3px",fun:function(){exampleEditor.selectedRange().setFormatting("size","3")}},{name:"5px",fun:function(){exampleEditor.selectedRange().setFormatting("size","5")}},{name:"10px",fun:function(){exampleEditor.selectedRange().setFormatting("size","10")}},{name:"15px",fun:function(){exampleEditor.selectedRange().setFormatting("size","15")}},{name:"20px",fun:function(){exampleEditor.selectedRange().setFormatting("size","20")}},{name:"30px",fun:function(){exampleEditor.selectedRange().setFormatting("size","30")}},{name:"50px",fun:function(){exampleEditor.selectedRange().setFormatting("size","50")}},{name:"100px",fun:function(){exampleEditor.selectedRange().setFormatting("size","100")}}]}];$(e.menudiv).contextMenu("menu",Y,{triggerOn:"click",subMenuTriggerOn:"hover"}),$(U.mainOuterWindow).contextMenu("menu",Y,{triggerOn:"click",subMenuTriggerOn:"hover"})},newCurve:function(e){"newcurveline"==e.name?I.setNewLineMode(0):"newcurvecurve"==e.name?I.setNewLineMode(1):"newcurvestep"==e.name&&I.setNewLineMode(2)},async setOperator(e,t){var i;"Orbit"==e.name?i=Communicator.OperatorId.Navigate:"Walk"==e.name?i=Communicator.OperatorId.KeyboardWalk:"EdgeLength"==e.name?i=Communicator.OperatorId.MeasureEdgeLength:"PointPoint"==e.name&&(i=Communicator.OperatorId.MeasurePointPointDistance);for(var n=U.getSelectedItems(),s=0;s<n.length;s++)if(n[s].getType()==l.wbItemHC){n[s].getActive(),await n[s].activate();var r=n[s].getHWV();i==Communicator.OperatorId.MeasureEdgeLength||i==Communicator.OperatorId.MeasurePointPointDistance?r.operatorManager.set(i,1):null==i?r.operatorManager.set(Communicator.OperatorId.Select,1):r.operatorManager.set(i,0)}},async setStandardViews(e,t){var i;"Front View"==e.name?i=Communicator.ViewOrientation.Front:"Back View"==e.name?i=Communicator.ViewOrientation.Back:"Left View"==e.name?i=Communicator.ViewOrientation.Left:"Right View"==e.name?i=Communicator.ViewOrientation.Right:"Top View"==e.name?i=Communicator.ViewOrientation.Top:"Down View"==e.name?i=Communicator.ViewOrientation.Bottom:"Iso View"==e.name&&(i=Communicator.ViewOrientation.Iso);for(var n=U.getSelectedItems(),s=0,r=0;r<n.length;r++)n[r].getType()==l.wbItemHC&&s++;for(r=0;r<n.length;r++)if(n[r].getType()==l.wbItemHC){var o=n[r].getActive();await n[r].activate();var a=n[r].getHWV();s>1||0==o?await a.view.setViewOrientation(i,0):await a.view.setViewOrientation(i,500),s>1&&await n[r].deactivate()}},setAutoArrange(e,t){var i;i=!!e.isToggled();for(var n=U.getSelectedItems(),s=0;s<n.length;s++)n[s].getType()==l.wbItemContainer&&(n[s].setAutoArrange(i),n[s].getAutoArange()&&(n[s].dragItemsAndArrange(),U.redraw()))},async setProjection(e,t){var i;i=e.isToggled()?Communicator.Projection.Perspective:Communicator.Projection.Orthographic;for(var n=U.getSelectedItems(),s=0,r=0;r<n.length;r++)n[r].getType()==l.wbItemHC&&s++;for(r=0;r<n.length;r++)if(n[r].getType()==l.wbItemHC){await n[r].activate();var o=n[r].getHWV();await o.view.setProjectionMode(i),s>1&&await n[r].deactivate()}},async setRendermode(e,t){var i,n,s;"Shaded with Lines"==e.name?i=Communicator.DrawMode.WireframeOnShaded:"Shaded"==e.name?i=Communicator.DrawMode.Shaded:"Hidden Line"==e.name?i=Communicator.DrawMode.HiddenLine:"Wireframe"==e.name?i=Communicator.DrawMode.Wireframe:"XRay"==e.name?i=Communicator.DrawMode.XRay:"AmbientOcclusion"==e.name?n=e.isToggled():"Bloom"==e.name&&(s=e.isToggled());for(var r=U.getSelectedItems(),o=0,a=0;a<r.length;a++)r[a].getType()==l.wbItemHC&&o++;for(a=0;a<r.length;a++)if(r[a].getType()==l.wbItemHC){await r[a].activate();var d=r[a].getHWV();null!=n?await d.view.setAmbientOcclusionEnabled(n):null!=s?await d.view.setBloomEnabled(s):await d.view.setDrawMode(i),o>1&&await r[a].deactivate()}},setDerived(e,t){for(var i=U.getSelectedItems(),n=0;n<i.length;n++)if(i[n].getType()==l.wbItemHC){"Duplicate"==e.name?i[n].duplicateToNewWindow():"Standard Views"==e.name?i[n].standardViewsToNewWindow():"Isolate"==e.name?i[n].isolateToNewWindow():"Isolate2"==e.name?i[n].isolateAllToNewWindow():"CAD Views"==e.name?i[n].CADViewstoNewWindow():"Sheets"==e.name?i[n].sheetsToNewWindow():"Floors"==e.name?i[n].floorsToNewWindow():"Unique Meshes"==e.name?i[n].uniqueMeshesToNewWindow():"Explode"==e.name?i[n].explodeToNewWindow():"Magnifier"==e.name?i[n].magnifierToNewWindow():"Model Tree"==e.name?i[n].modelTreeToNewWindow():"MTree"==e.name&&i[n].mTreeToNewWindow();break}},async addModelFromMenu(e,t){if("loadnewmodel"==t.name)for(var i=U.getSelectedItems(),n=0;n<i.length;n++)i[n].getType()==l.wbItemHC&&await S.replace(e.name,i[n]);else"emptymodel"==e.name?U.addFromRectangle(void 0,l.wbItemHC,"rgb(255,255,255)"):U.addFromRectangle(e.name,l.wbItemHC,"rgb(255,255,255)")},setEndArrows(t,i){var n=void 0,s=void 0;"Left Arrow"==t.name&&(n=!0),"Right Arrow"==t.name&&(s=!0),"No Arrow Left"==t.name&&(n=!1),"No Arrow Right"==t.name&&(s=!1);var r=e.getByName("selmenu");null!=n&&(1==n?b.setImage("arrowleft.png",r):b.setImage("arrownone.png",r)),null!=s&&(1==s?_.setImage("arrowleft.png",r):_.setImage("arrownone.png",r));for(var o=U.getSelectedItems(),a=0;a<o.length;a++)null!=n&&(o[a].drawStartArrow=n),null!=s&&(o[a].drawEndArrow=s);U.redraw()},setShape(e,t){"rectangleshape"==e.name?U.setShape(wbItemShape.rectangle):"circleshape"==e.name?U.setShape(wbItemShape.circle):U.setShape(wbItemShape.roundedCornerRectangle)},mainMenu(){window.location="./"},insertBlankItem(e,t,i){var n;n="transparent.png"==e.imagename?void 0:e.imagename,"createtexteditortext"!=e.name?null!=t&&("backgroundcolor"==t.name?U.setBackgroundColor(n):"createblank"==t.name?U.addFromRectangle("",l.wbItem,n):"createtexteditornote"==t.name?U.addFromRectangle("",l.wbItemTextEditorNote,n):"createtexteditortext"==t.name?U.addFromRectangle("",l.wbItemTextEditorText,n):"createcontainer"==t.name&&U.addFromRectangle("",l.wbItemContainer,n)):U.addFromRectangle("",l.wbItemTextEditorText,n)},showSelectionMenu(){var s=e.getByName("selmenu"),r=U.getSelectedItems();if(0==r.length)s.hide();else{for(var o=0,a=0,d=0,h=0,u=0;u<r.length;u++)r[u].getType()==l.wbItemHC&&o++,r[u].getType()==l.wbItemTextEditor&&a++,r[u].getType()==l.wbItemContainer&&d++,r[u].getType(),r[u].getType()==l.wbLine&&h++;if(t.hidden=!1,n.hidden=!1,f.hidden=!1,v.hidden=!1,y.hidden=!1,i.hidden=!1,c.hidden=!0,g.hidden=!0,w.hidden=!0,x.hidden=!0,b.hidden=!0,_.hidden=!0,0==o?(t.hidden=!0,i.hidden=!0,n.hidden=!0,f.hidden=!0,v.hidden=!0,y.hidden=!0):o>1&&(i.hidden=!0),1==a&&1==r.length&&(c.hidden=!1,g.hidden=!1),1==d&&1==r.length&&(w.hidden=!1,x.hidden=!1,x.setToggled(r[0].getAutoArange())),h==r.length){var m=r[0];b.hidden=!1,_.hidden=!1;var p=e.getByName("selmenu");1==m.drawStartArrow?b.setImage("arrowleft.png",p):b.setImage("arrownone.png",p),1==m.drawEndArrow?_.setImage("arrowright.png",p):_.setImage("arrownone.png",p)}var I=U.calculateCombinedBounding(r),C=U.convertCanvasToWindowCoordinates(I);s.setPosition(C.left+C.width/2,C.top-50),s.display()}},hideSelectionMenu(){e.getByName("selmenu").hide()}}};class k extends g{static dragAndArrangedTemp=void 0;static prepareForDragAndArrange(e){null!=k.dragAndArrangedTemp&&k.dragAndArrangedTemp.containerguid==e.getGUID()||(k.dragAndArrangedTemp={itemlist:U.getSelectedItems(),containerguid:e.getGUID(),newdims:[],insertBefore:void 0})}static clearDragAndArrange(){if(null!=k.dragAndArrangedTemp){for(var e=0;e<k.dragAndArrangedTemp.itemlist.length;e++){k.dragAndArrangedTemp.itemlist[e].getDimensions();var t=k.dragAndArrangedTemp.newdims[e];k.dragAndArrangedTemp.itemlist[e].move(t.left,t.top,!1)}var i=U.getItems(),n=[];for(e=0;e<k.dragAndArrangedTemp.itemlist.length;e++)if(n.push(k.dragAndArrangedTemp.itemlist[e]),k.dragAndArrangedTemp.itemlist[e].getType()==l.wbItemContainer)for(var s=0;s<k.dragAndArrangedTemp.itemlist[e]._containedItems.length;s++)n.push(k.dragAndArrangedTemp.itemlist[e]._containedItems[s]);for(k.dragAndArrangedTemp.itemlist=n,e=0;e<k.dragAndArrangedTemp.itemlist.length;e++)for(s=0;s<i.length;s++)if(i[s].getGUID()==k.dragAndArrangedTemp.itemlist[e].getGUID()){i.splice(s,1);break}if(null!=k.dragAndArrangedTemp.insertBefore){for(e=0;e<i.length;e++)if(i[e].getGUID()==k.dragAndArrangedTemp.insertBefore){for(s=k.dragAndArrangedTemp.itemlist.length-1;s>=0;s--)i.splice(e,0,k.dragAndArrangedTemp.itemlist[s]);break}}else for(s=0;s<k.dragAndArrangedTemp.itemlist.length;s++)i.push(k.dragAndArrangedTemp.itemlist[s]);k.dragAndArrangedTemp=void 0}}static assignItemsToContainer(){for(var e=U.getItems(),t=0;t<e.length;t++)e[t]._done=!1,e[t].containedIn=void 0;for(t=e.length-1;t>=0;t--)e[t].getType()==l.wbItemContainer&&e[t].findContainedItems()}static arrangeAllItemsByTags(){for(var e=U.getItems(),t=0;t<e.length;t++)e[t].getType()==l.wbItemContainer&&e[t].arrangeItems();U.redraw(),k.assignItemsToContainer()}constructor(){super(),this._containedItems=[],this._type=l.wbItemContainer,this._targetTags=new wbTags,this._autoArrange=!1}setFromJSON(e){super.setFromJSON(e),this._targetTags.setFromJSON(e._targetTags)}serialize(){var e=super.serialize();return e._autoArrange=this._autoArrange,e._targetTags=this._targetTags.serialize(),e}static _findConnectedItemsRecursive(e,t){e.push(t);for(var i=t.getContainedItems(),n=0;n<i.length;n++)e.push(i[n]),i[n].getType()==l.wbItemContainer&&k._findConnectedItemsRecursive(e,i[n])}findConnectedItems(){var e=[];return k._findConnectedItemsRecursive(e,this),e}getAutoArange(){return this._autoArrange}setAutoArrange(e){this._autoArrange=e}move(e,t,i){var n,s;this.dirty=!0,i?(n=e,s=t,this._dimensions.left+=e,this._dimensions.top+=t):(n=e-this._dimensions.left,s=t-this._dimensions.top,this._dimensions.left=e,this._dimensions.top=t);for(var r=0;r<this._containedItems.length;r++)this._containedItems[r].move(n,s,!0)}dragItemsAndArrange(e){var t=[];if(null!=e){if(k.prepareForDragAndArrange(this),1==k.dragAndArrangedTemp.itemlist.length&&k.dragAndArrangedTemp.itemlist[0]==this)return void(k.dragAndArrangedTemp=void 0);t=k.dragAndArrangedTemp.itemlist}for(var i=this._containedItems,n=0;n<t.length;n++)for(var s=0;s<i.length;s++)if(t[n].getGUID()==i[s].getGUID()){i.splice(s,1);break}var r=this.getDimensions(),o=new Communicator.Point2(10,10),a=0;o=new Communicator.Point2(10,10);var d=!1;for(n=0;n<i.length;n++){var h,l=i[n].findConnectedContainer();if(!(h=null!=l&&l.getGUID()!=this.getGUID()?l:i[n]).getLocked()){var c=h.findGroupItems(),g=h.findConnectedItems().concat(c),u=U.calculateCombinedBounding(g),m={x:o.x,y:o.y,maxlineheight:a};o.x+u.width>r.width&&(o.x=10,o.y+=a+20,a=0);var p=r.left+o.x,f=r.top+o.y;if(null!=e&&e.x>=p-20&&e.x<=p+u.width+20&&e.y>=f-20&&e.y<=f+u.height+20&&!d){for(o.x=m.x,o.y=m.y,a=m.maxlineheight,k.dragAndArrangedTemp.newdims=[],k.dragAndArrangedTemp.insertBefore=h.getGUID(),n--,s=0;s<t.length;s++)u.width=t[s].getDimensions().width,u.height=t[s].getDimensions().height,o.x+u.width>r.width&&(o.x=10,o.y+=a+20,a=0),p=r.left+o.x,f=r.top+o.y,k.dragAndArrangedTemp.newdims.push({left:p,top:f}),a<u.height&&(a=u.height),o.x+=u.width+20;d=!0}else{var v=p-u.left,w=f-u.top;for(s=0;s<g.length;s++){var x=g[s].getDimensions();x.left=x.left+v,x.top=x.top+w,g[s].setDimensions(x)}a<u.height&&(a=u.height),o.x+=u.width+20}}}if(null!=e&&!d)for(k.dragAndArrangedTemp.newdims=[],s=0;s<t.length;s++){var y=t[s].getDimensions().width,b=t[s].getDimensions().height;o.x+y>r.width&&(o.x=10,o.y+=a+20,a=0),k.dragAndArrangedTemp.newdims.push({left:r.left+o.x,top:r.top+o.y}),a<b&&(a=b),o.x+=y+20}}arrangeItems(){this._autoArrange=!0;var e=this.getTargetTags(),t=[];for(var i in e.getTagsHash())t.push(i);if(t.length>0){for(var n=U.getItems(),s=this.getDimensions(),r=new Communicator.Point2(10,10),o=0,a=0;a<n.length;a++)n[a]._done=!1;for(a=0;a<n.length;a++)if(!n[a]._done&&n[a].getGUID()!=this.getGUID()){if((c=null!=(g=n[a].findConnectedContainer())&&g.getGUID()!=this.getGUID()?g:n[a]).getLocked())continue;if(c.hasTags(t)){(u=c.findGroupItems()).push(c);var d=U.calculateCombinedBounding(u),h=c.findConnectedItems().concat(u);10+d.width>s.width&&(s.width=10+d.width+5)}}for(a=0;a<n.length;a++)n[a]._done=!1;r=new Communicator.Point2(10,10);var l=0;for(a=0;a<n.length;a++)if(!n[a]._done&&n[a].getGUID()!=this.getGUID()){var c,g;if((c=null!=(g=n[a].findConnectedContainer())&&g.getGUID()!=this.getGUID()?g:n[a]).getLocked())continue;if(c.hasTags(t)){var u;(u=c.findGroupItems()).push(c),d=U.calculateCombinedBounding(u),h=c.findConnectedItems().concat(u),r.x+d.width>s.width&&(r.x=10,r.y+=o+20,o=0);var m=s.left+r.x,p=s.top+r.y,f=m-d.left,v=p-d.top;for(i=0;i<h.length;i++)if(!h[i]._done){var w=h[i].getDimensions();h[i]._done=!0,w.left=w.left+f,w.top=w.top+v,h[i].setDimensions(w)}o<d.height&&(o=d.height),r.x+=d.width+20,l=d.height+20}}var x=r.y-10+l+10;x>s.height&&(s.height=x),this.setDimensions(s)}}static _hasTagsRecursive(e,t){if(e._hasTag2(t))return!0;for(var i=0;i<e._containedItems.length;i++){if(e._containedItems[i].hasTags(t))return!0;if(e._containedItems[i].getType()==l.wbItemContainer)return k._hasTagsRecursive(e._containedItems[i],t)}return!1}_hasTag2(e){return super.hasTags(e)}hasTags(e){return k._hasTagsRecursive(this,e)}getContainedItems(){return this._containedItems}setTargetTag(e){this._targetTags.addTag(e)}getTargetTags(){return this._targetTags}async duplicate(){await this.deactivate();var e=new k;return super._duplicate(e),e}findContainedItems(){this._containedItems=[];for(var e=U.getItems(),t=this.getDimensions(),i=0;i<e.length;i++){var n=e[i].getDimensions();n.left>t.left&&n.left+n.width<t.left+t.width&&n.top>t.top&&n.top+n.height<t.top+t.height&&e[i].getGUID()!=this.getGUID()&&0==e[i]._done&&(this._containedItems.push(e[i]),e[i]._done=!0,e[i].containedIn=this)}}}let A=new function(){var e,t=[];return{initialize:function(t){e=t},calculateAlignment:function(i){var n=U.calculateSelectionBounding(!1).bounding;t=[];for(var s,r,o=U.getItems(),a=20/e.getTransform().a,d=(n.x1+n.x2)/2,h=(n.y1+n.y2)/2,c=0;c<o.length;c++)if(0==o[c].getSelected()&&o[c].getType()!=l.wbLine){var g=o[c].getDimensions();if(g.left+g.width<n.x1||g.left>n.x2||g.top+g.height<n.y1||g.top>n.y2){var u=g.left+g.width/2,m=g.top+g.height/2;if(h>m-a&&h<m+a){var p=Math.abs(d-u);(null==s||p<s.dist)&&(s=u<d?{type:0,x1:n.x1,y1:m,x2:g.left+g.width,y2:m,dist:p}:{type:0,x1:n.x2,y1:m,x2:g.left,y2:m,dist:p})}d>u-a&&d<u+a&&(p=Math.abs(h-m),(null==r||p<r.dist)&&(r=m<h?{type:1,y1:n.y1,x1:u,y2:g.top+g.height,x2:u,dist:p}:{type:1,y1:n.y2,x1:u,y2:g.top,x2:u,dist:p}))}}null!=s&&t.push(s),null!=r&&t.push(r),this.adjustAlignment(n,i)},adjustAlignment:function(e,i){for(var n={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2},s=0;s<t.length;s++){var r=t[s];0==r.type?n.y1=r.y1-(n.y2-n.y1)/2:1==r.type&&(n.x1=r.x1-(n.x2-n.x1)/2)}var o=e.y1-n.y1,a=e.x1-n.x1,d=U.getItems();for(s=0;s<d.length;s++)if(null!=d[s].getTempDimensions()&&0==i&&null==d[s].containedIn||d[s].getSelected()){var h=d[s].getDimensions();d[s].move(h.left-a,h.top-o,!1)}},drawAlignment:function(){e.lineWidth=1/e.getTransform().a,e.setLineDash([5/e.getTransform().a,15/e.getTransform().a]);for(var i=0;i<t.length;i++)e.beginPath(),e.moveTo(t[i].x1,t[i].y1),e.lineTo(t[i].x2,t[i].y2),e.stroke();e.setLineDash([])}}};const D={scaleItem:0,dragItem:1,dragLinePoint:2};function P(e){this.type=e,this.extra=void 0}class N{constructor(e,t){this._whiteboarditem=window,this._button,this.drawSelectionRectangle,this._itemUnderMouse,this._ctx=e,this._ctx_o=t,this._dragged,this.dragStart,this.dragLast,this._dragged,this._pickedHandle,this._lastmouseuptime,this.cachedSelectedItems=[],this.cachedLineItems=[],this._cameraDirty=!1}setCameraDirty(){this._cameraDirty=!0}getCameraDirty(){return this._cameraDirty}clearCameraDirty(){this._cameraDirty=!1}_disableEnableInput(e){for(var t=U.getItems(),i=0;i<t.length;i++)1==e?t[i].enableInput():t[i].disableInput()}_recursiveContainerDrag(e){for(var t=e.getContainedItems(),i=0;i<t.length;i++)t[i].storeTempDimensions(),t[i].getType()==l.wbItemContainer&&this._recursiveContainerDrag(t[i])}_startSelectionDrag(e){for(var t=U.getItems(),i=0;i<t.length;i++)t[i].clearTempDimensions();for(i=0;i<t.length;i++)(t[i].getSelected()||i==e)&&(t[i].storeTempDimensions(),t[i].getType()==l.wbItemContainer&&this._recursiveContainerDrag(t[i]))}_selectionDrag(){for(var e=this._ctx.transformedPoint(U.lastX,U.lastY),t=U.getItems(),i=!1,n=0;n<t.length;n++)if(t[n].getType()==l.wbItemContainer&&1==t[n].getAutoArange()&&t[n].pointInsideItem(e)&&!i&&(t[n].dragItemsAndArrange(e),i=!0),null!=t[n].getTempDimensions()&&!t[n].getLocked()){t[n].getDimensions();var s=t[n].getTempDimensions();t[n].move(s.left+(e.x-this.dragStart.x),s.top+(e.y-this.dragStart.y),!1)}i||(k.dragAndArrangedTemp=void 0)}_selectionScale(){var e=U.calculateSelectionBounding(!0);if(null!=e){var t,i,n=e.bounding,s=this._ctx.transformedPoint(U.lastX,U.lastY);0==this._pickedHandle.extra?(i=n.x2-n.x1-(s.x-this.dragStart.x),t=e.keepAspectRatio?(n.y2-n.y1)/(n.x2-n.x1)*i:n.y2-n.y1-(s.y-this.dragStart.y)):2==this._pickedHandle.extra?(i=n.x2-n.x1+(s.x-this.dragStart.x),t=e.keepAspectRatio?(n.y2-n.y1)/(n.x2-n.x1)*i:n.y2-n.y1+(s.y-this.dragStart.y)):1==this._pickedHandle.extra?(i=n.x2-n.x1+(s.x-this.dragStart.x),t=e.keepAspectRatio?(n.y2-n.y1)/(n.x2-n.x1)*i:n.y2-n.y1-(s.y-this.dragStart.y)):3==this._pickedHandle.extra&&(i=n.x2-n.x1-(s.x-this.dragStart.x),t=e.keepAspectRatio?(n.y2-n.y1)/(n.x2-n.x1)*i:n.y2-n.y1+(s.y-this.dragStart.y));for(var r=i/(n.x2-n.x1),o=t/(n.y2-n.y1),a=U.getItems(),d=0;d<a.length;d++)if(a[d].getSelected()&&!a[d].getLocked()){var h={left:0,top:0,width:0,height:0},c=a[d].getTempDimensions(),g=h.width;h.width=c.width*r;var u=h.width/g;if(h.height=c.height*o,0==this._pickedHandle.extra?(h.left=n.x2+(c.left-n.x2)*r,h.top=n.y2+(c.top-n.y2)*o):2==this._pickedHandle.extra?(h.left=n.x1+(c.left-n.x1)*r,h.top=n.y1+(c.top-n.y1)*o):1==this._pickedHandle.extra?(h.left=n.x1+(c.left-n.x1)*r,h.top=n.y2+(c.top-n.y2)*o):3==this._pickedHandle.extra&&(h.left=n.x2+(c.left-n.x2)*r,h.top=n.y1+(c.top-n.y1)*o),a[d].scale(h),a[d].getType()==l.wbItemHC)for(var m=a[d].getConnectedWindows(),p=0;p<m.length;p++)null!=m[p].position&&(m[p].position.left*=u,m[p].position.top*=u,m[p].position.radius*=u);a[d].refreshPositioning()}}}_pickHandle(e){var t=15/this._ctx.getTransform().a,i=U.calculateSelectionBounding(!1);if(null!=i){var n=!0,s=new P(D.scaleItem),r=i.bounding,o=(r.x2+r.x1)/2;if(e.x>=r.x1-t&&e.x<=r.x1+t&&e.y>=r.y1-t&&e.y<=r.y1+t?s.extra=0:e.x>=r.x2-t&&e.x<=r.x2+t&&e.y>=r.y2-t&&e.y<=r.y2+t?s.extra=2:e.x>=r.x2-t&&e.x<=r.x2+t&&e.y>=r.y1-t&&e.y<=r.y1+t?s.extra=1:e.x>=r.x1-t&&e.x<=r.x1+t&&e.y>=r.y2-t&&e.y<=r.y2+t?s.extra=3:e.x>=o-t&&e.x<=o+t&&e.y>=r.y1-t&&e.y<=r.y1+t?s.type=D.dragItem:n=!1,n)return s}return I.checkAndStartLinePointSelection(e)}onMouseDown(t,i,n){if(!menuOpen&&(e.hideAll(),blockRightClick=!1,this._button=n,this.drawSelectionRectangle=!1,this._itemUnderMouse=void 0,document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",U.lastX=t,U.lastY=i,this.dragStart=this._ctx.transformedPoint(U.lastX,U.lastY),this.dragLast=this._ctx.transformedPoint(U.lastX,U.lastY),this._dragged=!1,this._pickedHandle=void 0,null==U.getRectangleLoadData())){if(this._itemUnderMouse=U.findwbItemUnderMouse(),null!=this._itemUnderMouse&&1==this._itemUnderMouse.getLocked()&&(this._itemUnderMouse=void 0),0==this._button)if(this._pickedHandle=I.checkAndStartNewLine(this.dragStart,this._itemUnderMouse),null==this._pickedHandle&&(this._pickedHandle=this._pickHandle(this.dragStart)),null==this._pickedHandle){if(null!=this._itemUnderMouse&&this._itemUnderMouse.getType()==l.wbItemModelTree&&this._itemUnderMouse.onMouseDown())return;null==this._itemUnderMouse?U.clearSelection():(1==this._itemUnderMouse.getSelected()&&U.ctrlPressed&&0==this._itemUnderMouse.getActive()?(this._itemUnderMouse.setSelected(!1),this._itemUnderMouse.deselectGroup()):0==this._itemUnderMouse.getSelected()&&(U.ctrlPressed||U.clearSelection(),this._itemUnderMouse.setSelected(!0),U.selectRelatedGroups(),M.hideSelectionMenu()),this._startSelectionDrag())}else this._pickedHandle.type==D.dragItem?(this._disableEnableInput(!1),this._startSelectionDrag()):this._pickedHandle.type==D.dragLinePoint||(this._disableEnableInput(!1),this._startSelectionDrag());this.cachedSelectedItems=U.getSelectedItems(),this.cachedLineItems=U.getLineItems()}}onMouseMove(e,t,i){if(!menuOpen){U.lastX=e,U.lastY=t,this._dragged=!0;var n=this._ctx.transformedPoint(U.lastX,U.lastY);if(this.dragStart)if(2==this._button)blockRightClick=!0,null==this._itemUnderMouse&&(M.hideSelectionMenu(),this._ctx.translate(n.x-this.dragStart.x,n.y-this.dragStart.y),this._ctx_o.translate(n.x-this.dragStart.x,n.y-this.dragStart.y),this.setCameraDirty(),U.redraw(),U.respositionNonCanvasItems());else{if(null!=this._itemUnderMouse&&this._itemUnderMouse.getType()==l.wbItemModelTree&&this._itemUnderMouse.onMouseMove())return;if(null!=this._itemUnderMouse&&this._itemUnderMouse.getActive()&&null==this._pickedHandle)return;if(M.hideSelectionMenu(),!I.dragLinePointSelection(n,this._pickedHandle))if(null==this._itemUnderMouse&&null==this._pickedHandle||0!=this.drawSelectionRectangle)null==U.getRectangleLoadData()&&(this.drawSelectionRectangle=!0),U.redraw();else{if(null==this._pickedHandle||this._pickedHandle.type==D.dragItem?(this._selectionDrag(),null==k.dragAndArrangedTemp&&A.calculateAlignment(!1)):(this._selectionScale(),null==k.dragAndArrangedTemp&&A.calculateAlignment(!0)),null!=this._pickedHandle&&this._pickedHandle.type!=D.dragItem)for(var s=U.getItems(),r=0;r<s.length;r++)s[r].getType()==l.wbItemTextEditor&&(s[r].getActive()?s[r].deactivate():null!=s[r].getTempDimensions()&&s[r].refreshImage(this._ctx));U.respositionNonCanvasItems(),I.updateAllSnappedLinePoints(),U.redraw(),A.drawAlignment()}}this.dragLast=this._ctx.transformedPoint(U.lastX,U.lastY)}}onMouseUp(e,t,i){if(!menuOpen){this._disableEnableInput(!0);var n=new Date,s=this._ctx.transformedPoint(U.lastX,U.lastY);null!=this._itemUnderMouse&&this._itemUnderMouse.getType()==l.wbItemModelTree&&this._itemUnderMouse.onMouseUp(this._dragged),n-this._lastmouseuptime<200&&0==this._button&&!this._dragged?null==this._itemUnderMouse?(U.deactivateAll(!0),I.deletePointFromDoubleClick(s)):I.deletePointFromDoubleClick(s)||0==this._itemUnderMouse.getActive()&&(this._dragged=!1,this.dragStart=void 0,U.deactivateAll(!S.keepAlive).then((function(){U.activateItemUnderMouse()}))):0!=this._button||this._dragged||null!=this._itemUnderMouse||U.deactivateAll(!S.keepAlive),this._lastmouseuptime=n,1==this.drawSelectionRectangle&&(U.selectFromRectangle(this.dragStart),this.drawSelectionRectangle=!1,U.redraw()),null!=U.getRectangleLoadData()&&U.loadFromLoadData(),this.dragStart=void 0,k.clearDragAndArrange(),k.assignItemsToContainer(),M.showSelectionMenu(),this.cachedSelectedItems=U.getSelectedItems(),this.cachedLineItems=U.getLineItems(),I.finalizePointDrag(this._pickedHandle),I.updateAllSnappedLinePoints(),I.updateAllLineData(),I.lineSnapItem&&(I.lineSnapItem.isLineSnapItem=!1,I.lineSnapItem=void 0),U.redraw()}}onMouseWheel(e){M.hideSelectionMenu(),setTimeout((function(){M.showSelectionMenu()}),100);var t=e.wheelDelta?e.wheelDelta/40:e.detail?-e.detail:0;return t&&U.zoom(t),U.respositionNonCanvasItems(),this.setCameraDirty(),e.preventDefault()&&!1}onTouchStart(e){}onTouchMove(e){}onTouchEnd(e){}onKeyDown(e){}onKeyUp(e){}onDeactivate(){}onActivate(){}onViewOrientationChange(){}stopInteraction(){}}class E extends g{static resizePhase=0;static startSize=50;static carotaScale=1;static carotaSuppressSelection=!1;static carotaItemActive=void 0;static carotaActive=!0;static skipCarotaLoad=!1;static contentChanged(){if(E.skip)E.skip=!1;else if(E.skipCarotaLoad)E.skipCarotaLoad=!1;else if(null==E.carotaItemActive||1!=E.carotaItemActive.autoResizeText){if(null!=E.carotaItemActive&&1==E.carotaItemActive.autoResizeExtents){for(e=0,t=0,i=U.carotaEditor.frame.lines,n=0;n<i.length;n++)i[n].actualWidth>e&&(e=i[n].actualWidth),i[n].baseline+i[n].descent>t&&(t=i[n].baseline+i[n].descent);(s=E.carotaItemActive.getDimensions()).width=e+30,s.height=t+30,s.width<40&&(s.width=40),s.height<40&&(s.height=40),E.carotaItemActive.setDimensions(s),U.redraw()}}else if(0==E.resizePhase)E.resizePhase=1,U.carotaEditor.select(0,U.carotaEditor.frame.length-1),U.carotaEditor.selectedRange().setFormatting("size",E.startSize.toString());else{for(var e=0,t=0,i=U.carotaEditor.frame.lines,n=0;n<i.length;n++)i[n].actualWidth>e&&(e=i[n].actualWidth),i[n].baseline+i[n].descent>t&&(t=i[n].baseline+i[n].descent);var s;(e>(s=E.carotaItemActive.getDimensions()).width-5||t>s.height-10)&&E.startSize>=10?(E.startSize-=2,U.carotaEditor.select(0,U.carotaEditor.frame.length-1),U.carotaEditor.selectedRange().setFormatting("size",E.startSize.toString())):(E.resizePhase=0,E.startSize=50,U.carotaEditor.select(0,0,!0))}}constructor(){super(),this._type=l.wbItemTextEditor,this._editorText,this.autoResizeExtents=!1,this.autoResizeText=!1,this.setDiv("carotadiv"),this.textBoxDimensions={left:0,top:0,width:0,right:0}}setFromJSON(e){super.setFromJSON(e),null!=e._editorText&&(this._editorText=e._editorText)}serialize(){var e=super.serialize();return e._editorText=this._editorText,e.hasImage=!1,e}scale(e){super.scale(e),this.autoResizeExtents=!1}refreshPositioning(){if(null!=this._targetdiv){var e=this.getDimensions();this.textBoxDimensions={width:e.width-20,height:e.height-20,top:e.top+10,left:e.left+10};var t=U.convertCanvasToWindowCoordinates(this.textBoxDimensions);$("#"+this.getDiv()).css({width:t.width,height:t.height,top:t.top,left:t.left}),U.carotaEditor.redraw()}}render(e,t){this.renderPre(e,t);var i=this.getBackgroundColor(),n=this.getDimensions();null!=i&&this.backgroundOpacity>0&&e.fillRect(n.left,n.top,n.width,n.height),this.borderWidth>0&&this.getShape()==c.rectangle&&e.strokeRect(n.left+(this.borderWidth-1)/2,n.top+(this.borderWidth-1)/2,n.width-(this.borderWidth-1),n.height-(this.borderWidth-1)),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0;var s=this.getImage();null!=s&&e.drawImage(s,this.textBoxDimensions.left,this.textBoxDimensions.top,this.textBoxDimensions.width,this.textBoxDimensions.height),this.renderPost(e,t)}refreshImage(e){var t=this._active;if(this.activate(e),this._active=t,0==this._active){E.carotaSuppressSelection=!0,U.carotaEditor.redraw();var i=$("#"+this.getDiv()).find("canvas")[0].toDataURL(),n=new Image;n.src=i,this.setImage(n),E.carotaSuppressSelection=!1;var s=this;setTimeout((function(){$("#"+s.getDiv()).css({display:"none"}),U.redraw()}),10)}}async duplicate(){await this.deactivate();var e=new E;return super._duplicate(e),e.setDiv("carotadiv"),e._editorText=(" "+this._editorText).slice(1),e}setBackgroundColor(e){this._backgroundColor=e}activate(e){var t=this._active;if(super.activate(e),0==t)if(E.carotaActive=!0,this.setBackgroundColor(this.getBackgroundColor()),E.carotaItemActive=this,E.carotaScale=e.getTransform().a,this._image=void 0,E.skipCarotaLoad=!0,null!=this._editorText){var i=JSON.parse(this._editorText);U.carotaEditor.load(i),(n=U.carotaEditor.selectedRange()).setFormatting("align","center")}else{(i=[]).push({text:"",size:10,align:"center"}),U.carotaEditor.load(i),U.carotaEditor.select(0,U.carotaEditor.frame.length-1);var n,s=this.getDimensions();(n=U.carotaEditor.selectedRange()).setFormatting("size",(s.height/2).toString()),n.setFormatting("align","center")}}deactivate(){if(this._active){E.carotaActive=!1,this.setDirty(),E.carotaItemActive=void 0,this._editorText=JSON.stringify(U.carotaEditor.save()),E.carotaSuppressSelection=!0,U.carotaEditor.redraw();var e=$("#"+this.getDiv()).find("canvas")[0].toDataURL(),t=new Image;t.src=e,this.setImage(t),E.carotaSuppressSelection=!1,setTimeout((function(){U.redraw()}),10)}super.deactivate()}}var L,O,W,H,V,z,F;(L={carota:{src:{"carota.js":function(e,t,i){var n={node:i("./node"),editor:i("./editor"),document:i("./doc"),dom:i("./dom"),runs:i("./runs"),html:i("./html"),frame:i("./frame"),text:i("./text"),rect:i("./rect")};if(t.exports=n,"undefined"!=typeof window&&window.document){if(window.carota)throw new Error("Something else is called carota!");window.carota=n}},"characters.js":function(e,t,i){var n=i("./runs"),s=function(e,t){if(e._runs!==t._runs)throw new Error("Characters for different documents")},r={equals:function(e){return s(this,e),this._run===e._run&&this._offset===e._offset},cut:function(e){s(this,e);var t=this;return function(i){for(var s=t._run;s<=e._run;s++){var r=t._runs[s];if(r){var o=s===t._run?t._offset:0,a=s===e._run?e._offset:n.getTextLength(r.text);o<a&&n.getSubText((function(e){var t=Object.create(r);t.text=e,i(t)}),r.text,o,a-o)}}}}};function o(e,t,i){return Object.create(r,{_runs:{value:e},_run:{value:t},_offset:{value:i},char:{value:t>=e.length?null:n.getTextChar(e[t].text,i)}})}function a(e,t){for(;t<e.length;t++)if(0!=n.getTextLength(e[t].text))return o(e,t,0);return o(e,e.length,0)}t.exports=function(e){return function(t){for(var i=a(e,0);!t(i)&&null!==i.char;)i=i._offset+1<n.getTextLength(e[i._run].text)?o(e,i._run,i._offset+1):a(e,i._run+1)}}},"codes.js":function(e,t,i){var n=i("./text"),s=i("./frame"),r=i("./node"),o=i("./rect"),a=i("./util"),d=r.derive({parent:function(){return this._parent},draw:function(e){this.inline.draw(e,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)},position:function(e,t,i){this.left=e,this.baseline=t,i&&(this._bounds=i)},bounds:function(){return this._bounds||o(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)},byCoordinate:function(e,t){return e<=this.bounds().center().x?this:this.next()}}),h={number:function(e,t){var i=t+1+".";return{measure:function(e){return n.measure(i,e)},draw:function(e,t,s,r,o,a,d){n.draw(e,i,d,t,s,r,o,a)}}}};h.listNext=h.listEnd=function(e){return a.derive(e,{eof:!0,measure:function(e){return{width:10,ascent:0,descent:0}},draw:function(e,t,i){}})},h.listStart=function(e,t,i){return a.derive(e,{block:function(t,n,a,h,l,c){var g,u,m,p=r.generic("list",l,t,n),f=function(e,o){g=r.generic("item",p);var l=i(e.marker||{$:"number"},p.children().length);m=function(e,t,i,n,s){if(!e.draw||!e.measure)throw new Error;return Object.create(d,{inline:{value:e},_parent:{value:t},ordinal:{value:i},length:{value:1},formatting:{value:s},measured:{value:e.measure(s)}})}(l,g,h,0,o),m.block=!0,u=s(t+50,n,a-50,h+1,g,(function(e){return"listEnd"===e.$}),m.measured.ascent)};return f(e,c),function(e){if(u?u((function(e){h=e.ordinal+e.length;var i=e.bounds(),s=e.first(),r=t+50-10-m.measured.width,a=o(t,n,50,i.h);"baseline"in s?m.position(r,s.baseline,a):m.position(r,n+m.measured.ascent,a),n=i.t+i.h,g.children().push(m),g.children().push(e),g.finalize(),p.children().push(g),g=u=m=null}),e):h++,!u){var i=e.code();if(i){if("listEnd"==i.$)return p.finalize(),p;"listNext"==i.$&&f(i,e.codeFormatting())}}}}})},t.exports=e=function(e,t,i){var n=h[e.$];return n&&n(e,t,i)},e.editFilter=function(e){var t=0;if(!e.words.some((function(i,n){var s=i.code();if(s)switch(s.$){case"listStart":t++;break;case"listNext":if(0===t)return e.spliceWordsWithRuns(n,1,[a.derive(i.codeFormatting(),{text:{$:"listStart",marker:s.marker}})]),!0;break;case"listEnd":0===t&&e.spliceWordsWithRuns(n,1,[]),t--}}))&&t>0){for(var i=[];t>0;)t--,i.push({text:{$:"listEnd"}});e.spliceWordsWithRuns(e.words.length-1,0,i)}}},"doc.js":function(e,t,i){var n=i("per"),s=i("./characters"),r=i("./split"),o=i("./word"),a=i("./node"),d=i("./runs"),h=i("./range"),l=i("./util"),c=i("./frame"),g=i("./codes"),u=i("./rect"),m=function(e,t,i,n){var s=e.selection.start,r=e.selection.end;return function(o){e._wordOrdinals=[];var a=Array.prototype.splice.apply(e.words,[t,i].concat(n));o(m(e,t,n.length,a)),e._nextSelection={start:s,end:r}}},p=function(e){var t=[];return e((function(e){t.push(e)})),function(e){e(p((function(e){for(;t.length;)t.pop()(e)})))}},f=function(e){if(e.isNewLine())return!0;var t=e.code();return!(!t||!t.block&&!t.eof)},v=a.derive({redraw:function(){this.quickrefresh(0,0,!1)},load:function(e,t){var i=this;this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=n(s(e)).per(r(i.codes)).map((function(e){return o(e,i.codes)})).all(),this.layout(),this.contentChanged.fire(),this.select(0,0,t)},layout:function(){this.frame=null;try{this.frame=n(this.words).per(c(0,0,this._width,0,this)).first()}catch(e){console.error(e)}if(this.frame){if(this._nextSelection){var e=this._nextSelection;delete this._nextSelection,this.select(e.start,e.end)}}else console.error("A bug somewhere has produced an invalid state - rolling back"),this.performUndo()},range:function(e,t){return h(this,e,t)},documentRange:function(){return this.range(0,this.frame.length-1)},selectedRange:function(){return this.range(this.selection.start,this.selection.end)},save:function(){return this.documentRange().save()},paragraphRange:function(e,t){var i,n=this.wordContainingOrdinal(e);if(e=0,n&&!f(n.word))for(i=n.index;i>0;i--)if(f(this.words[i-1])){e=this.wordOrdinal(i);break}var s=this.wordContainingOrdinal(t);if(t=this.frame.length-1,s&&!f(s.word))for(i=s.index;i<this.words.length;i++)if(f(this.words[i])){t=this.wordOrdinal(i);break}return this.range(e,t)},insert:function(e,t){this.select(this.selection.end+this.selectedRange().setText(e),null,t)},modifyInsertFormatting:function(e,t){this.nextInsertFormatting[e]=t,this.notifySelectionChanged()},applyInsertFormatting:function(e){var t=this.nextInsertFormatting,i=Object.keys(t);i.length&&e.forEach((function(e){i.forEach((function(i){e[i]=t[i]}))}))},wordOrdinal:function(e){if(e<this.words.length){var t=this._wordOrdinals.length;if(t<e+1)for(var i=t>0?this._wordOrdinals[t-1]:0,n=t;n<=e;n++)this._wordOrdinals[n]=i,i+=this.words[n].length;return this._wordOrdinals[e]}},wordContainingOrdinal:function(e){var t,i=0;return this.words.some((function(n,s){if(e>=i&&e<i+n.length)return t={word:n,ordinal:i,index:s,offset:e-i},!0;i+=n.length})),t},runs:function(e,t){var i=this.wordContainingOrdinal(Math.max(0,t.start)),n=this.wordContainingOrdinal(Math.min(t.end,this.frame.length-1));if(i.index===n.index)i.word.runs(e,{start:i.offset,end:n.offset});else{i.word.runs(e,{start:i.offset});for(var s=i.index+1;s<n.index;s++)this.words[s].runs(e);n.word.runs(e,{end:n.offset})}},spliceWordsWithRuns:function(e,t,i){var a=this,d=n(s(i)).per(r(a.codes)).truthy().map((function(e){return o(e,a.codes)})).all(),h=!1;if("_filtersRunning"in a)a._filtersRunning++;else{for(var l=0;l<t;l++)this.words[e+l].code()&&(h=!0);h||(h=d.some((function(e){return!!e.code()})))}this.transaction((function(i){if(m(a,e,t,d)(i),h){a._filtersRunning=0;try{for(;;){var n=a._filtersRunning;if(!a.editFilters.some((function(e){return e(a),n!==a._filtersRunning})))break}}finally{delete a._filtersRunning}}}))},splice:function(e,t,i){if("string"==typeof i){var s=Math.max(0,e-1),r=n({start:s,end:s+1}).per(this.runs,this).first();i=[r?Object.create(r,{text:{value:i}}):{text:i}]}else Array.isArray(i)||(i=[{text:i}]);this.applyInsertFormatting(i);var o,a,h=this.wordContainingOrdinal(e),l=this.wordContainingOrdinal(t);if(e===h.ordinal)if(h.index>0&&!f(this.words[h.index-1])){h.index--;var c=this.words[h.index];o=n({}).per(c.runs,c).all()}else o=[];else o=n({end:h.offset}).per(h.word.runs,h.word).all();t===l.ordinal?t===this.frame.length-1||f(l.word)?(a=[],l.index--):a=n({}).per(l.word.runs,l.word).all():a=n({start:l.offset}).per(l.word.runs,l.word).all();var g=this.frame.length;return this.spliceWordsWithRuns(h.index,l.index-h.index+1,n(o).concat(i).concat(a).per(d.consolidate()).all()),this.frame?this.frame.length-g:0},registerEditFilter:function(e){this.editFilters.push(e)},width:function(e){if(0===arguments.length)return this._width;this._width=e,this.layout()},children:function(){return[this.frame]},toggleCaret:function(){var e=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==e},getCaretCoords:function(e){var t,i=this.byOrdinal(e);if(i){if(i.block&&e>0){var n=this.byOrdinal(e-1);if(n.newLine){var s=n.bounds(),r=n.parent().parent().bounds();t=u(r.l,r.b,1,s.h)}else t=n.bounds(),t=u(t.r,t.t,1,t.h)}else t=(t=i.bounds()).h?u(t.l,t.t,1,t.h):u(t.l,t.t,t.w,1);return t}},byCoordinate:function(e,t){for(var i=this.frame.byCoordinate(e,t).ordinal,n=this.getCaretCoords(i);n.b<=t&&i<this.frame.length-1;)i++,n=this.getCaretCoords(i);for(;n.t>=t&&i>0;)i--,n=this.getCaretCoords(i);return this.byOrdinal(i)},drawSelection:function(e,t){if(!E.carotaSuppressSelection)if(this.selection.end===this.selection.start){if(this.selectionJustChanged||t&&this.caretVisible){var i=this.getCaretCoords(this.selection.start);i&&(e.save(),e.fillStyle="black",i.fill(e),e.restore())}}else e.save(),e.fillStyle=t?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)",this.selectedRange().parts((function(t){t.bounds(!0).fill(e)})),e.restore()},notifySelectionChanged:function(e){var t=null,i=this;this.selectionChanged.fire((function(){return t||(t=i.selectedRange().getFormatting()),t}),e)},quickrefresh:function(e,t,i){this.selectionJustChanged=!0,this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(i)},select:function(e,t,i){this.frame&&(this.selection.start=Math.max(0,e),this.selection.end=Math.min("number"==typeof t?t:this.selection.start,this.frame.length-1),this.selectionJustChanged=!0,this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(i))},performUndo:function(e){var t=e?this.redo:this.undo,i=e?this.undo:this.redo,n=t.pop();n&&(n((function(e){i.push(e)})),this.layout(),this.contentChanged.fire())},canUndo:function(e){return e?!!this.redo.length:!!this.undo.length},transaction:function(e){if(this._currentTransaction)e(this._currentTransaction);else{for(var t=this;this.undo.length>50;)t.undo.shift();this.redo.length=0;var i=!1;this.undo.push(p((function(n){t._currentTransaction=n;try{e(n)}finally{i=n.length>0,t._currentTransaction=null}}))),i&&(t.layout(),t.contentChanged.fire())}},type:"document"});t.exports=function(){var e=Object.create(v);return e._width=0,e.selection={start:0,end:0},e.caretVisible=!0,e.customCodes=function(e,t,i){},e.codes=function(t,i){return g(t,i,e.codes)||e.customCodes(t,i,e.codes)},e.selectionChanged=l.event(),e.contentChanged=l.event(),e.editFilters=[g.editFilter],e.load([]),e}},"dom.js":function(e,t,i){e.isAttached=function(e){for(var t=e;t.parentNode;)t=t.parentNode;return!!t.body},e.clear=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.setText=function(t,i){e.clear(t),t.appendChild(document.createTextNode(i))},e.handleEvent=function(e,t,i){e.addEventListener(t,(function(e){!1===i(e)&&e.preventDefault()}))},e.handleMouseEvent=function(t,i,n){e.handleEvent(t,i,(function(e){var i=t.getBoundingClientRect();return n(e,(e.clientX-i.left)/E.carotaScale,(e.clientY-i.top)/E.carotaScale)}))},e.effectiveStyle=function(e,t){return document.defaultView.getComputedStyle(e).getPropertyValue(t)}},"editor.js":function(e,t,i){i("per");var n=i("./doc"),s=i("./dom"),r=i("./rect");setInterval((function(){if(E.carotaActive){var e=document.querySelectorAll(".carotaEditorCanvas"),t=document.createEvent("Event");t.initEvent("carotaEditorSharedTimer",!0,!0);for(var i=0;i<e.length;i++)e[i].dispatchEvent(t)}}),200),e.create=function(e){"absolute"!==s.effectiveStyle(e,"position")&&(e.style.position="relative"),e.innerHTML='<div id="spacerid" class="carotaSpacer"><canvas width="100" height="100" class="carotaEditorCanvas" style="position: absolute;"></canvas></div><div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea>';var t=e.querySelector("canvas"),i=e.querySelector(".carotaSpacer"),o=e.querySelector(".carotaTextArea"),a=e.querySelector("textarea"),d=n(),h=0,l=null,c=null,g=null,u=null,m="",p=null,f=null,v={66:"bold",73:"italic",85:"underline",83:"strikeout"},w=function(e,t){return t<0?e<=0:e>=d.frame.length-1},x=function(e,t){return e.b<=t.t||t.b<=e.t},y=function(e,t){var i,n=d.getCaretCoords(e);for(c=null!==l?l:n.l;!w(e,t)&&(e+=t,i=d.getCaretCoords(e),!x(i,n)););for(n=i;!w(e,t)&&!(t>0&&i.l>=c||t<0&&i.l<=c);)if(e+=t,i=d.getCaretCoords(e),x(i,n)){e-=t;break}return e},b=function(e,t){for(var i,n=d.getCaretCoords(e);!w(e,t);)if(e+=t,i=d.getCaretCoords(e),x(i,n)){e-=t;break}return e},_=function(e,t,i){var n=d.selection.start,s=d.selection.end,r=d.frame.length-1,o=!1;if(c=null,t){if(!h)switch(e){case 37:case 38:case 36:case 33:h=-1;break;case 39:case 40:case 35:case 34:h=1}}else h=0;var a=1===h?s:n,g=!1;switch(e){case 37:t||n==s?a>0&&(i?a=(m=d.wordContainingOrdinal(a)).ordinal===a?m.index>0?d.wordOrdinal(m.index-1):0:m.ordinal:a--):a=n,g=!0;break;case 39:var m;t||n==s?a<r&&(i?a=(m=d.wordContainingOrdinal(a)).ordinal+m.word.length:a++):a=s,g=!0;break;case 40:a=y(a,1),g=!0;break;case 38:a=y(a,-1),g=!0;break;case 36:a=b(a,-1),g=!0;break;case 35:a=b(a,1),g=!0;break;case 33:a=0,g=!0;break;case 34:a=r,g=!0;break;case 8:n===s&&n>0&&(d.range(n-1,n).clear(),u=n-1,d.select(u,u),o=!0);break;case 46:n===s&&n<r&&(d.range(n,n+1).clear(),o=!0);break;case 90:i&&(o=!0,d.performUndo());break;case 89:i&&(o=!0,d.performUndo(!0));break;case 65:i&&(o=!0,d.select(0,r));break;case 67:case 88:i&&(p=d.selectedRange().save(),f=d.selectedRange().plainText())}var w=v[e];if(i&&w){var x=d.selectedRange();x.setFormatting(w,!0!==x.getFormatting()[w]),T(),o=!0}if(g){switch(h){case 0:n=s=a;break;case-1:n=a;break;case 1:s=a}if(n===s)h=0;else if(n>s){h=-h;var _=s;s=n,n=_}u=a,d.select(n,s),o=!0}return l=c,o};s.handleEvent(a,"keydown",(function(e){if(_(e.keyCode,e.shiftKey,e.ctrlKey))return!1;console.log(e.which)}));var I="top";function C(){var t=d.frame.bounds().h*E.carotaScale;if(t<e.clientHeight)switch(I){case"middle":return(e.clientHeight-t)/2/E.carotaScale+15;case"bottom":return e.clientHeight-t}return 0}d.setVerticalAlignment=function(e){I=e,T()};var T=function(){var n=1*e.clientWidth;d.width()!==n&&d.width(n);var s=d.frame.bounds().h,o=Math.max(d.frame.actualWidth(),e.clientWidth),h=e.clientHeight;parseFloat($(i).css("zoom")),t.width=1*e.clientWidth,t.height=1*h,t.style.width=e.clientWidth+"px",t.style.height=h+"px",t.style.top=e.scrollTop+"px",i.style.width=e.clientWidth+"px",i.style.height=Math.max(s,e.clientHeight)+"px",s<e.clientHeight-50&&d.frame.actualWidth(),e.style.overflow="hidden";var l=t.getContext("2d");l.scale(E.carotaScale,E.carotaScale),console.log(e.scrollTop),l.clearRect(0,0,o,h),l.translate(0,C()-e.scrollTop),d.draw(l,r(0,e.scrollTop,o,h)),d.drawSelection(l,g||document.activeElement===a)};s.handleEvent(e,"scroll",T),s.handleEvent(a,"input",(function(){var e=a.value;m!=e&&(m="",a.value="",e===f&&(e=p),d.insert(e))}));var S=function(){u=null===u?d.selection.end:u;var t=d.byOrdinal(u);if(u=null,t){var i=t.bounds();o.style.left=i.l*E.carotaScale+"px",o.style.top=i.t*E.carotaScale+"px",a.focus(),Math.max(0,(i.t+i.h)*E.carotaScale-(e.scrollTop+e.clientHeight))&&(e.scrollTop+=(i.t+i.h)*E.carotaScale-(e.scrollTop+e.clientHeight)),Math.max(0,e.scrollTop-i.t*E.carotaScale)&&(e.scrollTop-=e.scrollTop-i.t*E.carotaScale);var n=Math.max(0,i.l-(e.scrollLeft+e.clientWidth));(n=0)&&(e.scrollLeft+=n);var s=Math.max(0,e.scrollLeft-i.l);(s=0)&&(e.scrollLeft-=s),n=0,s=0}m=d.selectedRange().plainText(),a.value=m,a.select(),setTimeout((function(){a.focus()}),10)};function M(e,t){s.handleMouseEvent(i,e,(function(e,i,n){t(d.byCoordinate(i,n-C()),e.button,e.detail)}))}d.selectionChanged((function(e,t){T(),g||!1!==t&&S()})),M("mousedown",(function(e,t,i){if(2!=t){if(g=e.ordinal,3!=i)d.select(e.ordinal,e.ordinal);else{var n=e.word.line.ordinal,s=n+e.word.line.length;d.select(n,s)}l=null}})),M("dblclick",(function(e){(e=e.parent())&&d.select(e.ordinal,e.ordinal+(e.word?e.word.text.length:e.length))})),M("mousemove",(function(e,t){2!=t&&null!==g&&e&&(u=e.ordinal,g>e.ordinal?d.select(e.ordinal,g):d.select(g,e.ordinal))})),M("mouseup",(function(e,t){2!=t&&(g=null,l=null,S(),a.focus())}));var k=(new Date).getTime(),A=!1,D=e.clientWidth,P=e.clientHeight,N=function(){var t=!1,i=document.activeElement===a;A!==i&&(A=i,t=!0);var n=(new Date).getTime();n>k&&(k=n+500,d.toggleCaret()&&(t=!0)),e.clientWidth===D&&e.clientHeight===P||(t=!0,D=e.clientWidth,P=e.clientHeight),t&&T()};return s.handleEvent(t,"carotaEditorSharedTimer",N),N(),d.sendKey=_,d}},"frame.js":function(e,t,i){var n=i("./node"),s=i("./wrap"),r=i("./rect"),o=n.derive({bounds:function(){if(!this._bounds){var e=0,t=0,i=0,n=0;if(this.lines.length){var s=this.lines[0].bounds();e=s.l,t=s.t,this.lines.forEach((function(e){var t=e.bounds();i=Math.max(i,t.l+t.w),n=Math.max(n,t.t+t.h)}))}this._bounds=r(e,t,i-e,this.height||n-t)}return this._bounds},actualWidth:function(){if(!this._actualWidth){var e=0;this.lines.forEach((function(t){"number"==typeof t.actualWidth&&(e=Math.max(e,t.actualWidth))})),this._actualWidth=e}return this._actualWidth},children:function(){return this.lines},parent:function(){return this._parent},draw:function(e,t){t&&t.t,t?(t.t,t.h):Number.MAX_VALUE,this.lines.some((function(i){i.bounds(),i.draw(e,t)}))},type:"frame"});t.exports=function(e,t,i,n,r,a,d,h){var l=[],c=Object.create(o,{lines:{value:l},_parent:{value:r},ordinal:{value:n}}),g=s(e,t,i,n,c,a,d,h),u=0,m=0;return function(e,t){if(g((function(e){"number"==typeof e?m=e:(u=e.ordinal+e.length-n,l.push(e))}),t))return Object.defineProperty(c,"length",{value:u}),Object.defineProperty(c,"height",{value:m}),e(c),!0}}},"html.js":function(e,t,i){var n=i("./runs"),s=i("per"),r=function(e,t){return function(i,n){i.nodeName===e&&(n[t]=!0)}},o=function(e,t,i,n){return function(s,r){var o=s[e]&&s[e][t];o&&(n&&(o=n(o)),r[i]=o)}},a=function(e,t,i){return o("attributes",e,t,i)},d=function(e,t,i){return o("style",e,t,i)},h=function(e,t,i){return function(n,s){n.style&&n.style[e]===t&&(s[i]=!0)}},l=[6,7,9,10,12,16,20,30],c={left:!0,center:!0,right:!0,justify:!0},g=function(e){return c[e]?e:"left"},u=function(e){var t=e.split(/\s*,\s*/g);if(0==t.length)return e;var i=(e=t[0]).match(/^"(.*)"$/);return i||(i=e.match(/^'(.*)'$/))?i[1].trim():e},m={H1:30,H2:20,H3:16,H4:14,H5:12},p=[r("B","bold"),r("STRONG","bold"),r("I","italic"),r("EM","italic"),r("U","underline"),r("S","strikeout"),r("STRIKE","strikeout"),r("DEL","strikeout"),h("fontWeight","bold","bold"),h("fontStyle","italic","italic"),h("textDecoration","underline","underline"),h("textDecoration","line-through","strikeout"),d("color","color"),d("fontFamily","font",u),d("fontSize","size",(function(e){var t=e.match(/^([\d\.]+)pt$/);return t?parseFloat(t[1]):10})),d("textAlign","align",g),function(e,t){"SUB"===e.nodeName&&(t.script="sub")},function(e,t){"SUPER"===e.nodeName&&(t.script="super")},function(e,t){"CODE"===e.nodeName&&(t.font="monospace")},function(e,t){var i=m[e.nodeName];i&&(t.size=i)},a("color","color"),a("face","font",u),a("align","align",g),a("size","size",(function(e){return l[e]||10}))],f={};["BR","P","H1","H2","H3","H4","H5"].forEach((function(e){f[e]=!0})),e.parse=function(e,t){var i=e;"string"==typeof i&&((i=document.createElement("div")).innerHTML=e);var r=[],o=!0,a=s(n.consolidate()).into(r),d=function(e,t){a.submit(Object.create(t,{text:{value:e}}))};return function e(i,n){if(3==i.nodeType)!function(e,t){var i=(e=e.replace(/\n+\s*/g," ")).length;e=e.replace(/^\s+/,""),o?o=!1:i!==e.length&&(e=" "+e),(i=e.length)!==(e=e.replace(/\s+$/,"")).length&&(o=!0,e+=" "),d(e,t)}(i.nodeValue,n);else{n=Object.create(n);var s=i.attributes.class;if(s&&s.value.split(" ").forEach((function(e){(e=t[e])&&Object.keys(e).forEach((function(t){n[t]=e[t]}))})),p.forEach((function(e){e(i,n)})),i.childNodes)for(var r=0;r<i.childNodes.length;r++)e(i.childNodes[r],n);f[i.nodeName]&&(d("\n",n),o=!0)}}(i,{}),r}},"line.js":function(e,t,i){var n=i("./positionedword"),s=i("./rect"),r=i("./node"),o=(i("./runs"),r.derive({bounds:function(e){if(e){var t=this.first().bounds(),i=this.last().bounds();return s(t.l,this.baseline-this.ascent,i.l+i.w-t.l,this.ascent+this.descent)}return s(this.left,this.baseline-this.ascent,this.width/E.carotaScale,this.ascent+this.descent)},parent:function(){return this.doc},children:function(){return this.positionedWords},type:"line"}));t.exports=function(e,t,i,s,r,a,d,h){var l=d[0].align(),c=Object.create(o,{doc:{value:e},left:{value:t},width:{value:i},baseline:{value:s},ascent:{value:r},descent:{value:a},ordinal:{value:h},align:{value:l}}),g=0;d.forEach((function(e){g+=e.width})),i/=E.carotaScale,g-=d[d.length-1].space.width;var u=0,m=0;if(g<i)switch(l){case"right":u=i-g;break;case"center":u=(i-g)/2;break;case"justify":d.length>1&&!d[d.length-1].isNewLine()&&(m=(i-g)/(d.length-1))}return Object.defineProperty(c,"positionedWords",{value:d.map((function(e){var t=u;u+=e.width+m;var i=h;return h+=e.text.length+e.space.length,n(e,c,t,i,e.width+m)}))}),Object.defineProperty(c,"actualWidth",{value:g}),Object.defineProperty(c,"length",{value:h-c.ordinal}),c}},"node.js":function(e,t,i){i("per"),i("./runs");var n=i("./rect"),s=i("./util");e.prototype={children:function(){return[]},parent:function(){return null},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},next:function(){for(var e=this;;){var t=e.parent();if(!t)return null;var i=t.children(),n=i[i.indexOf(e)+1];if(n){for(;;){var s=n.first();if(!s)break;n=s}return n}e=t}},previous:function(){var e=this.parent();if(!e)return null;var t=e.children(),i=t[t.indexOf(this)-1];if(i)return i;var n=e.previous();return n?n.last():null},byOrdinal:function(e){var t=null;return this.children().some((function(i){if(e>=i.ordinal&&e<i.ordinal+i.length&&(t=i.byOrdinal(e)))return!0}))?t:this},byCoordinate:function(e,t){var i;if(this.children().some((function(n){if(n.bounds().contains(e,t)&&(i=n.byCoordinate(e,t)))return!0})),!i){for(i=this.last();i;){var n=i.last();if(!n)break;i=n}var s=i.next();s&&s.block&&(i=s)}return i},draw:function(e,t){this.children().forEach((function(i){i.draw(e,t)}))},parentOfType:function(e){var t=this.parent();return t&&(t.type===e?t:t.parentOfType(e))},bounds:function(){var e=this._left,t=this._top,i=0,s=0;return this.children().forEach((function(n){var r=n.bounds();e=Math.min(e,r.l),t=Math.min(t,r.t),i=Math.max(i,r.l+r.w),s=Math.max(s,r.t+r.h)})),n(e,t,i-e,s-t)}},e.derive=function(t){return s.derive(e.prototype,t)};var r=e.derive({children:function(){return this._children},parent:function(){return this._parent},finalize:function(e,t){var i=Number.MAX_VALUE,n=0;this._children.forEach((function(e){i=Math.min(i,e.ordinal),n=Math.max(n,e.ordinal+e.length)})),Object.defineProperty(this,"ordinal",{value:i-(e||0)}),Object.defineProperty(this,"length",{value:(t||0)+n-i})}});e.generic=function(e,t,i,n){return Object.create(r,{type:{value:e},_children:{value:[]},_parent:{value:t},_left:{value:"number"==typeof i?i:Number.MAX_VALUE},_top:{value:"number"==typeof n?n:Number.MAX_VALUE}})}},"part.js":function(e,t,i){var n=i("./text"),s={measure:function(e){var t=t.measure("?",e);return{width:t.width+4,ascent:t.width+2,descent:t.width+2}},draw:function(e,t,i,n,s,r){e.fillStyle="silver",e.fillRect(t,i-s,n,s+r),e.strokeRect(t,i-s,n,s+r),e.fillStyle="black",e.fillText("?",t+2,i)}},r={draw:function(e,t,i){"string"==typeof this.run.text?n.draw(e,this.run.text,this.run,t,i,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(e.save(),this.code.draw(e,t,i,this.width,this.ascent,this.descent,this.run),e.restore())}};t.exports=function(e,t){var i,o,a;"string"==typeof e.text?(o=1===e.text.length&&"\n"===e.text[0],i=n.measure(o?n.nbsp:e.text,e)):i=(a=t(e.text)||s).measure?a.measure(e):{width:0,ascent:0,descent:0};var d=Object.create(r,{run:{value:e},isNewLine:{value:o},width:{value:o?0:i.width},ascent:{value:i.ascent},descent:{value:i.descent}});return a&&Object.defineProperty(d,"code",{value:a}),d}},"positionedword.js":function(e,t,i){var n=i("./rect"),s=i("./part"),r=i("./text"),o=i("./node"),a=(i("./word"),i("./runs")),d=function(e){return r.measure(r.enter,e).width},h=o.derive({bounds:function(){var e=this.word.bounds(),t=this.word.word.isNewLine()?d(this.word.word.run):this.width||this.part.width;return n(e.l+this.left,e.t,t,e.h)},parent:function(){return this.word},byOrdinal:function(){return this},byCoordinate:function(e,t){return e<=this.bounds().center().x?this:this.next()},type:"character"}),l=o.derive({draw:function(e){this.word.draw(e,this.line.left+this.left,this.line.baseline)},bounds:function(){return n(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?d(this.word.run):this.width,this.line.ascent+this.line.descent)},parts:function(e){this.word.text.parts.some(e)||this.word.space.parts.some(e)},realiseCharacters:function(){if(!this._characters){var e=[],t=0,i=this,n=this.ordinal,r=this.parentOfType("document").codes;this.parts((function(o){a.pieceCharacters((function(a){var d=Object.create(o.run);d.text=a;var l=s(d,r);e.push(Object.create(h,{left:{value:t},part:{value:l},word:{value:i},ordinal:{value:n},length:{value:1}})),t+=l.width,n++}),o.run.text)}));var o=e[e.length-1];o&&(Object.defineProperty(o,"width",{value:this.width-o.left}),(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&Object.defineProperty(o,"newLine",{value:!0})),this._characters=e}},children:function(){return this.realiseCharacters(),this._characters},parent:function(){return this.line},type:"word"});t.exports=function(e,t,i,n,s){return Object.create(l,{word:{value:e},line:{value:t},left:{value:i},width:{value:s},ordinal:{value:n},length:{value:e.text.length+e.space.length}})}},"range.js":function(e,t,i){var n=i("per"),s=i("./runs");function r(e,t,i){this.doc=e,this.start=t,this.end=i,t>i&&(this.start=i,this.end=t)}r.prototype.parts=function(e,t){t=t||this.doc.children();var i=this;t.some((function(t){return!(t.ordinal+t.length<=i.start)&&(t.ordinal>=i.end||void(t.ordinal>=i.start&&t.ordinal+t.length<=i.end?e(t):i.parts(e,t.children())))}))},r.prototype.clear=function(){return this.setText([])},r.prototype.setText=function(e){return this.doc.splice(this.start,this.end,e)},r.prototype.runs=function(e){this.doc.runs(e,this)},r.prototype.plainText=function(){return n(this.runs,this).map(s.getPlainText).all().join("")},r.prototype.save=function(){return n(this.runs,this).per(s.consolidate()).all()},r.prototype.getFormatting=function(){var e=this;if(e.start===e.end){var t=e.start;t>0&&t--,e.start=t,e.end=t+1}return n(e.runs,e).reduce(s.merge).last()||s.defaultFormatting},r.prototype.setFormatting=function(e,t){var i=this;if("align"===e&&(i=i.doc.paragraphRange(i.start,i.end)),i.start===i.end)i.doc.modifyInsertFormatting(e,t);else{var n=i.save(),r={};r[e]=t,s.format(n,r),i.setText(n)}},t.exports=function(e,t,i){return new r(e,t,i)}},"rect.js":function(e,t,i){var n={contains:function(e,t){return e>=this.l&&e<this.l+this.w&&t>=this.t&&t<this.t+this.h},stroke:function(e){e.strokeRect(this.l,this.t,this.w,this.h)},fill:function(e){e.fillRect(this.l,this.t,this.w,this.h)},offset:function(e,t){return s(this.l+e,this.t+t,this.w,this.h)},equals:function(e){return this.l===e.l&&this.t===e.t&&this.w===e.w&&this.h===e.h},center:function(){return{x:this.l+this.w/2,y:this.t+this.h/2}}},s=t.exports=function(e,t,i,s){return Object.create(n,{l:{value:e},t:{value:t},w:{value:i},h:{value:s},r:{value:e+i},b:{value:t+s}})}},"runs.js":function(e,t,i){e.formattingKeys=["bold","italic","underline","strikeout","color","font","size","align","script"],e.defaultFormatting={size:10,font:"sans-serif",color:"black",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal"},e.sameFormatting=function(t,i){return e.formattingKeys.every((function(e){return t[e]===i[e]}))},e.clone=function(t){var i={text:t.text};return e.formattingKeys.forEach((function(n){var s=t[n];s&&s!=e.defaultFormatting[n]&&(i[n]=s)})),i},e.multipleValues={},e.merge=function(t,i){if(1===arguments.length)return Array.isArray(t)?t.reduce(e.merge):t;if(arguments.length>2)return e.merge(Array.prototype.slice.call(arguments,0));var n={};return e.formattingKeys.forEach((function(s){(s in t||s in i)&&(t[s]===i[s]?n[s]=t[s]:n[s]=e.multipleValues)})),n},e.format=function(t,i){Array.isArray(t)?t.forEach((function(t){e.format(t,i)})):Object.keys(i).forEach((function(n){i[n]!==e.multipleValues&&(t[n]=i[n])}))},e.consolidate=function(){var t;return function(i,n){t&&e.sameFormatting(t,n)&&"string"==typeof t.text&&"string"==typeof n.text?t.text+=n.text:i(t=e.clone(n))}},e.getPlainText=function(t){if("string"==typeof t.text)return t.text;if(Array.isArray(t.text)){var i=[];return t.text.forEach((function(t){i.push(e.getPiecePlainText(t))})),i.join("")}return"_"},e.getPieceLength=function(e){return e.length||1},e.getPiecePlainText=function(e){return e.length?e:"_"},e.getTextLength=function(t){if("string"==typeof t)return t.length;if(Array.isArray(t)){var i=0;return t.forEach((function(t){i+=e.getPieceLength(t)})),i}return 1},e.getSubText=function(t,i,n,s){if(0!==s)if("string"!=typeof i)if(Array.isArray(i)){var r=0;i.some((function(i){if(s<=0)return!0;var o=e.getPieceLength(i);if(r+o>n)if(1===o)t(i),s-=1;else{var a=i.substr(Math.max(0,n-r),s);t(a),s-=a.length}r+=o}))}else t(i);else t(i.substr(n,s))},e.getTextChar=function(t,i){var n;return e.getSubText((function(e){n=e}),t,i,1),n},e.pieceCharacters=function(e,t){if("string"==typeof t)for(var i=0;i<t.length;i++)e(t[i]);else e(t)}},"split.js":function(e,t,i){t.exports=function(e){var t=null,i=null,n=!0;return function(s,r){var o;if(null===r.char)o=!0;else if(n&&(o=!0,n=!1),"string"==typeof r.char)switch(r.char){case" ":i||(i=r);break;case"\n":o=!0,n=!0;break;default:i&&(o=!0)}else{var a=e(r.char);(a.block||a.eof)&&(o=!0,n=!0)}if(o){if(t&&!t.equals(r)){if(!1===s({text:t,spaces:i||r,end:r}))return!1;i=null}null===r.char&&s(null),t=r}}}},"text.js":function(e,t,i){var n=i("./runs"),s=e.getFontString=function(e){var t=e&&e.size||n.defaultFormatting.size;if(e)switch(e.script){case"super":case"sub":t*=.8}return(e&&e.italic?"italic ":"")+(e&&e.bold?"bold ":"")+" "+t+"pt "+(e&&e.font||n.defaultFormatting.font)};e.applyRunStyle=function(e,t){e.fillStyle=t&&t.color||n.defaultFormatting.color,e.font=s(t)},e.prepareContext=function(e){e.textAlign="left",e.textBaseline="alphabetic"},e.getRunStyle=function(e){var t=["font: ",s(e),"; color: ",e&&e.color||n.defaultFormatting.color];if(e)switch(e.script){case"super":t.push("; vertical-align: super");break;case"sub":t.push("; vertical-align: sub")}return t.join("")};var r=e.nbsp=String.fromCharCode(160),o=(e.enter=r,e.measureText=function(e,t){var i,n,s;i=document.createElement("span"),n=document.createElement("div"),s=document.createElement("div"),n.style.display="inline-block",n.style.width="1px",n.style.height="0",s.style.visibility="hidden",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="500px",s.style.height="200px",s.appendChild(i),s.appendChild(n),document.body.appendChild(s);try{i.setAttribute("style",t),i.innerHTML="",i.appendChild(document.createTextNode(e.replace(/\s/g,r)));var o={};n.style.verticalAlign="baseline",o.ascent=n.offsetTop-i.offsetTop,n.style.verticalAlign="bottom",o.height=n.offsetTop-i.offsetTop,o.descent=o.height-o.ascent,o.width=i.offsetWidth}finally{s.parentNode.removeChild(s),s=null}return o}),a=e.createCachedMeasureText=function(){var e={};return function(t,i){var n=i+"<>!&%"+t,s=e[n];return s||(e[n]=s=o(t,i)),s}};e.cachedMeasureText=a(),e.measure=function(t,i){return e.cachedMeasureText(t,e.getRunStyle(i))},e.draw=function(t,i,n,s,r,o,a,d){switch(e.prepareContext(t),e.applyRunStyle(t,n),n.script){case"super":r-=a*(1/3);break;case"sub":r+=d/2}t.fillText("\n"===i?e.enter:i,s,r),n.underline&&t.fillRect(s,1+r,o,1),n.strikeout&&t.fillRect(s,1+r-a/2,o,1)}},"util.js":function(e,t,i){e.event=function(){var e=[],t=function(t){e.push(t)};return t.fire=function(){var t=Array.prototype.slice.call(arguments,0);e.forEach((function(e){e.apply(null,t)}))},t},e.derive=function(e,t){var i={};return Object.keys(t).forEach((function(e){i[e]={value:t[e]}})),Object.create(e,i)}},"word.js":function(e,t,i){var n=i("per"),s=i("./part"),r=i("./runs"),o={isNewLine:function(){return 1==this.text.parts.length&&this.text.parts[0].isNewLine},code:function(){return 1==this.text.parts.length&&this.text.parts[0].code},codeFormatting:function(){return 1==this.text.parts.length&&this.text.parts[0].run},draw:function(e,t,i){n(this.text.parts).concat(this.space.parts).forEach((function(n){n.draw(e,t,i),t+=n.width}))},plainText:function(){return this.text.plainText+this.space.plainText},align:function(){var e=this.text.parts[0];return e?e.run.align:"left"},runs:function(e,t){var i=t&&t.start||0,n=t&&t.end;"number"!=typeof n&&(n=Number.MAX_VALUE),[this.text,this.space].forEach((function(t){t.parts.some((function(t){if(i>=n||n<=0)return!0;var s=t.run,r=s.text;if("string"==typeof r){if(i<=0&&n>=r.length)e(s);else if(i<r.length){var o=Object.create(s),a=Math.max(0,i);o.text=r.substr(a,Math.min(r.length,n-a)),e(o)}i-=r.length,n-=r.length}else i<=0&&n>=1&&e(s),i--,n--}))}))}},a=function(e,t){var i={parts:n(e).map((function(e){return s(e,t)})).all(),ascent:0,descent:0,width:0,length:0,plainText:""};return i.parts.forEach((function(e){i.ascent=Math.max(i.ascent,e.ascent),i.descent=Math.max(i.descent,e.descent),i.width+=e.width,i.length+=r.getPieceLength(e.run.text),i.plainText+=r.getPiecePlainText(e.run.text)})),i};t.exports=function(e,t){var i,n;e?(i=e.text.cut(e.spaces),n=e.spaces.cut(e.end)):(i=[{text:"\n"}],n=[]),i=a(i,t),n=a(n,t);var s=Object.create(o,{text:{value:i},space:{value:n},ascent:{value:Math.max(i.ascent,n.ascent)},descent:{value:Math.max(i.descent,n.descent)},width:{value:i.width+n.width,configurable:!0},length:{value:i.length+n.length}});return e||Object.defineProperty(s,"eof",{value:!0}),s}},"wrap.js":function(e,t,i){var n=i("./line");t.exports=function(e,t,i,s,r,o,a,d){var h,l=[],c=0,g=a||0,u=d||0,m=0,p=t,f=function(e,t){l.push(e),c+=e.width,g=Math.max(g,e.ascent),u=Math.max(u,e.descent),e.isNewLine()&&(v(t),m=e.ascent+e.descent)},v=function(t){if(!h&&0!==l.length){var o=n(r,e,i,p+g,g,u,l,s);s+=o.length,h=t(o),p+=g+u,l.length=0,c=g=u=0}},w=null;return function(n,a){if(w){m=0;var d=w(a);d&&(w=null,s+=d.length,p+=d.bounds().h,Object.defineProperty(d,"block",{value:!0}),n(d))}else{var g=a.code();g&&g.block?(l.length?v(n):p+=m,w=g.block(e,p,i,s,r,a.codeFormatting()),m=0):g&&g.eof||a.eof?((!g||o&&o(g))&&f(a,n),l.length?(v(n),n(p-t)):n(p+m-t),h=!0):(m=0,l.length?(null!=E.carotaItemActive&&E.carotaItemActive.autoResizeExtents||c+a.text.width>i/E.carotaScale&&v(n),f(a,n)):f(a,n))}return h}}}}},per:{":mainpath:":"per.js","per.js":function(e,t,i){!function(i){function n(e,t){return"function"!=typeof e?Array.isArray(e)?function(t){return e.some(t)}:function(t){return t(e)}:t?function(i,n){e.call(t,i,n)}:e}function s(e,t){this.forEach=n(e,t)}function r(e,t){e(t)}function o(e,t){return 0===arguments.length?new s(r):e&&e instanceof s?e:new s(e,t)}function a(e){return"string"==typeof e?new Function("x","return "+e):e}function d(e,t){var i=e[t];return"function"==typeof i?i:function(i){e[t]=i}}function h(){}function l(e){return!!e}function c(e,t){return Math.min(e,t)}function g(e,t){return Math.max(e,t)}function u(e,t){return e+t}function m(e,t){return!(!e||!t)}function p(e,t){return!(!e&&!t)}function f(e){return!e}s.prototype.per=function(e,t){var i=this.forEach,s=n(e&&e.forEach||e,t);return o((function(e,t){return i((function(t){return s(e,t)}),t)}))},s.prototype.map=function(e){return e=a(e),this.per((function(t,i){return t(e(i))}))},s.prototype.filter=function(e){return e=a(e),this.per((function(t,i){if(e(i))return t(i)}))},s.prototype.concat=function(e,t){e=e instanceof s?e.forEach:n(e,t);var i=this.forEach;return o((function(t,n){i(t,n),e(t,n)}))},s.prototype.skip=function(e){return this.per((function(t,i){return e>0?(e--,!1):t(i)}))},s.prototype.take=function(e){return this.per((function(t,i){return e<=0||(e--,t(i))}))},s.prototype.listen=function(e){return this.per((function(t,i){return!!e(i)||t(i)}))},s.prototype.flatten=function(){return this.per((function(e,t){return Array.isArray(t)?t.some((function(t){return e(t)})):e(t)}))},s.prototype.reduce=function(e,t){var i=t,n=2==arguments.length;return this.per((function(t,s){t(i=n?e(i,s):s),n=!0}))},s.prototype.multicast=function(e){return 1!==arguments.length&&(e=Array.prototype.slice.call(arguments,0)),e=e.map((function(e){return"function"==typeof e?e:e instanceof s?e.forEach:h})),this.listen((function(t){var i=!0;return e.forEach((function(e){e(h,t)||(i=!1)})),i}))},s.prototype.into=function(e,t){if(!Array.isArray(e))throw new Error("into expects an array");return t=function(e){return"number"!=typeof e?Number.MAX_VALUE:e}(t),this.listen((function(i){if(t<=0)return!0;e.push(i),t--}))},s.prototype.monitor=function(e){var t=0,i=d(e,"count"),n=d(e,"first"),s=d(e,"last"),r=e.limit;return"number"!=typeof r&&(r=Number.MAX_VALUE),r<1?this:this.listen((function(e){if(0===t&&n(e),t++,i(t),s(e),t>=r)return!0}))},s.prototype.submit=function(e){return this.forEach(h,e)},s.prototype.all=function(){var e=[];return this.into(e).submit(),e},s.prototype.first=function(){var e={limit:1};return this.monitor(e).submit(),e.count>0?e.first:void 0},s.prototype.last=function(){var e={};return this.monitor(e).submit(),e.count>0?e.last:void 0},s.prototype.truthy=function(){return this.filter(l)},s.prototype.min=function(){return this.reduce(c,Number.MAX_VALUE)},s.prototype.max=function(){return this.reduce(g,Number.MIN_VALUE)},s.prototype.sum=function(){return this.reduce(u,0)},s.prototype.and=function(){return this.reduce(m,!0)},s.prototype.or=function(){return this.reduce(p,!1)},s.prototype.not=function(){return this.map(f)},o.pulse=function(e){var t=0;return o((function(i){!function n(){!0!==i(t++)&&setTimeout(n,e)}()}))},function(i){void 0===e?this.per=i:t.exports=i}(o)}()}}},F={".js":[],".json":[],".css":[],".html":[]},V=function(e){var t=new Error("Could not find module '"+e+"'");return t.code="MODULE_NOT_FOUND",t},z=function(e,t,i){var n,s;if("function"==typeof e[t+i])return t+i;for(n=0;s=F[i][n];++n)if("function"==typeof e[t+s])return t+s;return null},O=function(e,t,i,n,s,r){var o,a,d,h,l,c;for("."!==(o=(i=i.split("/")).pop())&&".."!==o||(i.push(o),o="");null!=(a=i.shift());)if(a&&"."!==a&&(".."===a?(e=t.pop(),r=r.slice(0,r.lastIndexOf("/"))):(t.push(e),e=e[a],r+="/"+a),!e))throw V(n);if(o&&"function"!=typeof e[o]&&((c=z(e,o,".js"))||(c=z(e,o,".json")),c||(c=z(e,o,".css")),c||(c=z(e,o,".html")),c?o=c:2!==s&&"object"==typeof e[o]&&(t.push(e),e=e[o],r+="/"+o,o="")),!o)return 1!==s&&e[":mainpath:"]?O(e,t,e[":mainpath:"],n,1,r):O(e,t,"index",n,2,r);if(!(l=e[o]))throw V(n);return l.hasOwnProperty("module")?l.module.exports:(d={},l.module=h={exports:d,id:r+"/"+o},l.call(d,d,h,W(e,t,r)),h.exports)},H=function(e,t,n,s){var r,o=n,a=n.charAt(0),d=0;if("/"===a){if(o=o.slice(1),!(e=L["/"]))return i(287)(n);s="/",t=[]}else if("."!==a){if(r=o.split("/",1)[0],!(e=L[r]))return i(287)(n);s=r,t=[],(o=o.slice(r.length+1))||((o=e[":mainpath:"])?d=1:(o="index",d=2))}return O(e,t,o,n,d,s)},(W=function(e,t,i){return function(n){return H(e,[].concat(t),n,i)}})(L,[],""))("carota/src/carota");class R{static plusimage=void 0;static minusimage=void 0;static initialize(){R.plusimage=new Image,R.plusimage.src="js/wbManager/menuimages/mtreeplus.png",R.minusimage=new Image,R.minusimage.src="js/wbManager/menuimages/mtreeminus.png"}constructor(e){this.root=new B("root"),this.nodehash=[],this.ctx=void 0,this.hotSpots=[],this.dimensions=void 0,this.nodeHeight=15,this.openIndent=15,this.scrollY=.5,this.treeHeight=0,this.doScroll=!1,this.showScrollBar=!1,this.hotSpots=[],this.matchingnodes=[],this.selectedCallback=e}add(e,t,i){var n=this.root;null!=e&&(n=this.nodehash[e]);var s=new B(t,i);this.nodehash[i]=s,n.addChild(s)}setExpanded(e,t){var i=this.root;null!=e&&(i=this.nodehash[e]),i.setExpanded(t)}addHotSpot(e,t){this.hotSpots.push({item:e,pos:t})}render(e,t){if(this.hotSpots=[],this.ctx=e,this.dimensions=t,this.startX=this.dimensions.left+this.openIndent,this.treeHeight<this.dimensions.height)this.startY=this.dimensions.top+this.nodeHeight;else{var i=this.treeHeight-t.height;this.startY=this.dimensions.top+this.nodeHeight-this.scrollY*i}this.currentY=this.startY,this.ctx.textAlign="left",this.ctx.font=this.nodeHeight-3+'px "Arial"',this.ctx.fillStyle="rgb(0,0,0)",this.ctx.strokeStyle="rgb(0,0,0)",this.root.render(this,this.startX),this.treeHeight=this.currentY-this.startY,this.ctx.fillStyle="rgb(255,255,255)",e.lineWidth=1/wbMain.getZoomFactor();var n=10/wbMain.getZoomFactor(),s=this.dimensions.height/this.treeHeight;if(this.showScrollBar)if(s>1)s=1;else{var r=this.dimensions.height*s;e.fillRect(this.dimensions.left+this.dimensions.width-n,this.dimensions.top+(this.dimensions.height-r)*this.scrollY,n,r),e.strokeRect(this.dimensions.left+this.dimensions.width-n,this.dimensions.top+(this.dimensions.height-r)*this.scrollY,n,r)}}onMouseDown(e,t,i){var n=10/wbMain.getZoomFactor();return e>this.dimensions.left+this.dimensions.width-n&&e<this.dimensions.left+this.dimensions.width&&(this.doScroll=!0,this.startScrollY=this.scrollY,!0)}onMouseMove(e,t,i){if(this.doScroll){var n=wbMain.getDragStart().y,s=this.dimensions.height/this.treeHeight,r=this.dimensions.height*s,o=(t-n)/(this.dimensions.height-r);return this.scrollY=this.startScrollY+o,this.scrollY>1&&(this.scrollY=1),this.scrollY<0&&(this.scrollY=0),!0}return!1}deselectAll(){for(var e in this.nodehash)this.nodehash[e].setSelected(!1)}gatherMatchingNodes(e){for(var t in this.matchingnodes=[],this.nodehash)if(-1!=this.nodehash[t].text.toLowerCase().indexOf(e.toLowerCase())){var i=this.nodehash[t],n=[];for(n.push(this.nodehash[t].text);;){var s=i.getParent();if(null==s)break;n.push(s.text),i=s}for(var r="",o=n.length-1;o>=0;o--)r+=o>0?n[o]+"->":n[o];var a={name:this.nodehash[t].text,chain:r,id:this.nodehash[t].id,selected:this.nodehash[t].getSelected()};this.matchingnodes.push(a)}return this.matchingnodes}async doSelection(e,t){t==Communicator.SelectionMode.Set&&this.deselectAll();for(var i=!1,n=0;n<e.length;n++)t==Communicator.SelectionMode.Set?(this.nodehash[e[n]].setSelected(!0),i?this.selectedCallback(this.nodehash[e[n]].id,Communicator.SelectionMode.Add):(this.selectedCallback(this.nodehash[e[n]].id,Communicator.SelectionMode.Set),i=!0)):(this.nodehash[e[n]].setSelected(!this.nodehash[e[n]].getSelected()),this.selectedCallback(this.nodehash[e[n]].id,t))}onMouseUp(e,t,i){this.doScroll=!1;var n=this.nodeHeight/2;if(!i)for(var s=0;s<this.hotSpots.length;s++){var r=this.hotSpots[s].pos;if(e>=r.x-n&&e<=r.x+n&&t>=r.y-n&&t<=r.y+n){this.hotSpots[s].item.setExpanded(!this.hotSpots[s].item.getExpanded());break}if(e>=r.x+n&&t>=r.y-n&&t<=r.y+n){wbMain.ctrlPressed?(this.hotSpots[s].item.setSelected(!this.hotSpots[s].item.getSelected()),this.selectedCallback(this.hotSpots[s].item.id,Communicator.SelectionMode.Toggle)):(this.deselectAll(),this.hotSpots[s].item.setSelected(!0),this.selectedCallback(this.hotSpots[s].item.id,Communicator.SelectionMode.Set));break}}}}class B{constructor(e,t){this.text=e,this.children=[],this.expanded=!1,this.selected=!1,this.parent=void 0,this.hotspot=void 0,this.id=t}addChild(e){e.setParent(this),this.children.push(e)}setExpanded(e){this.expanded=e}getExpanded(){return this.expanded}setSelected(e){this.selected=e}getSelected(){return this.selected}setParent(e){this.parent=e}getParent(){return this.parent}render(e,t){if(e.addHotSpot(this,{x:t-e.nodeHeight/2,y:e.currentY-e.nodeHeight/1.5}),this.selected&&(e.ctx.fillStyle="rgb(255,255,0)",e.ctx.fillRect(t,e.currentY-e.nodeHeight/1.5,e.dimensions.left+e.dimensions.width-t,e.nodeHeight),e.ctx.fillStyle="rgb(0,0,0)"),e.ctx.fillText(this.text,t,e.currentY),this.children.length>0&&(this.expanded?e.ctx.drawImage(R.plusimage,t-e.nodeHeight+2,e.currentY-e.nodeHeight/1.5,e.nodeHeight/1.5,e.nodeHeight/1.5):e.ctx.drawImage(R.minusimage,t-e.nodeHeight+2,e.currentY-e.nodeHeight/1.5,e.nodeHeight/1.5,e.nodeHeight/1.5)),e.currentY+=e.nodeHeight,this.expanded){t+=e.openIndent;for(var i=0;i<this.children.length;i++)this.children[i].render(e,t)}}}let U=new function(){var t,i,n,s,r,o,a,d,u=1,m=[],p=[],f=!1,v="";function w(e,t,i){if(i>=e.length)for(var n=i-e.length+1;n--;)e.push(void 0);return e.splice(i,0,e.splice(t,1)[0]),e}return{shiftPressed:!1,ctrlPressed:!1,lastX:0,lastY:0,backendAvailable:!1,carotaEditor:null,mainOuterWindow:"",start:function(t){U.mainOuterWindow="#"+t,v="#mainwindow2",$(U.mainOuterWindow).empty(),$(U.mainOuterWindow).append('<div id="mainwindow2" style="width:100%;height:100%;position:absolute;z-index:1000000"></div>'),$(v).append('<div id="carotadiv" style="position:absolute;z-index:1;width:20%;height:100%;left:10px; display:none;overflow:hidden;margin-left:1px;border-style:none;border-width:1px">Test</div><canvas id="whiteboardcanvas" style="position:absolute;left:0px;top:0px;"></canvas><canvas id="whiteboardcanvasoverlay" style="position:absolute;left:0px;top:0px;pointer-events:none;z-index:100000000"></canvas>'),$(document.body).append('<div id="hcModelCache" style="display:none"></div>'),$(v).append('<div id="newdialogwindow" style="z-index:1000000"></div>'),$(U.mainOuterWindow).append('<div id="menudiv" style="width:100%;height:100%;z-index:10000000000"></div>');var i=document.querySelector("#carotadiv");U.carotaEditor=carota.editor.create(i),U.carotaEditor.contentChanged((function(){E.contentChanged()})),$(document).on("keydown",(e=>{e.ctrlKey?U.ctrlPressed=!0:U.ctrlPressed=!1,e.shiftKey?U.shiftPressed=!0:U.shiftPressed=!1})),$(document).on("keyup",(e=>{var t=e.keyCode;e.ctrlKey?U.ctrlPressed=!0:U.ctrlPressed=!1,e.shiftKey?U.shiftPressed=!0:U.shiftPressed=!1,67==t&&e.ctrlKey&&U.copy(),86==t&&e.ctrlKey&&U.paste()})),$(document).on("mousedown",(e=>{blockRightClick=!1})),$(document).on("mousemove",(e=>{blockRightClick=!0})),U.initialize("whiteboardcanvas","whiteboardcanvasoverlay"),x.initialize("hcModelCache"),e.initialize("menudiv"),M.initialize(),R.initialize()},initialize:function(e,s){t=$("#"+e)[0];var d=$("#"+s)[0];i=t.getContext("2d"),n=d.getContext("2d");var l=$("#"+e).parent()[0].getBoundingClientRect();$("#"+e).attr("width",l.width),$("#"+e).attr("height",l.height),$("#"+s).attr("width",l.width),$("#"+s).attr("height",l.height),U.lastX=t.width/2,U.lastY=t.height/2,function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=t.createSVGMatrix();e.getTransform=function(){return i};var n=[],s=e.save;e.save=function(){return n.push(i.translate(0,0)),s.call(e)};var r=e.restore;e.restore=function(){return i=n.pop(),r.call(e)};var o=e.scale;e.scale=function(t,n){return i=i.scaleNonUniform(t,n),o.call(e,t,n)};var a=e.rotate;e.rotate=function(t){return i=i.rotate(180*t/Math.PI),a.call(e,t)};var d=e.translate;e.translate=function(t,n){return i=i.translate(t,n),d.call(e,t,n)};var h=e.transform;e.transform=function(n,s,r,o,a,d){var l=t.createSVGMatrix();return l.a=n,l.b=s,l.c=r,l.d=o,l.e=a,l.f=d,i=i.multiply(l),h.call(e,n,s,r,o,a,d)};var l=e.setTransform;e.setTransform=function(t,n,s,r,o,a){return i.a=t,i.b=n,i.c=s,i.d=r,i.e=o,i.f=a,l.call(e,t,n,s,r,o,a)};var c=t.createSVGPoint();e.transformedPoint=function(e,t){return c.x=e,c.y=t,c.matrixTransform(i.inverse())},e.transformedPoint2=function(e,t){return c.x=e,c.y=t,c.matrixTransform(i)}}(i),A.initialize(i),h.initialize(),r=new N(i,n),$(v).on("mousedown",(e=>{var t,i,n=$(v).offset();t=e.clientX-n.left,i=e.clientY-n.top,r.onMouseDown(t,i,e.button),e.stopPropagation()})),setInterval((function(){U.backendAvailable&&U.serializeToNode()}),500),$(window).resize((function(){var t=$(window);$("#"+e).attr("width",t.width()),$("#"+e).attr("height",t.height()),$("#"+s).attr("width",t.width()),$("#"+s).attr("height",t.height()),U.redraw()})),$(v).on("touchstart",(e=>{e.touches.length>1?(a=new Communicator.Point2((e.touches[1].pageX+e.touches[0].pageX)/2,(e.touches[1].pageY+e.touches[0].pageY)/2),o=new Communicator.Point2(e.touches[1].pageX-e.touches[0].pageX,e.touches[1].pageY-e.touches[0].pageY).length(),r.onMouseDown(a.x,a.y,2)):r.onMouseDown(e.touches[0].pageX,e.touches[0].pageY,0)})),$(v).on("mousemove",(e=>{var t,i,n=$(v).offset();t=e.clientX-n.left,i=e.clientY-n.top,r.onMouseMove(t,i,e.button),e.stopPropagation()})),$(v).on("touchmove",(e=>{if(1!==e.scale&&e.preventDefault(),console.log(e.scale),e.touches.length>1){r.onMouseMove(e.touches[0].pageX,e.touches[0].pageY,2);var t=new Communicator.Point2((e.touches[1].pageX+e.touches[0].pageX)/2,(e.touches[1].pageY+e.touches[0].pageY)/2);r.onMouseMove(t.x,t.y,2);var i=new Communicator.Point2(e.touches[1].pageX-e.touches[0].pageX,e.touches[1].pageY-e.touches[0].pageY).length();U.zoomTouch(t.x,t.y,i/o),o=i,a=t,U.respositionNonCanvasItems()}else r.onMouseMove(e.touches[0].pageX,e.touches[0].pageY,0)})),$(v).on("touchend",(e=>{r.onMouseUp(0,0,0)})),$(v).on("mouseup",(e=>{r.onMouseUp(e),e.stopPropagation()})),t.addEventListener("DOMMouseScroll",(function(e){r.onMouseWheel(e)}),!1),t.addEventListener("mousewheel",(function(e){r.onMouseWheel(e)}),!1),this.loadFromNode(),this.redraw()},convertWindowToCanvasCoordinates:function(e){var t=i.transformedPoint(e.left,e.top),n=i.transformedPoint(e.left+e.width,e.top+e.height);return{left:t.x,top:t.y,width:n.x-t.x,height:n.y-t.y}},convertCanvasToWindowCoordinates:function(e){var t=i.transformedPoint2(e.left,e.top),n=i.transformedPoint2(e.left+e.width,e.top+e.height);return{left:t.x,top:t.y,width:n.x-t.x,height:n.y-t.y}},clearSelection:function(){for(var e=0;e<m.length;e++)m[e].setSelected(!1)},setSelected:function(e){for(var t=0;t<m.length;t++)e==t?m[t].setSelected(!0):m[t].setSelected(!1)},selectRelatedGroups:function(){for(var e=[],t=0;t<m.length;t++)if(1==m[t].getSelected()){var i=m[t].getGroup();null!=i&&(e[i]=!0)}for(var t in e)for(var n=0;n<m.length;n++)m[n].getGroup()==t&&m[n].setSelected(!0)},getItemByIndex:function(e){return m[e]},redraw:function(){var e=i.transformedPoint(0,0),o=i.transformedPoint(t.width,t.height),a=e.x%80,d=e.y%80;if(i.clearRect(e.x,e.y,o.x-e.x,o.y-e.y),n.clearRect(e.x,e.y,o.x-e.x,o.y-e.y),i.fillStyle="rgb(179,185,194)",i.getTransform().a>.155)for(var h=e.x-a;h<o.x;h+=80)for(var l=e.y-d;l<o.y;l+=80)i.fillRect(h,l,5,5);i.strokeStyle="#000000",i.fillStyle="rgb(255,255,255)";for(var c=0;c<m.length;c++)m[c].render(i,n);if(null!=s){var g=r.dragStart,u=i.transformedPoint(U.lastX,U.lastY);n.strokeStyle="rgb(0,0,0)",n.fillStyle="rgb(255,255,255)",n.lineWidth=1/i.getTransform().a,n.strokeRect(g.x,g.y,u.x-g.x,u.y-g.y),n.globalAlpha=.2,n.fillRect(g.x,g.y,u.x-g.x,u.y-g.y),n.globalAlpha=1}if(r.drawSelectionRectangle)g=r.dragStart,u=i.transformedPoint(U.lastX,U.lastY),n.strokeStyle="rgb(0,0,255)",n.fillStyle="rgb(0,0,255)",n.lineWidth=1/i.getTransform().a,n.strokeRect(g.x,g.y,u.x-g.x,u.y-g.y),n.globalAlpha=.2,n.fillRect(g.x,g.y,u.x-g.x,u.y-g.y),n.globalAlpha=1;else{var p=this.calculateSelectionBounding(!1);if(null!=p){var f=p.bounding;n.strokeStyle="rgb(0,0,255)",n.fillStyle="rgb(255,255,255)",n.lineWidth=1/i.getTransform().a,n.strokeRect(f.x1,f.y1,f.x2-f.x1,f.y2-f.y1),n.beginPath(),n.arc(f.x2,f.y2,5/i.getTransform().a,0,2*Math.PI),n.fill(),n.stroke(),n.beginPath(),n.arc(f.x1,f.y1,5/i.getTransform().a,0,2*Math.PI),n.fill(),n.stroke(),n.beginPath(),n.arc(f.x1,f.y2,5/i.getTransform().a,0,2*Math.PI),n.fill(),n.stroke(),n.beginPath(),n.arc(f.x2,f.y1,5/i.getTransform().a,0,2*Math.PI),n.fillStyle="rgb(255,255,255)",n.fill(),n.stroke(),n.fillRect((f.x2+f.x1)/2-5/i.getTransform().a,f.y1-5/i.getTransform().a,10/i.getTransform().a,10/i.getTransform().a),n.strokeRect((f.x2+f.x1)/2-5/i.getTransform().a,f.y1-5/i.getTransform().a,10/i.getTransform().a,10/i.getTransform().a)}}},zoom:function(e){var t=i.transformedPoint(U.lastX,U.lastY);i.translate(t.x,t.y);var s=Math.pow(1.1,e);i.scale(s,s),i.translate(-t.x,-t.y),n.translate(t.x,t.y),n.scale(s,s),n.translate(-t.x,-t.y),E.carotaScale=i.getTransform().a,this.redraw()},zoomTouch:function(e,t,s){var r=i.transformedPoint(e,t);i.translate(r.x,r.y),i.scale(s,s),i.translate(-r.x,-r.y),n.translate(r.x,r.y),n.scale(s,s),n.translate(-r.x,-r.y),E.carotaScale=i.getTransform().a,this.redraw()},fitAll:function(){var e=this.calculateCombinedBounding(this.getItems());this.fitSelection(1.5,e)},fitSelection:function(e,t){var n;n=null==t?this.calculateSelectionBounding().bounding:null!=t.x1?t:{x1:t.left,y1:t.top,x2:t.left+t.width,y2:t.top+t.height};var s,r=$("#whiteboardcanvas")[0].getBoundingClientRect(),o=i.getTransform(),a=r.width/(n.x2-n.x1),d=r.height/(n.y2-n.y1);s=a<d?a:d,s-=.1,this.animateCanvasCamera(o.e,o.f,o.a,-n.x1*s+r.width/2-(n.x2-n.x1)/2*s,-n.y1*s+r.height/2-(n.y2-n.y1)/2*s,s,e)},animateCanvasCamera:function(e,t,s,r,o,a,d){var h={x:e,y:t,s};M.hideSelectionMenu(),gsap.to(h,{duration:d,x:r,y:o,s:a,ease:Power2.easeInOut,onUpdate:function(){i.setTransform(h.s,0,0,h.s,h.x,h.y),n.setTransform(h.s,0,0,h.s,h.x,h.y),U.redraw(),U.respositionNonCanvasItems()},onComplete:function(){M.showSelectionMenu()}})},activateItemUnderMouse:function(){this.findwbItemUnderMouse().activate(i),this.redraw()},deactivateAll:function(e){var t=this,i=new Promise((function(i,n){for(var s=[],r=0;r<m.length;r++)!m[r].getActive()||m[r].getType()==l.wbItemHC&&1!=e||s.push(m[r].deactivate());e&&(S.activeHCItem=void 0),Promise.all(s).then((function(){setTimeout((function(){t.redraw()}),200),i()}))}));return i},findwbItemIndexUnderMouse:function(){for(var e=i.transformedPoint(U.lastX,U.lastY),t=m.length-1;t>=0;t--)if(m[t].pointInsideItem(e))return t},findwbItemUnderMouse:function(){for(var e=i.transformedPoint(U.lastX,U.lastY),t=m.length-1;t>=0;t--)if(m[t].pointInsideItem(e))return m[t]},findwbItemHCUnderMouse:function(){var e=this.findwbItemUnderMouse();if(null!=e)return e.getType()==l.wbItemHC?e:void 0},selectFromRectangle:function(e){for(var t=i.transformedPoint(U.lastX,U.lastY),n=0;n<m.length;n++){var s=m[n].getDimensions();s.left<e.x&&s.left+s.width<e.x||s.left>t.x&&s.left+s.width>t.x||s.top<e.y&&s.top+s.height<e.y||s.top>t.y&&s.top+s.height>t.y?m[n].setSelected(!1):m[n].setSelected(!0)}this.selectRelatedGroups()},getSelectedItems(){for(var e=[],t=0;t<m.length;t++)m[t].getSelected()&&e.push(m[t]);return e},getLineItems(){for(var e=[],t=0;t<m.length;t++)m[t].getType()==l.wbLine&&e.push(m[t]);return e},getCachedSelectedItems:()=>r.cachedSelectedItems,getCachedLineItems:()=>r.cachedLineItems,calculateSelectionBounding:function(e){for(var t={x1:Number.MAX_VALUE,y1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=!1,n=!1,s=0;s<m.length;s++){var r;m[s].getSelected()&&(i=!0,((m[s].getType()==l.wbItemHC||null!=m[s].getImage()&&null==m[s].getDiv())&&!m[s].getActive()||m[s].getShape()==c.circle)&&(n=!0),r=e?m[s].getTempDimensions():m[s].getDimensions(),t.x1>r.left&&(t.x1=r.left),t.x2<r.left+r.width&&(t.x2=r.left+r.width),t.y1>r.top&&(t.y1=r.top),t.y2<r.top+r.height&&(t.y2=r.top+r.height))}return i?{bounding:t,keepAspectRatio:n}:void 0},calculateCombinedBounding:function(e){for(var t={x1:Number.MAX_VALUE,y1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=0;i<e.length;i++){let n=e[i].getDimensions();t.x1>n.left&&(t.x1=n.left),t.x2<n.left+n.width&&(t.x2=n.left+n.width),t.y1>n.top&&(t.y1=n.top),t.y2<n.top+n.height&&(t.y2=n.top+n.height)}return{left:t.x1,top:t.y1,width:t.x2-t.x1,height:t.y2-t.y1}},addItem(e){m.push(e)},handleDelete(){for(var e=[],t=0;t<m.length;t++)m[t].getSelected()||e.push(m[t]);m=e,this.redraw()},bringToFront(){var e=this.findwbItemIndexUnderMouse();if(null!=e){var t=m[e];t.order=m[m.length-1].order+1e6,t.setDirty(),w(m,e,m.length-1),this.redraw()}},sendToBack(e){var t;if(null!=(t=null!=e?e:this.findwbItemIndexUnderMouse())){var i=m[t];i.order=Math.floor(m[0].order/2),i.setDirty(),w(m,t,0),this.redraw()}},setLocked(e){var t=this.findwbItemUnderMouse();null!=t&&0==t.getSelected()&&(this.clearSelection(),t.setSelected(!0),this.selectRelatedGroups());for(var i=0;i<m.length;i++)1==m[i].getSelected()&&m[i].setLocked(e);this.redraw()},setBackgroundColor(e){for(var t=0;t<m.length;t++)1==m[t].getSelected()&&m[t].setBackgroundColor(e);this.redraw()},setShape:function(e){for(var t=0;t<m.length;t++)1==m[t].getSelected()&&m[t].setShape(e);this.redraw()},group(){for(var e=0;e<m.length;e++)1==m[e].getSelected()&&m[e].setGroup(u);u++},ungroup(){for(var e=0;e<m.length;e++)1==m[e].getSelected()&&m[e].setGroup()},addEmptyBox(){var e=new g;e.initialize(),m.push(e),this.redraw()},addTextBox(){var e=new E;e.initialize(),m.push(e),this.redraw()},getItems:()=>m,getItemByGUID(e){for(var t=0;t<m.length;t++)if(m[t].getGUID()==e)return m[t]},setConsecutiveY(e){d=e},getConsecutiveY:()=>d,addFromImage(e){var t=this;e.onload=function(){console.log(this.width+"x"+this.height);var i={top:U.lastY,left:U.lastX,width:this.width,height:this.height},n=t.convertWindowToCanvasCoordinates(i),s=new g;s.initialize(),s.setImage(e),s.setDimensions(n),m.push(s),s.imageDirty=!0,t.redraw()}},addFromImageConsecutive(e){var t=this;e.onload=function(){var i;console.log(this.width+"x"+this.height),null==t.getConsecutiveY()?(i={top:U.lastY,left:U.lastX,width:this.width,height:this.height},t.setConsecutiveY(U.lastY+this.height+50)):(i={top:t.getConsecutiveY(),left:U.lastX,width:this.width,height:this.height},t.setConsecutiveY(t.getConsecutiveY()+this.height+50));var n=t.convertWindowToCanvasCoordinates(i),s=new g;s.initialize(),s.setImage(e),s.setDimensions(n),m.push(s),t.redraw()}},respositionNonCanvasItems(){for(var e=0;e<m.length;e++)m[e].getActive()&&m[e].refreshPositioning()},getZoomFactor:function(){return i.getTransform().a},getCtx:function(){return i},getLastMousePos:function(){return i.transformedPoint(U.lastX,U.lastY)},addFromRectangle(e,t,i){this.clearSelection(),s={type:t,extraData:e,backgroundColor:i}},getRectangleLoadData:()=>s,loadFromLoadData(){var e=i.transformedPoint(U.lastX,U.lastY),t=r.dragStart;if(t.x>e.x){var n=t.x;t.x=e.x,e.x=n}t.y>e.y&&(n=t.y,t.y=e.y,e.y=n);var o={left:t.x,top:t.y,width:e.x-t.x,height:e.y-t.y};if(s.type==l.wbItemHC)S.create(s.extraData,o);else if(s.type==l.wbItemTextEditorNote||s.type==l.wbItemTextEditorText){for(var a=0;a<m.length;a++)m[a].getType()==l.wbItemTextEditor&&m[a].getActive()&&m[a].deactivate();(d=new E).initialize(),s.type==l.wbItemTextEditorNote?(d.autoResizeText=!0,d.setBackgroundColor(s.backgroundColor)):(d.autoResizeExtents=!0,d.setBackgroundColor("rgb(255,255,255)")),d.setDimensions(o),m.push(d),d.activate(i),this.redraw()}else if(s.type==l.wbItem)(d=new g).initialize(),d.setDimensions(o),d.setBackgroundColor(s.backgroundColor),m.push(d),this.sendToBack(m.length-1),this.redraw();else if(s.type==l.wbItemContainer)(d=new wbItemContainer).initialize(),d.setDimensions(o),d.setBackgroundColor(s.backgroundColor),m.push(d),this.sendToBack(m.length-1),this.redraw();else if(s.type==l.wbItemModelTree){var d;(d=new wbItemModelTree).initialize(),d.setDimensions(o),d.setBackgroundColor(s.backgroundColor),m.push(d),this.redraw()}s=void 0},copy(){if(p=[],!this.editorActive())for(var e=0;e<m.length;e++)1==m[e].getSelected()&&p.push(m[e])},editorActive(){for(var e=0;e<m.length;e++)if(m[e].getType()==l.wbItemTextEditor&&1==m[e].getActive())return!0;return!1},paste(){if(!this.editorActive()){for(var e=[],t=0;t<p.length;t++)e.push(p[t].duplicate());this.clearSelection(),Promise.all(e).then((function(e){for(var t=0;t<e.length;t++)e[t]._dimensions.left+=20,e[t]._dimensions.top+=20,e[t].setSelected(!0);U.redraw()}))}},async refreshAll(){S.minFramerate=0;for(var e=0;e<m.length;e++)1==m[e].getSelected()&&(await this.deactivateAll(!0),await m[e].activate(i));S.minFramerate=50},getDragStart:()=>r.dragStart,getDirty:()=>f,setDirty(){f=!0},clearDirty(){f=!1},serializeToNode(){if(null==this.getDragStart()){for(var e=[],t=[],n=window.location.href.split("?")[1].split("=")[1],s=0;s<m.length;s++)1==m[s].getDirty()&&(e.push(m[s].serialize()),m[s].clearDirty()),1==m[s].imageDirty&&(t.push(m[s]),m[s].imageDirty=!1);if(e.length>0||r.getCameraDirty()||this.getDirty()){var o,a,d=i.getTransform();r.getCameraDirty()&&(o={a:d.a,b:d.b,c:d.c,d:d.d,e:d.e,f:d.f}),this.getDirty()&&(a={tags:h.allTags.serialize()}),this.clearDirty(),r.clearCameraDirty();var l={items:e,transform:o,wbdata:a},c=JSON.stringify(l);fetch("api/Items/"+n,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:c})}for(s=0;s<t.length;s++)t[s].postImage(n)}},getTopOrder:()=>m.length>0?m[m.length-1].order+1e6:1e6,async refreshItems(e){for(var t=0;t<e.length;t++)await e[t].activate(i),await e[t].deactivate(),e[t].clearDirty()},loadFromNode(){if(U.backendAvailable){var e=window.location.href.split("?")[1].split("=")[1];fetch("api/Items/"+e).then((function(t){200===t.status?t.json().then((function(t){var s=U.getItems(),r=t.rr.transform,o=t.rr.wbdata;null!=o&&h.allTags.setFromJSON(o.tags),null!=r&&(i.setTransform(r.a,r.b,r.c,r.d,r.e,r.f),n.setTransform(r.a,r.b,r.c,r.d,r.e,r.f));for(var a=[],d=[],c=0;c<t.rr.items.length;c++){var u,m=t.rr.items[c];m._type==l.wbItemHC?((u=new S).initialize(m._modelName),u.setupDiv(S.container),u.setFromJSON(m),null!=m.currentState?(u.getModelState().copy(m.currentState),null!=m.currentState.camera&&(u.getModelState().camera=Communicator.Camera.fromJson(m.currentState.camera))):a.push(u)):m._type==l.wbItemTextEditor?((u=new E).initialize(),u.setFromJSON(m),a.push(u)):m._type==l.wbLine?(m.lineType==wbLineType.straight?u=new wbLine:m.lineType==wbLineType.curve?u=new wbLineCurve:m.lineType==wbLineType.step&&(u=new wbLineStep),u.setFromJSON(m),d.push(u)):m._type==l.wbItemContainer?((u=new wbItemContainer).initialize(),u.setFromJSON(m)):((u=new g).initialize(),u.setFromJSON(m)),s.push(u),1==m.hasImage&&u.fetchImage(e)}for(wbItemContainer.assignItemsToContainer(),c=0;c<d.length;c++)null!=d[c].snapItems[0]&&(d[c].snapItems[0].item=U.getItemByGUID(d[c].snapItems[0].item)),null!=d[c].snapItems[1]&&(d[c].snapItems[1].item=U.getItemByGUID(d[c].snapItems[1].item)),d[c].initialize();U.redraw(),U.refreshItems(a),console.log(t)})):console.log("Looks like there was a problem. Status Code: "+t.status)})).catch((function(e){console.log("Fetch Error :-S",e)}))}}}};function j(e){U.start(e)}let X=l,Y=c,G=y;function q(e,t,i){var n=U.getItems();let s=new g;return s.initialize(),s.setDimensions(e),s.setBackgroundColor(t),i&&s.setShape(i),n.push(s),U.redraw(),s.getGUID()}function J(e,t,i,n,s,r,o,a){U.getItems();let d=new I(e,t);d.initialize(),d.setDrawArrows(i,n);let h=U.getItemByGUID(s),l=U.getItemByGUID(o);return d.setSnapItem(0,h,r),d.setSnapItem(1,l,a),I.addLine(d),U.redraw(),d.getGUID()}window.wb=new function(){return{addItem:q,addLine:J}}})(),wbManager=n})();