var __awaiter=this&&this.__awaiter||function(d,h,g,b){return new (g||(g=Promise))(function(e,c){function a(a){try{k(b.next(a))}catch(n){c(n)}}function f(a){try{k(b["throw"](a))}catch(n){c(n)}}function k(c){c.done?e(c.value):(new g(function(a){a(c.value)})).then(a,f)}k((b=b.apply(d,h||[])).next())})},__generator=this&&this.__generator||function(d,h){function g(a){return function(c){return b([a,c])}}function b(k){if(c)throw new TypeError("Generator is already executing.");for(;e;)try{if(c=1,a&&(f=k[0]&
2?a["return"]:k[0]?a["throw"]||((f=a["return"])&&f.call(a),0):a.next)&&!(f=f.call(a,k[1])).done)return f;if(a=0,f)k=[k[0]&2,f.value];switch(k[0]){case 0:case 1:f=k;break;case 4:return e.label++,{value:k[1],done:!1};case 5:e.label++;a=k[1];k=[0];continue;case 7:k=e.ops.pop();e.trys.pop();continue;default:if(!(f=e.trys,f=0<f.length&&f[f.length-1])&&(6===k[0]||2===k[0])){e=0;continue}if(3===k[0]&&(!f||k[1]>f[0]&&k[1]<f[3]))e.label=k[1];else if(6===k[0]&&e.label<f[1])e.label=f[1],f=k;else if(f&&e.label<
f[2])e.label=f[2],e.ops.push(k);else{f[2]&&e.ops.pop();e.trys.pop();continue}}k=h.call(d,e)}catch(n){k=[6,n],a=0}finally{c=f=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}var e={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,a,f,k;return k={next:g(0),"throw":g(1),"return":g(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},Communicator;
(function(d){var h;(function(b){b[b.Unknown=0]="Unknown";b[b.v1_0=1]="v1_0";b[b.v2_0=2]="v2_0";b[b.v2_1=3]="v2_1"})(h=d.BCFVersion||(d.BCFVersion={}));(function(b){b[b.Unknown=0]="Unknown";b[b.TopicFolder=1]="TopicFolder";b[b.Version=2]="Version";b[b.Markup=3]="Markup";b[b.Snapshot=4]="Snapshot";b[b.Viewpoint=5]="Viewpoint";b[b.Schema=6]="Schema";b[b.Project=7]="Project"})(d.BCFFileType||(d.BCFFileType={}));var g=function(){function b(b,c){this._version=h.Unknown;this._topicsMap=new Map;this._bcfFileName=
b;this._id=c}b.prototype.exportBCF=function(b){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return c=new XMLSerializer,a=new JSZip,a.file("bcf.version",'<?xml version="1.0" encoding="UTF-8"?><Version VersionId="2.1" xsi:noNamespaceSchemaLocation="version.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><DetailedVersion>2.1</DetailedVersion></Version>'),this._topicsMap.forEach(function(f,b){var k=a.folder(b);b=c.serializeToString(f.getMarkup().export());
k.file("markup.bcf",b);f.getViewpointMap().forEach(function(a,f){a=c.serializeToString(a.export());k.file(f,a)});f.getSnapshotMap().forEach(function(a,c){k.file(c,a.getData())})}),[4,a.generateAsync({type:"blob"}).then(function(a){saveAs(a,b+".bcf")})];case 1:return f.sent(),[2]}})})};b.prototype.addTopic=function(b,c){this._topicsMap.set(b,c)};b.prototype.getTopics=function(){return this._topicsMap};b.prototype.getTopic=function(b){return this._topicsMap.get(b)||null};b.prototype.getVersion=function(){return this._version};
b.prototype.setVersion=function(b){this._version=b};b.prototype.getFilename=function(){return this._bcfFileName};b.prototype.getId=function(){return this._id};return b}();d.BCFData=g})(Communicator||(Communicator={}));
(function(d){function h(a,c,f){void 0!==f&&null!==f&&a.setAttribute(c,f)}function g(a,c,f,k){a=a.createElement(f);a.innerHTML=k;c.appendChild(a)}function b(a,c,f,k){void 0!==k&&null!==k&&g(a,c,f,k)}function e(a){return void 0===a||null===a?null:a.toISOString()}function c(a){return void 0===a||null===a?null:a.toString()}function a(a){return void 0===a||null===a?null:a?"true":"false"}var f=function(){function a(a,c,f,k,b,d){this._ifcProject=a;this._ifcSpatialStructureElement=c;this._isExternal=f;this._filename=
k;this._date=b;this._reference=d}a.prototype.getIfcProject=function(){return this._ifcProject||null};a.prototype.getIfcSpacialStructureElement=function(){return this._ifcSpatialStructureElement||null};a.prototype.getIsExternal=function(){return this._isExternal||null};a.prototype.getBimFilename=function(){return this._filename||null};a.prototype.getBimDate=function(){return this._date||null};a.prototype.getReference=function(){return this._reference||null};return a}();d.BCFMarkupHeaderFile=f;var k=
function(){function a(a,c,f,k){this._index=this._snapshotFilename=this._viewpointFilename=void 0;this._guid=a;this._viewpointFilename=c;this._snapshotFilename=f;void 0!==k&&(this._index=parseInt(k,10))}a.prototype.getGuid=function(){return this._guid};a.prototype.getViewpointFilename=function(){return this._viewpointFilename||null};a.prototype.getSnapshotFilename=function(){return this._snapshotFilename||null};a.prototype.getIndex=function(){return this._index||null};return a}();d.BCFMarkupViewpoint=
k;var l=function(){function a(a,c,f,k,b,d,e){this._guid=a;this._date=c;this._author=f;this._text=k;this._viewpointGuid=b;this._modifiedDate=d;this._modifiedAuthor=e}a.prototype.getId=function(){return this._guid};a.prototype.getDate=function(){return this._date};a.prototype.setDate=function(a){this._date=a};a.prototype.getAuthor=function(){return this._author};a.prototype.setAuthor=function(a){this._author=a};a.prototype.getText=function(){return this._text};a.prototype.setText=function(a){this._text=
a};a.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};a.prototype.setViewpointGuid=function(a){this._viewpointGuid=null!==a?a:void 0};a.prototype.getModifiedDate=function(){return this._modifiedDate||null};a.prototype.setModifiedDate=function(a){this._modifiedDate=null!==a?a:void 0};a.prototype.getModifiedAuthor=function(){return this._modifiedAuthor||null};a.prototype.setModifiedAuthor=function(a){this._modifiedAuthor=null!==a?a:void 0};return a}();d.BCFComment=l;var n=function(){function n(a,
c,f){this._markupHeaderFiles=[];this._topic={guid:"",title:"",creationDate:new Date,creationAuthor:""};this._comments=new Map;this._viewpoints=new Map;this._filename=a;this._bcfTopic=f;this._parseDocument(c)}n.prototype._parseDocument=function(a){if(null!==a)for(a=a.documentElement.firstElementChild;null!==a;){var c=a.localName;if(null===c)break;switch(c){case "Header":this._parseHeader(a);break;case "Topic":this._parseTopic(a);break;case "Comment":this._parseComment(a);break;case "Viewpoints":this._parseViewpoint(a)}a=
a.nextElementSibling}};n.prototype._exportHeader=function(c){var f=c.createElement("Header");h(f,"ProjectGuid",this._projectGuid);this._markupHeaderFiles.forEach(function(k){var d=c.createElement("File");h(d,"IfcProject",k.getIfcProject());h(d,"IfcSpatialStructureElement",k.getIfcSpacialStructureElement());h(d,"isExternal",a(k.getIsExternal()));b(c,d,"Filename",k.getBimFilename());b(c,d,"Date",e(k.getBimDate()));b(c,d,"Reference",k.getReference());f.appendChild(d)});return f};n.prototype._exportTopicData=
function(a){var f=a.createElement("Topic");f.setAttribute("Guid",this._topic.guid);h(f,"TopicType",this._topic.topicType);h(f,"TopicStatus",this._topic.topicStatus);g(a,f,"Title",this._topic.title);g(a,f,"CreationDate",this._topic.creationDate.toISOString());g(a,f,"CreationAuthor",this._topic.creationAuthor);b(a,f,"ReferenceLink",this._topic.referenceLink);b(a,f,"Priority",this._topic.priority);b(a,f,"Index",c(this._topic.index));b(a,f,"ModifiedDate",e(this._topic.modifiedDate));b(a,f,"ModifiedAuthor",
this._topic.modifiedAuthor);b(a,f,"DueDate",e(this._topic.dueDate));b(a,f,"AssignedTo",this._topic.assignedTo);b(a,f,"Description",this._topic.description);b(a,f,"Stage",this._topic.stage);if(this._topic.labels){var k=a.createElement("Labels");this._topic.labels.forEach(function(c){g(a,k,"Label",c)});f.appendChild(k)}return f};n.prototype._exportBimSnippet=function(c,f){var k=c.createElement("BimSnippet");k.setAttribute("SnippetType",f.snippetType);h(k,"isExternal",a(f.isExternal));g(c,k,"Reference",
f.reference);b(c,k,"ReferenceSchema",f.referenceSchema);return k};n.prototype._exportDocumentReference=function(c,f){var k=c.createElement("DocumentReference");h(k,"Guid",f.guid);h(k,"isExternal",a(f.isExternal));b(c,k,"ReferencedDocument",f.referencedDocument);b(c,k,"Description",f.description);return k};n.prototype._exportRelatedTopic=function(a,c){a=a.createElement("RelatedTopic");a.setAttribute("Guid",c.guid);return a};n.prototype._exportTopic=function(a){var c=this,f=this._exportTopicData(a);
this._topic.bimSnippets&&this._topic.bimSnippets.forEach(function(k){f.appendChild(c._exportBimSnippet(a,k))});this._topic.documentReferences&&this._topic.documentReferences.forEach(function(k){f.appendChild(c._exportDocumentReference(a,k))});this._topic.relatedTopics&&this._topic.relatedTopics.forEach(function(k){f.appendChild(c._exportRelatedTopic(a,k))});return f};n.prototype._exportComment=function(a,c){var f=a.createElement("Comment");f.setAttribute("Guid",c.getId());g(a,f,"Date",c.getDate().toISOString());
g(a,f,"Author",c.getAuthor());g(a,f,"Comment",c.getText());b(a,f,"ModifiedDate",e(c.getModifiedDate()));b(a,f,"ModifiedAuthor",c.getModifiedAuthor());if(c=c.getViewpointGuid())a=a.createElement("Viewpoint"),a.setAttribute("Guid",c),f.appendChild(a);return f};n.prototype._exportViewpoint=function(a,f){var k=a.createElement("Viewpoints");k.setAttribute("Guid",f.getGuid());b(a,k,"Viewpoint",f.getViewpointFilename());b(a,k,"Snapshot",f.getSnapshotFilename());b(a,k,"Index",c(f.getIndex()));return k};n.prototype.export=
function(){var a=this,c=document.implementation.createDocument("","",null),f=c.createElement("Markup");f.appendChild(this._exportHeader(c));f.appendChild(this._exportTopic(c));this._comments.forEach(function(k){f.appendChild(a._exportComment(c,k))});this._viewpoints.forEach(function(k){f.appendChild(a._exportViewpoint(c,k))});c.appendChild(f);return c};n.prototype.getIfcProject=function(){var a=this._markupHeaderFiles[0];if(void 0!==a)return a.getIfcProject()||void 0};n.prototype.getIfcSpacialStructureElement=
function(){var a=this._markupHeaderFiles[0];if(void 0!==a)return a.getIfcSpacialStructureElement()||void 0};n.prototype.getIsExternal=function(){var a=this._markupHeaderFiles[0];if(void 0!==a)return a.getIsExternal()||void 0};n.prototype.getBimFilename=function(){var a=this._markupHeaderFiles[0];if(void 0!==a)return a.getBimFilename()||void 0};n.prototype.getBimDate=function(){var a=this._markupHeaderFiles[0];if(void 0!==a)return a.getBimDate()||void 0};n.prototype.getReference=function(){var a=this._markupHeaderFiles[0];
if(void 0!==a)return a.getReference()||void 0};n.prototype.getProjectGuid=function(){return this._projectGuid||null};n.prototype.getMarkupHeaderFiles=function(){return this._markupHeaderFiles};n.prototype.getFilename=function(){return this._filename};n.prototype.getTopicType=function(){return this._topic.topicType||null};n.prototype.setTopicType=function(a){this._topic.topicType=null!==a?a:void 0};n.prototype.getTopicStatus=function(){return this._topic.topicStatus||null};n.prototype.setTopicStatus=
function(a){this._topic.topicStatus=null!==a?a:void 0};n.prototype.getTopicTitle=function(){return this._topic.title};n.prototype.setTopicTitle=function(a){this._topic.title=a};n.prototype.getTopicCreationDate=function(){return this._topic.creationDate};n.prototype.setTopicCreationDate=function(a){this._topic.creationDate=a};n.prototype.getTopicCreationAuthor=function(){return this._topic.creationAuthor};n.prototype.setTopicCreationAuthor=function(a){this._topic.creationAuthor=a};n.prototype.getTopicReferenceLink=
function(){return this._topic.referenceLink||null};n.prototype.setTopicReferenceLink=function(a){this._topic.referenceLink=null===a?void 0:a};n.prototype.getTopicPriority=function(){return this._topic.priority||null};n.prototype.setTopicPriority=function(a){this._topic.priority=null===a?void 0:a};n.prototype.getTopicIndex=function(){return this._topic.index||null};n.prototype.setTopicIndex=function(a){this._topic.index=null===a?void 0:a};n.prototype.getTopicLabels=function(){return void 0===this._topic.labels?
[]:this._topic.labels.slice()};n.prototype.setTopicLabels=function(a){this._topic.labels=a.slice()};n.prototype.getTopicModifiedDate=function(){return this._topic.modifiedDate||null};n.prototype.setTopicModifiedDate=function(a){this._topic.modifiedDate=null===a?void 0:a};n.prototype.getTopicModifiedAuthor=function(){return this._topic.modifiedAuthor||null};n.prototype.setTopicModifiedAuthor=function(a){this._topic.modifiedAuthor=null===a?void 0:a};n.prototype.getTopicDueDate=function(){return this._topic.dueDate||
null};n.prototype.setTopicDueDate=function(a){this._topic.dueDate=null===a?void 0:a};n.prototype.getTopicAssignedTo=function(){return this._topic.assignedTo||null};n.prototype.setTopicAssignedTo=function(a){this._topic.assignedTo=null===a?void 0:a};n.prototype.getTopicDescription=function(){return this._topic.description||null};n.prototype.setTopicDescription=function(a){this._topic.description=null===a?void 0:a};n.prototype.getTopicStage=function(){return this._topic.stage||null};n.prototype.setTopicState=
function(a){this._topic.stage=null===a?void 0:a};n.prototype.getComments=function(){return this._comments};n.prototype.addComment=function(a,c,f,k,b,e){var n=d.UUID.create();a=new l(n,a,c,f,k,b,e);this._comments.set(n,a);return a};n.prototype.updateComment=function(a){var c=a.getId();this._comments.set(c,a)};n.prototype.deleteComment=function(a){this._comments.delete(a)};n.prototype.getViewpoints=function(){return this._viewpoints};n.prototype._addFile=function(a){var c=this._getElementAttributes(a),
k=this._getChildData(a);a=k.get("Date");a=void 0===a?void 0:new Date(a);var b=k.get("Filename");k=k.get("Reference");var d=c.get("IfcProject"),e=c.get("IfcSpatialStructureElement");c="true"===c.get("isExternal");this._markupHeaderFiles.push(new f(d,e,c,b,a,k))};n.prototype._parseHeader=function(a){var c=this._getElementAttributes(a).get("ProjectGuid");void 0!==c&&(this._projectGuid=c);a=a.firstElementChild;null!==a&&this._addFile(a)};n.prototype._parseTopic=function(a){var c=this._getElementAttributes(a),
f=c.get("Guid");if(void 0!==f&&(this._topic.guid=f,this._topic.topicType=c.get("TopicType")||c.get("Status"),this._topic.topicStatus=c.get("TopicStatus")||c.get("VerbalStatus"),a=a.firstElementChild,null!==a))for(;null!==a;){var k=a.localName;if(null===k)break;c=this._getChildData(a);f=this._getElementAttributes(a);switch(k){case "BimSnippet":void 0===this._topic.bimSnippets&&(this._topic.bimSnippets=[]);k=c.get("Reference");var b=f.get("SnippetType");void 0!==k&&void 0!==b&&(k={snippetType:b,reference:k},
f.get("isExternal")&&(k.isExternal="true"===f.get("isExternal")),c.get("ReferenceSchema")&&(k.referenceSchema=c.get("ReferenceSchema")),this._topic.bimSnippets.push(k));break;case "DocumentReference":void 0===this._topic.documentReferences&&(this._topic.documentReferences=[]);f={};c.get("Guid")&&(f.guid=c.get("Guid"));c.get("isExternal")&&(f.isExternal="true"===c.get("isExternal"));c.get("Description")&&(f.description=c.get("Description"));c.get("ReferencedDocument")&&(f.referencedDocument=c.get("ReferencedDocument"));
this._topic.documentReferences.push(f);break;case "RelatedTopic":void 0===this._topic.relatedTopics&&(this._topic.relatedTopics=[]);c=c.get("Guid");void 0!==c&&this._topic.relatedTopics.push({guid:c});break;case "ReferenceLink":a.textContent&&(this._topic.referenceLink=a.textContent);break;case "Title":a.textContent&&(this._topic.title=a.textContent);break;case "Priority":a.textContent&&(this._topic.priority=a.textContent);break;case "Index":a.textContent&&(this._topic.index=parseInt(a.textContent,
10));break;case "Labels":a.textContent&&(void 0===this._topic.labels&&(this._topic.labels=[]),this._topic.labels.push(a.textContent));break;case "CreationDate":a.textContent&&(this._topic.creationDate=new Date(a.textContent));break;case "CreationAuthor":a.textContent&&(this._topic.creationAuthor=a.textContent);break;case "ModifiedDate":a.textContent&&(this._topic.modifiedDate=new Date(a.textContent));break;case "ModifiedAuthor":a.textContent&&(this._topic.modifiedAuthor=a.textContent);break;case "DueDate":a.textContent&&
(this._topic.dueDate=new Date(a.textContent));break;case "AssignedTo":a.textContent&&(this._topic.assignedTo=a.textContent);break;case "Description":a.textContent&&(this._topic.description=a.textContent);break;case "Stage":a.textContent&&(this._topic.stage=a.textContent)}a=a.nextElementSibling}};n.prototype._parseComment=function(a){var c=new Date,f="",k="",b,d=this._getElementAttributes(a).get("Guid");if(d){a=a.firstElementChild;if(null!==a)for(;null!==a;){var e=a.localName;if(null===e)break;switch(e){case "Date":a.textContent&&
(c=new Date(a.textContent));break;case "Author":a.textContent&&(f=a.textContent);break;case "Comment":a.textContent&&(k=a.textContent);break;case "Viewpoint":var n=this._getElementAttributes(a).get("Guid");break;case "ModifiedDate":a.textContent&&(b=new Date(a.textContent));break;case "ModifiedAuthor":if(a.textContent)var g=a.textContent}a=a.nextElementSibling}c=new l(d,c,f,k,n,b,g);this._comments.set(d,c)}};n.prototype._parseViewpoint=function(a){var c=this._getElementAttributes(a).get("Guid");if(void 0!==
c){var f=this._getChildData(a);a=f.get("Viewpoint");var k=f.get("Snapshot");f=f.get("Index");this.addViewpoint(c,a,k,f)}};n.prototype.addViewpoint=function(a,c,f,b){this._viewpoints.set(a,new k(a,c,f,b))};n.prototype._getChildData=function(a){var c=new Map;for(a=a.firstElementChild;null!==a;){var f=a.localName,k=null;null===a.firstElementChild&&(k=a.textContent);null!==f&&null!==k&&c.set(f,k);a=a.nextElementSibling}return c};n.prototype._getElementAttributes=function(a){a=a.attributes;for(var c=new Map,
f=0;f<a.length;++f){var k=a[f];c.set(k.name,k.value)}return c};return n}();d.BCFMarkup=n})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b,d){this._filename=b;this._data=d}d.createFromImage=function(b,e){e=d.snapshotDataFromImage(e);return new d(b,e)};d.prototype.getFilename=function(){return this._filename};d.prototype.getData=function(){return this._data};d.prototype.getUrl=function(){var b=new Blob([this._data],{type:"image/png"});return URL.createObjectURL(b,{oneTimeOnly:!0})};d.snapshotDataFromImage=function(b){return d._convertDataURIToBinary(b.src)};d._convertDataURIToBinary=function(b){var d=
b.indexOf(";base64,")+8;b=window.atob(b.substring(d));d=new Uint8Array(b.length);for(var c=0;c<b.length;c++){var a=b[c].charCodeAt(0);d[c]=a}return d};return d}();d.BCFSnapshot=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,d,c,a){this._viewpointMap=new Map;this._snapshotMap=new Map;this._viewer=a;this._topicId=c;this._bcfDataId=b;this._bcfFilename=d}g.createTopic=function(b,e,c,a,f){void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p,q,h,w,t;return __generator(this,function(r){switch(r.label){case 0:return k=d.UUID.create(),l=new g(e,c,k,b),n=l.addMarkup("markup.bcf",null),n.setTopicTitle(a),m="viewpoint.bcfv",[4,d.BCFViewpoint.createViewpoint(b,
m,f)];case 1:return p=r.sent(),l.setViewpoint(m,p),q="snapshot.png",(w=null!==f?f.getSnapshotImage():null)?[3,3]:[4,b.takeSnapshot()];case 2:w=r.sent(),r.label=3;case 3:return h=w,t=d.BCFSnapshot.createFromImage(q,h),l.setSnapshot(q,t),[2,l]}})})};g.prototype.getTopicId=function(){return this._topicId};g.prototype.addMarkup=function(b,e){return this._markup=new d.BCFMarkup(b,e,this)};g.prototype.getMarkup=function(){return this._markup};g.prototype.addViewpoint=function(b,e,c,a,f){e=new d.BCFViewpoint(b,
e,c,a,f,this._viewer);this.setViewpoint(b,e);return e};g.prototype.setViewpoint=function(b,d){this._viewpointMap.set(b,d)};g.prototype.getViewpointMap=function(){return this._viewpointMap};g.prototype.getViewpoint=function(b){return this._viewpointMap.get(b)||null};g.prototype.addSnapshot=function(b,e){e=new d.BCFSnapshot(b,e);this.setSnapshot(b,e)};g.prototype.setSnapshot=function(b,d){this._snapshotMap.set(b,d)};g.prototype.getSnapshotMap=function(){return this._snapshotMap};g.prototype.getSnapshot=
function(b){return this._snapshotMap.get(this._massageSnapshotFilename(b))||null};g.prototype._massageSnapshotFilename=function(b){if("viewpoint.bcfv"===b)return"snapshot.png";var d=b.split(".");return"bcfv"===d[1]?d[0]+".png":b};return g}();d.BCFTopic=h})(Communicator||(Communicator={}));
(function(d){function h(a){return a?"true":"false"}function g(a,c){a=a.createElement("Component");a.setAttribute("IfcGuid",c.ifcGuid);c.originatingSystem&&a.setAttribute("OriginatingSystem",c.originatingSystem);c.authoringToolId&&a.setAttribute("AuthoringToolId",c.authoringToolId);return a}function b(a){return 1===a.length?"0"+a:a}function e(a,c){c=c?b(Math.round(c).toString(16)):"";var f=b(Math.round(a.r).toString(16)),k=b(Math.round(a.g).toString(16));a=b(Math.round(a.b).toString(16));return""+
c+f+k+a}function c(a,c,b){var f=a.createElement("X"),k=a.createElement("Y");a=a.createElement("Z");f.innerHTML=b.x.toString();k.innerHTML=b.y.toString();a.innerHTML=b.z.toString();c.appendChild(f);c.appendChild(k);c.appendChild(a)}var a=function(){function a(a,c,f,b,e,g){this._version=d.BCFVersion.Unknown;this._components={};this._lines=[];this._clippingPlanes=[];this._viewer=g;this._filename=a;this._version=f;this._modelBounding=b;this._unitScale=1E3/e;this._parseDocument(c)}a.createViewpoint=function(c,
f,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var k,e,l,n,g,h,u,v,z,x,y,A,B,D,C,F;return __generator(this,function(m){switch(m.label){case 0:return k=function(a){var c=[];a.forEach(function(a){for(var f=null;null!==a&&null===f;)f=e.getNodeGenericId(a),a=e.getNodeParent(a);null!==f&&c.push(f)});return c},e=c.model,l=e.getAbsoluteRootNode(),[4,c.model.getVisibilityState(l)];case 1:return n=m.sent(),[4,e.getNodeColorMap(l,d.ElementType.Faces)];case 2:return g=m.sent(),[4,e.getModelBounding(!0,
!1)];case 3:return h=m.sent(),u=e.getNodeUnitMultiplier(l),v=new a(f,null,d.BCFVersion.v2_1,h,u,c),v.setDefaultVisibility(n.defaultVisibility),z=n.visibilityExceptions,x=[],z.forEach(function(a){x.push(a)}),y=k(x),v.setVisibilityExceptions(y),A=c.selectionManager.getResults(),B=A.map(function(a){return a.getNodeId()}),D=k(B),v.setSelection(D),C=new Map,0<g.size&&g.forEach(function(a,c){c=e.getNodeParent(c);if(null!==c&&(c=e.getNodeGenericId(c),null!==c)){var f=C.get(a);void 0===f&&(f=new Set,C.set(a,
f));f.add(c)}}),v.setColors(C),v.setCamera(c.view.getCamera()),null!==b&&(F=a._markupRedlineToBcf(b.getMarkup(),c.view),v.setLines(F)),[2,v]}})})};a._markupRedlineToBcf=function(a,c){var f=function(a){a=c.projectPoint(a);return c.unprojectPoint(d.Point2.fromPoint3(a),0)},k=function(a,c,f){for(var k=2*Math.PI/f,b=[],e=0;e<=f;e++){var l=e*k;b.push(new d.Point2(a.x+Math.cos(l)*c,a.y+Math.sin(l)*c))}return b},b=function(a){for(var c=0;c<a.length-1;++c){var f=a[c],k=a[c+1];null!==f&&null!==k&&(f=[f.copy().scale(.001),
k.copy().scale(.001)],l.push(f))}},e=function(a){for(var c=0;c<a.length;++c){var f=a[c],k=a[(c+1)%a.length];null!==f&&null!==k&&(f=[f.copy().scale(.001),k.copy().scale(.001)],l.push(f))}},l=[];a.forEach(function(a){if(a instanceof d.Markup.Redline.RedlinePolyline){var l=a.getPoints().map(f);b(l)}else if(a instanceof d.Markup.Redline.RedlineCircle){l=a.getCenter();var n=a.getRadiusPoint();a=d.Point2.fromPoint3(c.projectPoint(l));l=d.Point2.fromPoint3(c.projectPoint(n));l=d.Point2.subtract(l,a).length();
l=k(a,l,40).map(function(a){return c.unprojectPoint(a,0)});e(l)}else a instanceof d.Markup.Redline.RedlineRectangle&&(l=a.getPoint1(),n=a.getPoint2(),a=d.Point2.fromPoint3(c.projectPoint(l)),n=d.Point2.fromPoint3(c.projectPoint(n)),l=[],l.push(c.unprojectPoint(a,0)),l.push(c.unprojectPoint(new d.Point2(a.x,n.y),0)),l.push(c.unprojectPoint(n,0)),l.push(c.unprojectPoint(new d.Point2(n.x,a.y),0)),e(l))});return l};a.prototype._parseDocument=function(a){if(null!==a){a=a.documentElement;var c=a.attributes.getNamedItem("Guid");
null!==c&&(this._viewpointGuid=c.value);for(a=a.firstElementChild;null!==a;){c=a.localName;if(null===c)break;switch(c){case "Components":this._version>=d.BCFVersion.v2_1?this._parseComponents(a):this._parseComponentsV2_0(a);break;case "OrthogonalCamera":this._parseOrthogonalCamera(a);break;case "PerspectiveCamera":this._parsePerspectiveCamera(a);break;case "Lines":this._parseLines(a);break;case "ClippingPlanes":this._parseClippingPlanes(a)}a=a.nextElementSibling}}};a.prototype._exportComponents=function(a){var c=
a.createElement("Components"),f=a.createElement("ViewSetupHints"),k=this._components.viewSetupHints;k&&(c.setAttribute("SpacesVisible",h(k.spacesVisible)),c.setAttribute("SpaceBoundariesVisible",h(k.spaceBoundariesVisible)),c.setAttribute("OpeningsVisible",h(k.openingsVisible)));c.appendChild(f);var b=a.createElement("Selection");(f=this._components.selection)&&f.forEach(function(c){b.appendChild(g(a,c))});c.appendChild(b);f=a.createElement("Visibility");k=this._components.defaultVisibility;var d=
this._components.visibilityExceptions;if(void 0!==k&&void 0!==d){f.setAttribute("DefaultVisibility",h(k));var r=a.createElement("Exceptions");d.forEach(function(c){r.appendChild(g(a,c))});f.appendChild(r)}c.appendChild(f);var w=a.createElement("Coloring");(f=this._components.coloring)&&f.forEach(function(c){var f=a.createElement("Color");f.setAttribute("Color",e(c.color,c.alpha));c.components.forEach(function(c){f.appendChild(g(a,c))});w.appendChild(f)});c.appendChild(w);return c};a.prototype._exportOrthogonalCamera=
function(a,f){var k=a.createElement("OrthogonalCamera"),b=a.createElement("CameraViewPoint"),d=a.createElement("CameraViewPoint"),e=a.createElement("CameraViewPoint");c(a,b,f.cameraViewPoint);c(a,d,f.cameraDirection);c(a,e,f.cameraUpVector);a=a.createElement("ViewToWorldScale");a.innerHTML=f.viewToWorldScale.toString();k.appendChild(b);k.appendChild(d);k.appendChild(e);k.appendChild(a);return k};a.prototype._exportPerspectiveCamera=function(a,f){var k=a.createElement("PerspectiveCamera"),b=a.createElement("CameraViewPoint"),
d=a.createElement("CameraViewPoint"),e=a.createElement("CameraViewPoint");c(a,b,f.cameraViewPoint);c(a,d,f.cameraDirection);c(a,e,f.cameraUpVector);a=a.createElement("FieldOfView");a.innerHTML=f.fieldOfView.toString();k.appendChild(b);k.appendChild(d);k.appendChild(e);k.appendChild(a);return k};a.prototype._exportLines=function(a){var f=a.createElement("Lines");this._lines.forEach(function(k){var b=a.createElement("Line"),d=a.createElement("StartPoint"),e=a.createElement("EndPoint");c(a,d,k.startPoint);
c(a,e,k.endPoint);b.appendChild(d);b.appendChild(e);f.appendChild(b)});return f};a.prototype._exportClippingPlanes=function(a){var f=a.createElement("ClippingPlanes");this._clippingPlanes.forEach(function(k){var b=a.createElement("ClippingPlane"),d=a.createElement("Location"),e=a.createElement("Direction");c(a,d,k.location);c(a,e,k.direction);b.appendChild(d);b.appendChild(e);f.appendChild(b)});return f};a.prototype.export=function(){var a=document.implementation.createDocument("","",null),c=a.createElement("VisualizationInfo");
c.appendChild(this._exportComponents(a));void 0!==this._viewpointGuid&&c.setAttribute("Guid",this._viewpointGuid);this._orthogonalCamera?c.appendChild(this._exportOrthogonalCamera(a,this._orthogonalCamera)):this._perspectiveCamera&&c.appendChild(this._exportPerspectiveCamera(a,this._perspectiveCamera));0<this._lines.length&&c.appendChild(this._exportLines(a));0<this._clippingPlanes.length&&c.appendChild(this._exportClippingPlanes(a));a.appendChild(c);return a};a.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._activateCamera(),[4,this._activateComponentsVisibility()];case 1:return a.sent(),[4,this._activateMarkup()];case 2:return a.sent(),[4,this._activateCuttingPlanes()];case 3:return a.sent(),this._activateSelected(),[4,this._activateColors()];case 4:return a.sent(),[2]}})})};a.prototype._activateCamera=function(){var a=this.getCamera();null!==a&&this._viewer.view.setCamera(a,800)};a.prototype._activateComponentsVisibility=
function(){return __awaiter(this,void 0,void 0,function(){var a,c,f;return __generator(this,function(k){switch(k.label){case 0:return a=this._viewer.model,c=this._getDefaultVisibility(),f=a.getNodeIdsByGenericIds(this.getVisibilityExceptions()),f.length?[4,a.setNodesVisibility([-2],c)]:[3,3];case 1:return k.sent(),[4,a.setNodesVisibility(f,!c)];case 2:return k.sent(),[3,5];case 3:return[4,a.reset()];case 4:k.sent(),k.label=5;case 5:return[2]}})})};a.prototype._activateMarkup=function(){return __awaiter(this,
void 0,void 0,function(){var a,c,f,b,e;return __generator(this,function(k){switch(k.label){case 0:return a=this._viewer.lineManager,[4,a.removeAllLines()];case 1:k.sent();c=[];for(f=0;f<this._lines.length;++f)b=this._lines[f],e=new d.Markup.Line.LineMarkup(this._viewer,b.startPoint.copy().scale(1E3),b.endPoint.copy().scale(1E3)),c.push(a.addLine(e));return[4,Promise.all(c)];case 2:return k.sent(),[2]}})})};a.prototype._activateCuttingPlanes=function(){return __awaiter(this,void 0,void 0,function(){var a,
c,f,b,e,g,h,w,t,u;return __generator(this,function(k){switch(k.label){case 0:return a=this._viewer.model,[4,a.getModelBounding(!0,!1)];case 1:return c=k.sent(),f=this._viewer.cuttingManager,[4,f.deactivateCuttingSections(!0)];case 2:k.sent(),b=0,k.label=3;case 3:if(!(b<this._clippingPlanes.length))return[3,7];e=f.getCuttingSection(b);return[4,e.clear()];case 4:return k.sent(),g=this._clippingPlanes[b],h=g.location.copy().scale(1E3),w=g.direction.normalize(),t=d.Plane.createFromPointAndNormal(h,w),
u=f.createReferenceGeometryFromFaceNormal(w,h,c),[4,e.addPlane(t,u)];case 5:k.sent(),k.label=6;case 6:return++b,[3,3];case 7:return[4,f.activateCuttingSections()];case 8:return k.sent(),[2]}})})};a.prototype._activateSelected=function(){var a=this._getGenericIdsFromComponents(this._components.selection);if(a){a=this._viewer.model.getNodeIdsByGenericIds(a);this._viewer.selectionManager.clear();for(var c=0;c<a.length;++c)this._viewer.selectionManager.selectNode(a[c],d.SelectionMode.Add)}};a.prototype._activateColors=
function(){return __awaiter(this,void 0,void 0,function(){var a,c,f,b,d;return __generator(this,function(k){switch(k.label){case 0:return a=this._viewer.model,[4,a.resetNodesColor()];case 1:k.sent();if(void 0===this._components.coloring)return[3,3];c=new Map;f=function(f){var k=b._components.coloring[f];f=b._getGenericIdsFromComponents(k.components);a.getNodeIdsByGenericIds(f).forEach(function(a){c.set(a,k.color)})};b=this;for(d=0;d<this._components.coloring.length;++d)f(d);return[4,this._viewer.model.setNodesColors(c)];
case 2:k.sent(),k.label=3;case 3:return[2]}})})};a.prototype.getFilename=function(){return this._filename};a.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};a.prototype._fromBCFPerspectiveCamera=function(a,c){var f=new d.Camera;f.setProjection(d.Projection.Perspective);var b=a.cameraViewPoint.copy().scale(this._unitScale);c=a.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(b,c);var k=a.cameraUpVector.copy().normalize();f.setPosition(b);f.setTarget(c);f.setUp(k);
a=d.Util.degreesToRadians(a.fieldOfView);a=Math.tan(a/2);a*=2*d.Point3.subtract(f.getTarget(),f.getPosition()).length();f.setWidth(a);f.setHeight(a);return f};a.prototype._fromBCFOrthogonalCamera=function(a,c){var f=new d.Camera;f.setProjection(d.Projection.Orthographic);var b=a.cameraViewPoint.copy().scale(this._unitScale);c=a.cameraDirection.copy().normalize().scale(c);c=d.Point3.add(b,c);var k=a.cameraUpVector.copy().normalize();f.setPosition(b);f.setTarget(c);f.setUp(k);a=a.viewToWorldScale*this._unitScale*
2;f.setWidth(a);f.setHeight(a);return f};a.prototype.getCamera=function(){var a=this._modelBounding.extents().length();return this._perspectiveCamera?this._fromBCFPerspectiveCamera(this._perspectiveCamera,a/40):this._orthogonalCamera?this._fromBCFOrthogonalCamera(this._orthogonalCamera,a):null};a.prototype.setCamera=function(a){a.getProjection()===d.Projection.Perspective?(this._perspectiveCamera=this._toBCFPerspectiveCamera(a),this._orthogonalCamera=void 0):(this._orthogonalCamera=this._toBCFOrthogonalCamera(a),
this._perspectiveCamera=void 0)};a.prototype._toBCFOrthogonalCamera=function(a){var c=a.getPosition(),f=a.getTarget();f=d.Point3.subtract(f,c).normalize();var b=a.getUp().normalize();c=c.copy().scale(1/this._unitScale);a=a.getWidth()/(2*this._unitScale);return{cameraDirection:f,cameraUpVector:b,cameraViewPoint:c,viewToWorldScale:a}};a.prototype._toBCFPerspectiveCamera=function(a){var c=a.getPosition(),f=a.getTarget();f=d.Point3.subtract(f,c).normalize();var b=a.getUp().normalize();c=c.copy().scale(1/
this._unitScale);var k=a.getWidth();a=d.Point3.subtract(a.getTarget(),a.getPosition()).length();a=d.Util.radiansToDegrees(2*Math.atan(k/(2*a)));return{cameraDirection:f,cameraUpVector:b,cameraViewPoint:c,fieldOfView:a}};a.prototype.setDefaultVisibility=function(a){this._components.defaultVisibility=a};a.prototype._getDefaultVisibility=function(){return void 0!==this._components.defaultVisibility?this._components.defaultVisibility:!0};a.prototype.setVisibilityExceptions=function(a){a=a.map(function(a){return{ifcGuid:a}});
this._components.visibilityExceptions=a};a.prototype.getVisibilityExceptions=function(){return this._getGenericIdsFromComponents(this._components.visibilityExceptions)};a.prototype.setColors=function(a){var c=[];a.forEach(function(a,f){var b=[];a.forEach(function(a){b.push({ifcGuid:a})});c.push({color:f,components:b})});this._components.coloring=c};a.prototype.getColors=function(){var a=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var f=c.color.copy(),b=new Set;c.components.map(function(a){b.add(a.ifcGuid)});
a.set(f,b)});return a};a.prototype.setLines=function(a){var c=this;this._lines=[];a.forEach(function(a){a={startPoint:a[0].copy(),endPoint:a[1].copy()};c._lines.push(a)})};a.prototype.getLines=function(){var a=[];this._lines.forEach(function(c){a.push([c.startPoint.copy(),c.endPoint.copy()])});return a};a.prototype.setClippingPlanes=function(a){var c=this;this._clippingPlanes=[];a.forEach(function(a){a={location:a[0].copy(),direction:a[1].copy()};c._clippingPlanes.push(a)})};a.prototype.getClippingPlanes=
function(){var a=[];this._clippingPlanes.forEach(function(c){a.push([c.location.copy(),c.direction.copy()])});return a};a.prototype.setSelection=function(a){a=a.map(function(a){return{ifcGuid:a}});this._components.selection=a};a.prototype.getSelection=function(){var a=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){a.push(c.ifcGuid)});return a};a.prototype._getGenericIdsFromComponents=function(a){if(!a)return[];for(var c=[],f=0;f<a.length;++f)c.push(a[f].ifcGuid);return c};a.prototype._parseComponentsV2_0=
function(a){console.assert(this._version<=d.BCFVersion.v2_0);var c=[],f=[],b=[],k=!0;for(a=a.firstElementChild;null!==a;){var e=a.localName;if(null===e)break;switch(e){case "Component":var g=a.attributes,h=g.getNamedItem("IfcGuid");e=g.getNamedItem("Selected");var t=g.getNamedItem("Visible");g=g.getNamedItem("Color");null!==h&&h.value&&(h={ifcGuid:h.value},null!==e&&"true"===e.value&&c.push(h),k=!1,null!==t&&"false"===t.value||f.push(h),null!==g&&g.value&&b.push(this._colorFromArgb(g.value,[h])))}a=
a.nextElementSibling}this._components={defaultVisibility:k,selection:c,visibilityExceptions:f,coloring:b}};a.prototype._parseComponents=function(a){console.assert(this._version>=d.BCFVersion.v2_1);a=a.firstElementChild;for(var c={spacesVisible:!1,spaceBoundariesVisible:!1,openingsVisible:!1},f=[],b=!0,k=[],e=[];null!==a;){var g=a.localName;if(null===g)break;var h=a.attributes;switch(g){case "ViewSetupHints":g=h.getNamedItem("SpacesVisible");var t=h.getNamedItem("SpaceBoundariesVisible");h=h.getNamedItem("OpeningsVisible");
null!==g&&(c.spacesVisible="true"===g.value);null!==t&&(c.spaceBoundariesVisible="true"===t.value);null!==h&&(c.openingsVisible="true"===h.value);break;case "Selection":f=this._getComponents(a);break;case "Visibility":(h=h.getNamedItem("DefaultVisibility"))&&(b="true"===h.value);h=a.firstElementChild;null!==h&&(k=this._getComponents(h));break;case "Coloring":e=this._getColoring(a)}a=a.nextElementSibling}this._components={viewSetupHints:c,selection:f,defaultVisibility:b,visibilityExceptions:k,coloring:e}};
a.prototype._getCameraData=function(a){var c=[];for(a=a.firstElementChild;null!==a;)switch(a.nodeName){case "FieldOfView":case "ViewToWorldScale":a=a.textContent;null!==a&&c.push(parseFloat(a));a=null;break;default:c.push(this._getPoint(a)),a=a.nextElementSibling}return c};a.prototype._parseOrthogonalCamera=function(a){a=this._getCameraData(a);4===a.length&&(this._orthogonalCamera={cameraViewPoint:a[0],cameraDirection:a[1],cameraUpVector:a[2],viewToWorldScale:a[3]})};a.prototype._parsePerspectiveCamera=
function(a){a=this._getCameraData(a);4===a.length&&(this._perspectiveCamera={cameraViewPoint:a[0],cameraDirection:a[1],cameraUpVector:a[2],fieldOfView:a[3]})};a.prototype._parseLines=function(a){for(a=a.firstElementChild;null!==a;)this._lines.push(this._getLine(a)),a=a.nextElementSibling};a.prototype._parseClippingPlanes=function(a){for(a=a.firstElementChild;null!==a;)this._clippingPlanes.push(this._getClippingPlane(a)),a=a.nextElementSibling};a.prototype._getClippingPlane=function(a){a=a.firstElementChild;
var c=d.Point3.zero(),f=d.Point3.zero();null!==a&&(c=this._getPoint(a),a=a.nextElementSibling,null!==a&&(f=this._getPoint(a)));return{location:c,direction:f}};a.prototype._getLine=function(a){a=a.firstElementChild;var c=d.Point3.zero(),f=d.Point3.zero();null!==a&&(c=this._getPoint(a),a=a.nextElementSibling,null!==a&&(f=this._getPoint(a)));return{startPoint:c,endPoint:f}};a.prototype._getPoint=function(a){var c=[];for(a=a.firstElementChild;null!==a;){var f=a.firstChild;null!==f&&c.push(parseFloat(f.wholeText));
a=a.nextElementSibling}console.assert(3===c.length);return new d.Point3(c[0],c[1],c[2])};a.prototype._colorFromArgb=function(a,c){c={color:d.Color.black(),components:c};for(var f=[],b=0;b<a.length;b+=2){var k=a.substr(b,2);f.push(parseInt(k,16))}3===f.length?c.color.set(f[0],f[1],f[2]):4===f.length&&(c.alpha=f[0],c.color.set(f[1],f[2],f[3]));return c};a.prototype._getColoring=function(a){var c=[];for(a=a.firstElementChild;null!==a;){var f=a.attributes.getNamedItem("Color"),b=this._getComponents(a);
f&&b.length&&c.push(this._colorFromArgb(f.value,b));a=a.nextElementSibling}return c};a.prototype._getComponents=function(a){var c=[];for(a=a.firstElementChild;null!==a;){var f=a.attributes,b=f.getNamedItem("IfcGuid"),k=f.getNamedItem("OriginatingSystem");f=f.getNamedItem("AuthoringToolId");null!==b&&(b={ifcGuid:b.value},null!==k&&(b.originatingSystem=k.value),null!==f&&(b.authoringToolId=f.value),c.push(b));a=a.nextElementSibling}return c};return a}();d.BCFViewpoint=a})(Communicator||(Communicator=
{}));
(function(d){var h=function(){function d(b,d,c){this.x=b;this.y=d;this.z=c}d.prototype.assign=function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this};d.prototype.set=function(b,d,c){this.x=b;this.y=d;this.z=c;return this};d.prototype.toArray=function(b){b[0]=this.x;b[1]=this.y;b[2]=this.z};d.prototype.fromArray=function(b){this.x=b[0];this.y=b[1];this.z=b[2];return this};d.prototype.add=function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;return this};d.prototype.subtract=function(b){this.x-=b.x;this.y-=
b.y;this.z-=b.z;return this};d.prototype.copy=function(){return new d(this.x,this.y,this.z)};d.fromJson=function(b){return new d(b.x,b.y,b.z)};d.construct=function(b){return d.fromJson(b)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y,z:this.z}};d.prototype.forJson=function(){return this.toJson()};d.prototype.equals=function(b){return this.x===b.x&&this.y===b.y&&this.z===b.z};d.prototype.equalsWithTolerance=function(b,d){return this.x-
b.x<d&&this.x-b.x>-d&&this.y-b.y<d&&this.y-b.y>-d&&this.z-b.z<d&&this.z-b.z>-d};d.prototype.isAxis=function(){return 1===Math.abs(this.x)&&0===this.y&&0===this.z||0===this.x&&1===Math.abs(this.y)&&0===this.z||0===this.x&&0===this.y&&1===Math.abs(this.z)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z};d.prototype.scale=function(b){this.x*=b;this.y*=b;this.z*=b;return this};d.prototype.normalize=
function(){return this.scale(1/this.length())};d.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};d.zero=function(){return new d(0,0,0)};d.add=function(b,e){return new d(b.x+e.x,b.y+e.y,b.z+e.z)};d.subtract=function(b,e){return new d(b.x-e.x,b.y-e.y,b.z-e.z)};d.dot=function(b,d){return b.x*d.x+b.y*d.y+b.z*d.z};d.cross=function(b,e){return new d(b.y*e.z-b.z*e.y,b.z*e.x-b.x*e.z,b.x*e.y-b.y*e.x)};d.distance=function(b,e){return d.subtract(e,b).length()};d.scale=function(b,
d){return b.copy().scale(d)};d.createFromArray=function(b){return new d(b[0],b[1],b[2])};return d}();d.Point3=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.loadIdentity()}g.prototype.loadIdentity=function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};g.prototype.isIdentity=function(){var b=this.m;return 1===b[0]&&0===b[1]&&0===b[2]&&0===b[3]&&0===b[4]&&1===b[5]&&0===b[6]&&0===b[7]&&0===b[8]&&0===b[9]&&1===b[10]&&0===b[11]&&0===b[12]&&0===b[13]&&0===b[14]&&1===b[15]};g.prototype.equals=function(b){for(var d=0;16>d;++d)if(this.m[d]!==b.m[d])return!1;return!0};g.prototype.equalsWithTolerance=function(b,
d){d=Math.abs(d);for(var c=0;16>c;++c)if(Math.abs(this.m[c]-b.m[c])>d)return!1;return!0};g.prototype.setScaleComponent=function(b,d,c){this.m[0]=b;this.m[5]=d;this.m[10]=c;return this};g.prototype.setTranslationComponent=function(b,d,c){this.m[12]=b;this.m[13]=d;this.m[14]=c;return this};g.prototype.copy=function(){var b=new g;b.m=this.m.slice();return b};g.prototype.assign=function(b){for(var d=0;d<b.m.length;d++)this.m[d]=b.m[d];return this};g.prototype.scale=function(b){for(var d=0;16>d;d++)this.m[d]*=
b;return this};g.prototype.transform=function(b,e){if(void 0===e)return e=d.Point3.zero(),this.transform(b,e),e;e.set(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12],b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13],b.x*this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14])};g.prototype.transform4=function(b,e){if(void 0===e)return e=d.Point4.zero(),this.transform4(b,e),e;e.set(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12]*b.w,b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13]*b.w,b.x*
this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14]*b.w,b.x*this.m[3]+b.y*this.m[7]+b.z*this.m[11]+this.m[15]*b.w)};g.prototype.transformArray=function(b,e){for(var c=0;c<b.length;c++){var a=b[c];a=new d.Point3(a.x*this.m[0]+a.y*this.m[4]+a.z*this.m[8]+this.m[12],a.x*this.m[1]+a.y*this.m[5]+a.z*this.m[9]+this.m[13],a.x*this.m[2]+a.y*this.m[6]+a.z*this.m[10]+this.m[14]);e[c]=a}};g.prototype.transformBox=function(b){if(b.isDegenerate())return d.Box.invalid();b=b.getCorners();for(var e=0;e<b.length;e++){var c=
b[e];this.transform(c,c)}e=new d.Box(b[0],b[0]);for(var a=1;a<b.length;++a)c=b[a],e.addPoint(c);return e};g.prototype.transpose=function(){var b=this.m[1];this.m[1]=this.m[4];this.m[4]=b;b=this.m[2];this.m[2]=this.m[8];this.m[8]=b;b=this.m[3];this.m[3]=this.m[12];this.m[12]=b;b=this.m[6];this.m[6]=this.m[9];this.m[9]=b;b=this.m[7];this.m[7]=this.m[13];this.m[13]=b;b=this.m[11];this.m[11]=this.m[14];this.m[14]=b;return this};g.createFromArray=function(b){var d=new g;d.m=b.slice();return d};g.createFromOffAxisRotation=
function(b,d){var c=Math.PI/180*d;d=Math.sin(c);c=Math.cos(c);var a=new g;b=b.copy().normalize();var f=1-c,k=f*b.x*b.y,e=f*b.x*b.z,n=f*b.y*b.z;a.m[0]=f*b.x*b.x+c;a.m[1]=d*b.z+k;a.m[2]=e-d*b.y;a.m[3]=0;a.m[4]=k-d*b.z;a.m[5]=f*b.y*b.y+c;a.m[6]=d*b.x+n;a.m[7]=0;a.m[8]=d*b.y+e;a.m[9]=n-d*b.x;a.m[10]=f*b.z*b.z+c;a.m[11]=0;a.m[12]=0;a.m[13]=0;a.m[14]=0;a.m[15]=1;return a};g.createFromBasis=function(b,d,c){var a=new g;a.m[0]=b.x;a.m[1]=b.y;a.m[2]=b.z;a.m[4]=d.x;a.m[5]=d.y;a.m[6]=d.z;a.m[8]=c.x;a.m[9]=c.y;
a.m[10]=c.z;return a};g.multiply=function(b,d){var c=new g;c.m[0]=b.m[0]*d.m[0]+b.m[1]*d.m[4]+b.m[2]*d.m[8]+b.m[3]*d.m[12];c.m[1]=b.m[0]*d.m[1]+b.m[1]*d.m[5]+b.m[2]*d.m[9]+b.m[3]*d.m[13];c.m[2]=b.m[0]*d.m[2]+b.m[1]*d.m[6]+b.m[2]*d.m[10]+b.m[3]*d.m[14];c.m[3]=b.m[0]*d.m[3]+b.m[1]*d.m[7]+b.m[2]*d.m[11]+b.m[3]*d.m[15];c.m[4]=b.m[4]*d.m[0]+b.m[5]*d.m[4]+b.m[6]*d.m[8]+b.m[7]*d.m[12];c.m[5]=b.m[4]*d.m[1]+b.m[5]*d.m[5]+b.m[6]*d.m[9]+b.m[7]*d.m[13];c.m[6]=b.m[4]*d.m[2]+b.m[5]*d.m[6]+b.m[6]*d.m[10]+b.m[7]*
d.m[14];c.m[7]=b.m[4]*d.m[3]+b.m[5]*d.m[7]+b.m[6]*d.m[11]+b.m[7]*d.m[15];c.m[8]=b.m[8]*d.m[0]+b.m[9]*d.m[4]+b.m[10]*d.m[8]+b.m[11]*d.m[12];c.m[9]=b.m[8]*d.m[1]+b.m[9]*d.m[5]+b.m[10]*d.m[9]+b.m[11]*d.m[13];c.m[10]=b.m[8]*d.m[2]+b.m[9]*d.m[6]+b.m[10]*d.m[10]+b.m[11]*d.m[14];c.m[11]=b.m[8]*d.m[3]+b.m[9]*d.m[7]+b.m[10]*d.m[11]+b.m[11]*d.m[15];c.m[12]=b.m[12]*d.m[0]+b.m[13]*d.m[4]+b.m[14]*d.m[8]+b.m[15]*d.m[12];c.m[13]=b.m[12]*d.m[1]+b.m[13]*d.m[5]+b.m[14]*d.m[9]+b.m[15]*d.m[13];c.m[14]=b.m[12]*d.m[2]+
b.m[13]*d.m[6]+b.m[14]*d.m[10]+b.m[15]*d.m[14];c.m[15]=b.m[12]*d.m[3]+b.m[13]*d.m[7]+b.m[14]*d.m[11]+b.m[15]*d.m[15];return c};g.prototype.inverseAndDeterminant=function(){var b=this.m[4]*this.m[9]-this.m[5]*this.m[8],d=this.m[4]*this.m[10]-this.m[6]*this.m[8],c=this.m[4]*this.m[11]-this.m[7]*this.m[8],a=this.m[4]*this.m[13]-this.m[5]*this.m[12],f=this.m[4]*this.m[14]-this.m[6]*this.m[12],k=this.m[4]*this.m[15]-this.m[7]*this.m[12],l=this.m[5]*this.m[10]-this.m[6]*this.m[9],n=this.m[5]*this.m[11]-
this.m[7]*this.m[9],m=this.m[5]*this.m[14]-this.m[6]*this.m[13],p=this.m[5]*this.m[15]-this.m[7]*this.m[13],h=this.m[6]*this.m[11]-this.m[7]*this.m[10],r=this.m[6]*this.m[15]-this.m[7]*this.m[14],w=this.m[8]*this.m[13]-this.m[9]*this.m[12],t=this.m[8]*this.m[14]-this.m[10]*this.m[12],u=this.m[8]*this.m[15]-this.m[11]*this.m[12],v=this.m[9]*this.m[14]-this.m[10]*this.m[13],z=this.m[9]*this.m[15]-this.m[11]*this.m[13],x=this.m[10]*this.m[15]-this.m[11]*this.m[14],y=new g;y.m[0]=this.m[5]*x-this.m[6]*
z+this.m[7]*v;y.m[1]=this.m[2]*z-this.m[3]*v-this.m[1]*x;y.m[2]=this.m[1]*r-this.m[2]*p+this.m[3]*m;y.m[3]=this.m[2]*n-this.m[3]*l-this.m[1]*h;y.m[4]=this.m[6]*u-this.m[7]*t-this.m[4]*x;y.m[5]=this.m[0]*x-this.m[2]*u+this.m[3]*t;y.m[6]=this.m[2]*k-this.m[3]*f-this.m[0]*r;y.m[7]=this.m[0]*h-this.m[2]*c+this.m[3]*d;y.m[8]=this.m[4]*z-this.m[5]*u+this.m[7]*w;y.m[9]=this.m[1]*u-this.m[3]*w-this.m[0]*z;y.m[10]=this.m[0]*p-this.m[1]*k+this.m[3]*a;y.m[11]=this.m[1]*c-this.m[3]*b-this.m[0]*n;y.m[12]=this.m[5]*
t-this.m[6]*w-this.m[4]*v;y.m[13]=this.m[0]*v-this.m[1]*t+this.m[2]*w;y.m[14]=this.m[1]*f-this.m[2]*a-this.m[0]*m;y.m[15]=this.m[0]*l-this.m[1]*d+this.m[2]*b;b=this.m[0]*y.m[0]-this.m[1]*-y.m[4]+this.m[2]*y.m[8]-this.m[3]*-y.m[12];if(0===b)return[null,0];y.scale(1/b);return[y,b]};g.inverse=function(b){return b.inverseAndDeterminant()[0]};g.prototype.upperLeft3x3Determinant=function(){return this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[4]*(this.m[1]*this.m[10]-this.m[9]*this.m[2])+this.m[8]*
(this.m[1]*this.m[6]-this.m[5]*this.m[2])};g.prototype.normalMatrix=function(){var b=this.copy().setTranslationComponent(0,0,0).inverseAndDeterminant()[0];return b?b.transpose():null};g.prototype.toJson=function(){return this.m.slice()};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(b){return g.createFromArray(b)};g.construct=function(b){return g.fromJson(b)};g.toMatrix12=function(b){return[b[0],b[1],b[2],b[4],b[5],b[6],b[8],b[9],b[10],b[12],b[13],b[14]]};g.xAxisRotation=
function(b){var e=new g,c=d.Util.degreesToRadians(b);b=Math.cos(c);c=Math.sin(c);e.m[5]=b;e.m[6]=-c;e.m[9]=c;e.m[10]=b;return e};g.yAxisRotation=function(b){var e=new g,c=d.Util.degreesToRadians(b);b=Math.cos(c);c=Math.sin(c);e.m[0]=b;e.m[2]=c;e.m[8]=-c;e.m[10]=b;return e};g.zAxisRotation=function(b){var e=new g,c=d.Util.degreesToRadians(b);b=Math.cos(c);c=Math.sin(c);e.m[0]=b;e.m[1]=-c;e.m[4]=c;e.m[5]=b;return e};return g}();d.Matrix=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b,d,c){this.r=b;this.g=d;this.b=c}d.prototype.assign=function(b){this.set(b.r,b.g,b.b);return this};d.prototype.copy=function(){return new d(this.r,this.g,this.b)};d.prototype.equals=function(b){return this.r===b.r&&this.g===b.g&&this.b===b.b};d.prototype.set=function(b,d,c){this.r=b;this.g=d;this.b=c};d.prototype.setFromFloat=function(b,d,c){this.r=Math.round(255*b);this.g=Math.round(255*d);this.b=Math.round(255*c)};d.prototype.fromFloatArray=function(b){return this.setFromFloat(b[0],
b[1],b[2])};d.prototype.getFloatArray=function(){return[this.r/255,this.g/255,this.b/255]};d.prototype.toFloatArray=function(b){b[0]=this.r/255;b[1]=this.g/255;b[2]=this.b/255};d.fromJson=function(b){return new d(b.r,b.g,b.b)};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{r:this.r,g:this.g,b:this.b}};d.prototype.forJson=function(){return this.toJson()};d.createFromFloat=function(b,e,c){var a=d.black();a.setFromFloat(b,e,c);return a};d.createFromFloatArray=
function(b){var e=d.black();e.fromFloatArray(b);return e};d.red=function(){return new d(255,0,0)};d.green=function(){return new d(0,255,0)};d.blue=function(){return new d(0,0,255)};d.yellow=function(){return new d(255,255,0)};d.white=function(){return new d(255,255,255)};d.black=function(){return new d(0,0,0)};return d}();d.Color=h;h=function(){return function(d,b){this.top=d;this.bottom=b}}();d.VerticalGradient=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(200,d.OverlayUnit.Pixels,200,d.OverlayUnit.Pixels);this._anchor=d.OverlayAnchor.LowerLeftCorner;this._instanceKeys=[];this._enabled=!1;this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=!1;this._viewer=b;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return this._createViewport(),this._updateVisibility(),[4,this._createGeometry()];case 1:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){var c,a,f,b,d;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];case 1:k.sent();c=this._viewer.model;a=0;for(f=this._instanceKeys;a<f.length;a++)b=f[a],d=c._getNodeFromInstanceInc(!0,0,b,!0),c._preventNodeDeletion(d);
return[2]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.AxisTriad&&e._onViewportSet()}})}g.prototype.setAxisColor=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f;return __generator(this,function(k){switch(k.label){case 0:return[4,this._sceneReadyCompleted];
case 1:k.sent();switch(b){case d.Axis.X:c=this._instanceKeys[0];a=this._instanceKeys[3];break;case d.Axis.Y:c=this._instanceKeys[1];a=this._instanceKeys[4];break;case d.Axis.Z:c=this._instanceKeys[2];a=this._instanceKeys[5];break;default:return[2]}f=this._getScEngine();f.setPartColor([0,c],d.ElementType.Faces,e);f.setPartColor([0,a],d.ElementType.Lines,e);return[2]}})})};g.prototype.setAnchor=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=
b,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype._updateVisibility=function(){this._enabled?this._showOverlay():this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,
!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.AxisTriad,!0)};g.prototype.getEnabled=function(){return this._enabled};g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.AxisTriad};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.AxisTriad,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,
d.OverlayUnit.Pixels)};g.prototype._createViewport=function(){var b=this._viewer.overlayManager;this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(g._fieldSize);e.setHeight(g._fieldSize);e.setProjection(d.Projection.Orthographic);b.setCamera(d.BuiltinOverlayIndex.AxisTriad,e)};g.prototype._onViewportSet=function(){var b=this._viewer.overlayManager,e=b._getViewportPosition(d.BuiltinOverlayIndex.AxisTriad),
c=b._getViewportSize(d.BuiltinOverlayIndex.AxisTriad);b=b.getViewportAnchor(d.BuiltinOverlayIndex.AxisTriad);null!==e&&null!==c&&null!==b&&(this._position=e,this._viewportSize=c,this._anchor=b)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var b,e,c,a,f,k,l;return __generator(this,function(n){switch(n.label){case 0:if(this._geometryCreated)return[2];b=[this._createAxis(g._xRotMatrix,0,g._xColor),this._createAxis(g._yRotMatrix,1,g._yColor),this._createAxis(g._zRotMatrix,
2,g._zColor),this._createAxisLabel(d.Axis.X,g._xColor,3),this._createAxisLabel(d.Axis.Y,g._yColor,4),this._createAxisLabel(d.Axis.Z,g._zColor,5)];return[4,Promise.all(b)];case 1:e=n.sent();this._onCameraUpdate();c=[];a=0;for(f=e;a<f.length;a++)k=f[a],c.push(0,k);l=this._getScEngine();l.setPartVisibility(c,!0,!0);this._createGeomCallbacks();this._geometryCreated=!0;return[2]}})})};g.prototype._createGeomCallbacks=function(){var b=this;this._viewer.setCallbacks({camera:function(){b._onCameraUpdate()}})};
g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(b){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return b.x>=c.x&&b.y>=c.y&&b.x<=c.x+d.x&&b.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var b=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,b)};g.prototype._getViewportSize=function(){return this._viewportSize};
g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype.getSelectionAxis=function(b){console.assert(this._enabled);if(null===b||!b.isFaceSelection()||b.overlayIndex()!==d.BuiltinOverlayIndex.AxisTriad)return null;var e=this._viewer.model;b=b.getNodeId();e=e._gatherInstanceIncsFromNodeIds([b],1);if(2!==e.length||0!==e[0])return null;e=e[1];for(b=0;b<this._instanceKeys.length;++b)if(this._instanceKeys[b]===e)switch(b%3){case 0:return d.Axis.X;
case 1:return d.Axis.Y;case 2:return d.Axis.Z}return null};g.prototype.onClickSelection=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,l,n,g;return __generator(this,function(m){switch(m.label){case 0:e=this.getSelectionAxis(b);if(null===e)return[2];c=this._viewer.model;a=this._viewer.view;switch(e){case d.Axis.X:f=34;break;case d.Axis.Y:f=68;break;case d.Axis.Z:f=24}return[4,c.getModelBounding(!0,!1)];case 1:return k=m.sent(),l=a.getCamera(),n=this._alignedFitBounding(f,
!1,!1,k),l.equals(n)&&(n=this._alignedFitBounding(f,!0,!1,k)),[4,a._setCameraPromise(n,d.DefaultTransitionDuration)];case 2:return m.sent(),g=this._viewer.model.getAbsoluteRootNode(),0===this._viewer.model.getNodeChildren(g).length?[2,this._viewer._getScEngine().markCameraAsEmpty()]:[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(b,e,c,a,f,k){return __awaiter(this,void 0,void 0,function(){var l,n,g,p,h;return __generator(this,
function(m){switch(m.label){case 0:return[4,this._viewer.model.createMesh(b)];case 1:return l=m.sent(),n=new d.MeshInstanceData(l),n.setCreationFlags(k|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.Invisible),n.setOverlayIndex(d.BuiltinOverlayIndex.AxisTriad),n.setFaceColor(c),n.setLineColor(a),n.setMatrix(f),g=this._getScEngine(),[4,g.createMeshInstance(n)];case 2:return p=m.sent(),h=p[1],this._instanceKeys[e]=
h,[2,h]}})})};g.prototype._createAxis=function(b,e,c){var a=d.Util.generateConeCylinderMeshData(.2,20,2,.4,.5,.1);return this._createInstance(a,e,c,d.Color.black(),b,d.MeshInstanceCreationFlags.None)};g.prototype._createAxisLabel=function(b,e,c){var a=new d.MeshData;a.setFaceWinding(d.FaceWinding.Clockwise);var f=new d.Matrix;b===d.Axis.X?(a.addPolyline([.15,.25,0,-.15,-.25,0]),a.addPolyline([-.15,.25,0,.15,-.25,0]),f.setTranslationComponent(3.1,0,0)):b===d.Axis.Y?(a.addPolyline([-.15,.25,0,0,0,0]),
a.addPolyline([0,0,0,.15,.25,0]),a.addPolyline([0,0,0,0,-.3125,0]),f.setTranslationComponent(0,3.1,0)):b===d.Axis.Z&&(a.addPolyline([-.15,.25,0,.15,.25,0]),a.addPolyline([.15,.25,0,-.15,-.25,0]),a.addPolyline([-.15,-.25,0,.15,-.25,0]),f.setTranslationComponent(0,0,3.1));return this._createInstance(a,c,d.Color.black(),e,f,d.MeshInstanceCreationFlags.ScreenOriented)};g.prototype._onCameraUpdate=function(){var b=new d.Camera,e=this._viewer.view.getCamera();b.setPosition(e.getPosition().subtract(e.getTarget()).normalize());
b.setTarget(d.Point3.zero());b.setUp(e.getUp());b.setProjection(d.Projection.Orthographic);b.setWidth(g._fieldSize);b.setHeight(g._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.AxisTriad,b)};g.prototype._alignedFitBounding=function(b,e,c,a){var f=d.Point3.subtract(a.max,a.min).length();a=d.Point3.add(d.Point3.scale(a.min,.5),d.Point3.scale(a.max,.5));var k=new d.Point3(a.x,a.y,a.z+f);k=d.Point3.subtract(a,k);var l=-k.length();c=c?-1:1;0===b?(b=new d.Point3(0,c,0),e&&k.negate()):
(e&&(l=-l),0!==(b&2)?k=new d.Point3(l,0,0):0!==(b&4)?k=new d.Point3(0,l,0):(console.assert(0!==(b&8)),k=new d.Point3(0,0,l)),0!==(b&16)?b=new d.Point3(c,0,0):0!==(b&32)?b=new d.Point3(0,c,0):(console.assert(0!==(b&64)),b=new d.Point3(0,0,c)));e=d.Point3.subtract(a,k);c=this._viewer.view.getCamera();return d.Camera.create(e,a,b,c.getProjection(),f,f,c.getNearLimit())};g._xRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(0,0,1),-90);g._yRotMatrix=new d.Matrix;g._zRotMatrix=d.Matrix.createFromOffAxisRotation(new d.Point3(1,
0,0),90);g._xColor=new d.Color(168,56,59);g._yColor=new d.Color(96,166,50);g._zColor=new d.Color(41,81,185);g._fieldSize=8;return g}();d.AxisTriad=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b){this._id=0;this._bcfMap=new Map;this._viewer=b}g.prototype._getId=function(){return++this._id};g.prototype.getBCFMap=function(){return this._bcfMap};g.prototype.getBCFData=function(b){return this._bcfMap.get(b)||null};g.prototype.removeBCFData=function(b){this._bcfMap.delete(b);this._viewer.trigger("bcfRemoved",b)};g.prototype.createBCFData=function(b){var e=this._getId();b=new d.BCFData(b,e);this._bcfMap.set(e,b);this._viewer.trigger("bcfLoaded",b.getId(),
b.getFilename());return b};g.prototype.addBCFFromFile=function(b){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(a){switch(a.label){case 0:return d=this.createBCFData(b),[4,new JSZip.external.Promise(function(a,c){JSZipUtils.getBinaryContent(b,function(f,b){f?c(f):a(b)})})];case 1:return c=a.sent(),[4,this._loadBCFData(c,d)];case 2:return a.sent(),[2]}})})};g.prototype.addBCFFromBuffer=function(b,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(a){switch(a.label){case 0:return c=this.createBCFData(d),[4,this._loadBCFData(b,c)];case 1:return a.sent(),[2]}})})};g.prototype._getVersion=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f;return __generator(this,function(k){switch(k.label){case 0:return e=b.file("bcf.version"),null!==e?[3,1]:[2,d.BCFVersion.v1_0];case 1:return[4,this._getDocument(e)];case 2:c=k.sent();a=c.documentElement;f=a.firstElementChild;if(null!==f&&null!==f.textContent)switch(f.textContent){case "2.0 RC":return[2,
d.BCFVersion.v2_0];case "2.1":return[2,d.BCFVersion.v2_1]}return[2,d.BCFVersion.Unknown]}})})};g.prototype._loadBCFData=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f,k,l,n,g,p,h,r=this;return __generator(this,function(m){switch(m.label){case 0:return c=this._viewer.model,[4,c.getModelBounding(!0,!1)];case 1:return a=m.sent(),f=c.getNodeUnitMultiplier(c.getAbsoluteRootNode()),k=e.getId(),l=e.getFilename(),[4,JSZip.loadAsync(b)];case 2:return n=m.sent(),p=(g=e).setVersion,[4,
this._getVersion(n)];case 3:return p.apply(g,[m.sent()]),h=[],n.forEach(function(c){return __awaiter(r,void 0,void 0,function(){var b,g,m,p,q,r,w,t,C,F,E,H,G,I,K,J,L;return __generator(this,function(u){switch(u.label){case 0:b=d.Util.OpenPromise.create();h.push(b);g=this._getFileType(c);if(g!==d.BCFFileType.Markup&&g!==d.BCFFileType.Snapshot&&g!==d.BCFFileType.Viewpoint)return[3,7];m=c.split("/");p=m[0];q=m[1];r=e.getTopic(p);null===r&&(r=new d.BCFTopic(k,l,p,this._viewer),e.addTopic(p,r));if(!q.length)return[3,
7];w=n.file(c);if(null===w)return[3,7];t=g;switch(t){case d.BCFFileType.Markup:return[3,1];case d.BCFFileType.Viewpoint:return[3,3];case d.BCFFileType.Snapshot:return[3,5]}return[3,7];case 1:return F=(C=r).addMarkup,E=[q],[4,this._getDocument(w)];case 2:return F.apply(C,E.concat([u.sent()])),[3,7];case 3:return G=(H=r).addViewpoint,I=[q],[4,this._getDocument(w)];case 4:return G.apply(H,I.concat([u.sent(),e.getVersion(),a,f])),[3,7];case 5:return J=(K=r).addSnapshot,L=[q],[4,w.async("uint8array")];
case 6:return J.apply(K,L.concat([u.sent()])),[3,7];case 7:return b.resolve(),[2]}})})}),[4,d.Util.waitForAll(h)];case 4:return m.sent(),this._viewer.trigger("bcfLoaded",k,l),[2]}})})};g.prototype._getDocument=function(b){return __awaiter(this,void 0,void 0,function(){var d,c,a;return __generator(this,function(f){switch(f.label){case 0:return d=new DOMParser,a=(c=d).parseFromString,[4,b.async("text")];case 1:return[2,a.apply(c,[f.sent(),"application/xml"])]}})})};g.prototype._getFileType=function(b){if("/"===
b.slice(-1))return d.BCFFileType.TopicFolder;b=b.split(".");console.assert(2===b.length);switch(b[1]){case "bcf":return d.BCFFileType.Markup;case "bcfv":return d.BCFFileType.Viewpoint;case "png":return d.BCFFileType.Snapshot;case "version":return d.BCFFileType.Version;case "xsd":return d.BCFFileType.Schema;case "bcfp":return d.BCFFileType.Project}return d.BCFFileType.Unknown};return g}();d.BCFManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,e){void 0===b&&(b=d.Point3.zero());void 0===e&&(e=d.Point3.zero());this.min=b.copy();this.max=e.copy()}g.prototype.copy=function(){return new g(this.min,this.max)};g.prototype.equals=function(b){return this.min.equals(b.min)&&this.max.equals(b.max)};g.prototype.center=function(){var b=d.Point3.add(this.min,this.max);b.scale(.5);return b};g.prototype.extents=function(){return d.Point3.subtract(this.max,this.min)};g.prototype.addBox=function(b){b.isDegenerate()||
(this.addPoint(b.min),this.addPoint(b.max))};g.prototype.addPoint=function(b){b.x<this.min.x&&(this.min.x=b.x);b.y<this.min.y&&(this.min.y=b.y);b.z<this.min.z&&(this.min.z=b.z);b.x>this.max.x&&(this.max.x=b.x);b.y>this.max.y&&(this.max.y=b.y);b.z>this.max.z&&(this.max.z=b.z)};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{min:this.min.toJson(),max:this.max.toJson()}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(b){var e=d.Point3.fromJson(b.min);
b=d.Point3.fromJson(b.max);return new g(e,b)};g.construct=function(b){return g.fromJson(b)};g.prototype.getCorners=function(){var b=[];b[0]=this.min.copy();b[1]=this.min.copy();b[2]=this.min.copy();b[1].x=this.max.x;b[2].y=this.max.y;b[3]=b[2].copy();b[3].x=this.max.x;b[4]=b[0].copy();b[5]=b[1].copy();b[6]=b[2].copy();b[7]=b[3].copy();b[4].z=this.max.z;b[5].z=this.max.z;b[6].z=this.max.z;b[7].z=this.max.z;return b};g.invalid=function(){return new g(new d.Point3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY),new d.Point3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))};g.prototype.isDegenerate=function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z};return g}();d.Box=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){var b=this;this._aliasMap=new Map;this._callbackMap=new Map;this._activeTriggerDepth=0;this._pendingClearUnboundFilteredNames=new Set;this._aliasMap.set("sceneRendered","frameDrawn");this.bind({selectionArray:function(c){b._triggerDeprecatedSelectionCallback(c)},incrementalSelectionBatchBegin:function(){return b.unsafeTrigger("volumeSelectionBatchBegin")},incrementalSelectionBatchEnd:function(){return b.unsafeTrigger("volumeSelectionBatchEnd")},
incrementalSelectionEnd:function(){return b.unsafeTrigger("volumeSelectionEnd")},visibilityChanged:function(c,a){b.unsafeTrigger("partsVisibilityShown",c);b.unsafeTrigger("partsVisibilityHidden",a)}})}b.prototype._triggerDeprecatedSelectionCallback=function(b){if(0===b.length)this.unsafeTrigger("selection",[d.Event.NodeSelectionEvent._createNull()]);else if(100>=b.length)this.unsafeTrigger("selection",b);else{var c=0;for(b=h.chunkify(b,100);c<b.length;c++)this.unsafeTrigger("selection",b[c])}};b.prototype._filterName=
function(b){var c=this._aliasMap.get(b);return void 0===c?b:c};b.prototype.bind=function(b,c){for(var a=0,f=Object.keys(b);a<f.length;a++){var k=f[a],d=b[k];if("function"===typeof d){k=this._filterName(k);var e=this._callbackMap.get(k);void 0===e?this._callbackMap.set(k,[d]):c?e.unshift(d):e.push(d)}}};b.prototype.unbind=function(b){for(var c=0,a=Object.keys(b);c<a.length;c++){var f=a[c],k=this._filterName(f),d=this._callbackMap.get(k);if(void 0!==d){f=b[f];for(var e=0;e<d.length;e++)d[e]===f&&(d[e]=
null,this._pendingClearUnboundFilteredNames.add(k))}}this._clearUnboundCallbacks()};b.prototype._clearUnboundCallbacks=function(){var b=this;0!==this._pendingClearUnboundFilteredNames.size&&0===this._activeTriggerDepth&&(this._pendingClearUnboundFilteredNames.forEach(function(c){var a=b._callbackMap.get(c);void 0!==a&&(a=a.filter(function(a){return null!==a}),0===a.length?b._callbackMap.delete(c):b._callbackMap.set(c,a))}),this._pendingClearUnboundFilteredNames.clear())};b.prototype.promiseTrigger=
function(b,c){for(var a=[],f=2;f<arguments.length;f++)a[f-2]=arguments[f];return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(k){switch(k.label){case 0:console.assert(b!==c),k.label=1;case 1:return k.trys.push([1,3,4,5]),[4,this._unsafePromiseTrigger(b,a)];case 2:return k.sent(),[3,5];case 3:return f=k.sent(),console.log("Rejected promise in '"+b+"' callback:"),console.log(f),[3,5];case 4:return null!==c&&this.unsafeTrigger(c,a),[7];case 5:return[2]}})})};b.prototype._unsafePromiseTrigger=
function(b,c){var a=this._filterName(b);a=this._callbackMap.get(a);var f=[];if(void 0!==a){++this._activeTriggerDepth;for(var k=0;k<a.length;k++){var e=a[k];if(null!==e)try{f.push(e.apply(null,c))}catch(n){console.log("Unhandled exception in '"+b+"' callback:"),console.log(n)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}return d.Util.waitForAll(f)};b.prototype.trigger=function(b){for(var c=[],a=1;a<arguments.length;a++)c[a-1]=arguments[a];this.unsafeTrigger(b,c)};b.prototype.unsafeTrigger=
function(b,c){var a=this._filterName(b);a=this._callbackMap.get(a);if(void 0!==a){++this._activeTriggerDepth;for(var f=0;f<a.length;f++){var k=a[f];if(null!==k)try{k.apply(null,c)}catch(l){console.log("Unhandled exception in '"+b+"' callback:"),console.log(l)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}};return b}();h.CallbackManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(b){b[b.LoadModel=0]="LoadModel";b[b.CreateNode=1]="CreateNode";b[b.CreateInstance=2]="CreateInstance";b[b.CreatePmi=3]="CreatePmi"})(d.NodeSource||(d.NodeSource={}));(function(b){b[b.Desktop=0]="Desktop";b[b.Mobile=1]="Mobile"})(d.ScreenConfiguration||(d.ScreenConfiguration={}));(function(b){b[b.Faces=0]="Faces";b[b.Lines=1]="Lines";b[b.Points=2]="Points"})(d.ElementType||(d.ElementType={}));(function(b){b[b.Orthographic=0]="Orthographic";b[b.Perspective=1]="Perspective"})(d.Projection||
(d.Projection={}));(function(b){b[b.Top=0]="Top";b[b.Bottom=1]="Bottom";b[b.Left=2]="Left";b[b.Right=3]="Right";b[b.Front=4]="Front";b[b.Back=5]="Back";b[b.Iso=6]="Iso";b[b.TopRightFront=7]="TopRightFront";b[b.TopLeftFront=8]="TopLeftFront";b[b.TopLeftBack=9]="TopLeftBack";b[b.TopRightBack=10]="TopRightBack";b[b.TopBack=11]="TopBack";b[b.TopFront=12]="TopFront";b[b.TopLeft=13]="TopLeft";b[b.TopRight=14]="TopRight";b[b.BottomRightBack=15]="BottomRightBack";b[b.BottomLeftBack=16]="BottomLeftBack";b[b.BottomLeftFront=
17]="BottomLeftFront";b[b.BottomRightFront=18]="BottomRightFront";b[b.BottomFront=19]="BottomFront";b[b.BottomBack=20]="BottomBack";b[b.BottomLeft=21]="BottomLeft";b[b.BottomRight=22]="BottomRight";b[b.RightBottomBack=23]="RightBottomBack";b[b.RightBottomFront=24]="RightBottomFront";b[b.RightTopFront=25]="RightTopFront";b[b.RightTopBack=26]="RightTopBack";b[b.RightTop=27]="RightTop";b[b.RightBottom=28]="RightBottom";b[b.RightFront=29]="RightFront";b[b.RightBack=30]="RightBack";b[b.LeftBottomFront=
31]="LeftBottomFront";b[b.LeftBottomBack=32]="LeftBottomBack";b[b.LeftTopBack=33]="LeftTopBack";b[b.LeftTopFront=34]="LeftTopFront";b[b.LeftTop=35]="LeftTop";b[b.LeftBottom=36]="LeftBottom";b[b.LeftBack=37]="LeftBack";b[b.LeftFront=38]="LeftFront";b[b.FrontBottomRight=39]="FrontBottomRight";b[b.FrontTopRight=40]="FrontTopRight";b[b.FrontTopLeft=41]="FrontTopLeft";b[b.FrontBottomLeft=42]="FrontBottomLeft";b[b.FrontRight=43]="FrontRight";b[b.FrontLeft=44]="FrontLeft";b[b.FrontTop=45]="FrontTop";b[b.FrontBottom=
46]="FrontBottom";b[b.BackTopRight=47]="BackTopRight";b[b.BackBottomRight=48]="BackBottomRight";b[b.BackBottomLeft=49]="BackBottomLeft";b[b.BackTopLeft=50]="BackTopLeft";b[b.BackLeft=51]="BackLeft";b[b.BackRight=52]="BackRight";b[b.BackBottom=53]="BackBottom";b[b.BackTop=54]="BackTop"})(d.ViewOrientation||(d.ViewOrientation={}));(function(b){b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z"})(d.Axis||(d.Axis={}));(function(b){b[b.None=-1]="None";b[b.Left=0]="Left";b[b.Middle=1]="Middle";b[b.Right=2]="Right"})(d.Button||
(d.Button={}));(function(b){b[b.None=0]="None";b[b.Left=1]="Left";b[b.Right=2]="Right";b[b.Middle=4]="Middle"})(d.Buttons||(d.Buttons={}));(function(b){b[b.Axis=0]="Axis";b[b.Plane=1]="Plane";b[b.ViewPlane=2]="ViewPlane";b[b.Rotate=3]="Rotate"})(d.HandleType||(d.HandleType={}));(function(b){b[b.Translate=0]="Translate";b[b.Rotate=1]="Rotate"})(d.HandleEventType||(d.HandleEventType={}));(function(b){b[b.Invalid=-1]="Invalid";b[b.None=0]="None";b[b.Navigate=1]="Navigate";b[b.Orbit=2]="Orbit";b[b.Pan=
3]="Pan";b[b.Zoom=4]="Zoom";b[b.Walk=5]="Walk";b[b.KeyboardWalk=6]="KeyboardWalk";b[b.WalkMode=7]="WalkMode";b[b.Turntable=8]="Turntable";b[b.Select=9]="Select";b[b.AreaSelect=10]="AreaSelect";b[b.RayDrillSelect=11]="RayDrillSelect";b[b.RedlineCircle=12]="RedlineCircle";b[b.RedlineText=13]="RedlineText";b[b.RedlineRectangle=14]="RedlineRectangle";b[b.RedlinePolyline=15]="RedlinePolyline";b[b.MeasureEdgeLength=16]="MeasureEdgeLength";b[b.MeasureFaceFaceDistance=17]="MeasureFaceFaceDistance";b[b.MeasureLineLineAngle=
18]="MeasureLineLineAngle";b[b.MeasurePointPointDistance=19]="MeasurePointPointDistance";b[b.MeasureFaceFaceAngle=20]="MeasureFaceFaceAngle";b[b.MeasurePolylineDistance=21]="MeasurePolylineDistance";b[b.MeasurePolygonArea=22]="MeasurePolygonArea";b[b.Note=23]="Note";b[b.Cutting=24]="Cutting";b[b.Handle=25]="Handle";b[b.NavCube=26]="NavCube";b[b.AxisTriad=27]="AxisTriad";b[b.Floorplan=28]="Floorplan"})(d.OperatorId||(d.OperatorId={}));(function(b){b[b.MouseDown=0]="MouseDown";b[b.MouseMove=1]="MouseMove";
b[b.MouseUp=2]="MouseUp";b[b.Mousewheel=3]="Mousewheel";b[b.TouchStart=4]="TouchStart";b[b.TouchMove=5]="TouchMove";b[b.TouchEnd=6]="TouchEnd";b[b.KeyDown=7]="KeyDown";b[b.KeyUp=8]="KeyUp";b[b.ViewOrientationChange=9]="ViewOrientationChange"})(d.EventType||(d.EventType={}));(function(b){b[b.None=0]="None";b[b.Shift=2]="Shift";b[b.Alt=4]="Alt";b[b.Control=8]="Control";b[b.Command=16]="Command"})(d.KeyModifiers||(d.KeyModifiers={}));(function(b){b[b.Down=0]="Down";b[b.Up=1]="Up";b[b.Move=2]="Move";
b[b.Wheel=3]="Wheel"})(d.MouseInputType||(d.MouseInputType={}));(function(b){b[b.Start=0]="Start";b[b.Move=1]="Move";b[b.End=2]="End"})(d.TouchInputType||(d.TouchInputType={}));(function(b){b[b.Down=0]="Down";b[b.Up=1]="Up"})(d.KeyInputType||(d.KeyInputType={}));(function(b){b[b.Forward=0]="Forward";b[b.Backward=1]="Backward";b[b.Left=2]="Left";b[b.Right=3]="Right";b[b.Up=4]="Up";b[b.Down=5]="Down";b[b.RotateRight=6]="RotateRight";b[b.RotateLeft=7]="RotateLeft";b[b.TiltUp=8]="TiltUp";b[b.TiltDown=
9]="TiltDown"})(d.WalkDirection||(d.WalkDirection={}));(function(b){b[b.Backspace=8]="Backspace";b[b.Shift=16]="Shift";b[b.Escape=27]="Escape";b[b.PgUp=33]="PgUp";b[b.PgDown=34]="PgDown";b[b.LeftArrow=37]="LeftArrow";b[b.UpArrow=38]="UpArrow";b[b.RightArrow=39]="RightArrow";b[b.DownArrow=40]="DownArrow";b[b.Delete=46]="Delete";b[b.a=65]="a";b[b.b=66]="b";b[b.c=67]="c";b[b.d=68]="d";b[b.e=69]="e";b[b.f=70]="f";b[b.g=71]="g";b[b.h=72]="h";b[b.i=73]="i";b[b.j=74]="j";b[b.k=75]="k";b[b.l=76]="l";b[b.m=
77]="m";b[b.n=78]="n";b[b.o=79]="o";b[b.p=80]="p";b[b.q=81]="q";b[b.r=82]="r";b[b.s=83]="s";b[b.t=84]="t";b[b.u=85]="u";b[b.v=86]="v";b[b.w=87]="w";b[b.x=88]="x";b[b.y=89]="y";b[b.z=90]="z";b[b._0=48]="_0";b[b._1=49]="_1";b[b._2=50]="_2";b[b._3=51]="_3";b[b._4=52]="_4";b[b._5=53]="_5";b[b._6=54]="_6";b[b._7=55]="_7";b[b._8=56]="_8";b[b._9=57]="_9";b[b.NumPad_0=96]="NumPad_0";b[b.NumPad_1=97]="NumPad_1";b[b.NumPad_2=98]="NumPad_2";b[b.NumPad_3=99]="NumPad_3";b[b.NumPad_4=100]="NumPad_4";b[b.NumPad_5=
101]="NumPad_5";b[b.NumPad_6=102]="NumPad_6";b[b.NumPad_7=103]="NumPad_7";b[b.NumPad_8=104]="NumPad_8";b[b.NumPad_9=105]="NumPad_9"})(d.KeyCode||(d.KeyCode={}));(function(b){b[b.None=0]="None";b[b.Face=1]="Face";b[b.Line=2]="Line";b[b.Point=4]="Point";b[b.All=7]="All"})(d.SelectionMask||(d.SelectionMask={}));(function(b){b[b.None=0]="None";b[b.Face=1]="Face";b[b.Line=2]="Line";b[b.Point=3]="Point";b[b.Part=4]="Part"})(d.SelectionType||(d.SelectionType={}));(function(b){b[b.Set=0]="Set";b[b.Add=1]=
"Add";b[b.Toggle=2]="Toggle"})(d.SelectionMode||(d.SelectionMode={}));(function(b){b[b.HighlightOnly=0]="HighlightOnly";b[b.OutlineOnly=1]="OutlineOnly";b[b.HighlightAndOutline=2]="HighlightAndOutline"})(d.SelectionHighlightMode||(d.SelectionHighlightMode={}));(function(b){b[b.Info=0]="Info";b[b.Warning=1]="Warning";b[b.Error=2]="Error"})(d.InfoType||(d.InfoType={}));(function(b){b[b.Interactive=1]="Interactive";b[b.All=2]="All";b[b.OnDemand=4]="OnDemand";b[b.Default=1]="Default"})(d.StreamingMode||
(d.StreamingMode={}));(function(b){b[b.Client=0]="Client";b[b.Server=1]="Server"})(d.RendererType||(d.RendererType={}));(function(b){b[b.Wireframe=0]="Wireframe";b[b.Shaded=1]="Shaded";b[b.WireframeOnShaded=2]="WireframeOnShaded";b[b.HiddenLine=3]="HiddenLine";b[b.XRay=4]="XRay"})(d.DrawMode||(d.DrawMode={}));(function(b){b[b.Unsorted=0]="Unsorted";b[b.SingleLayer=1]="SingleLayer"})(d.TransparencyMode||(d.TransparencyMode={}));(function(b){b[b.Unsorted=0]="Unsorted";b[b.SingleLayer=1]="SingleLayer"})(d.XRayTransparencyMode||
(d.XRayTransparencyMode={}));(function(b){b[b.SMAA=0]="SMAA";b[b.None=1]="None"})(d.AntiAliasingMode||(d.AntiAliasingMode={}));(function(b){b[b.DoNotExplode=0]="DoNotExplode";b[b.DoNotCut=1]="DoNotCut";b[b.DoNotSelect=2]="DoNotSelect";b[b.SuppressCameraScale=3]="SuppressCameraScale";b[b.OverrideSceneVisibility=4]="OverrideSceneVisibility";b[b.DoNotLight=5]="DoNotLight";b[b.DoNotOutlineHighlight=6]="DoNotOutlineHighlight";b[b.ExcludeBounding=7]="ExcludeBounding";b[b.DoNotUseVertexColors=8]="DoNotUseVertexColors";
b[b.AlwaysDraw=9]="AlwaysDraw";b[b.DoNotXRay=10]="DoNotXRay";b[b.ScreenOriented=11]="ScreenOriented";b[b.ScreenSpace=12]="ScreenSpace";b[b.ScreenSpaceStretched=13]="ScreenSpaceStretched";b[b.IgnoreExplosion=0]="IgnoreExplosion";b[b.IgnoreCutting=1]="IgnoreCutting";b[b.IgnoreSelection=2]="IgnoreSelection";b[b.IgnoreCameraScale=3]="IgnoreCameraScale";b[b.IgnoreLighting=5]="IgnoreLighting";b[b.IgnoreOutlineHighlight=6]="IgnoreOutlineHighlight"})(d.InstanceModifier||(d.InstanceModifier={}));(function(b){b[b.None=
0]="None";b[b.SuppressCameraScale=1]="SuppressCameraScale";b[b.ScreenOriented=2]="ScreenOriented";b[b.DoNotCut=4]="DoNotCut";b[b.DoNotExplode=8]="DoNotExplode";b[b.DoNotSelect=16]="DoNotSelect";b[b.DoNotLight=32]="DoNotLight";b[b.DoNotOutlineHighlight=64]="DoNotOutlineHighlight";b[b.ExcludeBounding=128]="ExcludeBounding";b[b.DoNotUseVertexColors=256]="DoNotUseVertexColors";b[b.Invisible=512]="Invisible";b[b.DoNotXRay=1024]="DoNotXRay";b[b.AlwaysDraw=2048]="AlwaysDraw";b[b.OverrideSceneVisibility=
4096]="OverrideSceneVisibility";b[b.ScreenSpace=8192]="ScreenSpace";b[b.ScreenSpaceStretched=16384]="ScreenSpaceStretched"})(d.MeshInstanceCreationFlags||(d.MeshInstanceCreationFlags={}));(function(b){b[b.None=0]="None";b[b.Model=1]="Model";b[b.Instance=2]="Instance";b[b.Ejected=4]="Ejected";b[b.All=7]="All"})(d.BoundingPreviewMode||(d.BoundingPreviewMode={}));(function(b){b[b.CameraTarget=0]="CameraTarget";b[b.ModelCenter=1]="ModelCenter";b[b.OrbitTarget=2]="OrbitTarget"})(d.OrbitFallbackMode||(d.OrbitFallbackMode=
{}));(function(b){b[b.Mouse=0]="Mouse";b[b.Keyboard=1]="Keyboard"})(d.WalkMode||(d.WalkMode={}));(function(b){b[b.AssemblyNode=0]="AssemblyNode";b[b.PartInstance=1]="PartInstance";b[b.Part=2]="Part";b[b.BodyInstance=3]="BodyInstance";b[b.PmiBody=4]="PmiBody";b[b.PMIBody=4]="PMIBody";b[b.ViewFrame=5]="ViewFrame";b[b.Body=6]="Body";b[b.BrepBody=7]="BrepBody";b[b.TessBody=8]="TessBody";b[b.WireBody=9]="WireBody";b[b.PointsBody=10]="PointsBody";b[b.Pmi=11]="Pmi";b[b.PMI=11]="PMI";b[b.CadView=12]="CadView";
b[b.CADView=12]="CADView";b[b.DrawingSheet=13]="DrawingSheet";b[b.Unknown=14]="Unknown"})(d.NodeType||(d.NodeType={}));var h;(function(b){b[b.Unknown=0]="Unknown";b[b.Text=1]="Text";b[b.Dimension=2]="Dimension";b[b.Arrow=3]="Arrow";b[b.Balloon=4]="Balloon";b[b.CircleCenter=5]="CircleCenter";b[b.Coordinate=6]="Coordinate";b[b.Datum=7]="Datum";b[b.Fastener=8]="Fastener";b[b.Gdt=9]="Gdt";b[b.Locator=10]="Locator";b[b.MeasurementPoint=11]="MeasurementPoint";b[b.Roughness=12]="Roughness";b[b.Welding=13]=
"Welding";b[b.Table=14]="Table";b[b.Other=15]="Other";b[b.GeometricalTolerance=16]="GeometricalTolerance"})(h=d.PmiType||(d.PmiType={}));d.PMIType=h;(function(b){b[b.Unknown=0]="Unknown";b[b.DatumIdent=1]="DatumIdent";b[b.DatumTarget=2]="DatumTarget";b[b.DimensionDistance=1]="DimensionDistance";b[b.DimensionDistanceOffset=2]="DimensionDistanceOffset";b[b.DimensionDistanceCumulate=3]="DimensionDistanceCumulate";b[b.DimensionChamfer=4]="DimensionChamfer";b[b.DimensionSlope=5]="DimensionSlope";b[b.DimensionOrdinate=
6]="DimensionOrdinate";b[b.DimensionRadius=7]="DimensionRadius";b[b.DimensionRadiusTangent=8]="DimensionRadiusTangent";b[b.DimensionRadiusCylinder=9]="DimensionRadiusCylinder";b[b.DimensionRadiusEdge=10]="DimensionRadiusEdge";b[b.DimensionDiameter=11]="DimensionDiameter";b[b.DimensionDiameterTangent=12]="DimensionDiameterTangent";b[b.DimensionDiameterCylinder=13]="DimensionDiameterCylinder";b[b.DimensionDiameterEdge=14]="DimensionDiameterEdge";b[b.DimensionDiameterCone=15]="DimensionDiameterCone";
b[b.DimensionLength=16]="DimensionLength";b[b.DimensionLengthCurvilinear=17]="DimensionLengthCurvilinear";b[b.DimensionLengthCircular=18]="DimensionLengthCircular";b[b.DimensionAngle=19]="DimensionAngle";b[b.GdtFcf=1]="GdtFcf";b[b.WeldingLine=1]="WeldingLine";b[b.WeldingSpot=2]="WeldingSpot";b[b.OtherSymbolUser=1]="OtherSymbolUser";b[b.OtherSymbolUtility=2]="OtherSymbolUtility";b[b.OtherSymbolCustom=3]="OtherSymbolCustom";b[b.OtherGeometricReference=4]="OtherGeometricReference";b[b.OtherRegion=5]=
"OtherRegion"})(h=d.PmiSubType||(d.PmiSubType={}));d.PMISubType=h;var g;(function(b){b[b.Unknown=-1]="Unknown";b[b.Context=1]="Context";b[b.Item=2]="Item";b[b.MultipleVertex=3]="MultipleVertex";b[b.UniqueVertex=4]="UniqueVertex";b[b.WireEdge=5]="WireEdge";b[b.Edge=6]="Edge";b[b.CoEdge=7]="CoEdge";b[b.Loop=8]="Loop";b[b.Face=9]="Face";b[b.Shell=10]="Shell";b[b.Connex=11]="Connex";b[b.Body=12]="Body";b[b.SingleWireBody=13]="SingleWireBody";b[b.BrepData=14]="BrepData";b[b.WireBody=17]="WireBody"})(g=
d.PmiTopoRef||(d.PmiTopoRef={}));d.PMITopoRef=g;(function(b){b[b.Unknown=0]="Unknown";b[b.Clockwise=1]="Clockwise";b[b.CounterClockwise=2]="CounterClockwise"})(d.FaceWinding||(d.FaceWinding={}));(function(b){b[b.UpperLeftCorner=0]="UpperLeftCorner";b[b.LowerLeftCorner=1]="LowerLeftCorner";b[b.LowerRightCorner=2]="LowerRightCorner";b[b.UpperRightCorner=3]="UpperRightCorner";b[b.TopCenter=4]="TopCenter";b[b.LeftCenter=5]="LeftCenter";b[b.RightCenter=6]="RightCenter";b[b.BottomCenter=7]="BottomCenter";
b[b.Center=8]="Center"})(d.OverlayAnchor||(d.OverlayAnchor={}));(function(b){b[b.Pixels=0]="Pixels";b[b.ProportionOfCanvas=1]="ProportionOfCanvas";b[b.ProportionOfOtherDimension=2]="ProportionOfOtherDimension"})(d.OverlayUnit||(d.OverlayUnit={}));(function(b){b[b.ScreenPixels=0]="ScreenPixels";b[b.CSSPixels=1]="CSSPixels";b[b.World=2]="World";b[b.ProportionOfScreenWidth=3]="ProportionOfScreenWidth";b[b.ProportionOfScreenHeight=4]="ProportionOfScreenHeight";b[b.ProportionOfBoundingDiagonal=5]="ProportionOfBoundingDiagonal"})(d.PointSizeUnit||
(d.PointSizeUnit={}));(function(b){b[b.Square=0]="Square";b[b.Disk=1]="Disk";b[b.Sphere=2]="Sphere"})(d.PointShape||(d.PointShape={}));h=function(){function b(){this.bodyId=d.InvalidNodeId;this.subElementType=g.Unknown;this.subElementIndex=-1}Object.defineProperty(b.prototype,"bodyID",{get:function(){return this.bodyId},set:function(b){this.bodyId=b},enumerable:!0,configurable:!0});return b}();d.RefOnTopoItem=h;(function(b){b[b.Hidden=0]="Hidden";b[b.Shown=1]="Shown";b[b.Mixed=2]="Mixed"})(d.BranchVisibility||
(d.BranchVisibility={}));(function(b){b[b.Object=0]="Object";b[b.World=1]="World"})(d.CullingVectorSpace||(d.CullingVectorSpace={}));(function(b){b[b.First=8]="First";b[b.Handles=8]="Handles";b[b.AxisTriad=9]="AxisTriad";b[b.NavCube=10]="NavCube";b[b.Floorplan=11]="Floorplan";b[b.TestFramework=12]="TestFramework"})(d.BuiltinOverlayIndex||(d.BuiltinOverlayIndex={}));h=function(){return function(){this.pos1=d.Point3.zero();this.pos2=d.Point3.zero();this.distance=0}}();d.FaceFaceDistanceItem=h;h=function(){return function(){this.frontVector=
new d.Point3(-1,0,0);this.upVector=new d.Point3(0,0,1)}}();d.ViewAxes=h;(function(b){b[b.Object=0]="Object";b[b.World=1]="World";b[b.ProportionOfScreenWidth=2]="ProportionOfScreenWidth";b[b.ProportionOfScreenHeight=3]="ProportionOfScreenHeight"})(d.LinePatternLengthUnit||(d.LinePatternLengthUnit={}));(function(b){b[b.Selected=0]="Selected";b[b.Unselected=1]="Unselected"})(d.XRayGroup||(d.XRayGroup={}));(function(b){b[b.Pixels=0]="Pixels";b[b.ProportionOfWidth=1]="ProportionOfWidth";b[b.ProportionOfHeight=
2]="ProportionOfHeight"})(d.BlurIntervalUnit||(d.BlurIntervalUnit={}));(function(b){b[b.Undefined=0]="Undefined";b[b.Int=1]="Int";b[b.Float=2]="Float";b[b.Time=3]="Time";b[b.String=4]="String";b[b.Ignored=5]="Ignored"})(d.AttributeType||(d.AttributeType={}));h=function(){return function(b,d){this.isInclusive=b;this.nodeIds=d}}();d.FilteredNodes=h;h=function(){return function(b,d){this.defaultVisibility=b;this.visibilityExceptions=d}}();d.VisibilityState=h;h=function(){function b(){this.additionalMatrix=
null;this.attachInvisibly=this.allowMissingExternalModels=!1;this._allowSubtreeLoadedCallback=this.implicitlyLoadXmlExternalModels=!0}b.prototype.copy=function(){var d=new b;d.additionalMatrix=this.additionalMatrix;null!==d.additionalMatrix&&(d.additionalMatrix=d.additionalMatrix.copy());d.allowMissingExternalModels=this.allowMissingExternalModels;d.attachInvisibly=this.attachInvisibly;d.implicitlyLoadXmlExternalModels=this.implicitlyLoadXmlExternalModels;d._allowSubtreeLoadedCallback=this._allowSubtreeLoadedCallback;
return d};return b}();d.LoadSubtreeConfig=h;(function(b){b[b.Unknown=0]="Unknown";b[b.Catia=2]="Catia";b[b.CatiaV5=3]="CatiaV5";b[b.Cadds=4]="Cadds";b[b.Unigraphics=5]="Unigraphics";b[b.Parasolid=6]="Parasolid";b[b.Euclid=7]="Euclid";b[b.Iges=9]="Iges";b[b.Unisurf=10]="Unisurf";b[b.Vda=11]="Vda";b[b.Stl=12]="Stl";b[b.Wrl=13]="Wrl";b[b.Dxf=14]="Dxf";b[b.Acis=15]="Acis";b[b.ProE=16]="ProE";b[b.Step=18]="Step";b[b.Ideas=19]="Ideas";b[b.Jt=20]="Jt";b[b.Slw=22]="Slw";b[b.Cgr=23]="Cgr";b[b.Prc=24]="Prc";
b[b.Xvl=25]="Xvl";b[b.Hpgl=26]="Hpgl";b[b.TopSolid=27]="TopSolid";b[b.OneSpaceDesigner=28]="OneSpaceDesigner";b[b._3dxml=29]="_3dxml";b[b.Inventor=30]="Inventor";b[b.PostScript=31]="PostScript";b[b.Pdp=32]="Pdp";b[b.U3d=33]="U3d";b[b.Ifc=34]="Ifc";b[b.Dwg=35]="Dwg";b[b.Dwf=36]="Dwf";b[b.Se=37]="Se";b[b.Obj=38]="Obj";b[b.Kmz=39]="Kmz";b[b.Dae=40]="Dae";b[b._3ds=41]="_3ds";b[b.Rhino=43]="Rhino";b[b.Xml=44]="Xml";b[b._3mf=45]="_3mf";b[b.Scs=46]="Scs";b[b._3dHtml=47]="_3dHtml";b[b.Hsf=48]="Hsf";b[b.Gltf=
49]="Gltf";b[b.Revit=50]="Revit";b[b.Fbx=51]="Fbx"})(d.FileType||(d.FileType={}));(function(b){b[b.World=0]="World";b[b.ProportionOfBoundingHeight=1]="ProportionOfBoundingHeight"})(d.SimpleReflectionAttenuationUnit||(d.SimpleReflectionAttenuationUnit={}));(function(b){b[b.Default=0]="Default";b[b.PerNode=1]="PerNode"})(d.TreeWalkMode||(d.TreeWalkMode={}));(function(b){b[b.NorthUp=0]="NorthUp";b[b.AvatarUp=1]="AvatarUp"})(d.FloorplanOrientation||(d.FloorplanOrientation={}))})(Communicator||(Communicator=
{}));(function(d){d=d.Internal||(d.Internal={});d=d.AttachType||(d.AttachType={});d[d.Direct=0]="Direct";d[d.Indirect=1]="Indirect"})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CameraFlags||(d.CameraFlags={});d[d.None=0]="None";d[d.Position=1]="Position";d[d.Target=2]="Target";d[d.Up=4]="Up";d[d.Width=8]="Width";d[d.Height=16]="Height";d[d.Projection=32]="Projection";d[d.NearLimit=64]="NearLimit"})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._position=new d.Point3(0,0,1);this._target=d.Point3.zero();this._up=new d.Point3(0,1,0);this._height=this._width=0;this._projection=d.Projection.Orthographic;this._nearLimit=.01;this._cameraFlags=d.Internal.CameraFlags.None}g.prototype._clearFlags=function(){this._cameraFlags=d.Internal.CameraFlags.None};g.prototype._getFlags=function(){return this._cameraFlags};g.prototype.copy=function(){return g.create(this._position,this._target,this._up,this._projection,
this._width,this._height,this._nearLimit)};g.prototype.setPosition=function(b){this._position.assign(b);this._cameraFlags|=d.Internal.CameraFlags.Position};g.prototype.getPosition=function(){return this._position.copy()};g.prototype.setTarget=function(b){this._target.assign(b);this._cameraFlags|=d.Internal.CameraFlags.Target};g.prototype.getTarget=function(){return this._target.copy()};g.prototype.setUp=function(b){this._up.assign(b);this._cameraFlags|=d.Internal.CameraFlags.Up};g.prototype.getUp=
function(){return this._up.copy()};g.prototype.setWidth=function(b){this._width=b;this._cameraFlags|=d.Internal.CameraFlags.Width};g.prototype.getWidth=function(){return this._width};g.prototype.setHeight=function(b){this._height=b;this._cameraFlags|=d.Internal.CameraFlags.Height};g.prototype.getHeight=function(){return this._height};g.prototype.setProjection=function(b){this._projection=b;this._cameraFlags|=d.Internal.CameraFlags.Projection};g.prototype.getProjection=function(){return this._projection};
g.prototype.setNearLimit=function(b){this._nearLimit=b;this._cameraFlags|=d.Internal.CameraFlags.NearLimit};g.prototype.getNearLimit=function(){return this._nearLimit};g.prototype.equals=function(b){return this._position.equals(b._position)&&this._target.equals(b._target)&&this._up.equals(b._up)&&this._width===b._width&&this._height===b._height&&this._projection===b._projection&&this._nearLimit===b._nearLimit};g.prototype.dolly=function(b){this._position.subtract(b);this._target.subtract(b)};g.prototype.getCameraPlaneIntersectionPoint=
function(b,e){var c=d.Point3.subtract(this._position,this._target).normalize();c=d.Plane.createFromPointAndNormal(this._target,c);b=e.raycastFromPoint(b);if(null===b)return null;e=d.Point3.zero();return c.intersectsRay(b,e)?e:null};g.prototype.getViewMatrix=function(b){return b._getScEngine().getViewMatrix(this)};g.prototype.getProjectionMatrix=function(b){return b._getScEngine().getProjectionMatrix(this)};g.prototype.getFullMatrix=function(b){return b._getScEngine().getFullCameraMatrix(this)};g.prototype.getMatrixFromCamera=
function(){var b=d.Point3.subtract(this.getTarget(),this.getPosition()).normalize(),e=this.getUp().normalize();e=d.Point3.cross(e,b);var c=d.Point3.cross(b,e);return d.Matrix.createFromBasis(e,c,b)};g.create=function(b,d,c,a,f,k,l){var e=new g;e._position.assign(b);e._target.assign(d);e._up.assign(c);e._projection=a;e._width=f;e._height=k;void 0!==l&&(e._nearLimit=l);return e};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){return{position:this._position.toJson(),
target:this._target.toJson(),up:this._up.toJson(),width:this._width,height:this._height,projection:this._projection,nearLimit:this._nearLimit,className:"Communicator.Camera"}};g.prototype.forJson=function(){return this.toJson()};g.fromJson=function(b){var e=d.Point3.fromJson(b.position),c=d.Point3.fromJson(b.target),a=d.Point3.fromJson(b.up);return g.create(e,c,a,b.projection,b.width,b.height,b.nearLimit)};g.construct=function(b){return g.fromJson(b)};g.prototype.transform=function(b){if(b.isIdentity())return this.copy();
var e=Math.abs(this._width),c=Math.abs(this._height),a=this.getUp().normalize().scale(c);c=d.Point3.subtract(this._position,this._target);var f=d.Point3.cross(a,c).normalize().scale(e);e=this.getTarget();f=d.Point3.add(e,f);a=d.Point3.add(e,a);var k=d.Point3.add(e,c);b.transform(e,e);b.transform(f,f);b.transform(a,a);b.transform(k,k);b=d.Point3.subtract(f,e);c=d.Point3.subtract(a,e);a=d.Point3.subtract(k,e);a=d.Point3.add(e,a);f=c.copy().normalize();b=b.length();c=c.length();0>this._width&&(b=-b);
0>this._height&&(c=-c);return g.create(a,e,f,this._projection,b,c,this._nearLimit)};return g}();d.Camera=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,e,c,a){var f=this;this._cuttingSections=[];this._isInit=!1;this._standinGeometryPickable=!0;this._cappingFaceColor=d.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=d.Color.createFromFloat(.5,.5,.5);this._cappingIdleCallbackEnabled=!1;this._cappingIdlePromise=null;this._conservativeIsCappingIdle=!1;this._viewer=b;this._model=e;this._callbackManager=c;this._engine=a;b.setCallbacks({cappingIdle:function(a){(f._conservativeIsCappingIdle=a)&&null!==f._cappingIdlePromise&&
(f._cappingIdlePromise.resolve(),f._cappingIdlePromise=null)},_resetAssemblyTreeBegin:function(){null!==f._cappingIdlePromise&&(f._cappingIdlePromise.reject(new d.CommunicatorError("Model became reset.")),f._cappingIdlePromise=null);return Promise.resolve()}})}g.prototype.createReferenceGeometryFromAxis=function(b,e){var c=[];switch(b){case d.Axis.X:c.push(new d.Point3(0,e.max.y,e.min.z));c.push(new d.Point3(0,e.max.y,e.max.z));c.push(new d.Point3(0,e.min.y,e.max.z));c.push(new d.Point3(0,e.min.y,
e.min.z));break;case d.Axis.Y:c.push(new d.Point3(e.min.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.min.z));c.push(new d.Point3(e.max.x,0,e.max.z));c.push(new d.Point3(e.min.x,0,e.max.z));break;case d.Axis.Z:c.push(new d.Point3(e.min.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.max.y,0)),c.push(new d.Point3(e.max.x,e.min.y,0)),c.push(new d.Point3(e.min.x,e.min.y,0))}return c};g.prototype.createReferenceGeometryFromFaceNormal=function(b,e,c){var a=[],f=(new d.Plane).setFromPointAndNormal(e,b).d;f=
e.copy().add(d.Point3.scale(b,f));e=c.center();e=d.Point3.add(e,d.Point3.scale(b,d.Point3.dot(b,d.Point3.subtract(f,e))));c=c.extents().length()/2;f=d.Point3.subtract(e,f);var k=d.Point3.cross(b,f),l=f.copy().scale(-1),n=k.copy().scale(-1);b=d.Point3.add(f,k).normalize().scale(c).add(e);k=d.Point3.add(l,k).normalize().scale(c).add(e);l=d.Point3.add(l,n).normalize().scale(c).add(e);e=d.Point3.add(f,n).normalize().scale(c).add(e);a.push(b);a.push(k);a.push(l);a.push(e);return a};g.prototype.activateCuttingSections=
function(){for(var b=[],e=0,c=this._cuttingSections;e<c.length;e++)b.push(c[e].activate());return d.Util.waitForAll(b)};g.prototype.deactivateCuttingSections=function(b){void 0===b&&(b=!1);for(var e=[],c=0,a=this._cuttingSections;c<a.length;c++){var f=a[c];b?e.push(f.clear()):e.push(f.deactivate())}return d.Util.waitForAll(e)};g.prototype.setCuttingPlaneColor=function(b){for(var d=0,c=this._cuttingSections;d<c.length;d++)c[d].setColor(b);return Promise.resolve()};g.prototype.setCappingFaceColor=function(b){this._cappingFaceColor=
b?b.copy():null;return this._engine.setCappingFaceColor(this._cappingFaceColor)};g.prototype.getCappingFaceColor=function(){return this._cappingFaceColor?this._cappingFaceColor.copy():null};g.prototype.setCappingLineColor=function(b){this._cappingLineColor=b?b.copy():null;return this._engine.setCappingLineColor(this._cappingLineColor)};g.prototype.getCappingLineColor=function(){return this._cappingLineColor?this._cappingLineColor.copy():null};g.prototype.getCuttingSection=function(b){return this._isInit&&
b<this._cuttingSections.length?this._cuttingSections[b]:null};g.prototype.getCuttingSectionCapacity=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingPlanesPerSection:0};g.prototype.getCuttingSectionCount=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingSections:0};g.prototype.getCuttingSectionFromNodeId=function(b){if(null!==b)for(var d=0,c=this._cuttingSections;d<c.length;d++){var a=c[d];if(0<=a._getInstanceNodeIds().indexOf(b))return a}return null};
g.prototype.setStandinGeometryPickable=function(b){this._standinGeometryPickable=b;var e=this._gatherStandinGeometryIds();this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,e,!b);return Promise.resolve()};g.prototype.getStandinGeometryPickable=function(){return this._standinGeometryPickable};g.prototype._setStandinGeometryVisible=function(b){var d=this,c=this._gatherStandinGeometryIds(),a=this._model._gatherInstanceIncsFromNodeIds(c);this._engine.pauseRendering(function(){d._engine.setPartVisibility(a,
b,!1)})};g.prototype.setCappingDelay=function(b){this._engine.setCappingDelay(b)};g.prototype.delayCapping=function(){this._engine.delayCapping()};g.prototype.enableCappingIdleCallback=function(b){b!==this._cappingIdleCallbackEnabled&&(this._cappingIdleCallbackEnabled=b,this._conservativeIsCappingIdle=!1,b||null===this._cappingIdlePromise||(this._cappingIdlePromise.reject(new d.CommunicatorError("Capping idle callback became disabled.")),this._cappingIdlePromise=null));return this._engine.enableCappingIdleCallback(b)};
g.prototype.waitForCappingIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(!this._cappingIdleCallbackEnabled)throw console.assert(null===this._cappingIdlePromise),new d.CommunicatorError("Capping idle callback is not enabled.");if(this._conservativeIsCappingIdle)return[2];null===this._cappingIdlePromise&&(this._cappingIdlePromise=d.Util.OpenPromise.create());return[2,this._cappingIdlePromise]})})};g.prototype.setCappingGeometryVisibility=function(b){return this._engine.setCappingGeometryVisibility(b)};
g.prototype.getCappingGeometryVisibility=function(){return this._engine.getCappingGeometryVisibility()};g.prototype.getActiveCuttingSectionCount=function(){var b=0;if(this._cuttingLimits)for(var d=0;d<this._cuttingLimits.maxCuttingSections;d++){var c=this.getCuttingSection(d);null!==c&&c.isActive()&&(b+=c.getCount())}return b};g.prototype._init=function(){if(!this._isInit){this._cuttingLimits=this._engine.getCuttingSectionLimits();for(var b=0;b<this._cuttingLimits.maxCuttingSections;b++){var e=new d.CuttingSection(this._viewer,
this._model,this._callbackManager,this,this._engine);this._cuttingSections.push(e)}this._isInit=!0}};g.prototype._isInitialized=function(){return this._isInit};g.prototype.refreshPlaneGeometry=function(){for(var b=[],e=0,c=this._cuttingSections;e<c.length;e++)for(var a=c[e],f=0;f<a.getCount();f++){var k=a.getPlane(f);null!==k&&b.push(a.updatePlane(f,k,new d.Matrix,!1,!1))}return d.Util.waitForAll(b)};g.prototype.hasActiveCuttingSection=function(){if(this._cuttingLimits)for(var b=0;b<this._cuttingLimits.maxCuttingSections;b++){var d=
this.getCuttingSection(b);if(null!==d&&d.isActive())return!0}return!1};g.prototype.toJson=function(){return this._toJson()};g.prototype._toJson=function(){for(var b=[],d=0;d<this._cuttingSections.length;d++)b[d]=this._cuttingSections[d].toJson();return{cuttingSections:b,cappingGeometryVisibility:this.getCappingGeometryVisibility(),cappingFaceColor:this.getCappingFaceColor(),cappingLineColor:this.getCappingLineColor(),pickable:this.getStandinGeometryPickable()}};g.prototype.forJson=function(){return this.toJson()};
g.prototype.fromJson=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,l;return __generator(this,function(n){switch(n.label){case 0:e=d.Internal.deepClone(b);c=[];a=e.cuttingSections;for(f=0;f<a.length;f++)k=a[f],l=this._cuttingSections[f],c.push(l.fromJson(k));this.setStandinGeometryPickable(e.pickable);c.push(this.setCappingGeometryVisibility(e.cappingGeometryVisibility));c.push(this.setCappingFaceColor(d.Color.fromJson(e.cappingFaceColor)));c.push(this.setCappingLineColor(d.Color.fromJson(e.cappingLineColor)));
return[4,Promise.all(c)];case 1:return n.sent(),this._callbackManager.trigger("cuttingSectionsLoaded"),[2]}})})};g.prototype._gatherStandinGeometryIds=function(){for(var b=[],d=0,c=this._cuttingSections;d<c.length;d++)for(var a=0,f=c[d]._getInstanceNodeIds();a<f.length;a++)b.push(f[a]);return b};return g}();d.CuttingManager=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a,f,d){this._container=b;this._canvasContainerElement=c;this._markupSvgElement=a;this._redlineSvgElement=f;this._redlineElement=d}b.prototype.getCanvasContainerElement=function(){return this._canvasContainerElement};b.prototype.getMarkupSvgElement=function(){return this._markupSvgElement};b.prototype.getRedlineSvgElement=function(){return this._redlineSvgElement};b.prototype.getRedlineElement=function(){return this._redlineElement};b.prototype.shutdown=
function(){this._container.removeChild(this._markupSvgElement);this._container.removeChild(this._redlineSvgElement);this._container.removeChild(this._redlineElement);this._container.removeChild(this._canvasContainerElement)};b.createFromElement=function(e){var c=e.id;0===c.length&&(c=d.UUID.create());var a=c+"-canvas-container",f=c+"-svg",k=c+"-redline-svg";c+="-redline";var l=document.createElement("div");l.id=a;l.style.width="100%";l.style.height="100%";l.style.position="absolute";l.tabIndex=-1;
l.classList.add("webviewer-canvas");l.oncontextmenu=function(){return!1};e.appendChild(l);a=b._createSvgElement(f);e.appendChild(a);k=b._createSvgElement(k);e.appendChild(k);f=document.createElement("div");f.id=c;f.style.position="absolute";f.style.width="100%";f.style.height="100%";f.style.pointerEvents="none";e.appendChild(f);return new b(e,l,a,k,f)};b.createFromId=function(b){b=document.getElementById(b);return null===b?null:this.createFromElement(b)};b._createSvgElement=function(b){var c=document.createElementNS("http://www.w3.org/2000/svg",
"svg");c.id=b;c.style.width="100%";c.style.height="100%";c.style.position="absolute";c.style.pointerEvents="none";c.style.overflow="hidden";c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");return c};return b}();h.DomElements=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
var __extends=this&&this.__extends||function(){var d=function(h,g){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,d){b.__proto__=d}||function(b,d){for(var c in d)d.hasOwnProperty(c)&&(b[c]=d[c])};return d(h,g)};return function(h,g){function b(){this.constructor=h}d(h,g);h.prototype=null===g?Object.create(g):(b.prototype=g.prototype,new b)}}();
(function(d){var h=function(b){function c(a){a=b.call(this,a)||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(Error);d.CommunicatorError=h;var g=function(b){function c(a){a=b.call(this,"Invalid index ("+a+").")||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.InvalidIndexError=g;g=function(b){function c(){var a=b.call(this,"Selection invalidated.")||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.SelectionInvalidatedError=
g;g=function(b){function c(){var a=b.call(this,"Internal logic error.")||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.InternalLogicError=g;g=function(b){function c(a){var f=b.call(this,"Invalid node ("+a+").")||this;Object.setPrototypeOf(f,c.prototype);f.nodeId=a;return f}__extends(c,b);return c}(h);d.InvalidNodeIdError=g;g=function(b){function c(a,f){for(var k=[],e=2;e<arguments.length;e++)k[e-2]=arguments[e];k.push(f);e=[];for(var n=0;n<k.length;n++){var g=k[n];
switch(g){case 0:e.push(d.NodeType.DrawingSheet,d.NodeType.PartInstance,d.NodeType.AssemblyNode);break;case 1:e.push(d.NodeType.BodyInstance);e.push(d.NodeType.PmiBody);e.push(d.NodeType.ViewFrame);break;case 2:e.push(d.NodeType.BodyInstance);break;case 3:e.push(d.NodeType.CadView);break;default:d.Util.TypeAssertNever(g)}}e.sort();k=[];for(n=0;n<e.length;n++)k.push(d.NodeType[e[n]]);k=b.call(this,"Expected node ("+a+") to be of "+(1===k.length?"type ("+k[0]+")":"types "+k)+".")||this;Object.setPrototypeOf(k,
c.prototype);k.nodeId=a;k.expectedTypes=e;return k}__extends(c,b);return c}(h);d.InvalidNodeTypeError=g;g=function(b){function c(a){a=b.call(this,a)||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.LoadError=g;var b=function(b){function c(){var a=b.call(this,"Load cancelled.")||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(g);d.LoadCancelledError=b;g=function(b){function c(a){a=b.call(this,"Missing model: '"+a+"'.")||this;Object.setPrototypeOf(a,
c.prototype);return a}__extends(c,b);return c}(g);d.MissingModelError=g;h=function(b){function c(a){a=b.call(this,a)||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.ParseError=h;g=function(b){function c(a){a=b.call(this,a)||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);d.AssemblyDataParseError=g;d.MetaDataParseError=g;h=function(b){function c(a){a=b.call(this,a)||this;Object.setPrototypeOf(a,c.prototype);return a}__extends(c,b);return c}(h);
d.XmlParseError=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b,d,c){var a=this;this._explodeActive=!1;this._explodeMagnitude=0;this._model=b;this._engine=d;c.bind({_modelSwitched:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this.stop();return[2]})})}})}d.prototype.start=function(b,d){this.getActive()&&this.stop();return this._doExplode(b,d)};d.prototype.setMagnitude=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return 0<
b&&!this._explodeActive?[4,this.start()]:[3,2];case 1:return d.sent(),[3,3];case 2:0===b&&this._explodeActive&&this.stop(),d.label=3;case 3:return this._explodeActive?(this._explodeMagnitude=b,[2,this._engine.setExplodeMagnitude(b)]):[2]}})})};d.prototype.stop=function(){this._engine.stopExplode();this._explodeMagnitude=0;this._explodeActive=!1;this._engine.setExplodeMagnitude(0);return Promise.resolve()};d.prototype.getMagnitude=function(){return this._explodeMagnitude};d.prototype.getActive=function(){return this._explodeActive};
d.prototype._doExplode=function(b,d){return __awaiter(this,void 0,void 0,function(){var c,a;return __generator(this,function(f){switch(f.label){case 0:return this._explodeActive=!0,c=void 0!==b&&0<b.length?this._model._gatherInstanceIncsFromNodeIds(b):[],d?[3,2]:[4,this._model.getModelBounding(!0,!1)];case 1:return a=f.sent(),this._engine.startExplode(c,a.center()),[3,3];case 2:this._engine.startExplode(c,d),f.label=3;case 3:return[2]}})})};return d}();d.ExplodeManager=h})(Communicator||(Communicator=
{}));
(function(d){function h(a){if(0===a.length)return new d.Matrix;if(1===a.length)return a[0];for(var c=d.Matrix.multiply(a[1],a[0]),f=2;f<a.length;++f)c=d.Matrix.multiply(a[f],c);return c}function g(a,c){return a.x>=c.min.x&&a.x<=c.max.x&&a.y>=c.min.y&&a.y<=c.max.y&&a.z>=c.min.z&&a.z<=c.max.z}function b(a,c){return a.z>=c.min.z&&a.z<=c.max.z}var e=function(){function a(){this.overlayAnchor=d.OverlayAnchor.LowerRightCorner;this.overlaySize=new d.Point2(.25,1);this.overlayWidthUnit=d.OverlayUnit.ProportionOfCanvas;this.overlayHeightUnit=
d.OverlayUnit.ProportionOfOtherDimension;this.overlayOffset=new d.Point2(0,0);this.overlayOffsetYUnit=this.overlayOffsetXUnit=d.OverlayUnit.Pixels;this.backgroundColor=d.Color.white();this.backgroundOpacity=.25;this.borderColor=d.Color.black();this.borderOpacity=1;this.avatarColor=d.Color.createFromFloat(1,0,1);this.avatarOutlineColor=d.Color.black();this.avatarScale=this.avatarOpacity=1;this.fixedAvatarScale=!0;this.overlayFeetPerPixel=.1;this.zoomLevel=1;this.autoActivate=c.BimWalk;this.floorplanOrientation=
d.FloorplanOrientation.NorthUp;this.customAvatar=null;this.trackCameraEnabled=!1}a.prototype.copy=function(){var c=new a;c.overlayAnchor=this.overlayAnchor;c.overlaySize=this.overlaySize.copy();c.overlayWidthUnit=this.overlayWidthUnit;c.overlayHeightUnit=this.overlayHeightUnit;c.overlayOffset=this.overlayOffset.copy();c.overlayOffsetXUnit=this.overlayOffsetXUnit;c.overlayOffsetYUnit=this.overlayOffsetYUnit;c.backgroundColor=this.backgroundColor.copy();c.backgroundOpacity=this.backgroundOpacity;c.borderColor=
this.borderColor.copy();c.borderOpacity=this.borderOpacity;c.avatarColor=this.avatarColor.copy();c.avatarOutlineColor=this.avatarOutlineColor.copy();c.avatarOpacity=this.avatarOpacity;c.avatarScale=this.avatarScale;c.fixedAvatarScale=this.fixedAvatarScale;c.customAvatar=this.customAvatar;c.overlayFeetPerPixel=this.overlayFeetPerPixel;c.zoomLevel=this.zoomLevel;c.trackCameraEnabled=this.trackCameraEnabled;c.autoActivate=this.autoActivate;c.floorplanOrientation=this.floorplanOrientation;return c};return a}();
d.FloorplanConfig=e;var c;(function(a){a[a.Never=0]="Never";a[a.Bim=1]="Bim";a[a.BimWalk=2]="BimWalk"})(c=d.FloorplanAutoActivation||(d.FloorplanAutoActivation={}));var a=function(){return function(a,c,f,b,d){this.floorplanNode=null;this.floorNode=a;this.bounds=c;this.slabNodes=f;this.spaceNodes=b;this.floorplanMeshCreationNodes=d}}(),f=function(){function f(a,c,f,b,k,g){var l=this;this._active="inactive";this._isCallbacksSet=this._isOverlayVisible=this._isModelLoaded=this._isSceneReady=!1;this._onCameraUpdateFunc=
this._doCameraUpdate.bind(this);this._onFrameDrawnFunc=this._onFrameDrawn.bind(this);this._currentFloorInfo=this._floorplanNode=null;this._config=new e;this._tightBoundings=this._floorLock=!1;this._genericStoreyType="IFCBUILDINGSTOREY";this._floorInfos=new Map;this._floorInfosArray=[];this._avatarNode=null;this._avatarDirty=!0;this._borderNode=null;this._borderDirty=!0;this._backgroundNode=null;this._backgroundDirty=!0;this._canvasSize=new d.Point2(1,1);this._sync=new d.Internal.PromiseQueue(1,!0);
this._setFloorplanSync=new d.Internal.SingleMostRecentPromiseQueue(!1);this._viewer=a;this._model=c;this._engine=b;this._modelStructure=k;this._overlayManager=f;this._config=g.copy();this._viewer.setCallbacks({sceneReady:function(){return __awaiter(l,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return console.assert("active"!==this._active,"Got sceneReady while Floorplan is Active"),this._isSceneReady=!0,"activating"!==this._active?[3,2]:[4,this._sync.push(function(){return a._doUpdateActivation()})];
case 1:c.sent(),c.label=2;case 2:return[2]}})})},modelSwitchStart:function(){return __awaiter(l,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return this._isModelLoaded=!1,[4,this._sync.push(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){return[2,this._deactivate()]})})})];case 1:return c.sent(),[2]}})})},firstModelLoaded:function(a){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._isModelLoaded=
!0,[4,this._onModelLoaded()];case 1:return a.sent(),[2]}})})},subtreeLoaded:function(a,c){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._isModelLoaded=!0,[4,this._onModelLoaded()];case 1:return a.sent(),[2]}})})}})}f.prototype.setCustomAvatar=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.customAvatar===a?[2]:[4,this._doSetCustomAvatar(a)];
case 1:return c.sent(),this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setOverlaySize=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){this._config.overlaySize=a.copy();this._config.overlayWidthUnit=c;this._config.overlayHeightUnit=f;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayAnchor=
a;return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayOffset=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayOffset=a.copy();return[2,this._onConfigurationChanged()]})})};f.prototype.setOverlayFeetPerPixel=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.overlayFeetPerPixel=a;return[2,this._onConfigurationChanged()]})})};f.prototype.setZoomLevel=function(a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.zoomLevel=a;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundColor=a;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBackgroundOpacity=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.backgroundOpacity=
a;this._backgroundDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderColor=a;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setBorderOpacity=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.borderOpacity=a;this._borderDirty=!0;return[2,this._onConfigurationChanged()]})})};
f.prototype.setAvatarColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarColor=a;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOutlineColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOutlineColor=a;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarOpacity=function(a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){this._config.avatarOpacity=a;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setAvatarScale=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.avatarScale=a;this._avatarDirty=!0;return[2,this._onConfigurationChanged()]})})};f.prototype.setFixedAvatarScale=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._config.fixedAvatarScale===
a?[2]:[4,this._deleteAvatarNode()];case 1:return c.sent(),this._config.fixedAvatarScale=a,this._avatarDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.setTrackCameraEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.trackCameraEnabled=a;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorplanOrientation=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.floorplanOrientation=
a;return[2,this._onConfigurationChanged()]})})};f.prototype.setAutoActivate=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._config.autoActivate=a;return[2,this._onConfigurationChanged()]})})};f.prototype.setFloorLock=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:this._floorLock=a;if(!this.isActive()||a)return[3,2];c=this._viewer.view.getCamera().getPosition();return[4,
this._setFloorplanFromPosition(c)];case 1:f.sent(),f.label=2;case 2:return[2]}})})};f.prototype.getFloorLock=function(){return this._floorLock};f.prototype.setUseTightBoundings=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return a===this._tightBoundings?[2]:[4,this._deleteAllFloorplans()];case 1:return c.sent(),this._tightBoundings=a,this.isActive()?[4,this._onProcessIfc()]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};
f.prototype.setConfiguration=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=this._config.customAvatar,this._config=a.copy(),c===this._config.customAvatar?[3,2]:[4,this._doSetCustomAvatar(this._config.customAvatar)];case 1:f.sent(),f.label=2;case 2:return this._avatarDirty=this._backgroundDirty=this._borderDirty=!0,[2,this._onConfigurationChanged()]}})})};f.prototype.getConfiguration=function(){return this._config.copy()};
f.prototype.getCurrentFloorNodeId=function(){return null!==this._currentFloorInfo?this._currentFloorInfo.floorNode:null};f.prototype.getAvatarNodeId=function(){return this._avatarNode};f.prototype.insideOverlay=function(a){var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels();return a.x>=f.x&&a.y>=f.y&&a.x<=f.x+c.x&&a.y<=f.y+c.y};f.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._sync.push(function(){return a._activate()})];case 1:return c.sent(),[2]}})})};f.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return a._deactivate()})];case 1:return c.sent(),[2]}})})};f.prototype._deleteAvatarNode=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:if(null===this._avatarNode)return[3,
5];c.label=1;case 1:return c.trys.push([1,3,,4]),this._modelStructure.allowNodeDeletion(this._avatarNode),[4,this._model.deleteNode(this._avatarNode)];case 2:return c.sent(),[3,4];case 3:return a=c.sent(),console.log("Problem deleting existing avatar: "+a.message),[3,4];case 4:this._avatarNode=null,c.label=5;case 5:return[2]}})})};f.prototype._doSetCustomAvatar=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._deleteAvatarNode()];
case 1:return c.sent(),this._config.customAvatar=a,[2]}})})};f.prototype._onConfigurationChanged=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:this._config.zoomLevel=Math.max(.1,Math.min(10,this._config.zoomLevel));this._config.avatarScale=Math.max(.1,Math.min(10,this._config.avatarScale));this._config.backgroundOpacity=Math.max(0,Math.min(1,this._config.backgroundOpacity));this._config.borderOpacity=Math.max(0,Math.min(1,this._config.borderOpacity));
this._config.avatarOpacity=Math.max(0,Math.min(1,this._config.avatarOpacity));if(this._isModelLoaded&&"inactive"===this._active&&this._config.autoActivate===c.Bim)return[2,this._onModelLoaded()];if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];case 1:a.sent(),a.label=2;case 2:return[2,this._doCameraUpdate()]}})})};f.prototype._setFloorplanFromPosition=function(a){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(f){return[2,
this._setFloorplanSync.push(function(){return c._doSetFloorplanFromPosition(a)})]})})};f.prototype._doSetFloorplanFromPosition=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,k,e,l,h,t,u,v=this;return __generator(this,function(n){switch(n.label){case 0:c=null;d=[];k=0;for(e=this._floorInfosArray;k<e.length;k++)l=e[k],g(a,l.bounds)&&d.push(l);h=function(c){return __awaiter(v,void 0,void 0,function(){var d,k,e,l,n,g,m,p,h,q,r,w,t,u;return __generator(this,function(v){switch(v.label){case 0:return[4,
this._performDownwardSelection(a)];case 1:d=v.sent(),k=0,e=d,v.label=2;case 2:if(!(k<e.length))return[3,6];l=e[k];n=l.getNodeId();g=this._model.getNodeParent(n);if(null===g)return[3,5];m=this._viewer.model.getNodeGenericType(g);return null===m?[3,5]:f._ifcSpaceTypes.has(m)?[4,this._viewer.model.getNodesBounding([g])]:[3,4];case 3:p=v.sent();h=b(a,p);if(!h)return[3,5];q=0;for(r=c;q<r.length;q++)if(w=r[q],-1!==w.spaceNodes.indexOf(g))return[2,w];return[3,5];case 4:if(f._ifcFloorTypes.has(m))for(t=0,
u=c;t<u.length;t++)if(w=u[t],-1!==w.slabNodes.indexOf(g))return[2,w];v.label=5;case 5:return k++,[3,2];case 6:return[2,null]}})})};return[4,h(d)];case 1:c=n.sent();if(null===c)for(t=0,u=this._floorInfosArray;t<u.length;t++)if(l=u[t],b(a,l.bounds)){c=l;break}return null!==c&&(this._currentFloorInfo=c,null===this._floorplanNode||this._floorplanNode!==c.floorplanNode)?[2,this._setFloorplanFromFloorNode(c.floorNode)]:[2]}})})};f.prototype._performDownwardSelection=function(a){return __awaiter(this,void 0,
void 0,function(){var c,f,b,k,e,l,g,h,v,z;return __generator(this,function(n){switch(n.label){case 0:return c=new d.PickConfig,c.respectVisibility=!1,c.oneEntityPerTypePerInstance=!0,f=new d.Ray(a,new d.Point3(0,0,-1)),[4,this._viewer.view.pickAllFromRay(f,c)];case 1:b=n.sent(),k=new Map,e=0,l=b,n.label=2;case 2:if(!(e<l.length))return[3,5];g=l[e];h=g.getNodeId();return[4,this._model.getNodesBounding([h])];case 3:v=n.sent(),k.set(h,v.max.z),n.label=4;case 4:return e++,[3,2];case 5:return z=function(a,
c){a=k.get(a.getNodeId());c=k.get(c.getNodeId());return void 0===a||void 0===c?-1:c-a},[2,b.sort(z)]}})})};f.prototype._activate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:if("inactive"!==this._active)return[2];this._active="activating";return[4,this._doUpdateActivation()];case 1:return a.sent(),[2]}})})};f.prototype._deactivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:if("inactive"===
this._active)return[2];this._active="inactive";this._isCallbacksSet&&(this._isCallbacksSet=!1,this._viewer.unsetCallbacks({camera:this._onCameraUpdateFunc,frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc}));this._isOverlayVisible=!1;return[4,this._overlayManager.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 1:return a.sent(),this._borderNode?[4,this._model.deleteNode(this._borderNode)]:[3,3];case 2:a.sent(),this._borderNode=null,a.label=3;case 3:return this._backgroundNode?
[4,this._model.deleteNode(this._backgroundNode)]:[3,5];case 4:a.sent(),this._backgroundNode=null,a.label=5;case 5:return[4,this._deleteAllFloorplans()];case 6:return a.sent(),[2]}})})};f.prototype._onModelLoaded=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sync.push(function(){return a._doOnModelLoaded()})];case 1:return c.sent(),[2]}})})};f.prototype._doOnModelLoaded=function(){return __awaiter(this,
void 0,void 0,function(){var a,f;return __generator(this,function(b){switch(b.label){case 0:return console.assert(this._isModelLoaded,"Model not loaded as expected"),(f=(a=this._model.getNodesByGenericType(this._genericStoreyType))&&0<a.size)?[3,2]:[4,this._deactivate()];case 1:return b.sent(),[2];case 2:return"inactive"===this._active?f&&this._config.autoActivate===c.Bim&&(this._active="activating"):"active"===this._active&&(this._active="activating"),"activating"!==this._active?[3,4]:[4,this._doUpdateActivation()];
case 3:b.sent(),b.label=4;case 4:return[2]}})})};f.prototype._doUpdateActivation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:if("activating"!==this._active||!this._isSceneReady||!this._isModelLoaded)return[2];this._active="active";return this._isOverlayVisible?[3,2]:[4,this._setupOverlay()];case 1:a.sent(),a.label=2;case 2:return[4,this._onProcessIfc()];case 3:return a.sent(),this._isCallbacksSet||(this._isCallbacksSet=!0,this._viewer.setCallbacks({camera:this._onCameraUpdateFunc,
frameDrawn:this._onFrameDrawnFunc,transitionEnd:this._onCameraUpdateFunc})),[2]}})})};f.prototype._deleteAllFloorplans=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f,b;return __generator(this,function(d){switch(d.label){case 0:a=this._floorInfosArray.slice(),this._floorInfos.clear(),this._floorInfosArray.length=0,this._currentFloorInfo=this._floorplanNode=null,c=0,f=a,d.label=1;case 1:if(!(c<f.length))return[3,4];b=f[c];return b.floorplanNode?[4,this._model.deleteNode(b.floorplanNode)]:
[3,3];case 2:d.sent(),d.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};f.prototype._hideActiveFloorplan=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._floorplanNode?[2]:[4,this._hideOverlayNode(this._floorplanNode)];case 1:return a.sent(),this._currentFloorInfo=this._floorplanNode=null,[2]}})})};f.prototype._onProcessIfc=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return console.assert("active"===this._active),[4,this._gatherFloorInfos()];case 1:return a.sent(),[4,this._doCameraUpdate()];case 2:return a.sent(),[2]}})})};f.prototype._hasFloorInfo=function(a){return this._floorInfos.has(a)};f.prototype._getFloorInfo=function(a){a=this._floorInfos.get(a);return void 0===a?null:a};f.prototype._createFloorInfo=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,k,e,l;return __generator(this,function(n){switch(n.label){case 0:return b=
[],this._gatherDescendentIfcNodes(c,f._ifcFloorTypes,b),d=[],this._gatherDescendentIfcNodes(c,f._ifcSpaceTypes,d),k=[],this._gatherDescendentIfcNodes(c,f._ifcFloorplanCreationTypes,k),0===k.length?[2,null]:[4,this._model.getNodesBounding(k,{bodyInstance:!0,pmiBody:!1,viewFrame:!1,tightBounding:this._tightBoundings})];case 1:return e=n.sent(),l=new a(c,e,b,d,k),this._floorInfos.set(c,l),this._floorInfosArray.push(l),[2,l]}})})};f.prototype._gatherFloorInfos=function(){return __awaiter(this,void 0,
void 0,function(){var a,c,b,k;return __generator(this,function(e){switch(e.label){case 0:return a=this._model.getNodesByGenericType(f._genericStoreyType),null!==a&&0!==a.size?[3,2]:[4,this._deactivate()];case 1:return e.sent(),[2];case 2:c=0,b=d.Util.setToArray(a),e.label=3;case 3:if(!(c<b.length))return[3,6];k=b[c];return this._hasFloorInfo(k)?[3,5]:[4,this._createFloorInfo(k)];case 4:e.sent(),e.label=5;case 5:return c++,[3,3];case 6:return 0!==this._floorInfos.size?[3,8]:[4,this._deactivate()];
case 7:e.sent(),e.label=8;case 8:return[2]}})})};f.prototype._gatherDescendentIfcNodes=function(a,c,f){var b=0;for(a=this._model.getNodeChildren(a);b<a.length;b++){var d=a[b],k=this._model.getNodeGenericType(d);null!==k&&c.has(k)&&f.push(d);this._gatherDescendentIfcNodes(d,c,f)}};f.prototype._createFloorplanFromFloorInfo=function(a){return __awaiter(this,void 0,void 0,function(){var c,f,b,d,k;return __generator(this,function(e){switch(e.label){case 0:return c=this._model._gatherInstanceIncsFromNodeIds(a.floorplanMeshCreationNodes),
[4,this._engine.createFloorplanMesh(c)];case 1:return f=e.sent(),b=f[0],d=f[1],k=this._modelStructure.createMeshInstance(b,d,"floorplan",null,!0,!0),[2,k]}})})};f.prototype._onFrameDrawn=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:a=this._viewer.view.getCanvasSize();if(a.equals(this._canvasSize))return[3,2];this._canvasSize=a.copy();if(!this._isOverlayVisible)return[3,2];this._isOverlayVisible=!1;return[4,this._setupOverlay()];
case 1:c.sent(),c.label=2;case 2:return[2]}})})};f.prototype._doCameraUpdate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this.isActive()?this._floorLock?[3,2]:[4,this._setFloorplanFromPosition(this._viewer.view.getCamera().getPosition())]:[2];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,,4,5]),this._viewer.pauseRendering(),[4,this._updateOverlay()];case 3:return a.sent(),[3,5];case 4:return this._viewer.resumeRendering(),
[7];case 5:return[2]}})})};f.prototype.isActive=function(){return"active"===this._active};f.prototype._updateOverlay=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f;return __generator(this,function(b){switch(b.label){case 0:if(!this.isActive())return[2];a=this._viewer.view.getCamera();c=a.getPosition();f=d.Point3.subtract(a.getTarget(),c);f.z=0;f.normalize();if(isNaN(f.x)||0===f.length())f=new d.Point3(0,1,0);return[4,this._updateOverlayCamera(c,f)];case 1:return b.sent(),[4,this._updateOverlayNodes(c,
f)];case 2:return b.sent(),[2]}})})};f.prototype._updateOverlayNodes=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,k,e,l,n,g,u,v,z,x,y,A,B,D,C,F,E,H,G,I;return __generator(this,function(m){switch(m.label){case 0:return b=this._model,k=this._config,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=this._getOverlaySizeInPixels(),n=l.x/l.y,g=e*k.overlayFeetPerPixel/k.zoomLevel,u=g/n,v=g*l.x,z=v/n,k.trackCameraEnabled||(x=this._getFixedCameraSize(n),null!==
x&&(v=x.x,z=x.y)),y=(new d.Matrix).setTranslationComponent(a.x,a.y,f._avatarZ),A=e*k.avatarScale,B=(new d.Matrix).setScaleComponent(A,A,A),D=new d.Matrix,D.m[0]=c.y,D.m[1]=-c.x,D.m[2]=0,D.m[4]=c.x,D.m[5]=c.y,D.m[6]=0,D.m[8]=0,D.m[9]=0,D.m[10]=1,[4,this._viewer.model.setNodeMatrix(this._avatarNode,h([y,D,B]))];case 1:return m.sent(),this._avatarDirty&&(null===k.customAvatar&&(b.setNodesFaceColor([this._avatarNode],k.avatarColor),b.setNodesLineColor([this._avatarNode],k.avatarOutlineColor),b.setNodesOpacity([this._avatarNode],
k.avatarOpacity)),this._avatarDirty=!1),this._borderDirty&&(b.setNodesLineColor([this._borderNode],k.borderColor),b.setNodesOpacity([this._borderNode],k.borderOpacity),this._borderDirty=!1),this._backgroundDirty&&(b.setNodesFaceColor([this._backgroundNode],k.backgroundColor),b.setNodesOpacity([this._backgroundNode],k.backgroundOpacity),this._backgroundDirty=!1),C=v-g,F=z-u,E=(new d.Matrix).setScaleComponent(C,F,1),H=new d.Matrix,this._config.trackCameraEnabled||null===this._currentFloorInfo?H.setTranslationComponent(a.x,
a.y,0):(G=this._currentFloorInfo.bounds.center(),H.setTranslationComponent(G.x,G.y,0)),I=this._config.floorplanOrientation===d.FloorplanOrientation.AvatarUp?h([H,D,E]):d.Matrix.multiply(E,H),[4,this._viewer.model.setNodeMatrix(this._borderNode,I)];case 2:return m.sent(),[4,this._viewer.model.setNodeMatrix(this._backgroundNode,I)];case 3:return m.sent(),[2]}})})};f.prototype.snapAvatarToPoint=function(a){if(null!==this._currentFloorInfo&&this.insideOverlay(a))if(this._config.trackCameraEnabled)console.log("FP: snapAvatarToPoint: currently only supported when trackCameraEnabled is false");
else{var c=this._getOverlaySizeInPixels(),f=this._getOverlayOffsetInPixels(),b=new d.Point2(a.x-f.x,a.y-f.y),k=this._currentFloorInfo.bounds,e=k.extents(),l=e.x/e.y,g=c.x/c.y;a=this._viewer.view.getCamera();f=a.getPosition();var h=a.getTarget(),v=new d.Matrix;if(this._config.floorplanOrientation!==d.FloorplanOrientation.NorthUp){v=d.Point3.subtract(h,f);v=(new d.Point3(v.x,v.y,0)).normalize();var z=new d.Point3(0,1,0),x=new d.Point3(-1,0,0);x=90<d.Util.computeAngleBetweenVector(x,v)?new d.Point3(0,
0,-1):new d.Point3(0,0,1);v=d.Util.computeAngleBetweenVector(z,v);v=d.Matrix.createFromOffAxisRotation(x,v)}g>l?(c=e.y/c.y,k=new d.Point2(k.center().x-e.y/2*g,k.center().y+e.y/2)):(c=e.x/c.x,k=new d.Point2(k.center().x-e.x/2,k.center().y+e.x/2/g));c=new d.Point3(b.x*c+k.x,k.y-b.y*c,f.z);c=v.transform(c);f=d.Point3.subtract(h,f);f=d.Point3.add(c,f);a.setPosition(c);a.setTarget(f);a.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(a)}};f.prototype._getOverlaySizeInPixels=function(){var a=
new d.OverlayUnitPoint(this._config.overlaySize.x,this._config.overlayWidthUnit,this._config.overlaySize.y,this._config.overlayHeightUnit);return this._viewer.overlayManager._toPixelPoint(a)};f.prototype._getOverlayOffsetInPixels=function(){var a=this._overlayManager.getViewportPixelOffsetInCanvas(d.BuiltinOverlayIndex.Floorplan);return null===a?d.Point2.zero():a};f.prototype._getFixedCameraSize=function(a){if(null!==this._currentFloorInfo){var c=this._currentFloorInfo.bounds.extents();return c.x/
c.y>a?new d.Point2(c.x,c.x/a):new d.Point2(c.y*a,c.y)}return null};f.prototype._updateOverlayCamera=function(a,c){return __awaiter(this,void 0,void 0,function(){var f,b,k,e,l,n,g,h,z,x;return __generator(this,function(m){switch(m.label){case 0:return f=this._config,b=this._getOverlaySizeInPixels(),k=b.x/b.y,e=304.8*this._model.getNodeUnitMultiplier(this._model.getAbsoluteRootNode()),l=e*f.overlayFeetPerPixel/f.zoomLevel,n=l*b.x,g=n/k,f.trackCameraEnabled||(h=this._getFixedCameraSize(k),null!==h&&
(n=h.x,g=h.y)),z=new d.Camera,z.setWidth(n),z.setHeight(g),this._config.trackCameraEnabled||null===this._currentFloorInfo?(z.setTarget(new d.Point3(a.x,a.y,0)),z.setPosition(new d.Point3(a.x,a.y,10))):(x=this._currentFloorInfo.bounds.center(),z.setTarget(new d.Point3(x.x,x.y,0)),z.setPosition(new d.Point3(x.x,x.y,10))),f.floorplanOrientation===d.FloorplanOrientation.AvatarUp?z.setUp(c):f.floorplanOrientation===d.FloorplanOrientation.NorthUp&&z.setUp(new d.Point3(0,1,0)),[4,this._overlayManager.setCamera(d.BuiltinOverlayIndex.Floorplan,
z)];case 1:return m.sent(),[2]}})})};f.prototype._setFloorplanFromFloorNode=function(a){return __awaiter(this,void 0,void 0,function(){var c,f,b,k;return __generator(this,function(e){switch(e.label){case 0:return[4,this._hideActiveFloorplan()];case 1:e.sent();if(!this._hasFloorInfo(a))return[3,2];f=this._getFloorInfo(a);return[3,4];case 2:return[4,this._createFloorInfo(a)];case 3:f=e.sent(),e.label=4;case 4:return c=f,null===c?[2]:null!==c.floorplanNode?[3,9]:[4,this._createFloorplanFromFloorInfo(c)];
case 5:return b=e.sent(),k=new d.Matrix,[4,this._model.setNodeMatrix(b,k,!0)];case 6:return e.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[b])];case 7:return e.sent(),this._floorplanNode=c.floorplanNode=b,this._currentFloorInfo=c,[4,this._showOverlayNode(b)];case 8:return e.sent(),[3,11];case 9:return this._floorplanNode=c.floorplanNode,this._currentFloorInfo=c,[4,this._showOverlayNode(c.floorplanNode)];case 10:e.sent(),e.label=11;case 11:return[4,this._updateOverlay()];
case 12:return e.sent(),[2]}})})};f.prototype._setupOverlay=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,k,e,g;return __generator(this,function(l){switch(l.label){case 0:return a=this._config,console.assert(this.isActive()),c=this._overlayManager,this._isOverlayVisible=!0,[4,c.setViewport(d.BuiltinOverlayIndex.Floorplan,a.overlayAnchor,a.overlayOffset.x,a.overlayOffsetXUnit,a.overlayOffset.y,a.overlayOffsetYUnit,a.overlaySize.x,a.overlayWidthUnit,a.overlaySize.y,a.overlayHeightUnit)];
case 1:return l.sent(),[4,c.setVisibility(d.BuiltinOverlayIndex.Floorplan,this._isOverlayVisible)];case 2:l.sent();if(this._avatarNode)return[3,7];b=this;if(null===this._config.customAvatar)return[3,3];k=this._config.customAvatar;return[3,5];case 3:return[4,this._createAvatar()];case 4:k=l.sent(),l.label=5;case 5:return b._avatarNode=k,this._modelStructure.preventNodeDeletion(this._avatarNode),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._avatarNode])];case 6:l.sent(),l.label=
7;case 7:if(this._borderNode)return[3,10];e=this;return[4,this._create2dBox(!0,!1,f._borderZ)];case 8:return e._borderNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._borderNode])];case 9:l.sent(),this._borderDirty=!0,l.label=10;case 10:if(this._backgroundNode)return[3,13];g=this;return[4,this._create2dBox(!1,!0,f._backgroundZ)];case 11:return g._backgroundNode=l.sent(),[4,this._overlayManager.addNodes(d.BuiltinOverlayIndex.Floorplan,[this._backgroundNode])];case 12:l.sent(),
this._backgroundDirty=!0,l.label=13;case 13:return[4,this._updateOverlay()];case 14:return l.sent(),[2]}})})};f.prototype._hideOverlayNode=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return c=new d.Matrix,c.setTranslationComponent(1E30,0,0),[4,this._model.setNodeMatrix(a,c,!0)];case 1:return f.sent(),[2]}})})};f.prototype._showOverlayNode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return[4,this._model.setNodeMatrix(a,new d.Matrix,!0)];case 1:return c.sent(),[2]}})})};f.prototype._createAvatar=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f,b,k,e,g,h,u,v,z;return __generator(this,function(l){switch(l.label){case 0:return a=this._config.fixedAvatarScale?1E4:1,c=1.2/a,f=1.5/a,b=-1.1/a,k=[0,f,0,-c,-f,0,0,b,0,0,f,0,0,b,0,c,-f,0],e=[-c,-f,0,0,f,0,c,-f,0,0,b,0,-c,-f,0],g=new d.MeshData,g.setBackfacesEnabled(!1),g.addFaces(k,void 0,
void 0,void 0),g.addPolyline(e,void 0),[4,this._viewer.model.createMesh(g)];case 1:return h=l.sent(),u=new d.MeshInstanceData(h),v=(this._config.fixedAvatarScale?d.MeshInstanceCreationFlags.SuppressCameraScale:d.MeshInstanceCreationFlags.None)|d.MeshInstanceCreationFlags.ExcludeBounding,u.setCreationFlags(v),[4,this._viewer.model.createMeshInstance(u,null,!0,!0)];case 2:return z=l.sent(),[2,z]}})})};f.prototype._create2dBox=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var b,k,e,
l,n,g,m;return __generator(this,function(p){switch(p.label){case 0:return b=new d.MeshData,a&&(k=[-.5,-.5,f,-.5,.5,f,.5,.5,f,.5,-.5,f,-.5,-.5,f],b.addPolyline(k,void 0)),c&&(e=[.5,-.5,f,.5,.5,f,-.5,.5,f,-.5,.5,f,-.5,-.5,f,.5,-.5,f],l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],b.addFaces(e,l),b.setBackfacesEnabled(!1)),[4,this._viewer.model.createMesh(b)];case 1:return n=p.sent(),g=new d.MeshInstanceData(n),g.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,this._viewer.model.createMeshInstance(g,
null,!0,!0)];case 2:return m=p.sent(),[2,m]}})})};f._genericStoreyType="IFCBUILDINGSTOREY";f._ifcFloorTypes=new Set(["IFCSLAB"]);f._ifcSpaceTypes=new Set(["IFCSPACE"]);f._ifcFloorplanCreationTypes=new Set(["IFCWALL","IFCWALLSTANDARDCASE","IFCCURTAINWALL","IFCSLAB","IFCCOLUMN"]);f._backgroundZ=-1;f._avatarZ=1;f._borderZ=2;return f}();d.FloorplanManager=f})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){this._obscuredLineColor=d.Color.black();this._obscuredLineOpacity=.2;this._visibleLineColor=d.Color.black();this._visibleLineOpacity=1;this._backgroundColor=d.Color.white()}b.prototype.getObscuredLineColor=function(){return this._obscuredLineColor.copy()};b.prototype.setObscuredLineColor=function(b){this._obscuredLineColor.assign(b)};b.prototype.getObscuredLineOpacity=function(){return this._obscuredLineOpacity};b.prototype.getObscuredLineTransparency=
function(){return this.getObscuredLineOpacity()};b.prototype.setObscuredLineOpacity=function(b){0<=b&&1>=b&&(this._obscuredLineOpacity=b)};b.prototype.setObscuredLineTransparency=function(b){this.setObscuredLineOpacity(b)};b.prototype.getVisibleLineColor=function(){return this._visibleLineColor.copy()};b.prototype.setVisibleLineColor=function(b){this._visibleLineColor.assign(b)};b.prototype.getVisibleLineOpacity=function(){return this._visibleLineOpacity};b.prototype.getVisibleLineTransparency=function(){return this.getVisibleLineOpacity()};
b.prototype.setVisibleLineOpacity=function(b){0<=b&&1>=b&&(this._visibleLineOpacity=b)};b.prototype.setVisibleLineTransparency=function(b){this.setVisibleLineOpacity(b)};b.prototype.getBackgroundColor=function(){return this._backgroundColor.copy()};b.prototype.setBackgroundColor=function(b){this._backgroundColor.assign(b)};return b}();h.HiddenLineSettings=g})(d.Settings||(d.Settings={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.isMouseEventType=function(b){switch(b){case d.EventType.MouseDown:return!0;case d.EventType.MouseMove:return!0;case d.EventType.MouseUp:return!0;case d.EventType.Mousewheel:return!0;case d.EventType.TouchStart:return!1;case d.EventType.TouchMove:return!1;case d.EventType.TouchEnd:return!1;case d.EventType.KeyDown:return!1;case d.EventType.KeyUp:return!1;case d.EventType.ViewOrientationChange:return!1}};var g=function(){function b(){this._date=new Date;this._handled=!1}
b.prototype.getHandled=function(){return this._handled};b.prototype.setHandled=function(b){this._handled=b};b.prototype.getDate=function(){return this._date};return b}();h.InputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(b){function d(c,a,f){a=b.call(this)||this;a._keyCode=c;a._eventType=f;return a}__extends(d,b);d.prototype.getKeyCode=function(){return this._keyCode};d.prototype.getEventType=function(){return this._eventType};return d}(d.InputEvent);d.KeyInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function e(c,a){this._callbackManager=c;this._operatorManager=a;this._contextEventChecker=new b(this._callbackManager)}e.prototype.injectMouseDownEvent=function(c,a,f,b,e){c=new d.Event.MouseInputEvent(c,a,f,b,e,d.MouseInputType.Down);a=d.EventType.MouseDown;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a);this._contextEventChecker.onMouseDownEvent(c)};e.prototype.injectMouseMoveEvent=function(c,a,f,b,e){c=new d.Event.MouseInputEvent(c,
a,f,b,e,d.MouseInputType.Move);a=d.EventType.MouseMove;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a)};e.prototype.injectMouseUpEvent=function(c,a,f,b,e){c=new d.Event.MouseInputEvent(c,a,f,b,e,d.MouseInputType.Up);a=d.EventType.MouseUp;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a);this._contextEventChecker.onMouseUpEvent(c)};e.prototype.injectMousewheelEvent=function(c,a,f,b,e){c=new d.Event.MouseWheelInputEvent(c,
a,f,b,e,d.MouseInputType.Wheel);a=d.EventType.Mousewheel;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a)};e.prototype.injectKeyDownEvent=function(c,a){c=new d.Event.KeyInputEvent(c,a,d.KeyInputType.Down);a=d.EventType.KeyDown;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a)};e.prototype.injectKeyUpEvent=function(c,a){c=new d.Event.KeyInputEvent(c,a,d.KeyInputType.Up);a=d.EventType.KeyUp;this._callbackManager.trigger("_inputInteraction",
c,a);this._operatorManager.injectEvent(c,a)};e.prototype.injectTouchStartEvent=function(c,a,f,b){c=new d.Event.TouchInputEvent(c,a,f,b,d.TouchInputType.Start);a=d.EventType.TouchStart;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a);this._contextEventChecker.onTouchStartEvent(c)};e.prototype.injectTouchMoveEvent=function(c,a,f,b){c=new d.Event.TouchInputEvent(c,a,f,b,d.TouchInputType.Start);a=d.EventType.TouchMove;this._callbackManager.trigger("_inputInteraction",
c,a);this._operatorManager.injectEvent(c,a);this._contextEventChecker.onTouchMoveEvent(c)};e.prototype.injectTouchEndEvent=function(c,a,f,b){c=new d.Event.TouchInputEvent(c,a,f,b,d.TouchInputType.End);a=d.EventType.TouchEnd;this._callbackManager.trigger("_inputInteraction",c,a);this._operatorManager.injectEvent(c,a);this._contextEventChecker.onTouchEndEvent(c)};e.prototype.injectViewOrientationChangeEvent=function(){this._operatorManager._injectViewOrientationChangeEvent()};return e}();h.EventDispatcher=
g;var b=function(){function b(c){this._contextMenuMouseButton=d.Button.Right;this._contextMenuPositionStart=d.Point2.zero();this._touchTimer=new d.Util.Timer;this._activeTouchCount=0;this._initialPosition=d.Point2.zero();this._callbackManager=c}b.prototype.onMouseDownEvent=function(c){c.getHandled()||this._contextMenuPositionStart.assign(c.getPosition())};b.prototype.onMouseUpEvent=function(c){if(!c.getHandled()){var a=c.getPosition();c.getButton()===this._contextMenuMouseButton&&this._contextMenuPositionStart.equals(a)&&
this._callbackManager.trigger("contextMenu",a,c.getModifiers())}};b.prototype.onTouchStartEvent=function(c){var a=this,f=c.getPosition().copy();0===this._activeTouchCount&&(this._initialPosition=f);++this._activeTouchCount;c.getHandled()||this._touchTimer.set(600,function(){a._callbackManager.trigger("contextMenu",f,d.KeyModifiers.None)})};b.prototype.onTouchMoveEvent=function(c){if(!this._touchTimer.isIdle(0)){c=d.Point2.subtract(this._initialPosition,c.getPosition());c=Math.abs(c.squaredLength());
var a=.02*window.outerHeight;c>a*a&&this._touchTimer.clear()}};b.prototype.onTouchEndEvent=function(c){0<this._activeTouchCount&&--this._activeTouchCount;this._touchTimer.clear()};return b}()})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b,d){this.x=b;this.y=d}d.prototype.assign=function(b){this.x=b.x;this.y=b.y;return this};d.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};d.prototype.subtract=function(b){this.x-=b.x;this.y-=b.y;return this};d.prototype.scale=function(b){this.x*=b;this.y*=b;return this};d.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};d.prototype.set=function(b,d){this.x=b;this.y=d;return this};d.prototype.copy=function(){return new d(this.x,
this.y)};d.prototype.length=function(){return Math.sqrt(this.squaredLength())};d.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};d.prototype.toJson=function(){return this._toJson()};d.prototype._toJson=function(){return{x:this.x,y:this.y}};d.prototype.forJson=function(){return this.toJson()};d.fromJson=function(b){return new d(b.x,b.y)};d.subtract=function(b,e){return new d(b.x-e.x,b.y-e.y)};d.add=function(b,e){return new d(b.x+e.x,b.y+e.y)};d.distance=function(b,e){return d.subtract(e,
b).length()};d.zero=function(){return new d(0,0)};d.fromPoint3=function(b){return new d(b.x,b.y)};return d}();d.Point2=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.top=this.left=0}}(),b=function(){function b(c,a){this._isFirefox=this._isIE=!1;this._canvas=null;this._canvasEventFunctions=new Map;this._documentEventFunctions=new Map;this._pointerEventsEnabled=!0;this._captureInput=this._dragStarted=this._eventsBound=this._processInput=!1;this._elementOffset=new g;this._pointerUp=!1;this._buttons=d.Buttons.None;this._eventDispatcher=c;this._timeoutMonitor=a;this._document=document;c=navigator.userAgent.toLowerCase();
this._isIE=0<=c.indexOf("trident")||0<=c.indexOf("edge");this._isFirefox=-1<c.indexOf("firefox")}b.prototype._tryLockEventDispatcher=function(){return b._activeEventDispatcherLocked&&b._activeEventDispatcher!==this._eventDispatcher?!1:(this._calculateElementOffset(),b._activeEventDispatcher=this._eventDispatcher,b._activeOffset=this._elementOffset,b._activeEventDispatcherLocked=!0)};b.prototype._unlockEventDispatcher=function(){b._activeEventDispatcherLocked=!1};b.prototype.shutdown=function(){this.unbindEvents()};
b.prototype.setDocument=function(c){this._unbindDocumentEvents();this._document=c;this._initDocumentEvents()};b.prototype.setOptions=function(c){c.hasOwnProperty("usePointerEvents")&&this.setPointerEventsEnabled(!!c.usePointerEvents)};b.prototype.elementResize=function(){this._calculateElementOffset()};b.prototype.setPointerEventsEnabled=function(c){this._pointerEventsEnabled=c};b.prototype.getPointerEventsEnabled=function(){return this._pointerEventsEnabled};b.prototype._browserSupportsPointerEvents=
function(){return window.hasOwnProperty("PointerEvent")};b.prototype._usePointerEvents=function(){return this._browserSupportsPointerEvents()&&this._pointerEventsEnabled&&this._isIE};b.prototype._calculateElementOffset=function(){if(null!==this._canvas){var c=this._canvas.getBoundingClientRect();this._elementOffset.left=c.left;this._elementOffset.top=c.top}};b.prototype._initDocumentEvents=function(){var c=this;this._usePointerEvents()?(this._bindDocumentEvent("pointermove",function(a){c._processDocumentPointerMove(a)}),
this._bindDocumentEvent("pointerup",function(a){c._processDocumentPointerUp(a)})):(this._bindDocumentEvent("mousemove",function(a){c._processDocumentMouseMove(a)}),this._bindDocumentEvent("mouseup",function(a){c._processDocumentMouseUp(a)}))};b.prototype._initCanvasEvents=function(){var c=this;this._usePointerEvents()?(this._bindCanvasEvent("pointerdown",function(a){c._processPointerDown(a)}),this._bindCanvasEvent("pointermove",function(a){c._processPointerMove(a)}),this._bindCanvasEvent("pointerup",
function(a){c._processPointerUp(a)}),this._bindCanvasEvent("pointerenter",function(a){c._processPointerEnter(a)}),this._bindCanvasEvent("pointerleave",function(a){c._processPointerLeave(a)})):(this._bindCanvasEvent("mousedown",function(a){c._processMouseDown(a)}),this._bindCanvasEvent("mousemove",function(a){c._processMouseMove(a)}),this._bindCanvasEvent("mouseup",function(a){c._processMouseUp(a)}),this._bindCanvasEvent("mouseenter",function(a){c._processMouseEnter(a)}),this._bindCanvasEvent("mouseleave",
function(a){c._processMouseLeave(a)}),this._bindCanvasEvent("touchstart",function(a){c._processTouchStart(a)}),this._bindCanvasEvent("touchmove",function(a){c._processTouchMove(a)}),this._bindCanvasEvent("touchend",function(a){c._processTouchEnd(a)}),this._bindCanvasEvent("touchcancel",function(a){c._processTouchEnd(a)}));this._isFirefox?this._bindCanvasEvent("DOMMouseScroll",function(a){c._processMousewheel(a)}):this._bindCanvasEvent("mousewheel",function(a){c._processMousewheel(a)});this._bindCanvasEvent("keydown",
function(a){c._processKeyDownEvent(a)});this._bindCanvasEvent("keyup",function(a){c._processKeyUpEvent(a)})};b.prototype.bindEvents=function(c){this._eventsBound||(this._canvas=c,this._processInput=!0,this._initCanvasEvents(),this._initDocumentEvents(),this._eventsBound=!0,this._tryLockEventDispatcher())};b.prototype._bindDocumentEvent=function(c,a){if(null!==this._document){var f=this._documentEventFunctions.get(c);void 0!==f&&this._document.removeEventListener(c,f);this._documentEventFunctions.set(c,
a);this._document.addEventListener(c,a)}};b.prototype._bindCanvasEvent=function(c,a){if(null!==this._canvas){var f=this._canvasEventFunctions.get(c);void 0!==f&&this._canvas.removeEventListener(c,f);this._canvasEventFunctions.set(c,a);this._canvas.addEventListener(c,a)}};b.prototype._unbindDocumentEvents=function(){var c=this;this._documentEventFunctions.forEach(function(a,f){c._document.removeEventListener(f,a)});this._documentEventFunctions.clear()};b.prototype._unbindCanvasEvents=function(){var c=
this;null!==this._canvas&&(this._canvasEventFunctions.forEach(function(a,f){c._canvas.removeEventListener(f,a)}),this._canvasEventFunctions.clear());console.assert(0===this._canvasEventFunctions.size)};b.prototype.unbindEvents=function(){this._unbindCanvasEvents();this._unbindDocumentEvents();this._eventsBound=this._processInput=!1;b._activeEventDispatcher===this._eventDispatcher&&this._unlockEventDispatcher()};b.prototype._convertEventCoordsToTargetCoords=function(c,a){var f=null!==b._activeOffset?
b._activeOffset:this._elementOffset;return new d.Point2(c-f.left,a-f.top)};b.prototype.focusInput=function(c){null!==this._canvas&&(c?this._canvas.focus():this._canvas.blur())};b.prototype._setButtons=function(c){c.buttons&&(this._buttons=c.buttons)};b.prototype._processMouseDown=function(c){if(this._tryLockEventDispatcher()){switch(c.button){case 0:this._buttons|=d.Buttons.Left;break;case 1:this._buttons|=d.Buttons.Middle;break;case 2:this._buttons|=d.Buttons.Right}c.preventDefault();this._timeoutMonitor.resetTimeout();
if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);b._activeEventDispatcher.injectMouseDownEvent(a.x,a.y,c.button,this._buttons,f);this._dragStarted=!0}}};b.prototype._processMouseMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY);c=this._getEventModifiers(c);null!==b._activeEventDispatcher&&b._activeEventDispatcher.injectMouseMoveEvent(a.x,
a.y,d.Button.None,this._buttons,c)}};b.prototype._processMouseUp=function(c){this._unlockEventDispatcher();switch(c.button){case 0:this._buttons&=~d.Buttons.Left;break;case 1:this._buttons&=~d.Buttons.Middle;break;case 2:this._buttons&=~d.Buttons.Right}c.preventDefault();c.stopPropagation();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);null!==b._activeEventDispatcher?b._activeEventDispatcher.injectMouseUpEvent(a.x,
a.y,c.button,this._buttons,f):this._eventDispatcher.injectMouseUpEvent(a.x,a.y,c.button,this._buttons,f);this._captureInput=this._dragStarted=!1}};b.prototype._processMousewheel=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);this._eventDispatcher.injectMousewheelEvent(a.x,a.y,this._isFirefox?0<c.detail?-1:1:0<c.wheelDelta?1:-1,this._buttons,f)}};b.prototype._processDocumentMouseMove=
function(c){this._dragStarted&&this._captureInput&&this._processMouseMove(c)};b.prototype._processDocumentMouseUp=function(c){this._dragStarted&&this._captureInput&&this._processMouseUp(c)};b.prototype._processMouseLeave=function(c){this._unlockEventDispatcher();this._dragStarted&&(this._captureInput=!0)};b.prototype._processMouseEnter=function(c){this._tryLockEventDispatcher()&&this._dragStarted&&(this._captureInput=!1)};b.prototype._isFunctionKey=function(c){return 112<=c.which&&123>=c.which};b.prototype._processKeyDownEvent=
function(c){this._isFunctionKey(c)||c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._getEventModifiers(c);this._eventDispatcher.injectKeyDownEvent(c.which,a)}};b.prototype._processKeyUpEvent=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._getEventModifiers(c);this._eventDispatcher.injectKeyUpEvent(c.which,a)}};b.prototype._processTouchStart=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();
if(this._processInput)for(var a=0;a<c.changedTouches.length;a++){var f=c.changedTouches.item(a),b=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchStartEvent(f.identifier,b.x,b.y,this._buttons)}};b.prototype._processTouchMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var a=0;a<c.changedTouches.length;a++){var f=c.changedTouches.item(a),b=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchMoveEvent(f.identifier,
b.x,b.y,this._buttons)}};b.prototype._processTouchEnd=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var a=0;a<c.changedTouches.length;a++){var f=c.changedTouches.item(a),b=this._convertEventCoordsToTargetCoords(f.clientX,f.clientY);this._eventDispatcher.injectTouchEndEvent(f.identifier,b.x,b.y,this._buttons)}};b.prototype._processPointerDown=function(c){if(this._tryLockEventDispatcher()&&(this._setButtons(c),c.preventDefault(),this._timeoutMonitor.resetTimeout(),
this._processInput)){var a=this._convertEventCoordsToTargetCoords(c.clientX,c.clientY),f=this._getEventModifiers(c);"mouse"===c.pointerType?b._activeEventDispatcher.injectMouseDownEvent(a.x,a.y,c.button,this._buttons,f):"touch"===c.pointerType&&b._activeEventDispatcher.injectTouchStartEvent(c.pointerId,a.x,a.y,this._buttons);this._pointerUp=!1}};b.prototype._processPointerMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();this._setButtons(c);if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,
c.clientY),f=this._getEventModifiers(c);null!==b._activeEventDispatcher&&("mouse"===c.pointerType?b._activeEventDispatcher.injectMouseMoveEvent(a.x,a.y,c.button,this._buttons,f):"touch"===c.pointerType&&b._activeEventDispatcher.injectTouchMoveEvent(c.pointerId,a.x,a.y,this._buttons))}};b.prototype._processPointerUp=function(c){this._unlockEventDispatcher();this._setButtons(c);c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var a=this._convertEventCoordsToTargetCoords(c.clientX,
c.clientY),f=this._getEventModifiers(c);"mouse"!==c.pointerType||this._pointerUp?"touch"===c.pointerType&&this._eventDispatcher.injectTouchEndEvent(c.pointerId,a.x,a.y,this._buttons):null!==b._activeEventDispatcher?b._activeEventDispatcher.injectMouseUpEvent(a.x,a.y,c.button,this._buttons,f):this._eventDispatcher.injectMouseUpEvent(a.x,a.y,c.button,this._buttons,f);this._captureInput=this._dragStarted=!1;this._pointerUp=!0}};b.prototype._processPointerEnter=function(c){this._pointerUp||(this._captureInput=
!1)};b.prototype._processPointerLeave=function(c){this._pointerUp||(this._captureInput=!0)};b.prototype._processDocumentPointerMove=function(c){!this._pointerUp&&this._captureInput&&this._processPointerMove(c)};b.prototype._processDocumentPointerUp=function(c){!this._pointerUp&&this._captureInput&&this._processPointerUp(c)};b.prototype._getEventModifiers=function(c){var a=d.KeyModifiers.None;c.altKey&&(a|=d.KeyModifiers.Alt);c.ctrlKey&&(a|=d.KeyModifiers.Control);c.shiftKey&&(a|=d.KeyModifiers.Shift);
c.metaKey&&(a|=d.KeyModifiers.Command);return a};b._activeEventDispatcher=null;b._activeEventDispatcherLocked=!1;b._activeOffset=null;return b}();h.InputMonitor=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Directional=0]="Directional"})(d.LightType||(d.LightType={}));(function(d){d[d.World=0]="World";d[d.Camera=1]="Camera"})(d.LightSpace||(d.LightSpace={}));var h=function(){return function(d,b,e,c){this.type=d;this.space=b;this.position=e;this.color=c}}();d.Light=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(){}d.prototype.exportMarkup=function(){return[]};d.prototype.loadData=function(b){b;return Promise.resolve([])};return d}();d.MarkupTypeManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function b(b,c){var a=g.call(this)||this;a._markupArray=[];a._viewer=b;a._callbackManager=c;a._callbackManager.bind({modelSwitched:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.removeAllLines()];case 1:return a.sent(),[2]}})})}});return a}__extends(b,g);b.prototype.addLine=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._markupArray.push(b),
[4,b.updateLine()];case 1:return c.sent(),this._callbackManager.trigger("lineCreated",b),[2]}})})};b.prototype.removeLine=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:c=0,a.label=1;case 1:return c<this._markupArray.length?this._markupArray[c].getId()!==b.getId()?[3,3]:[4,b.removeLine()]:[3,4];case 2:a.sent(),this._markupArray.splice(c,1),this._callbackManager.trigger("lineDeleted",b),a.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};
b.prototype.removeAllLines=function(){for(var b=this,c=[],a=function(a){var d=f._markupArray[a];c.push(d.removeLine().then(function(){b._callbackManager.trigger("lineDeleted",d)}));f._markupArray.splice(a,1)},f=this,k=this._markupArray.length-1;0<=k;k--)a(k);return d.Util.waitForAll(c)};b.prototype.getAllLines=function(){return this._markupArray.slice(0)};b.prototype.removeLastLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0<
this._markupArray.length?[4,this.removeLine(this._markupArray[this._markupArray.length-1])]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2]}})})};b.prototype.getLineByNodeId=function(b){for(var c=0,a=this._markupArray;c<a.length;c++){var f=a[c],d=f.getNodeId();if(null!==d&&d===b)return f}return null};b.prototype.exportMarkup=function(){for(var b=[],c=0,a=this._markupArray;c<a.length;c++)b.push(a[c].toJson());return b};b.prototype._handleLoadLine=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return b instanceof d.Markup.Line.LineMarkup?[4,this.addLine(b)]:[3,2];case 1:return c.sent(),this._callbackManager.trigger("lineLoaded",b),[2,!0];case 2:return[2,!1]}})})};b.prototype.loadData=function(b){for(var c=this,a=[],f=0;f<b.length;f++){var k=b[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof Promise?a.push(k.then(function(a){return c._handleLoadLine(a)})):a.push(this._handleLoadLine(k)))}}return Promise.all(a)};
return b}(d.MarkupTypeManager);d.LineManager=h})(Communicator||(Communicator={}));var __decorate=this&&this.__decorate||function(d,h,g,b){var e=arguments.length,c=3>e?h:null===b?b=Object.getOwnPropertyDescriptor(h,g):b,a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(d,h,g,b);else for(var f=d.length-1;0<=f;f--)if(a=d[f])c=(3>e?a(c):3<e?a(h,g,c):a(h,g))||c;return 3<e&&c&&Object.defineProperty(h,g,c),c};
(function(d){var h=function(){function g(b,e,c,a,f,k,l){this._markupTypeMap=new Map;this._domElements=b;this._callbackManager=a;this._viewer=l;this._sheetManager=f;this._sheetManager.setMarkupManager(this);this._noteTextManager=k;this._renderer=new d.Internal.SVG.SVGMarkupRenderer;this._itemManager=new d.Internal.MarkupItemManager(this._callbackManager,this._domElements,this._renderer);this._viewManager=new d.Internal.MarkupViewManager(this._viewer,this._itemManager,this._callbackManager,l.explodeManager,
l.cuttingManager,this._sheetManager);this._measurementManager=e;this._lineManager=c}g.deprecated=function(b,d,c){var a=c.value;c.value=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this._callbackManager.trigger("deprecated","MarkupManager",d);return a.apply(this,c)};return c};g.prototype.registerMarkupTypeManager=function(b,d){this._markupTypeMap.set(b,d)};g.prototype.createMarkupView=function(b,d,c,a,f){void 0===d&&(d=!0);void 0===c&&(c=null);void 0===a&&(a=null);void 0===
f&&(f=null);var k=this._viewer.sheetManager.getActiveSheetId();return this._viewManager.createView(b,d,k,c,a,f).getUniqueId()};g.prototype.getMarkupView=function(b){return this._viewManager.getView(b)};g.prototype.getMarkupViewKeys=function(){return this._viewManager.getViewKeys()};g.prototype.activateMarkupViewWithPromise=function(b,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._viewManager.activateView(b,
e)]})})};g.prototype.activateMarkupView=function(b,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._viewManager.deprecatedActivateView(b,e)};g.prototype.getActiveMarkupView=function(){return this._itemManager.getActiveView()};g.prototype.deleteMarkupView=function(b){return this._viewManager.deleteView(b)};g.prototype.registerMarkup=function(b){b=this._itemManager.registerMarkupItem(b);this.updateLater();return b};g.prototype.unregisterMarkup=function(b){this._itemManager.unregisterMarkupItem(b);
this.updateLater()};g.prototype.addMarkupElement=function(b){var e=d.UUID.create();b.id=e;this._domElements.getRedlineElement().appendChild(b);return e};g.prototype.removeMarkupElement=function(b){for(var d=this._domElements.getRedlineElement(),c=0;c<d.children.length;c++){var a=d.children.item(c);null!==a&&a.id===b&&d.removeChild(a)}};g.prototype.refreshMarkup=function(){this.updateLater()};g.prototype.updateLater=function(){this._itemManager.updateLater()};g.prototype.pickMarkupItem=function(b){return this._itemManager.pick(b)};
g.prototype.getPickTolerance=function(){return this._itemManager.getPickTolerance()};g.prototype.setPickTolerance=function(b){return this._itemManager.setPickTolerance(b)};g.prototype.selectMarkup=function(b){this._itemManager.select(b)};g.prototype.getSelectedMarkup=function(){return this._itemManager.getSelected()};g.prototype.exportMarkup=function(){var b={views:this._viewManager.exportMarkup(),notes:this._noteTextManager.exportMarkup(),measurement:this._measurementManager.exportMarkup(),lines:this._lineManager.exportMarkup()};
this._markupTypeMap.forEach(function(d,c){b[c]=d.exportMarkup()});return b};g.prototype.loadMarkupData=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){"string"===typeof b&&(b=JSON.parse(b));return[2,this._loadMarkupData(b)]})})};g.prototype._loadMarkupData=function(b){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,function(a){e=[];b.hasOwnProperty("views")&&(c=this._viewManager.loadData(b.views).then(d.Internal.all),e.push(c));
b.hasOwnProperty("notes")&&(c=this._noteTextManager.loadData(b.notes).then(d.Internal.all),e.push(c));b.hasOwnProperty("measurement")&&(c=this._measurementManager.loadData(b.measurement).then(d.Internal.all),e.push(c));b.hasOwnProperty("lines")&&(c=this._lineManager.loadData(b.lines).then(d.Internal.all),e.push(c));this._markupTypeMap.forEach(function(a,c){b.hasOwnProperty(c)&&(a=a.loadData(b[c]).then(d.Internal.all),e.push(a))});return[2,Promise.all(e).then(d.Internal.all)]})})};g.prototype.getRenderer=
function(){return this._renderer};g.prototype._shutdown=function(){this._itemManager.shutdown();this._renderer._clear()};g.prototype._update=function(){this._itemManager.update()};g.prototype._setActiveMarkupView=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._itemManager.setActiveView(b)]})})};g.prototype._getItemManager=function(){return this._itemManager};__decorate([g.deprecated],g.prototype,"activateMarkupView",null);return g}();d.MarkupManager=
h})(Communicator||(Communicator={}));
(function(d){var h=function(g){function b(b,c){var a=g.call(this)||this;a._markupArray=[];a._color=new d.Color(0,0,0);a._edgeColor=new d.Color(0,0,0);a._viewer=b;a._callbackManager=c;a._callbackManager.bind({modelSwitched:function(){a.removeAllMeasurements()}});return a}__extends(b,g);b.prototype.addMeasurement=function(b){this._markupArray.push(b);var c=this._viewer.markupManager.registerMarkup(b);b._setId(c);return c};b.prototype.finalizeMeasurement=function(b){this._callbackManager.trigger("measurementCreated",b)};
b.prototype.removeMeasurement=function(b){for(var c=0;c<this._markupArray.length;c++)if(this._markupArray[c]._getId()===b._getId()){this._markupArray.splice(c,1);this._viewer.markupManager.unregisterMarkup(b._getId());this._callbackManager.trigger("measurementDeleted",b);break}};b.prototype.removeAllMeasurements=function(){for(var b=this._markupArray.length-1;0<=b;b--){var c=this._markupArray[b];this._viewer.markupManager.unregisterMarkup(c._getId());this._markupArray.splice(b,1);this._callbackManager.trigger("measurementDeleted",
c)}};b.prototype.getAllMeasurements=function(){return this._markupArray.slice(0)};b.prototype.removeLastMeasurement=function(){0<this._markupArray.length&&this.removeMeasurement(this._markupArray[this._markupArray.length-1])};b.prototype.setMeasurementColor=function(b){this._color.assign(b)};b.prototype.getMeasurementColor=function(){return this._color.copy()};b.prototype.setMeasurementEdgeColor=function(b){this._edgeColor.assign(b)};b.prototype.getMeasurementEdgeColor=function(){return this._edgeColor.copy()};
b.prototype.exportMarkup=function(){for(var b=[],c=0,a=this._markupArray;c<a.length;c++)b.push(a[c].toJson());return b};b.prototype._handleLoadMeasurement=function(b){return b instanceof d.Markup.Measure.MeasureMarkup?(this.addMeasurement(b),this._callbackManager.trigger("measurementLoaded",b),!0):!1};b.prototype.loadData=function(b){for(var c=this,a=[],f=0;f<b.length;f++){var k=b[f];if(k.hasOwnProperty("className")){var e=d.Internal.classFromString(k.className);e&&(k=e.fromJson(k,this._viewer),k instanceof
Promise?a.push(k.then(function(a){return c._handleLoadMeasurement(a)})):a.push(Promise.resolve(this._handleLoadMeasurement(k))))}}return Promise.all(a)};return b}(d.MarkupTypeManager);d.MeasureManager=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this._faceMeshData=[];this._pointMeshData=[];this._polylineMeshData=[];this._faceWinding=d.FaceWinding.CounterClockwise;this._isManifold=this._backfacesEnabled=!1}g.prototype.addFaces=function(b,e,c,a,f){void 0===f&&(f=0);this._faceMeshData.push(new d.Internal.FaceMeshData(b,e,c,a,f))};g.prototype.addPoints=function(b,e,c){void 0===c&&(c=0);this._pointMeshData.push(new d.Internal.PointMeshData(b,e,c))};g.prototype.addPolyline=function(b,e,c){void 0===c&&
(c=0);this._polylineMeshData.push(new d.Internal.PolylineMeshData(b,e,c))};g.prototype.clear=function(){this._faceMeshData.length=0;this._pointMeshData.length=0;this._polylineMeshData.length=0};g.prototype.setFaceWinding=function(b){this._faceWinding=b};g.prototype.getFaceWinding=function(){return this._faceWinding};g.prototype.setBackfacesEnabled=function(b){this._backfacesEnabled=b};g.prototype.getBackfacesEnabled=function(){return this._backfacesEnabled};g.prototype.setManifold=function(b){this._isManifold=
b};g.prototype.isManifold=function(){return this._isManifold};g.prototype._getFaceData=function(){return this._faceMeshData};g.prototype._getPointData=function(){return this._pointMeshData};g.prototype._getPolylineData=function(){return this._polylineMeshData};return g}();d.MeshData=h;h=function(){function g(b,e,c,a,f,k,l){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=
d.MeshInstanceCreationFlags.None;this._overlayIndex=0;b&&(this._meshId=b.slice());e&&(this._matrix=e.copy());c&&(this._instanceName=c);a&&(this._faceColor=a.copy());f&&(this._lineColor=f.copy());k&&(this._pointColor=k.copy());l&&(this._creationFlags=l)}g.prototype.copy=function(){var b=new g(this.getMeshId(),this.getMatrix(),this.getInstanceName(),this.getFaceColor(),this.getLineColor(),this.getPointColor(),this.getCreationFlags());b.setPointOpacity(this.getOpacity());b.setLineOpacity(this.getLineOpacity());
b.setOpacity(this.getOpacity());b.setOverlayIndex(this.getOverlayIndex());return b};g.prototype.clear=function(){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=d.MeshInstanceCreationFlags.None;this._overlayIndex=0};g.prototype.getMeshId=function(){return null!==this._meshId?this._meshId.slice():null};g.prototype.getMeshKey=function(){return this.getMeshId()};g.prototype.setMeshId=
function(b){this._meshId=b.slice()};g.prototype.setMeshKey=function(b){this.setMeshId(b)};g.prototype.getMatrix=function(){return null!==this._matrix?this._matrix.copy():null};g.prototype.getCreationFlags=function(){return this._creationFlags};g.prototype.setCreationFlags=function(b){this._creationFlags=b};g.prototype.setMatrix=function(b){this._matrix=b.copy()};g.prototype.getInstanceName=function(){return this._instanceName};g.prototype.setInstanceName=function(b){this._instanceName=b};g.prototype.setFaceColor=
function(b){this._faceColor=b.copy()};g.prototype.getFaceColor=function(){return null!==this._faceColor?this._faceColor.copy():null};g.prototype.setLineColor=function(b){this._lineColor=b.copy()};g.prototype.getLineColor=function(){return null!==this._lineColor?this._lineColor.copy():null};g.prototype.setPointColor=function(b){this._pointColor=b.copy()};g.prototype.getPointColor=function(){return null!==this._pointColor?this._pointColor.copy():null};g.prototype.setPointOpacity=function(b){this._pointOpacity=
b};g.prototype.getPointOpacity=function(){return this._pointOpacity};g.prototype.setLineOpacity=function(b){this._lineOpacity=b};g.prototype.getLineOpacity=function(){return this._lineOpacity};g.prototype.setOpacity=function(b){this._faceOpacity=b};g.prototype.setTransparency=function(b){this._faceOpacity=b};g.prototype.getOpacity=function(){return this._faceOpacity};g.prototype.getTransparency=function(){return this._faceOpacity};g.prototype.setOverlayIndex=function(b){this._overlayIndex=b};g.prototype.getOverlayIndex=
function(){return this._overlayIndex};return g}();d.MeshInstanceData=h})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(b,d,c,a,f){void 0===f&&(f=0);this.vertexData=b;this.normalData=d;this.rgba32data=c;this.uvData=a;this.bits=f}}();d.FaceMeshData=g;g=function(){return function(b,d,c){void 0===c&&(c=0);this.vertexData=b;this.rgba32data=d;this.bits=c}}();d.PolylineMeshData=g;g=function(){return function(b,d,c){void 0===c&&(c=0);this.vertexData=b;this.rgba32data=d;this.bits=c}}();d.PointMeshData=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){function b(b){console.assert(b!==d.invalidNodeId);return b>d.invalidNodeId}d.invalidNodeId=-1;d.isAuthoredId=b;d.getAuthoredId=function(d){console.assert(b(d));return d};d.getRuntimeId=function(e,c){return b(e)?d.towardInclusionContext(c).toRuntimeId(e):e}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d.DefaultTransitionDuration=400;d.EmptyModelName="_empty";d.InvalidNodeId=d.Internal.Tree.invalidNodeId;var h=function(){function g(b,e){var c=this;this._pmiColor=d.Color.black();this._pmiColorOverride=!1;this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;this._firstModelRootId=d.InvalidNodeId;this._engine=b;this._callbackManager=e;this._callbackManager.bind({_firstModelLoaded:function(a){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){this._firstModelRootId=
a[0];return[2]})})},_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){this._viewAxes=new d.ViewAxes;this._viewAxesSet=!1;return[2]})})}})}g.deprecated=function(b,d,c){var a=c.value;c.value=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this._callbackManager.trigger("deprecated","Model",d);return a.apply(this,c)};return c};g.prototype._setModelStructure=function(b){console.assert(void 0===this._modelStructure);this._modelStructure=
b};g.prototype.getClientDimensions=function(){return this._engine.getClientDimensions()};g.prototype.setViewAxes=function(b,e){if(b.isAxis()&&e.isAxis()&&!b.equals(e))this._viewAxes.frontVector=b,this._viewAxes.upVector=e,this._callbackManager.trigger("viewAxes",b,e),this._viewAxesSet=!0;else throw new d.CommunicatorError("The upVector and frontVector must be unique, cardinal axes.");};g.prototype.viewAxesHaveBeenSet=function(){return this._viewAxesSet};g.prototype.getViewAxes=function(){return this._viewAxes};
g.prototype.getModelBounding=function(b,e,c){void 0===c&&(c=!1);return __awaiter(this,void 0,void 0,function(){var a,f,k,l;return __generator(this,function(n){switch(n.label){case 0:a=new d.Box,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._engine.getModelBounding(b,e,c)];case 2:return a=n.sent(),[3,4];case 3:return f=n.sent(),k=!1,SC.isError(f)&&(l=SC.getStateFailure(f),1===l&&(k=!0)),console.assert(k),[3,4];case 4:return[2,a]}})})};g.prototype.getLooseBounding=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){return[2,this._engine.getLooseBounding()]})})};g.prototype._allowNodeDeletion=function(b){return this._modelStructure.allowNodeDeletion(b)};g.prototype._preventNodeDeletion=function(b){return this._modelStructure.preventNodeDeletion(b)};g.prototype._preventMeshDeletion=function(b){console.assert(0===b[0]);return this._modelStructure.preventMeshDeletion(b[1])};g.prototype._getNodeFromInstanceInc=function(b,d,c,a){return this._modelStructure.getNodeFromInstanceInc(b,
d,c,a)};g.prototype.getNodesBounding=function(b,d){var c=7,a=!1,f=!1;void 0!==d&&(!1===d.bodyInstance&&(c&=-2),!1===d.pmiBody&&(c&=-3),!1===d.viewFrame&&(c&=-5),d.ignoreInvisible&&(a=!0),d.tightBounding&&(f=!0));return this._modelStructure.getBounding(b,c,a,f)};g.prototype.getNodeRealBounding=function(b){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.gatherInstanceIncsFromNodeIds([b],7,d.Internal.Tree.WalkRestriction.None);if(0===e.length)throw new d.CommunicatorError("Cannot get bounding of node without geometry.");
return[2,this._engine.getDrawnPartsBounding(e)]})})};g.prototype.setNodesVisibilities=function(b,e,c){void 0===e&&(e=null);void 0===c&&(c=d.TreeWalkMode.Default);b=d.Internal.fromIntegerMap(b);return this._modelStructure.setVisibilitiesByMap(b,e,c)};g.prototype.setNodesVisibility=function(b,e,c,a){void 0===c&&(c=null);void 0===a&&(a=d.TreeWalkMode.Default);return this._modelStructure.setVisibilitiesByValue(b,e,c,a)};g.prototype.resetNodesVisibility=function(){return this.isDrawing()?this._callbackManager.promiseTrigger("_resetDrawing",
null):this._modelStructure.resetAllVisibilities()};g.prototype.getVisibilityState=function(b){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){e=this._modelStructure.lookupAnyTreeNode(b);if(null===e)throw new d.InvalidNodeIdError(b);return[2,d.Internal.Tree.getVisibilityState(e)]})})};g.prototype.resetNodesTransform=function(){return this._modelStructure.resetAllTransforms()};g.prototype.reset=function(){return this._modelStructure.reset()};g.prototype.clear=
function(){return this._modelStructure.clear()};g.prototype.setNodesFaceColor=function(b,d){this._setNodesFaceColor(b,d);return Promise.resolve()};g.prototype._setNodesFaceColor=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);0<b.length&&this._engine.setPartColor(b,d.ElementType.Faces,e)};g.prototype._unsetNodesColor=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);0<b.length&&
this._engine.unsetPartColor(b,e)};g.prototype.unsetNodesFaceColor=function(b){this._unsetNodesColor(b,d.ElementType.Faces);return Promise.resolve()};g.prototype.setNodesLineColor=function(b,d){this._setNodesLineColor(b,d);return Promise.resolve()};g.prototype._setNodesLineColor=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);0<b.length&&this._engine.setPartColor(b,d.ElementType.Lines,e)};g.prototype.unsetNodesLineColor=function(b){this._unsetNodesColor(b,
d.ElementType.Lines);return Promise.resolve()};g.prototype.setNodesHighlighted=function(b,e){if(0===b.length)return Promise.resolve();b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<b.length&&this._engine.highlightParts(b,e);return Promise.resolve()};g.prototype.getNodesHighlighted=function(b){b=this._getInstanceIncsFromLeafNodes(b);return 0<b.length?this._engine.getPartHighlighted(b):Promise.resolve([])};g.prototype.setNodesColors=function(b,
e){var c=this;void 0===e&&(e=!1);var a=new Set,f=new Map,k=function(b,k){b=c._modelStructure.lookupAnyTreeNode(b);if(null!==b&&(b=d.Internal.Tree.gatherInstanceIncsSync(b,7,!1,a,d.Internal.Tree.WalkRestriction.None),0<b.length)){k=(k.r<<16)+(k.g<<8)+k.b;var e=f.get(k);e?f.set(k,e.concat(b)):f.set(k,b)}};if(b instanceof Map)b.forEach(function(a,c){k(c,a)});else for(var l=0,n=Object.keys(b);l<n.length;l++){var g=parseInt(n[l],10);k(g,b[g])}f.forEach(function(a,f){f=new d.Color(f>>16,(f&65280)>>8,f&
255);c._engine.setPartColor(a,d.ElementType.Faces,f);e&&c._engine.setPartColor(a,d.ElementType.Lines,f)});return Promise.resolve()};g.prototype.getPmiTopologyReferences=function(b){var e=[],c=function(a,c,f){var b=new d.RefOnTopoItem;b.bodyId=a;b.subElementType=c;b.subElementIndex=f;return b};b=this._modelStructure.getPmiTopologyReferences(b);if(null!==b)for(var a=0;a<b.length;a++){for(var f=b[a],k=f.body.getRuntimeId(),l=0,n=f.faceIds;l<n.length;l++)e.push(c(k,d.PmiTopoRef.Face,n[l]));l=0;for(f=
f.edgeIds;l<f.length;l++)e.push(c(k,d.PmiTopoRef.Edge,f[l]))}return 0===e.length?null:e};g.prototype.getPmis=function(){return this._modelStructure.getPmis()};g.prototype.getPMIs=function(){return this.getPmis()};g.prototype.getPmiType=function(b){return this._modelStructure.getPmiType(b)};g.prototype.getPMIType=function(b){return this.getPmiType(b)};g.prototype.getPmiSubtype=function(b){return this._modelStructure.getPmiSubType(b)};g.prototype.getPMISubtype=function(b){return this.getPmiSubtype(b)};
g.prototype.setPmiColor=function(b){this._pmiColor.assign(b)};g.prototype.setPMIColor=function(b){this.setPmiColor(b)};g.prototype.getPmiColor=function(){return this._pmiColor.copy()};g.prototype.getPMIColor=function(){return this.getPmiColor()};g.prototype.setPmiColorOverride=function(b,d){(this._pmiColorOverride=b)?this._modelStructure.setPmiColor(this._pmiColor,d):this._modelStructure.resetPmiColor(d);return Promise.resolve()};g.prototype.setPMIColorOverride=function(b){return this.setPmiColorOverride(b)};
g.prototype.getPmiColorOverride=function(){return this._pmiColorOverride};g.prototype.getPMIColorOverride=function(){return this.getPmiColorOverride()};g.prototype.computeMinimumBodyBodyDistance=function(b,e){var c=this._modelStructure.lookupAnyBody(b);if(null===c)throw new d.InvalidNodeTypeError(b,1);b=this._modelStructure.lookupAnyBody(e);if(null===b)throw new d.InvalidNodeTypeError(e,1);e=c.getInstanceInc();c=b.getInstanceInc();return this._engine.computeMinimumBodyBodyDistance(e,c)};g.prototype.computeMinimumFaceFaceDistance=
function(b,e,c,a){var f=this._modelStructure.lookupAnyBody(b);if(null===f)throw new d.InvalidNodeTypeError(b,1);b=this._modelStructure.lookupAnyBody(c);if(null===b)throw new d.InvalidNodeTypeError(c,1);c=f.getInstanceInc();f=b.getInstanceInc();return this._engine.computeMininimumFaceFaceDistance([c[0],c[1]],e,[f[0],f[1]],a)};g.prototype.computeMinimumFaceRayDistance=function(b,e,c){var a=this._modelStructure.lookupAnyBody(b);if(null===a)throw new d.InvalidNodeTypeError(b,1);b=a.getInstanceInc();return this._engine.computeMinimumFaceRayDistance(b,
e,c)};g.prototype.computeMinimumFaceLineDistance=function(b,e,c){var a=this._modelStructure.lookupAnyBody(b);if(null===a)throw new d.InvalidNodeTypeError(b,1);b=a.getInstanceInc();return this._engine.computeMinimumFaceLineDistance(b,e,c)};g.prototype.setNodeFaceColor=function(b,d,c){this._setNodeFaceColor(b,d,c);return Promise.resolve()};g.prototype._setNodeFaceColor=function(b,e,c){b=this._modelStructure.gatherInstanceIncsFromNodeIds([b],7,d.Internal.Tree.WalkRestriction.None);2===b.length&&this._engine.setElementColor(b,
d.ElementType.Faces,e,1,c)};g.prototype._unsetElementColor=function(b,d,c){b=this._getInstanceIncFromSingleLeafNode(b);this._engine.unsetElementColor(b,d,c,1)};g.prototype.unsetNodeFaceColor=function(b,e){this._unsetElementColor(b,d.ElementType.Faces,e);return Promise.resolve()};g.prototype.setNodeFaceHighlighted=function(b,d,c){this._setNodeFaceHighlighted(b,d,c);return Promise.resolve()};g.prototype._setNodeFaceHighlighted=function(b,e,c){b=this._modelStructure.gatherInstanceIncsFromNodeIds([b],
7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<b.length&&this._engine.highlightElements(b,d.ElementType.Faces,e,1,c)};g.prototype._getElementHighlighted=function(b,d,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(k){switch(k.label){case 0:return a=this._getInstanceIncFromSingleLeafNode(b),[4,this._engine.getElementHighlighted(a,d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceHighlighted=function(b,e){return this._getElementHighlighted(b,
d.ElementType.Faces,e)};g.prototype.setNodeLineColor=function(b,d,c){this._setNodeLineColor(b,d,c);return Promise.resolve()};g.prototype._setNodeLineColor=function(b,e,c){var a=this._modelStructure.lookupAnyBody(b);if(null===a)throw new d.InvalidNodeTypeError(b,1);b=a.getInstanceInc();this._engine.setElementColor(b,d.ElementType.Lines,e,1,c)};g.prototype.unsetNodeLineColor=function(b,e){this._unsetElementColor(b,d.ElementType.Lines,e);return Promise.resolve()};g.prototype.setNodeLineHighlighted=function(b,
d,c){this._setNodeLineHighlighted(b,d,c);return Promise.resolve()};g.prototype._setNodeLineHighlighted=function(b,e,c){b=this._modelStructure.gatherInstanceIncsFromNodeIds([b],7,d.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<b.length&&this._engine.highlightElements(b,d.ElementType.Lines,e,1,c)};g.prototype.getNodeLineHighlighted=function(b,e){return this._getElementHighlighted(b,d.ElementType.Lines,e)};g.prototype.setNodePointHighlighted=function(b,d,c){this._setNodePointHighlighted(b,d,c);return Promise.resolve()};
g.prototype._setNodePointHighlighted=function(b,e,c){var a=this._modelStructure.lookupAnyBody(b);if(null===a)throw new d.InvalidNodeTypeError(b,1);b=a.getInstanceInc();this._engine.highlightElements(b,d.ElementType.Points,e,1,c)};g.prototype.getNodePointHighlighted=function(b,e){return this._getElementHighlighted(b,d.ElementType.Points,e)};g.prototype.resetNodesColor=function(){this._engine.resetColors();return Promise.resolve()};g.prototype.setNodesOpacity=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,
7,d.Internal.Tree.WalkRestriction.None);0<b.length&&this._engine.setPartOpacity(b,e)};g.prototype.setNodesTransparency=function(b,d){this.setNodesOpacity(b,d);return Promise.resolve()};g.prototype.getNodesHaveTransparency=function(b){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);return 0<b.length?this._engine.getPartHasTransparency(b):Promise.resolve([])};g.prototype.setNodesOpacities=function(b){var e=this;b=d.Internal.fromIntegerMap(b);var c=new Set;
b.forEach(function(a,f){f=e._modelStructure.lookupAnyTreeNode(f);null!==f&&(f=d.Internal.Tree.gatherInstanceIncsSync(f,1,!1,c,d.Internal.Tree.WalkRestriction.None),0<f.length&&e._engine.setPartOpacity(f,a))})};g.prototype.setNodesTransparencies=function(b){this.setNodesOpacities(b);return Promise.resolve()};g.prototype.resetModelOpacity=function(){this._engine.resetOpacity();this._callbackManager.trigger("_resetOpacity")};g.prototype.resetModelTransparency=function(){this.resetModelOpacity();return Promise.resolve()};
g.prototype.resetModelHighlight=function(){this._engine.clearHighlight();return Promise.resolve()};g.prototype.resetNodesOpacity=function(b){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);0<b.length&&this._engine.unsetPartOpacity(b)};g.prototype.resetNodesTransparency=function(b){this.resetNodesOpacity(b);return Promise.resolve()};g.prototype._getNodesColor=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);
return 0<b.length?this._engine.getPartColor(b,e):Promise.resolve([])};g.prototype._getNodesEffectiveColor=function(b,e){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);return 0<b.length?this._engine.getEffectivePartColor(b,e):Promise.resolve([])};g.prototype.getNodesFaceColor=function(b){return this._getNodesColor(b,d.ElementType.Faces)};g.prototype.getNodesEffectiveFaceColor=function(b){return this._getNodesEffectiveColor(b,d.ElementType.Faces)};g.prototype.getNodesLineColor=
function(b){return this._getNodesColor(b,d.ElementType.Lines)};g.prototype.getNodesEffectiveLineColor=function(b){return this._getNodesEffectiveColor(b,d.ElementType.Lines)};g.prototype.getNodeColorMap=function(b,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=this._modelStructure.lookupAnyTreeNode(b);if(null!==c)return[2,d.Internal.Tree.getNodeColorMap(c,this._engine,e)];throw new d.InvalidNodeIdError(b);})})};g.prototype.getNodesOpacity=function(b){return Promise.resolve(this._getNodesOpacity(b))};
g.prototype.getNodesTransparency=function(b){return this.getNodesOpacity(b)};g.prototype._getNodesOpacity=function(b){b=this._getInstanceIncsFromLeafNodes(b);return 0<b.length?this._engine.getPartOpacity(b):[]};g.prototype.getNodesEffectiveOpacity=function(b,d){return(b=this._getInstanceIncsFromLeafNodes(b))&&0<b.length?this._engine.getEffectivePartOpacity(b,d):Promise.resolve([])};g.prototype.getNodesEffectiveTransparency=function(b,d){return this.getNodesEffectiveOpacity(b,d)};g.prototype._getNodeElementColor=
function(b,d,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(k){switch(k.label){case 0:return a=this._getInstanceIncFromSingleLeafNode(b),[4,this._engine.getElementColor(a,d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype._getNodeEffectiveElementColor=function(b,d,c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(k){switch(k.label){case 0:return a=this._getInstanceIncFromSingleLeafNode(b),[4,this._engine.getEffectiveElementColor(a,
d,c)];case 1:return f=k.sent()[0],[2,f]}})})};g.prototype.getNodeFaceColor=function(b,e){return this._getNodeElementColor(b,d.ElementType.Faces,e)};g.prototype.getNodeEffectiveFaceColor=function(b,e){return this._getNodeEffectiveElementColor(b,d.ElementType.Faces,e)};g.prototype.getNodeLineColor=function(b,e){return this._getNodeElementColor(b,d.ElementType.Lines,e)};g.prototype.getNodeEffectiveLineColor=function(b,e){return this._getNodeEffectiveElementColor(b,d.ElementType.Lines,e)};g.prototype.getOutOfHierarchy=
function(b){return this._modelStructure.isOutOfHierarchy(b)};g.prototype.getAbsoluteRootNode=function(){return this._modelStructure.getAbsoluteRootNodeId()};g.prototype.getRootNode=function(){return this.getAbsoluteRootNode()};g.prototype.getNodeChildren=function(b,d){return this._modelStructure.getChildIds(b,d||!1)};g.prototype.getNodesInstancingSamePart=function(b){return this._modelStructure.getPartReferrers(b)};g.prototype.getUnitMultiplier=function(){var b=this._firstModelRootId!==d.InvalidNodeId?
this._firstModelRootId:this.getAbsoluteRootNode();return this.getNodeUnitMultiplier(b)};g.prototype.getNodeUnitMultiplier=function(b){return this._modelStructure.getUnit(b)};g.prototype.createCadView=function(b,d,c,a,f,k,l,n,g){a||(a=[]);f||(f=[]);k||(k=[]);l||(l=[]);void 0===n&&(n=null);void 0===g&&(g=null);b=this._modelStructure.createCadView(b,d,c,a,f,k,l,n,g);null!==b&&this._callbackManager.trigger("cadViewCreated",b,d);return b};g.prototype.createCADView=function(b,d,c,a,f,k,l,n,g){return this.createCadView(b,
d,c,a,f,k,l,n,g)};g.prototype.getCadViewMap=function(){return this._modelStructure.getCadViewMap()};g.prototype.getCadViews=function(){return d.Internal.toIntegerMap(this.getCadViewMap())};g.prototype.getCADViews=function(){return this.getCadViews()};g.prototype.activateCadView=function(b,e){void 0===e&&(e=d.DefaultTransitionDuration);return this._modelStructure.activateCadView(b,e)};g.prototype.activateCADView=function(b,d){return this.activateCadView(b,d)};g.prototype.getCadViewPmis=function(b){return this._modelStructure.getCadViewPmis(b)};
g.prototype.getCADViewPMIs=function(b){return this.getCadViewPmis(b)};g.prototype.cadConfigurationsEnabled=function(){return this._modelStructure.cadConfigurationsEnabled()};g.prototype.getCadConfigurations=function(){return this._modelStructure.getCadConfigurations()};g.prototype.getCADConfigurations=function(){return this.getCadConfigurations()};g.prototype.getDefaultCadConfiguration=function(){return this._modelStructure.getDefaultCadConfiguration()};g.prototype.getCADDefaultConfiguration=function(){return this.getDefaultCadConfiguration()};
g.prototype.getActiveCadConfiguration=function(){return this._modelStructure.getActiveCadConfiguration()};g.prototype.getCADActiveConfiguration=function(){return this.getActiveCadConfiguration()};g.prototype.activateCadConfiguration=function(b){return this._modelStructure.activateCadConfiguration(b)};g.prototype.activateCADConfiguration=function(b){return this.activateCadConfiguration(b)};g.prototype.activateDefaultCadConfiguration=function(){return this._modelStructure.activateDefaultCadConfiguration()};
g.prototype.activateCADDefaultConfiguration=function(){return this.activateDefaultCadConfiguration()};g.prototype.getEdgeCount=function(b){return this._modelStructure.getEdgeCount(b)};g.prototype.getEdgeAttributes=function(b,d){return this._modelStructure.getEdgeAttributes(b,d)};g.prototype.getEdgeProperty=function(b,d){return this._modelStructure.getEdgeProperty(b,d)};g.prototype.getFaceCount=function(b){return this._modelStructure.getFaceCount(b)};g.prototype.getFaceAttributes=function(b,d){return this._modelStructure.getFaceAttributes(b,
d)};g.prototype.getFaceProperty=function(b,d){return this._modelStructure.getFaceProperty(b,d)};g.prototype.setEdgeProperty=function(b,d,c){this._modelStructure.setEdgeProperty(b,d,c)};g.prototype.setFaceProperty=function(b,d,c){this._modelStructure.setFaceProperty(b,d,c)};g.prototype.getNodeMeshData=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a;return __generator(this,function(f){switch(f.label){case 0:e=this._modelStructure.gatherInstanceIncsFromNodeIds([b],7,d.Internal.Tree.WalkRestriction.None);
if(0===e.length)throw new d.CommunicatorError("Node does not refer to a mesh instance");if(2<e.length)throw new d.CommunicatorError("Node refers to multiple mesh instances");c=e;return[4,this._engine.getInstancesMeshData(c)];case 1:return a=f.sent(),[2,this._engine.getMeshData(a)]}})})};g.prototype.getNodeMatrix=function(b){return this._modelStructure.getMatrix(b)};g.prototype.setNodeMatrix=function(b,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrix(b,d,c)};g.prototype._setNodesMatrices=
function(b,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrices(b,d,c)};g.prototype.resetNodeMatrixToInitial=function(b){return this._modelStructure.resetToInitialMatrix(b)};g.prototype.getNodeNetMatrix=function(b){return this._modelStructure.getNetMatrix(b)};g.prototype.getNodeParent=function(b){return this._modelStructure.getParentId(b)};g.prototype.getNodeType=function(b){return this._modelStructure.getType(b)};g.prototype.getNodeProperties=function(b){return this._modelStructure.getProperties(b)};
g.prototype.addPropertyToNode=function(b,d,c){return this._modelStructure.addProperty(b,d,c)};g.prototype.setPhysicalProperties=function(b,d,c,a){return this._modelStructure.setPhysicalProperties(b,d,c,a)};g.prototype.requestNodes=function(b){return this._modelStructure.requestNodes(b)};g.prototype.getNodeName=function(b){return this._modelStructure.getName(b)||null};g.prototype.getNodeExchangeId=function(b){return this._modelStructure.getNodeExchangeId(b)};g.prototype.getFilters=function(){return this._modelStructure.getFilters()};
g.prototype.getFilterName=function(b){return this._modelStructure.getFilterName(b)};g.prototype.getFiltersWithNode=function(b){return this._modelStructure.getFiltersWithNode(b)};g.prototype.getNodesFromFiltersId=function(b){return this._modelStructure.getNodesFromFilterIds(b)};g.prototype.getLayers=function(){return this._modelStructure.getLayers()};g.prototype.getUniqueLayerNames=function(){return this._modelStructure.getUniqueLayerNames()};g.prototype.getLayerName=function(b){return this._modelStructure.getLayerName(b)};
g.prototype.getLayerIdsFromName=function(b){return this._modelStructure.getLayerIdsFromName(b)};g.prototype.getNodeLayerId=function(b){return this._modelStructure.getNodeLayerId(b)};g.prototype.getNodesFromLayer=function(b,d){return this._modelStructure.getRuntimeNodesFromLayer(b,d)};g.prototype.getNodesFromLayers=function(b,d){return this._modelStructure.getRuntimeNodesFromLayers(b,d)};g.prototype.getNodesFromLayerName=function(b,d){return this._modelStructure.getNodesFromLayerName(b,d)};g.prototype.getNodeVisibility=
function(b){return this._modelStructure.isVisible(b)};g.prototype.getBranchVisibility=function(b){b=this._modelStructure.getBranchVisibility(b);if(2===b)return d.BranchVisibility.Shown;if(1===b)return d.BranchVisibility.Hidden;console.assert(3===b);return d.BranchVisibility.Mixed};g.prototype.getDataFromIds=function(b){return this._engine.getDataFromIds(b)};g.prototype.getDataFromKeys=function(b){return this.getDataFromIds(b)};g.prototype.createMesh=function(b,d){return __awaiter(this,void 0,void 0,
function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._engine.createMesh(b)];case 1:return c=a.sent(),d&&d.doNotDelete&&this._preventMeshDeletion(c),[2,c]}})})};g._flatArrayToPairArray=function(b){for(var d=[],c=0;c<b.length;c+=2)d.push([b[c],b[c+1]]);return d};g._pairArrayToFlatArray=function(b){for(var d=[],c=0;c<b.length;c++){var a=b[c];d.push(a[0],a[1])}return d};g.prototype.getMeshIds=function(b){return __awaiter(this,void 0,void 0,function(){var e,c;return __generator(this,
function(a){switch(a.label){case 0:return e=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesMeshData(e)];case 1:return c=a.sent(),[2,g._flatArrayToPairArray(c)]}})})};g.prototype.replaceMesh=function(b,d){return this._engine.replaceMesh(b,d)};g.prototype.createMeshInstance=function(b,d,c,a){void 0===d&&(d=null);c||(c=!1);a||(a=!1);return this._createMeshInstance(b,d,c,a)};g.prototype._createMeshInstance=function(b,e,c,a){return __awaiter(this,
void 0,void 0,function(){var f,k,l,n,g,p,h,r;return __generator(this,function(m){switch(m.label){case 0:f=b.getMatrix();k=null!==f||null!==e;l=b.getCreationFlags();console.assert(!e||!a,"Out of hierarchy instances should not have a parent node.");n=null===e||this.getNodeVisibility(e);g=b;if(k||!n)g=b.copy(),g.setCreationFlags(l|d.MeshInstanceCreationFlags.Invisible);return[4,this._engine.createMeshInstance(g)];case 1:p=m.sent();h=this._modelStructure.createMeshInstance(p[0],p[1],b.getInstanceName(),
e,c,a);if(!k)return[3,3];r=f?f:new d.Matrix;return[4,this.setNodeMatrix(h,r,!0)];case 2:m.sent(),0===(l&d.MeshInstanceCreationFlags.Invisible)&&n&&this._engine.setPartVisibility(p,!0,!0),m.label=3;case 3:return null===e?[3,5]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[h],d.NodeSource.CreateInstance)];case 4:m.sent(),m.label=5;case 5:return[2,h]}})})};g.prototype.createPmiInstance=function(b,e,c,a,f){return __awaiter(this,void 0,void 0,function(){var k,l,n,g,p,h,r,w;
return __generator(this,function(m){switch(m.label){case 0:void 0===f&&(f=null);k=[];l=0;for(n=a;l<n.length;l++){g=n[l];p=this._modelStructure.lookupBodyInstance(g.bodyId);if(null===p)throw new d.InvalidNodeIdError(g.bodyId);h=d.Internal.Tree.ReferenceOnTopology.fromBodyInstance(p,g.subElementType,g.subElementIndex);k.push(h)}return[4,this._engine.createMeshInstance(b)];case 1:return r=m.sent(),w=this._modelStructure.createPmiInstance(r[0],r[1],e,c,k,b.getInstanceName(),f),null===f?[3,3]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded",
"subtreeLoaded",[w],d.NodeSource.CreatePmi)];case 2:m.sent(),m.label=3;case 3:return[2,w]}})})};g.prototype.createPMIInstance=function(b,d,c,a,f){return this.createPmiInstance(b,d,c,a,f)};g.prototype.createImage=function(b,d){return this._engine.createImage(b,d)};g.prototype.deleteImages=function(b){return this._engine.destroyImages(g._pairArrayToFlatArray(b))};g.prototype.setNodesTexture=function(b,d){b=this._getInstanceIncsFromLeafNodes(b);return this._engine.setTexture(b,d)};g.prototype.unsetNodesTexture=
function(b){b=this._getInstanceIncsFromLeafNodes(b);this._engine.unsetTexture(b)};g.prototype.deleteMeshes=function(b){return this._engine.destroyMeshes(g._pairArrayToFlatArray(b))};g.prototype.deleteMeshInstances=function(b){var e=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None),c=[];if(0<e.length){for(var a=0;a<b.length;a++)c.push(this._modelStructure.deleteNode(b[a]));c.push(this._engine.destroyLocalInstances(e))}return d.Util.waitForAll(c)};g.prototype._obtainLoadSubtreeConfig=
function(b){if(b[0]instanceof d.LoadSubtreeConfig)var e=b[0];else e=new d.LoadSubtreeConfig,e.additionalMatrix=b[0]||null,e.allowMissingExternalModels=!!b[1];return e.copy()};g.prototype.loadSubtreeFromXmlFile=function(b,e,c){for(var a=[],f=3;f<arguments.length;f++)a[f-3]=arguments[f];a=this._obtainLoadSubtreeConfig(a);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlFile(b,e,c,a)};g.prototype.loadSubtreeFromXmlBuffer=function(b,e,c){for(var a=[],f=3;f<arguments.length;f++)a[f-
3]=arguments[f];a=this._obtainLoadSubtreeConfig(a);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromXmlDoc(b,e,c,a)};g.prototype.loadSubtreeFromScsXmlFile=function(b,e,c){for(var a=[],f=3;f<arguments.length;f++)a[f-3]=arguments[f];a=this._obtainLoadSubtreeConfig(a);c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlFile(b,e,c,a)};g.prototype.loadSubtreeFromScsXmlBuffer=function(b,e,c){for(var a=[],f=3;f<arguments.length;f++)a[f-3]=arguments[f];a=this._obtainLoadSubtreeConfig(a);
c||(c=d.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlDoc(b,e,c,a)};g.prototype.loadSubtreeFromModel=function(b,d){for(var c=[],a=2;a<arguments.length;a++)c[a-2]=arguments[a];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromStream(b,d,c)};g.prototype.loadSubtreeFromScsFile=function(b,d){for(var c=[],a=2;a<arguments.length;a++)c[a-2]=arguments[a];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsFile(b,d,c)};g.prototype.loadSubtreeFromScsBuffer=
function(b,d){for(var c=[],a=2;a<arguments.length;a++)c[a-2]=arguments[a];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsBuffer(b,d,c)};g.prototype.loadSubtreeFromUrl=function(b,d){return this.loadSubtreeFromXmlFile(b,d)};g.prototype.loadSubtreeFromXML=function(b,d){return this.loadSubtreeFromXmlBuffer(b,d)};g.prototype.switchToModel=function(b){this._callbackManager.trigger("modelLoadBegin");return this._modelStructure.switchToModel(b)};g.prototype.createNode=function(b,
e,c,a,f,k){void 0===b&&(b=null);void 0===c&&(c=null);void 0===a&&(a=null);if(void 0===f||null===f)f=!0;b=this._modelStructure.createNode(b,e,c,a,f,k);null!==b&&(e=this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[b],d.NodeSource.CreateNode),e);return b};g.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._modelStructure.deleteNode(b)];case 1:return d.sent(),this._callbackManager.trigger("subtreeDeleted",
[b]),[2]}})})};g.prototype.createPart=function(b){void 0===b&&(b=null);return this._modelStructure.createPart(b)};g.prototype.setPart=function(b,d){return void 0===b||null===b||void 0===d||null===d?!1:this._modelStructure.setPart(b,d)};g.prototype.createAndAddRepresentationItem=function(b,d){if(void 0===b||null===b)return null;void 0===d&&(d=null);return this._modelStructure.createAndAddRepItem(b,d)};g.prototype.createAndAddBody=function(b,d){return this.createAndAddRepresentationItem(b,d)};g.prototype.getLowestAvailableNodeId=
function(){return this._modelStructure.getLowestAvailableNodeId()};g.prototype.getLowestAvailableNodeID=function(){return this.getLowestAvailableNodeId()};g.prototype.setInstanceModifier=function(b,d,c){this._setInstanceModifier(b,d,c,7);return Promise.resolve()};g.prototype._setInstanceModifier=function(b,e,c,a){e=this._modelStructure.gatherInstanceIncsFromNodeIds(e,a,d.Internal.Tree.WalkRestriction.None);0<e.length&&this._engine.setInstanceModifier(b,e,c)};g.prototype.getSCInstanceKey=function(b){b=
this._modelStructure.lookupBodyInstance(b);return null!==b?b.getInstanceInc():null};g.prototype.getNodeIDFromSCInstanceKey=function(b,d){return this._modelStructure.getNodeFromInstanceInc(!1,b,d,!1)};g.prototype.getPrimaryModelKey=function(){return this._engine.getPrimaryModelKey()};g.prototype.getPrimaryModelId=function(){return this.getPrimaryModelKey()};g.prototype.getAssociatedModelKey=function(b){b=this._modelStructure.getAssociatedModelKey(b);return Promise.resolve(b)};g.prototype.hasDepthRange=
function(b){b=this._getInstanceIncsFromLeafNodes(b);return this._engine.hasDepthRange(b)};g.prototype.setDepthRange=function(b,d,c){this._setDepthRange(b,d,c);return Promise.resolve()};g.prototype._setDepthRange=function(b,e,c){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);this._engine.setDepthRange(b,e,c)};g.prototype.unsetDepthRange=function(b){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetDepthRange(b)};
g.prototype._gatherInstanceIncsFromNodeIds=function(b,e){void 0===e&&(e=7);return this._modelStructure.gatherInstanceIncsFromNodeIds(b,e,d.Internal.Tree.WalkRestriction.None)};g.prototype._getInstanceIncsFromLeafNodes=function(b){for(var e=[],c=0;c<b.length;c++){var a=this._modelStructure.gatherInstanceIncsFromNodeIds([b[c]],7,d.Internal.Tree.WalkRestriction.None);if(2===a.length)e.push(a[0],a[1]);else throw new d.CommunicatorError("Non-leaf node encountered");}return e};g.prototype._getInstanceIncFromSingleLeafNode=
function(b){b=this._modelStructure.gatherInstanceIncsFromNodeIds([b],7,d.Internal.Tree.WalkRestriction.None);if(2===b.length)return b;throw new d.CommunicatorError("Non-leaf node encountered");};g.prototype.setMeshLevel=function(b,d){this._modelStructure.setMeshLevel(b,d);return Promise.resolve()};g.prototype.setEnableAutomaticUnitScaling=function(b){return this._modelStructure.setEnableAutomaticUnitScaling(b)};g.prototype.setBehaviorInitiallyHidden=function(b){return this._modelStructure.setBehaviorInitiallyHidden(b)};
g.prototype.isDrawing=function(){return this._modelStructure.isACadDrawing()};g.prototype.isMeasurable=function(){return this._modelStructure.isMeasurable()};g.prototype.getModelFileNameFromNode=function(b){return this._modelStructure.getModelFileNameFromNode(b)};g.prototype.getModelFileTypeFromNode=function(b){return this._modelStructure.getModelFileTypeFromNode(b)};g.prototype.getNodeGenericType=function(b){return this._modelStructure.getNodeGenericType(b)};g.prototype.getNodeGenericId=function(b){return this._modelStructure.getNodeGenericId(b)};
g.prototype.registerBimNodes=function(b,e,c){void 0===c&&(c=null);return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){a=this._modelStructure.lookupAnyTreeNode(b);if(null===a)return[2];"boolean"===typeof c&&(c=c?"TYPE":null);return[2,d.Internal.Tree.registerBimNodes(e,this._engine,this._modelStructure,a,c)]})})};g.prototype.getGenericTypeIdMap=function(){return this._modelStructure.getGenericTypeIdMap()};g.prototype.getIfcNodeIds=function(){return this.getGenericTypeIdMap()};
g.prototype.getIfcTypeByNodeId=function(b){return this._modelStructure.getNodeGenericType(b)};g.prototype.getNodesByGenericType=function(b){return this._modelStructure.getNodesByGenericType(b)};g.prototype.getNodesByIfcType=function(b){return this.getNodesByGenericType(b)};g.prototype.getGenericTypes=function(){return this._modelStructure.getGenericTypes()};g.prototype.getIfcTypes=function(){return this.getGenericTypes()};g.prototype.hasEffectiveGenericType=function(b,d){return this._modelStructure.hasEffectiveGenericType(b,
d)};g.prototype.registerIfcNodes=function(b,e){void 0===e&&(e=null);return this.registerBimNodes(b,d.Internal.Tree.ifcAttributeToBimMask,e)};g.prototype.isAnnotationView=function(b){return this._modelStructure.isAnnotationView(b)};g.prototype.setNodesCullingVector=function(b,d,c,a){this._setNodesCullingVector(b,d,c,a);return Promise.resolve()};g.prototype._setNodesCullingVector=function(b,e,c,a){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);return this._engine.setCullingVector(b,
e,c,a)};g.prototype.unsetNodesCullingVectors=function(b){this._unsetNodesCullingVectors(b);return Promise.resolve()};g.prototype._unsetNodesCullingVectors=function(b){b=this._modelStructure.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);this._engine.unsetCullingVector(b)};g.prototype.getNodesCullingVectors=function(b){b=this._getInstanceIncsFromLeafNodes(b);return this._engine.getCullingVector(b)};g.prototype.getNodeIdOffset=function(b){return this._modelStructure.getIdOffset(b)};
g.prototype.isNodeLoaded=function(b){return this._modelStructure.isNodeLoaded(b)};g.prototype.triangulatePolygon=function(b,e){e=d.Internal.toVec3(e);return this._engine.triangulatePolygon(b,e)};g.prototype.setNodesLinePattern=function(b,d,c,a){b=this._gatherInstanceIncsFromNodeIds(b);this._engine.setLinePattern(b,d,c,a)};g.prototype.unsetNodesLinePattern=function(b){b=this._gatherInstanceIncsFromNodeIds(b);this._engine.unsetLinePattern(b)};g.prototype._hwfAwaitAssemblyTreeReady=function(){return __awaiter(this,
void 0,void 0,function(){var b,e,c;return __generator(this,function(a){switch(a.label){case 0:b=this.getAbsoluteRootNode();e=this._modelStructure.lookupAnyTreeNode(b);if(null===e)throw new d.InternalLogicError;c=d.Internal.Tree.towardLoadContext(e);return[4,d.Internal.Tree.WalkerAsync.forceLazyPromises(c)];case 1:return a.sent(),[4,d.Internal.Tree.markContextsLoaded([c])];case 2:return a.sent(),[2]}})})};g.prototype.getNodeUserDataIndices=function(b){return this._modelStructure.getUserDataIndices(b)};
g.prototype.getNodeUserData=function(b,d){return this._modelStructure.getUserData(b,d)};g.prototype.getNodeIdsByGenericIds=function(b){for(var d=[],c=0;c<b.length;c++){var a=this._modelStructure.getNodeByGenericId(b[c]);null!==a&&d.push(a)}return d};g.prototype.getNodeIdsByIfcGuids=function(b){return this.getNodeIdsByGenericIds(b)};g.prototype._getModelStructure=function(){return this._modelStructure};g.prototype.isWithinExternalModel=function(b){return this._modelStructure.isWithinExternalModel(b)};
g.prototype._firstAssemblyDataHeader=function(){return this._modelStructure.firstAssemblyDataHeader()};__decorate([g.deprecated],g.prototype,"getPMIs",null);__decorate([g.deprecated],g.prototype,"getPMIType",null);__decorate([g.deprecated],g.prototype,"getPMISubtype",null);__decorate([g.deprecated],g.prototype,"setPMIColor",null);__decorate([g.deprecated],g.prototype,"getPMIColor",null);__decorate([g.deprecated],g.prototype,"setPMIColorOverride",null);__decorate([g.deprecated],g.prototype,"getPMIColorOverride",
null);__decorate([g.deprecated],g.prototype,"setNodesTransparency",null);__decorate([g.deprecated],g.prototype,"setNodesTransparencies",null);__decorate([g.deprecated],g.prototype,"resetModelTransparency",null);__decorate([g.deprecated],g.prototype,"resetNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesTransparency",null);__decorate([g.deprecated],g.prototype,"getNodesEffectiveTransparency",null);__decorate([g.deprecated],g.prototype,"getRootNode",null);__decorate([g.deprecated],
g.prototype,"getUnitMultiplier",null);__decorate([g.deprecated],g.prototype,"createCADView",null);__decorate([g.deprecated],g.prototype,"getCadViews",null);__decorate([g.deprecated],g.prototype,"getCADViews",null);__decorate([g.deprecated],g.prototype,"activateCADView",null);__decorate([g.deprecated],g.prototype,"getCADViewPMIs",null);__decorate([g.deprecated],g.prototype,"getCADConfigurations",null);__decorate([g.deprecated],g.prototype,"getCADDefaultConfiguration",null);__decorate([g.deprecated],
g.prototype,"getCADActiveConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADConfiguration",null);__decorate([g.deprecated],g.prototype,"activateCADDefaultConfiguration",null);__decorate([g.deprecated],g.prototype,"getDataFromKeys",null);__decorate([g.deprecated],g.prototype,"createPMIInstance",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromUrl",null);__decorate([g.deprecated],g.prototype,"loadSubtreeFromXML",null);__decorate([g.deprecated],g.prototype,"createAndAddBody",
null);__decorate([g.deprecated],g.prototype,"getLowestAvailableNodeID",null);__decorate([g.deprecated],g.prototype,"getSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getNodeIDFromSCInstanceKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelKey",null);__decorate([g.deprecated],g.prototype,"getPrimaryModelId",null);__decorate([g.deprecated],g.prototype,"getIfcNodeIds",null);__decorate([g.deprecated],g.prototype,"getIfcTypeByNodeId",null);__decorate([g.deprecated],g.prototype,
"getNodesByIfcType",null);__decorate([g.deprecated],g.prototype,"getIfcTypes",null);__decorate([g.deprecated],g.prototype,"getNodeIdsByIfcGuids",null);return g}();d.Model=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b){var e=this;this._position=new d.OverlayUnitPoint(0,d.OverlayUnit.Pixels,0,d.OverlayUnit.Pixels);this._viewportSize=new d.OverlayUnitPoint(200,d.OverlayUnit.Pixels,200,d.OverlayUnit.Pixels);this._anchor=d.OverlayAnchor.UpperRightCorner;this._dimension=3;this._fieldSize=8;this._instanceKeys=[];this._enabled=!1;this._textImageId=null;this._selectionFaceColor=new d.Color(76,186,240);this._outlineColor=new d.Color(17,94,133);this._lastSelectedNodes=[];this._nodeIds=
[];this._adjacentFaces=[];this._preserveModelUp=!0;this._cameraRotation=0;this._lastFaceIndex=this._lastCamera=this._lastOrientation=null;this._textWidths=[];this._sceneReadyCompleted=d.Util.OpenPromise.create();this._geometryCreated=this._texturesReady=!1;this._viewer=b;this._fontSize=25;this._fontInfo=this._fontSize+"px Arial";this._textureSize=512;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._createViewport()];case 1:return c.sent(),this._updateVisibility(),[4,this._createGeometry()];case 2:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._sceneReadyCompleted];case 1:return c.sent(),[2,this._setTextures()]}})})},_firstAttachment:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,
this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},camera:function(){e._onCameraUpdate()},overlayViewportSet:function(c){c===d.BuiltinOverlayIndex.NavCube&&e._onViewportSet()},transitionEnd:function(){e._onCameraUpdate()},viewAxes:function(){e._updateOrientationMatrices()},_resetOpacity:function(){e._viewer.model.setNodesOpacity(e._nodeIds.slice(1),0)},viewOrientation:function(c){e._lastOrientation=c;e._cameraRotation=0;e._lastCamera=e._viewer.view.getCamera()}})}g.prototype.setAnchor=
function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=b,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};g.prototype.getAnchor=function(){return this._anchor};g.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};g.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};g.prototype.setPreserveModelUp=
function(b){this._preserveModelUp=b};g.prototype.getPreserveModelUp=function(){return this._preserveModelUp};g.prototype._updateVisibility=function(){this._enabled&&this._texturesReady?this._showOverlay():this._hideOverlay()};g.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!1)};g.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.NavCube,!0)};g.prototype.getEnabled=function(){return this._enabled};
g.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.NavCube};g.prototype._setTextures=function(){return __awaiter(this,void 0,void 0,function(){var b,d,c,a,f;return __generator(this,function(k){switch(k.label){case 0:if(!this._textImageId||0<this._nodeIds.length||0>=this._instanceKeys.length)return[2];b=this._viewer.model;d=0;for(c=this._instanceKeys;d<c.length;d++)a=c[d],f=b._getNodeFromInstanceInc(!0,0,a,!0),this._nodeIds.push(f),b._preventNodeDeletion(f);b.setNodesOpacity(this._nodeIds.slice(1),
0);return[4,b.setNodesTexture([this._nodeIds[0]],{imageId:this._textImageId})];case 1:return k.sent(),this._texturesReady=!0,this._updateVisibility(),[2]}})})};g.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.NavCube,this._anchor,this._position.x,d.OverlayUnit.Pixels,this._position.y,d.OverlayUnit.Pixels,this._viewportSize.x,d.OverlayUnit.Pixels,this._viewportSize.y,d.OverlayUnit.Pixels)};g.prototype._createViewport=function(){var b=this._viewer.overlayManager;
this._updateViewport();var e=new d.Camera;e.setPosition(new d.Point3(0,0,10));e.setTarget(d.Point3.zero());e.setUp(new d.Point3(0,1,0));e.setWidth(this._fieldSize);e.setHeight(this._fieldSize);e.setProjection(d.Projection.Orthographic);b.setCamera(d.BuiltinOverlayIndex.NavCube,e)};g.prototype._onViewportSet=function(){var b=this._viewer.overlayManager,e=b._getViewportPosition(d.BuiltinOverlayIndex.NavCube),c=b._getViewportSize(d.BuiltinOverlayIndex.NavCube);b=b.getViewportAnchor(d.BuiltinOverlayIndex.NavCube);
null!==e&&null!==c&&null!==b&&(this._position=e,this._viewportSize=c,this._anchor=b)};g.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var b,e,c,a,f,k,l,n,g,p,h,r,w,t,u,v,z,x,y,A,B,D,C,F,E,H,G,I,K,J,L,M,N;return __generator(this,function(m){switch(m.label){case 0:if(this._geometryCreated)return[2];b=this._initializeTextures();e=0;c=[];c.push(this._createCube(e++,this._dimension));a=[];a.push(this._makeRotationMatrixX(-.5*Math.PI));a.push(this._makeRotationMatrixX(.5*
Math.PI));a.push(this._makeRotationMatrixY(.5*Math.PI));a.push(this._makeRotationMatrixY(-.5*Math.PI));a.push(this._makeRotationMatrixZ(.5*Math.PI));a.push(this._makeRotationMatrixZ(-.5*Math.PI));f=this._dimension/4;k=this._dimension/2;l=[];n=new d.Point3(0,0,0);g=new d.Point3(0,0,0);p=new d.Point3(0,0,0);for(h=0;h<a.length;h++)r=this._dimension,w=a[h],t=!1,h===a.length-1&&(t=!0,n.z+=this._dimension+.02),g=new d.Point3(.5*r-f,-.5*r+f,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-f,g.z),c.push(this._createSelectionFace(e++,
g,p,w,t,n,l)),g=new d.Point3(-.5*r,-.5*r+f,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-f,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(-.5*r,.5*r,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-f,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(.5*r-f,.5*r,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-f,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(-.5*r+f,.5*r,-.5*r+-.01),p=new d.Point3(g.x+k,g.y-f,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),
g=new d.Point3(-.5*r+f,-.5*r+f,-.5*r+-.01),p=new d.Point3(g.x+k,g.y-f,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(-.5*r,.5*r-f,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-k,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(.5*r-f,.5*r-f,-.5*r+-.01),p=new d.Point3(g.x+f,g.y-k,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l)),g=new d.Point3(-.5*r+f,.5*r-f,-.5*r+-.01),p=new d.Point3(g.x+k,g.y-k,g.z),c.push(this._createSelectionFace(e++,g,p,w,t,n,l));for(u=
0;u<l.length;u++){v=Math.floor(u/9);z=[];x=l[u];for(y=0;y<x.length;y+=2)for(A=x[y],B=x[y+1],D=0;D<l.length;D++)if(C=Math.floor(D/9),C!==v)for(F=l[D],E=0;E<F.length;E+=2)H=F[E],G=F[E+1],this._isSameEdge(A,B,H,G)&&z.push(D);this._adjacentFaces.push(z)}return[4,Promise.all(c)];case 1:I=m.sent();this._updateOrientationMatrices();this._onCameraUpdate();K=[];J=0;for(L=I;J<L.length;J++)M=L[J],K.push(0,M);N=this._getScEngine();N.setPartVisibility(K,!0,!0);this._geometryCreated=!0;return[2,b]}})})};g.prototype._createTexture=
function(b,e){b=b.getImageData(0,0,e,e).data;e=new ArrayBuffer(e*e*3);e=new Uint8Array(e);for(var c=0,a=0;a<b.length;a+=4)e[c]=b[a],e[c+1]=b[a],e[c+2]=b[a],c+=3;return this._viewer.model.createImage({format:d.ImageFormat.Rgb24,data:e,width:this._textureSize,height:this._textureSize})};g.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};g.prototype.insideOverlay=function(b){var d=this._viewer.overlayManager._toPixelPoint(this._viewportSize),c=this._getOverlayOffset();return b.x>=
c.x&&b.y>=c.y&&b.x<=c.x+d.x&&b.y<=c.y+d.y};g.prototype._getOverlayOffset=function(){var b=this._viewer.overlayManager._toPixelPoint(this._viewportSize);return this._viewer.overlayManager._getOverlayOffset(this._anchor,b)};g.prototype._getViewportSize=function(){return this._viewportSize};g.prototype._getViewportPixelSize=function(){return this._viewer.overlayManager._toPixelPoint(this._viewportSize)};g.prototype._onNoSelection=function(){this._enabled&&0<this._lastSelectedNodes.length&&(this._viewer.model.setNodesOpacity(this._lastSelectedNodes,
0),this._lastSelectedNodes.length=0)};g.prototype.onClickSelection=function(b){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(c){switch(c.label){case 0:console.assert(this._enabled);if(null===b||!b.isFaceSelection()||b.overlayIndex()!==d.BuiltinOverlayIndex.NavCube)return this._onNoSelection(),[2];e=this._getFaceIndexFromNodeId(b.getNodeId());return e<this._nodeIds.length&&0<e?[4,this._setViewOrientation(e)]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})};
g.prototype.onMoveSelection=function(b){var e=this;console.assert(this._enabled);if(null!==b&&b.isFaceSelection()&&b.overlayIndex()===d.BuiltinOverlayIndex.NavCube){var c=b.getNodeId(),a=this._getFaceIndexFromNodeId(c)-1;0<=a&&c!==this._nodeIds[0]&&this._viewer.pauseRendering(function(){var f=e._viewer.model;f.setNodesOpacity(e._lastSelectedNodes,0);e._lastSelectedNodes.length=0;e._lastSelectedNodes.push(c);console.assert(a<e._adjacentFaces.length);for(var b=0,d=e._adjacentFaces[a];b<d.length;b++){var g=
e._getNodeIdFromFaceIndex(d[b]+1);e._lastSelectedNodes.push(g)}f.setNodesOpacity(e._lastSelectedNodes,1)})}else this._onNoSelection()};g.prototype._getViewOrientationFromFaceIndex=function(b){switch(b){case 1:b=d.ViewOrientation.LeftBottomBack;break;case 2:b=d.ViewOrientation.LeftBottomFront;break;case 3:b=d.ViewOrientation.LeftTopFront;break;case 4:b=d.ViewOrientation.LeftTopBack;break;case 5:b=d.ViewOrientation.LeftTop;break;case 6:b=d.ViewOrientation.LeftBottom;break;case 7:b=d.ViewOrientation.LeftFront;
break;case 8:b=d.ViewOrientation.LeftBack;break;case 9:b=d.ViewOrientation.Left;break;case 10:b=d.ViewOrientation.RightTopBack;break;case 11:b=d.ViewOrientation.RightTopFront;break;case 12:b=d.ViewOrientation.RightBottomFront;break;case 13:b=d.ViewOrientation.RightBottomBack;break;case 14:b=d.ViewOrientation.RightBottom;break;case 15:b=d.ViewOrientation.RightTop;break;case 16:b=d.ViewOrientation.RightFront;break;case 17:b=d.ViewOrientation.RightBack;break;case 18:b=d.ViewOrientation.Right;break;case 19:b=
d.ViewOrientation.BackTopRight;break;case 20:b=d.ViewOrientation.BackBottomRight;break;case 21:b=d.ViewOrientation.BackBottomLeft;break;case 22:b=d.ViewOrientation.BackTopLeft;break;case 23:b=d.ViewOrientation.BackLeft;break;case 24:b=d.ViewOrientation.BackRight;break;case 25:b=d.ViewOrientation.BackBottom;break;case 26:b=d.ViewOrientation.BackTop;break;case 27:b=d.ViewOrientation.Back;break;case 28:b=d.ViewOrientation.FrontBottomRight;break;case 29:b=d.ViewOrientation.FrontTopRight;break;case 30:b=
d.ViewOrientation.FrontTopLeft;break;case 31:b=d.ViewOrientation.FrontBottomLeft;break;case 32:b=d.ViewOrientation.FrontLeft;break;case 33:b=d.ViewOrientation.FrontRight;break;case 34:b=d.ViewOrientation.FrontTop;break;case 35:b=d.ViewOrientation.FrontBottom;break;case 36:b=d.ViewOrientation.Front;break;case 37:b=d.ViewOrientation.BottomRightFront;break;case 38:b=d.ViewOrientation.BottomLeftFront;break;case 39:b=d.ViewOrientation.BottomLeftBack;break;case 40:b=d.ViewOrientation.BottomRightBack;break;
case 41:b=d.ViewOrientation.BottomBack;break;case 42:b=d.ViewOrientation.BottomFront;break;case 43:b=d.ViewOrientation.BottomLeft;break;case 44:b=d.ViewOrientation.BottomRight;break;case 45:b=d.ViewOrientation.Bottom;break;case 46:b=d.ViewOrientation.TopLeftBack;break;case 47:b=d.ViewOrientation.TopRightBack;break;case 48:b=d.ViewOrientation.TopRightFront;break;case 49:b=d.ViewOrientation.TopLeftFront;break;case 50:b=d.ViewOrientation.TopFront;break;case 51:b=d.ViewOrientation.TopBack;break;case 52:b=
d.ViewOrientation.TopRight;break;case 53:b=d.ViewOrientation.TopLeft;break;case 54:b=d.ViewOrientation.Top;break;default:b=d.ViewOrientation.Front}return b};g.prototype._setViewOrientation=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,l,g,m,p,h,r,w,t,u,v;return __generator(this,function(n){switch(n.label){case 0:return e=this._viewer.view,c=this._getViewOrientationFromFaceIndex(b),[4,e.getViewOrientationCamera(c,void 0,this._preserveModelUp)];case 1:a=n.sent();f=!1;console.assert(0<=
b-1);console.assert(b-1<this._adjacentFaces.length);k=this._adjacentFaces[b-1];l=0;for(g=k;l<g.length;l++)if(m=g[l],p=m+1,p===this._lastFaceIndex){f=!0;break}this._lastFaceIndex=b;h=null!==this._lastCamera&&this._lastCamera.equals(e.getCamera());this._cameraRotation=(r=this._lastOrientation===c||f)&&h?this._preserveModelUp?(this._cameraRotation+90)%360:90:0;this._lastOrientation=c;0<this._cameraRotation&&(w=d.Point3.subtract(a.getPosition(),a.getTarget()).normalize(),t=d.Matrix.createFromOffAxisRotation(w,
this._cameraRotation),u=a.getUp(),t.transform(u,u),a.setUp(u));return[4,e.fitWorld(d.DefaultTransitionDuration,a)];case 2:n.sent();v=this._viewer.model.getAbsoluteRootNode();if(0===this._viewer.model.getNodeChildren(v).length)return[2,this._getScEngine().markCameraAsEmpty()];this._lastCamera=e.getCamera();return[2]}})})};g.prototype._getScEngine=function(){return this._viewer._getScEngine()};g.prototype._createInstance=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f,k,l;return __generator(this,
function(g){switch(g.label){case 0:return[4,this._viewer.model.createMesh(b)];case 1:return c=g.sent(),a=new d.MeshInstanceData(c),a.setCreationFlags(d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.Invisible),a.setOverlayIndex(d.BuiltinOverlayIndex.NavCube),f=this._getScEngine(),[4,f.createMeshInstance(a)];case 2:return k=g.sent(),l=k[1],this._instanceKeys[e]=
l,[2,l]}})})};g.prototype._createCube=function(b,e){for(var c=[],a=[],f=[],k=[],l=this._textWidths[0],g=0,m=this._textWidths;g<m.length;g++){var p=m[g];p>l&&(l=p)}l+=10;c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));a.push(new d.Point3(0,1,0));a.push(new d.Point3(0,1,0));a.push(new d.Point3(0,1,0));a.push(new d.Point3(0,
1,0));a.push(new d.Point3(0,1,0));a.push(new d.Point3(0,1,0));g=22/this._textureSize;m=82/this._textureSize;g=1-g;m=1-m;var h=(l-this._textWidths[0])/2;p=-(h/this._textureSize);h=(this._textWidths[0]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*
e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));a.push(new d.Point3(0,-1,0));a.push(new d.Point3(0,-1,0));a.push(new d.Point3(0,-1,0));a.push(new d.Point3(0,
-1,0));a.push(new d.Point3(0,-1,0));a.push(new d.Point3(0,-1,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[1])/2;p=-(h/this._textureSize);h=(this._textWidths[1]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*
e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));a.push(new d.Point3(-1,0,0));a.push(new d.Point3(-1,0,0));a.push(new d.Point3(-1,0,0));a.push(new d.Point3(-1,
0,0));a.push(new d.Point3(-1,0,0));a.push(new d.Point3(-1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[2])/2;p=-(h/this._textureSize);h=(this._textWidths[2]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));k.push(new d.Point3(-.5*e,.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*e,.5*e,.5*e));k.push(new d.Point3(-.5*
e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,-.5*e,-.5*e));k.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));a.push(new d.Point3(1,0,0));a.push(new d.Point3(1,0,0));a.push(new d.Point3(1,0,0));a.push(new d.Point3(1,
0,0));a.push(new d.Point3(1,0,0));a.push(new d.Point3(1,0,0));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[3])/2;p=-(h/this._textureSize);h=(this._textWidths[3]+h)/this._textureSize;f.push(new d.Point2(h,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));k.push(new d.Point3(.5*e,.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*
e,.5*e));k.push(new d.Point3(.5*e,-.5*e,.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,-.5*e,-.5*e));k.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,.5*e,-.5*e));c.push(new d.Point3(.5*e,-.5*e,-.5*e));c.push(new d.Point3(-.5*e,.5*e,-.5*e));a.push(new d.Point3(0,0,-1));a.push(new d.Point3(0,0,-1));a.push(new d.Point3(0,0,-1));a.push(new d.Point3(0,
0,-1));a.push(new d.Point3(0,0,-1));a.push(new d.Point3(0,0,-1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[4])/2;p=-(h/this._textureSize);h=(this._textWidths[4]+h)/this._textureSize;f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,g));c.push(new d.Point3(-.5*e,.5*e,.5*e));c.push(new d.Point3(-.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(-.5*
e,.5*e,.5*e));c.push(new d.Point3(.5*e,-.5*e,.5*e));c.push(new d.Point3(.5*e,.5*e,.5*e));a.push(new d.Point3(0,0,1));a.push(new d.Point3(0,0,1));a.push(new d.Point3(0,0,1));a.push(new d.Point3(0,0,1));a.push(new d.Point3(0,0,1));a.push(new d.Point3(0,0,1));g-=60/this._textureSize;m-=60/this._textureSize;h=(l-this._textWidths[5])/2;p=-(h/this._textureSize);h=(this._textWidths[5]+h)/this._textureSize;f.push(new d.Point2(p,g));f.push(new d.Point2(p,m));f.push(new d.Point2(h,m));f.push(new d.Point2(p,
g));f.push(new d.Point2(h,m));f.push(new d.Point2(h,g));e=new d.MeshData;e.setFaceWinding(d.FaceWinding.CounterClockwise);l=[];m=[];p=[];for(g=h=0;g<c.length;g++){var r=c[g];l.push(r.x);l.push(r.y);l.push(r.z);r=a[g];m.push(r.x);m.push(r.y);m.push(r.z);r=f[g];p.push(r.x);p.push(r.y);if(18<=l.length){r=[[0,255,0,255],[0,255,0,255],[255,0,0,255],[255,0,0,255],[0,0,255,255],[0,0,255,255]][h];for(var w=[],t=0;6>t;t++)w.push(r[0]),w.push(r[1]),w.push(r[2]),w.push(r[3]);e.addFaces(l,m,new Uint8Array(w),
p);l=[];m=[];p=[];++h}}l=[];c=new Uint8Array(4*k.length);for(g=0;g<k.length;g++)a=k[g],l.push(a.x),l.push(a.y),l.push(a.z),a=4*g,c[a]=this._outlineColor.r,c[a+1]=this._outlineColor.g,c[a+2]=this._outlineColor.b,c[a+3]=255;e.addPolyline(l,c);return this._createInstance(e,b)};g.prototype._onCameraUpdate=function(){var b=new d.Camera,e=this._viewer.view.getCamera();b.setPosition(e.getPosition().subtract(e.getTarget()).normalize());b.setTarget(d.Point3.zero());b.setUp(e.getUp());b.setProjection(d.Projection.Orthographic);
b.setWidth(this._fieldSize);b.setHeight(this._fieldSize);this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.NavCube,b)};g.prototype._updateOrientationMatrices=function(){var b=this._viewer.model.getViewAxes(),e=b.upVector.copy(),c=b.frontVector.copy(),a=d.Point3.cross(e,c.copy().scale(-1));b=new d.Matrix;b.m[0]=-c.x;b.m[1]=-c.y;b.m[2]=-c.z;b.m[4]=a.x;b.m[5]=a.y;b.m[6]=a.z;b.m[8]=e.x;b.m[9]=e.y;b.m[10]=e.z;e=this._getScEngine();c=[];a=0;for(var f=this._instanceKeys;a<f.length;a++)c.push(0,
f[a]);e.setInstancesMatrix(c,b)};g.prototype._createSelectionFace=function(b,e,c,a,f,k,l){var g=new d.MeshData;g.setFaceWinding(d.FaceWinding.CounterClockwise);var m=[];this._createQuad(e,c,m,a,k,f);e=[];c=[];a=[];for(k=0;k<m.length;k++){var p=m[k];e.push(p.x);e.push(p.y);e.push(p.z);c.push(0);c.push(0);c.push(-1);a.push(this._selectionFaceColor.r);a.push(this._selectionFaceColor.g);a.push(this._selectionFaceColor.b);a.push(128)}k=[];p=[this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,
255,this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255];g.addFaces(e,c,new Uint8Array(a));e=[];f?(e.push(m[4].x,m[4].y,m[4].z),e.push(m[5].x,m[5].y,m[5].z)):(e.push(m[0].x,m[0].y,m[0].z),e.push(m[1].x,m[1].y,m[1].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];e.push(m[1].x,m[1].y,m[1].z);e.push(m[2].x,m[2].y,m[2].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];
e.push(m[3].x,m[3].y,m[3].z);e.push(m[4].x,m[4].y,m[4].z);g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));e=[];f?(e.push(m[3].x,m[3].y,m[3].z),e.push(m[2].x,m[2].y,m[2].z)):(e.push(m[5].x,m[5].y,m[5].z),e.push(m[3].x,m[3].y,m[3].z));g.addPolyline(e,new Uint8Array(p));k.push(new d.Point3(e[0],e[1],e[2]),new d.Point3(e[3],e[4],e[5]));l.push(k);return this._createInstance(g,b)};g.prototype._createQuad=function(b,e,c,a,f,k){void 0===k&&(k=!1);b=new d.Point3(b.x,
b.y,b.z);e=new d.Point3(e.x,e.y,e.z);f&&(b.x+=f.x,b.y+=f.y,b.z+=f.z,e.x+=f.x,e.y+=f.y,e.z+=f.z);f=c.length;var l=new d.Point3(e.x,e.y,b.z);l=a.transform(l);c.push(l);l=new d.Point3(b.x,e.y,b.z);l=a.transform(l);c.push(l);l=new d.Point3(b.x,b.y,b.z);l=a.transform(l);c.push(l);l=new d.Point3(e.x,b.y,b.z);l=a.transform(l);c.push(l);l=new d.Point3(e.x,e.y,b.z);l=a.transform(l);c.push(l);l=new d.Point3(b.x,b.y,b.z);l=a.transform(l);c.push(l);if(k)for(a=0;3>a;a++)k=f+a,b=c[f+a],b=new d.Point3(b.x,b.y,b.z),
e=f+(6-a-1),c[k].x=c[e].x,c[k].y=c[e].y,c[k].z=c[e].z,c[e].x=b.x,c[e].y=b.y,c[e].z=b.z};g.prototype._makeRotationMatrixX=function(b){var e=Math.cos(b);b=Math.sin(b);var c=new d.Matrix;c.m[5]=e;c.m[6]=-b;c.m[9]=b;c.m[10]=e;return c};g.prototype._makeRotationMatrixY=function(b){var e=Math.cos(b);b=Math.sin(b);var c=new d.Matrix;c.m[0]=e;c.m[2]=b;c.m[8]=-b;c.m[10]=e;return c};g.prototype._makeRotationMatrixZ=function(b){var e=Math.cos(b);b=Math.sin(b);var c=new d.Matrix;c.m[0]=e;c.m[1]=-b;c.m[4]=b;c.m[5]=
e;return c};g.prototype._getFaceIndexFromNodeId=function(b){for(var d=0;d<this._nodeIds.length;d++)if(this._nodeIds[d]===b)return d;return-1};g.prototype._getNodeIdFromFaceIndex=function(b){return this._nodeIds[b]};g.prototype._isSameEdge=function(b,e,c,a){var f=d.Point3.subtract(b,c).squaredLength()+d.Point3.subtract(e,a).squaredLength();b=d.Point3.subtract(e,c).squaredLength()+d.Point3.subtract(b,a).squaredLength();return.03>Math.min(f,b)};g.prototype._initializeTextures=function(){return __awaiter(this,
void 0,void 0,function(){var b,d,c,a,f,k,l;return __generator(this,function(e){switch(e.label){case 0:b=document.createElement("canvas");b.width=this._textureSize;b.height=this._textureSize;d=b.getContext("2d");c=2*(this._fontSize+5);d.beginPath();d.rect(0,0,this._textureSize,this._textureSize);d.fillStyle="gray";d.fill();d.fillStyle="black";d.font=this._fontInfo;for(a=0;a<g._faceTexts.length;a++)f=g._faceTexts[a],d.fillText(f,0,c*(a+1)),k=d.measureText(f),this._textWidths.push(k.width);return[4,
this._createTexture(d,this._textureSize)];case 1:return this._textImageId=l=e.sent(),[2]}})})};g._faceTexts="LEFT RIGHT FRONT BACK BOTTOM TOP".split(" ");return g}();d.NavCube=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b){var e=this;this._operatorStack=[];this._operators=new Map;this._customOperatorIdCount=0;this._customOperatorIdIndex=1E4;this._eventSequencePromise=Promise.resolve();this._events=[];this._viewer=b;this._viewer.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){var c,a=this;return __generator(this,function(f){c=[];this._operators.forEach(function(f,b){f=a._deactivateOperator(b);void 0!==f&&c.push(f);f=a._activateOperator(b);
void 0!==f&&c.push(f)});return[2,d.Util.waitForAll(c)]})})}})}g.prototype._shutdown=function(){for(;void 0!==this.pop(););};g.prototype._registerOperator=function(b,d){this._operators.set(b,d)};g.prototype.registerCustomOperator=function(b){var d=this._customOperatorIdIndex+this._customOperatorIdCount++;this._operators.set(d,b);return d};g.prototype.unregisterCustomOperator=function(b){b>=this._customOperatorIdIndex&&this._operators.delete(b)};g.prototype.replaceOperator=function(b,d){d=this.getOperator(d);
return null!==d?(this._operators.set(b,d),!0):!1};g.prototype.indexOf=function(b){for(var d=this.size()-1;0<=d;d--)if(this._operatorStack[d]===b)return d;return-1};g.prototype.push=function(b){return this._isValid(b)&&!this._contains(b)?(this._operatorStack.push(b),this._activateOperator(b),!0):!1};g.prototype.set=function(b,d){var c=this._operatorStack[d];return b===c?!1:this._isValid(b)&&!this._contains(b)?(this._deactivateOperator(c),this._activateOperator(b),this._operatorStack[d]=b,!0):!1};g.prototype.pop=
function(){var b=this._operatorStack.pop();void 0!==b&&this._deactivateOperator(b);return b};g.prototype.remove=function(b){var d=this.indexOf(b);-1!==d&&(this._operatorStack.splice(d,1),this._deactivateOperator(b))};g.prototype.peek=function(){return 0<this.size()?this._operatorStack[this.size()-1]:d.OperatorId.Invalid};g.prototype.clear=function(){for(var b=this.size()-1;0<=b;b--)this.pop()};g.prototype.size=function(){return this._operatorStack.length};g.prototype.getOperator=function(b){b=this._operators.get(b);
return void 0!==b?b:null};g.prototype._injectEvent=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f;return __generator(this,function(k){switch(k.label){case 0:c=this.size()-1,k.label=1;case 1:if(!(0<=c))return[3,37];a=this._operators.get(this._operatorStack[c]);if(void 0===a)return[3,33];f=e;switch(f){case d.EventType.KeyDown:return[3,2];case d.EventType.KeyUp:return[3,5];case d.EventType.MouseDown:return[3,8];case d.EventType.MouseMove:return[3,11];case d.EventType.MouseUp:return[3,
14];case d.EventType.Mousewheel:return[3,17];case d.EventType.TouchStart:return[3,20];case d.EventType.TouchMove:return[3,23];case d.EventType.TouchEnd:return[3,26];case d.EventType.ViewOrientationChange:return[3,29]}return[3,32];case 2:return a.onKeyDown?[4,a.onKeyDown(b)]:[3,4];case 3:k.sent(),k.label=4;case 4:return[3,33];case 5:return a.onKeyUp?[4,a.onKeyUp(b)]:[3,7];case 6:k.sent(),k.label=7;case 7:return[3,33];case 8:return a.onMouseDown?[4,a.onMouseDown(b)]:[3,10];case 9:k.sent(),k.label=10;
case 10:return[3,33];case 11:return a.onMouseMove?[4,a.onMouseMove(b)]:[3,13];case 12:k.sent(),k.label=13;case 13:return[3,33];case 14:return a.onMouseUp?[4,a.onMouseUp(b)]:[3,16];case 15:k.sent(),k.label=16;case 16:return[3,33];case 17:return a.onMousewheel?[4,a.onMousewheel(b)]:[3,19];case 18:k.sent(),k.label=19;case 19:return[3,33];case 20:return a.onTouchStart?[4,a.onTouchStart(b)]:[3,22];case 21:k.sent(),k.label=22;case 22:return[3,33];case 23:return a.onTouchMove?[4,a.onTouchMove(b)]:[3,25];
case 24:k.sent(),k.label=25;case 25:return[3,33];case 26:return a.onTouchEnd?[4,a.onTouchEnd(b)]:[3,28];case 27:k.sent(),k.label=28;case 28:return[3,33];case 29:return a.onViewOrientationChange?[4,a.onViewOrientationChange()]:[3,31];case 30:k.sent(),k.label=31;case 31:return[3,33];case 32:d.Util.TypeAssertNever(e),k.label=33;case 33:return b.getHandled()?e!==d.EventType.MouseUp&&e!==d.EventType.TouchEnd?[3,35]:[4,this._stopInteraction()]:[3,36];case 34:k.sent(),k.label=35;case 35:return[3,37];case 36:return c--,
[3,1];case 37:return[2]}})})};g.prototype.injectEvent=function(b,d){return __awaiter(this,void 0,void 0,function(){var c=this;return __generator(this,function(a){this._events.push({event:b,eventType:d});this._eventSequencePromise=this._eventSequencePromise.then(function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._injectNextEvent()];case 1:return a.sent(),[2]}})})});return[2,this._eventSequencePromise]})})};g.prototype._injectNextEvent=
function(){return __awaiter(this,void 0,void 0,function(){var b,e,c,a;return __generator(this,function(f){switch(f.label){case 0:b=this._events.shift();if(void 0===b)return[2];e=b.eventType;if(e===d.EventType.MouseMove||e===d.EventType.TouchMove)for(;0<this._events.length;)if(c=this._events[0],c.eventType===e)b=c,this._events.shift();else break;f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._injectEvent(b.event,b.eventType)];case 2:return f.sent(),[3,4];case 3:return a=f.sent(),console.log(a),
[3,4];case 4:return[2]}})})};g.prototype._stopInteraction=function(){return __awaiter(this,void 0,void 0,function(){var b,e,c,a;return __generator(this,function(f){b=[];for(e=this.size()-1;0<=e;e--)(c=this._operators.get(this._operatorStack[e]))&&c.stopInteraction&&(a=c.stopInteraction(),void 0!==a&&b.push(a));return[2,d.Util.waitForAll(b)]})})};g.prototype._injectViewOrientationChangeEvent=function(){for(var b=this.size()-1;0<=b;b--){var d=this._operators.get(this._operatorStack[b]);if(void 0!==
d&&d.onViewOrientationChange)d.onViewOrientationChange()}};g.prototype._isValid=function(b){return this._operators.has(b)||b===d.OperatorId.None};g.prototype._contains=function(b){return-1!==this.indexOf(b)};g.prototype._activateOperator=function(b){b=this._operators.get(b);if(void 0!==b&&b.onActivate)return b.onActivate()};g.prototype._deactivateOperator=function(b){b=this._operators.get(b);if(void 0!==b&&b.onDeactivate)return b.onDeactivate()};return g}();d.OperatorManager=h})(Communicator||(Communicator=
{}));
(function(d){var h=function(){return function(b,c,a,f){this.x=b;this.xUnit=c;this.y=a;this.yUnit=f}}();d.OverlayUnitPoint=h;var g=function(){function b(c,a,f){this._anchor=c;this._position=a;this._size=f}b.prototype.getAnchor=function(){return this._anchor};b.prototype.getPosition=function(){return this._position};b.prototype.getSize=function(){return this._size};return b}(),b=function(){function b(c,a){this._viewer=c;this._engine=a;this._viewports=[];for(c=0;c<=this.maxIndex();c++)this._viewports.push(null)}b.prototype.maxIndex=
function(){return d.BuiltinOverlayIndex.First-1};b.prototype.setViewport=function(c,a,f,b,e,n,m,p,q,r){if(0===c)throw new d.CommunicatorError("Index 0 is reserved and may not be used to specify an overlay.");if(0>c)throw new d.CommunicatorError("Invalid index "+c+" specified when setting viewport.");if(b===d.OverlayUnit.ProportionOfOtherDimension&&n===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both x and y may not be set proportional to each other");if(p===d.OverlayUnit.ProportionOfOtherDimension&&
r===d.OverlayUnit.ProportionOfOtherDimension)throw new d.CommunicatorError("Both width and height may not be set proportional to each other");this._validateUnit(f,b,"x");this._validateUnit(e,n,"y");this._validateUnit(m,p,"width");this._validateUnit(q,r,"height");var k=new h(f,b,e,n),l=new h(m,p,q,r);k=new g(a,k,l);this._viewports[c]=k;this._engine.setOverlayViewport(c,a,f,b,e,n,m,p,q,r);this._viewer._getCallbackManager().trigger("overlayViewportSet",c);return Promise.resolve()};b.prototype._getViewportPosition=
function(c){c=this._viewports[c];return null===c?null:c.getPosition()};b.prototype.getViewportPixelPosition=function(c){c=this._viewports[c];if(null===c)return null;c=c.getPosition();return this._toPixelPoint(c)};b.prototype.getViewportPixelOffsetInCanvas=function(c){var a=this.getViewportPixelPosition(c);if(null===a)return null;var f=this.getViewportPixelSize(c);if(null===f)return null;c=this.getViewportAnchor(c);if(null===c)return null;f=this._getOverlayOffset(c,f);var b=d.Point2.add(f,a);switch(c){case d.OverlayAnchor.UpperRightCorner:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerRightCorner:b.x=
f.x-a.x}switch(c){case d.OverlayAnchor.LeftCenter:case d.OverlayAnchor.Center:case d.OverlayAnchor.RightCenter:case d.OverlayAnchor.LowerLeftCorner:case d.OverlayAnchor.BottomCenter:case d.OverlayAnchor.LowerRightCorner:b.y=f.y-a.y}return b};b.prototype._getViewportSize=function(c){c=this._viewports[c];return null===c?null:c.getSize()};b.prototype.getViewportPixelSize=function(c){c=this._viewports[c];if(null===c)return null;c=c.getSize();return this._toPixelPoint(c)};b.prototype.getViewportAnchor=
function(c){c=this._viewports[c];return null===c?null:c.getAnchor()};b.prototype.setVisibility=function(c,a){this._engine.setOverlayVisibility(c,a);return Promise.resolve()};b.prototype.destroy=function(c){this._engine.destroyOverlay(c);this._viewports[c]=null;return Promise.resolve()};b.prototype.addNodes=function(c,a){a=this._viewer.model._gatherInstanceIncsFromNodeIds(a);0<a.length&&this._engine.addNodesToOverlay(a,c);return Promise.resolve()};b.prototype.setCamera=function(c,a){this._engine.setOverlayCamera(c,
a);return Promise.resolve()};b.prototype._getOverlayOffset=function(c,a){var f=this._viewer.view.getCanvasSize(),b=d.Point2.zero();if(c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.UpperRightCorner||c===d.OverlayAnchor.RightCenter)b.x=f.x-a.x;else if(c===d.OverlayAnchor.Center||c===d.OverlayAnchor.TopCenter||c===d.OverlayAnchor.BottomCenter)b.x=.5*(f.x-a.x);if(c===d.OverlayAnchor.LowerLeftCorner||c===d.OverlayAnchor.LowerRightCorner||c===d.OverlayAnchor.BottomCenter)b.y=f.y-a.y;else if(c===
d.OverlayAnchor.Center||c===d.OverlayAnchor.LeftCenter||c===d.OverlayAnchor.RightCenter)b.y=.5*(f.y-a.y);return b};b.prototype._toPixelPoint=function(c){var a=this._viewer.view.getCanvasSize(),f=d.Point2.zero(),b=!1;switch(c.xUnit){case d.OverlayUnit.Pixels:f.x=c.x;break;case d.OverlayUnit.ProportionOfCanvas:f.x=a.x*c.x;break;case d.OverlayUnit.ProportionOfOtherDimension:b=!0}switch(c.yUnit){case d.OverlayUnit.Pixels:f.y=c.y;break;case d.OverlayUnit.ProportionOfCanvas:f.y=a.y*c.y;break;case d.OverlayUnit.ProportionOfOtherDimension:f.y=
f.x*c.y}b&&(f.x=c.x*c.y);return f};b.prototype._validateUnit=function(c,a,f){if(a!==d.OverlayUnit.Pixels&&(0>c||1<c))throw new d.ParseError("value for "+f+" should be between 0.0 and 1.0 when specifying non pixel value");};return b}();d.OverlayManager=b})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.None=0]="None";d[d.Floor=1]="Floor";d[d.Wall=2]="Wall";d[d.Door=4]="Door"})(d.BimMask||(d.BimMask={}));var h=function(){function g(b){void 0===b&&(b=d.SelectionMask.Face);this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=d.SelectionMask.None;this.restrictLinesAndPointsToSelectedFaceInstances=this.oneEntityPerTypePerInstance=this.respectDepthRange=!0;this.restrictToOverlays=this.ignoreOverlays=this.ignoreCappingGeometry=
this.enableProximityFaces=!1;this.selectionMask=b}Object.defineProperty(g.prototype,"allowFaces",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Face)},set:function(b){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Face,b)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowLines",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Line)},set:function(b){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Line,
b)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"allowPoints",{get:function(){return 0!==(this.selectionMask&d.SelectionMask.Point)},set:function(b){this.selectionMask=d.Internal.setBit(this.selectionMask,d.SelectionMask.Point,b)},enumerable:!0,configurable:!0});return g}();d.PickConfig=h;h=function(){return function(g){void 0===g&&(g=d.SelectionMask.All);this.mustBeFullyContained=!1;this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=
d.SelectionMask.None;this.ignoreCuttingSections=this.allowPoints=this.allowLines=this.allowFaces=!0;this.ignoreUnrequestedInstances=this.onlyStreamedInstances=!1;this.allowFaces=0!==(g&d.SelectionMask.Face);this.allowLines=0!==(g&d.SelectionMask.Line);this.allowPoints=0!==(g&d.SelectionMask.Point)}}();d.IncrementalPickConfig=h})(Communicator||(Communicator={}));var SC;
(function(d){d.UnspecifiedMeasurementUnit=0;d.isError=function(d){return"object"===typeof d&&null!==d&&!0};d.getStateFailure=function(d){d=d.data;return"object"===typeof d&&null!==d&&"scStateFailure"in d?d.scStateFailure:null}})(SC||(SC={}));
(function(d){(function(h){function g(a){return null!==a?d.Color.createFromFloatArray(a):a}function b(a){return h.mapInPlace(a,g)}var e;(function(a){a[a.Add=0]="Add";a[a.Update=1]="Update"})(e||(e={}));var c=function(){return function(a){this.promise=h.OpenPromise.create();this.ids=a}}(),a=function(){function a(a,c){this._engineReadyPromise=h.OpenPromise.create();this._sessionStartedPromise=h.OpenPromise.create();this._connectionlessEmpty=!1;this._uri="ws://localhost:9999";this._streamingMode=d.StreamingMode.Default;
this._rendererType=d.RendererType.Client;this._memoryLimit=this._meshLevel=0;this._boundingPreviewMode=d.BoundingPreviewMode.All;this._streamCutoffScale=1;this._loadFinished=!1;this._statistics=new h.StatisticMap;this._cachedElementCount=this._cachedTriangleCount=null;this._windowSize=new d.Point2(0,0);this._cuttingSectionToKeyMap=new Map;this._cappingQuantizationGranularity=-1E4;this._cappingMaterialDirty=this._cappingGeometryVisibility=this._cappingLinesEnabled=this._cappingFacesEnabled=!0;this._cappingDelayTimeoutId=
null;this._cappingDelay=500;this._requestBatchCountByType=[];this._pendingRequestsByType=[];this._xRayMaterials=[];this._callbackManager=a;this._applyOptions(c);for(a=0;1>a;++a)this._requestBatchCountByType.push(0),this._pendingRequestsByType.push([])}a.prototype.getNetworkModelName=function(){console.assert(1===this._sessionType);if(void 0!==this._model)return this._model;throw new d.InternalLogicError;};a.prototype.logMessage=function(a){console.log(a)};a.prototype.setTimeout=function(a,c){return setTimeout(a,
c)};a.prototype.sleep=function(a){return d.Util.sleep(a)};a.prototype.getScsInfo=function(){console.assert(2===this._sessionType);return void 0!==this._buffer?this._buffer:/^wss?:\/\//i.test(this._uri)?null:this._uri};a.prototype._applyOptions=function(a){void 0!==a.empty&&(this._connectionlessEmpty=a.empty);void 0!==a.endpointUri&&(this._uri=a.endpointUri);a.model&&(this._model=a.model);void 0!==a.sessionToken&&(this._sessionToken=a.sessionToken);void 0!==a.buffer&&(this._buffer=a.buffer);void 0!==
a.streamingMode&&(this._streamingMode=a.streamingMode);void 0!==a.rendererType&&(this._rendererType=a.rendererType);void 0!==a.defaultMeshLevel&&(this._meshLevel=a.defaultMeshLevel);void 0!==a.memoryLimit&&(this._memoryLimit=a.memoryLimit);void 0!==a.boundingPreviewMode&&(this._boundingPreviewMode=a.boundingPreviewMode);void 0!==a.streamCutoffScale&&this._setStreamCutoffScale(a.streamCutoffScale)};a.prototype.start=function(a,c){var f=this;this._canvasContainer=a;this._initOptions=c;_SC.createInstance({container:a,
onReady:function(a){f._onEngineReady(a)},onError:function(a){f._callbackManager.trigger("modelLoadFailure",f._model||"","failed to load engine: "+a)},enginePath:c.enginePath});return!0};a.prototype.setPickTolerance=function(a){this._scSelectionManager.setPickTolerance(a)};a.prototype.getPickTolerance=function(){return this._scSelectionManager.getPickTolerance()};a.prototype._onEngineReady=function(a){var c=this;this._sc=a;this._sessionType=0;this._matrixCache=new h.ScMatrixCache(this);this._materialCache=
new h.ScMaterialCache(this);this._scSelectionManager=new h.ScSelectionManager(this._sc);this.resize();this._callbackManager.bind({_firstBoundingReady:function(){return c._regenerateCapping()}});this._sc.setEventHandler("session_started",function(){var a=function(){c._callbackManager.unbind(f);return c._sessionStartedPromise},f={_sessionStarted:function(){return c._onSessionStarted()},_assemblyTreeReady:a,_modelSwitched:a};c._callbackManager.bind(f);c._sessionStartedPromise.resolve(c._callbackManager.promiseTrigger("_sessionStarted",
null))});this._sc.setEventHandler("announce_model",function(a,f,b){c._callbackManager.trigger("_announceModel",f,b)});this._sc.setEventHandler("first_instance",function(){c._callbackManager.trigger("_firstInstance")});this._sc.setEventHandler("inclusion",function(a,f,b,d){c._callbackManager.trigger("_inclusion",f,b,d)});this._sc.setEventHandler("remap_model",function(a,f,b,d){c._callbackManager.trigger("_remapModel",f,b,d)});this._sc.setEventHandler("remap_inclusion",function(a,f,b,d,k){c._callbackManager.trigger("_remapInclusion",
f,b,d,k)});this._sc.setEventHandler("capping_idle",function(a,f,b){c._callbackManager.trigger("cappingIdle",f,b)});this._sc.setEventHandler("stream_active",this._initOptions.streamingActivated);this._sc.setEventHandler("stream_idle",this._initOptions.streamingDeactivated);this._sc.setEventHandler("open_model_failed",function(a,f){switch(f.reason){case "UNKNOWN_MODEL":a="Unknown model";break;case "BAD_NETWORK_VERSION":a="Client/Server network version mismatch";break;case "BAD_STREAM_VERSION":case "BAD_STORE_VERSION":a=
"Unsupported file version";break;default:a="Internal Error"}c._callbackManager.trigger("modelLoadFailure",c._model||"",a)});this._sc.setEventHandler("missing_model",function(a,f,b){c._callbackManager.trigger("_missingModel",f,b);c._callbackManager.trigger("missingModel",b)});this._sc.setEventHandler("bad_data",function(a,f){switch(f.type){case "TRUNCATED_BLOCK":a="Failed to parse truncated data block.";break;case "ZFRAME_DECOMPRESS_FAILED":a="Failed to decompress data.";break;case "UNMATCHED_CODE":a=
"Unknown opcode.";break;case "STORE_VERSION_MISMATCHED":a="Store version mismatched. Expected='"+(f.expected+"'.");a+=" Actual='"+f.actual+"'.";break;case "STREAM_VERSION_MISMATCHED":a="Stream version mismatched. Expected='"+(f.expected+"'.");a+=" Actual='"+f.actual+"'.";break;case "PARSE_BOUNDING_TREE_FAILED":a="Failed to parse bounding tree.";break;default:a="Unknown error."}c._callbackManager.trigger("modelLoadFailure",c._model||"",a)});this._sc.setEventHandler("socket_open_failed",function(){c._callbackManager.trigger("modelLoadFailure",
c._model||"","WebSocket connection failed.")});this._sc.setEventHandler("post_draw",function(a,f,b,d){c._syncedCamera=b;c._statistics=f;c._initOptions.renderComplete();c._fillStatTotalCounts();a=c._fromScCamera(b);c._callbackManager.trigger("frameDrawn",a,d)});this._sc.setEventHandler("priority_meta_data_sent",function(a,f,b){c._initOptions.priorityMetaDataSent(f,b)});this.setAllowHighDpi(!0);this._sc.setEventHandler("meta_data",function(a,f,b,d){0>f&&(f+=4294967296);c._callbackManager.trigger("_metaData",
f,b,d)});this._sc.setEventHandler("draw_complete",function(){c._callbackManager.trigger("_drawComplete")});this._sc.setEventHandler("webgl_context_lost",function(){c._callbackManager.trigger("webGlContextLost")});this._sc.setEventHandler("websocket_connection_closed",function(){c._callbackManager.trigger("websocketConnectionClosed")});this._initOptions.engineReady(this._sessionStartedPromise);this._engineReadyPromise.resolve()};a.prototype.loadFinished=function(){return this._loadFinished};a.prototype.resetCachedStatistics=
function(){this._cachedTriangleCount=this._cachedElementCount=null};a.prototype.setAmbientOcclusionEnabled=function(a){this._sc.setAmbientOcclusionEnabled(a)};a.prototype.setAmbientOcclusionRadius=function(a){this._sc.setAmbientOcclusionRadius(a)};a.prototype.setLightingEnabled=function(a){this._sc.setLightingEnabled(a)};a.prototype._fillStatTotalCounts=function(){null!==this._cachedElementCount&&null!==this._cachedTriangleCount&&(this._statistics.total_element_count=this._cachedElementCount,this._statistics.total_triangle_count=
this._cachedTriangleCount)};a.prototype._updateCachedStats=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f;return __generator(this,function(b){switch(b.label){case 0:return a=this._sc.getElementCount(),c=this._sc.getTriangleCount(),[4,Promise.all([a,c])];case 1:return f=b.sent(),this._cachedElementCount=f[0],this._cachedTriangleCount=f[1],this._fillStatTotalCounts(),[2]}})})};a.prototype._toVector3=function(a){var c=[0,0,0];a.toArray(c);return c};a.prototype.startExplode=function(a,
c){this.delayCapping();this._sc.startExplode(a,this._toVector3(c))};a.prototype.setExplodeMagnitude=function(a){this._callbackManager.trigger("explode",a);this.delayCapping();this._sc.explode(a)};a.prototype.stopExplode=function(){this.delayCapping();this._sc.resetExplode()};a.prototype.getStatistics=function(a){void 0===a&&(a=!1);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return!a||this.loadFinished()?[3,2]:[4,this._updateCachedStats()];
case 1:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 2:return this.loadFinished()&&null===this._cachedTriangleCount?[4,this._updateCachedStats()]:[3,4];case 3:return c.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 4:return this._fillStatTotalCounts(),[2,this._statistics]}})})};a.prototype.setStreamIdleMarker=function(){return this._sc.setStreamIdleMarker()};a.prototype.hasDepthRange=function(a){return this._sc.MeshInstance.hasDepthRange(a)};a.prototype.setDepthRange=
function(a,c,f){this._sc.MeshInstance.setDepthRange(a,c,f)};a.prototype.unsetDepthRange=function(a){this._sc.MeshInstance.unsetDepthRange(a)};a.prototype.setDefaultDepthRange=function(a,c){this._sc.setDefaultDepthRange(a,c)};a.prototype._getScPlaneArray=function(a){for(var c=[],f=0;f<a.getCount();f++){var b=a.getPlane(f);if(null!==b){var d=[];b.normal.toArray(d);d[3]=b.d;c.push(d)}}return c};a.prototype.getCuttingSectionLimits=function(){return this._sc.cuttingSectionLimits()};a.prototype._addCuttingSection=
function(a,c){return __awaiter(this,void 0,void 0,function(){var f,b,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(!this._cuttingSectionToKeyMap.has(a)),f=4294967295,b=this._getScPlaneArray(a),0<b.length?[4,this._sc.addCuttingSection(b)]:[3,2];case 1:f=l.sent();if(4294967295===f)throw k=c===e.Add?"add":"update",new d.CommunicatorError("Failed to "+k+" cutting section.");l.label=2;case 2:return console.assert(!this._cuttingSectionToKeyMap.has(a)),this._cuttingSectionToKeyMap.set(a,
f),c===e.Add&&this._callbackManager.trigger("addCuttingSection",a),[2]}})})};a.prototype.addCuttingSection=function(a){return this._addCuttingSection(a,e.Add)};a.prototype.removeCuttingSection=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){c=this._cuttingSectionToKeyMap.get(a);if(void 0===c)return console.assert(!1),[2];this._cuttingSectionToKeyMap.delete(a);this._callbackManager.trigger("removeCuttingSection");return 4294967295===c?[2]:[2,this._sc.removeCuttingSections([c])]})})};
a.prototype.removeAllCuttingSections=function(){this._cuttingSectionToKeyMap.clear();this._callbackManager.trigger("removeCuttingSection");return this._sc.removeAllCuttingSections()};a.prototype.updateCuttingSection=function(a){return __awaiter(this,void 0,void 0,function(){var c,f;return __generator(this,function(b){c=this._cuttingSectionToKeyMap.get(a);if(void 0===c)return console.assert(!1),[2];if(4294967295===c)return[2,this._addCuttingSection(a,e.Update)];f=this._getScPlaneArray(a);return[2,
this._sc.replaceCuttingSection(f,c)]})})};a.prototype.setCappingDelay=function(a){this._cappingDelay=a};a.prototype.enableCappingIdleCallback=function(a){return this._sc.setCappingIdleHookEnabled(a)};a.prototype.delayCapping=function(){var a=this;null===this._cappingDelayTimeoutId?this._sc.pauseCapping():clearTimeout(this._cappingDelayTimeoutId);this._cappingDelayTimeoutId=setTimeout(function(){a._cappingDelayTimeoutId=null;a._sc.resumeCapping()},this._cappingDelay)};a.prototype.setCappingGeometryVisibility=
function(a){return __awaiter(this,void 0,void 0,function(){var c,f;return __generator(this,function(b){console.assert(void 0!==this._cappingLineMaterialId);console.assert(void 0!==this._cappingFaceMaterialId);if(this._cappingGeometryVisibility!==a||this._cappingMaterialDirty){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._cappingMaterialDirty=!1;if(this._cappingGeometryVisibility=a)return c=this._cappingLinesEnabled?this._cappingLineMaterialId:
[0,4294967295],f=this._cappingFacesEnabled?this._cappingFaceMaterialId:[0,4294967295],[2,this._sc.enableCapping(c,f,this._cappingQuantizationGranularity)];this._sc.disableCapping()}return[2]})})};a.prototype._regenerateCapping=function(){this._cappingMaterialDirty=!0;return this.setCappingGeometryVisibility(this._cappingGeometryVisibility)};a.prototype.getCappingGeometryVisibility=function(){return this._cappingGeometryVisibility};a.prototype.setDiffuseColor=function(a,c){return this._sc.Material.setDiffuseColor(a,
c)};a.prototype._toRgb=function(a){var c=[0,0,0];a.toFloatArray(c);return c};a.prototype._toRgba=function(a,c){c=[0,0,0,c];a.toFloatArray(c);return c};a.prototype.setCappingFaceColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._cappingMaterialDirty=!0,this._cappingFacesEnabled=!!a,a?[4,this.setDiffuseColor(this._cappingFaceMaterialId,this._toRgba(a,1))]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2,this._regenerateCapping()]}})})};
a.prototype.setCappingLineColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._cappingMaterialDirty=!0,this._cappingLinesEnabled=!!a,a?[4,this.setDiffuseColor(this._cappingLineMaterialId,this._toRgba(a,1))]:[3,2];case 1:c.sent(),c.label=2;case 2:return[2,this._regenerateCapping()]}})})};a.prototype._onSessionStarted=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f,b,e,g,h,w,t=this;return __generator(this,
function(k){switch(k.label){case 0:this._sc.suspendDrawing();this._sc.setDrawMode(1);this._sc.setHighlightedInstanceFilter(3);this._sc.setUnhighlightedFilter(0);this._sc.setHighlightMode(1);this._sc.setAntiAliasingMode(1);a=[];a.push(this._matrixCache.init());c=[.5,.5,.5,1];f=function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(a){this._cappingMaterialDirty=!0;return void 0!==this._cappingFaceMaterialId&&void 0!==this._cappingLineMaterialId?[2,this.setCappingGeometryVisibility(this.getCappingGeometryVisibility())]:
[2]})})};a.push(this.createMaterial().then(function(a){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.setDiffuseColor(a,c)];case 1:return b.sent(),this._cappingFaceMaterialId=a,[2,f()]}})})}));a.push(this.createMaterial().then(function(a){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.setDiffuseColor(a,c)];case 1:return b.sent(),this._cappingLineMaterialId=a,
[2,f()]}})})}));b=function(c){e._xRayMaterials[c]=[];for(var f=function(f){a.push(e.createMaterial().then(function(a){t._xRayMaterials[c][f]={id:a,color:null}}))},b=0,k=[d.ElementType.Faces,d.ElementType.Lines,d.ElementType.Points];b<k.length;b++)f(k[b])};e=this;g=0;for(h=[d.XRayGroup.Selected,d.XRayGroup.Unselected];g<h.length;g++)w=h[g],b(w);return[4,Promise.all(a)];case 1:return k.sent(),this._initOptions.sceneReady(),this._sc.resumeDrawing(),[2]}})})};a.prototype.isInit=function(){return void 0!==
this._sc};a.prototype.setRemoteEndpoint=function(a,c){this._uri=a;this._model=c};a.prototype.getSessionType=function(){return this._sessionType};a.prototype._awaitEmptyLoad=function(){var a=this,c=h.OpenPromise.create(),f={_attached:function(b){a._callbackManager.unbind(f);0===b?c.resolve():c.reject(new d.InternalLogicError)}};this._callbackManager.bind(f);return c};a.prototype.loadEmpty=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._engineReadyPromise];case 1:c.sent();try{if(0!==this._sessionType)throw new d.LoadError("Incompatible load types.");a=this._awaitEmptyLoad();this._sessionType=this._connectionlessEmpty||void 0!==this._buffer||void 0===this._model?this._loadEmptyScs():this._loadEmptyNetwork();return[2,a]}catch(n){throw this._callbackManager.trigger("modelLoadFailure",this._model||"",n.message),n;}}})})};a.prototype._loadEmpty=function(a){var c=this;console.assert(void 0===a.XHRonprogress);console.assert(void 0===
a.XHRonerror);console.assert(void 0===a.XHRonloadend);a.XHRonprogress=function(a){c._callbackManager.trigger("XHRonprogress",a)};a.XHRonerror=function(a){c._callbackManager.trigger("XHRonerror",a)};a.XHRonloadend=function(a,f,b){c._callbackManager.trigger("XHRonloadend",a,f,b)};return this._sc.load(a)};a.prototype._loadEmptyScs=function(){console.assert(void 0===this._model);var a={empty:!0};this._streamingMode===d.StreamingMode.OnDemand&&(a.streamInstancesOnDemand=!0);return this._loadEmpty(a)};
a.prototype._loadEmptyNetwork=function(){console.assert(void 0!==this._model);var a={model:d.EmptyModelName,uri:this._uri,serverSideRendering:this._rendererType===d.RendererType.Server,meshLevel:this._meshLevel,streamCutoffScale:this._streamCutoffScale};void 0!==this._sessionToken&&(a.sessionToken=this._sessionToken);0<this._memoryLimit&&(a.limitMiB=this._memoryLimit);(this._boundingPreviewMode&d.BoundingPreviewMode.Model)===d.BoundingPreviewMode.Model&&(a.streamModelBoundingPreviews=!0);(this._boundingPreviewMode&
d.BoundingPreviewMode.Instance)===d.BoundingPreviewMode.Instance&&(a.streamInstanceBoundingPreviews=!0);(this._boundingPreviewMode&d.BoundingPreviewMode.Ejected)===d.BoundingPreviewMode.Ejected&&(a.streamEjectedBoundingPreviews=!0);switch(this._streamingMode){case d.StreamingMode.OnDemand:a.streamInstancesOnDemand=!0;break;case d.StreamingMode.All:a.streamCulled=!0,a.streamMetaDataOnIdle=!0}return this._loadEmpty(a)};a.prototype.setProjection=function(a){var c=this.getCamera();c.getProjection()!==
a&&(c.setProjection(a),this.setCamera(c))};a.prototype.getViewMatrix=function(a){a=void 0!==a?this._toCamera(a):this._sc.getCamera();return d.Matrix.createFromArray(a.viewMatrix())};a.prototype.getProjectionMatrix=function(a){a=void 0!==a?this._toCamera(a):this._sc.getCamera();return d.Matrix.createFromArray(a.projectionMatrix())};a.prototype.getFullCameraMatrix=function(a){a=void 0!==a?this._toCamera(a):this._sc.getCamera();return d.Matrix.createFromArray(a.fullMatrix())};a.prototype.getSynchedViewMatrix=
function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.viewMatrix()):new d.Matrix};a.prototype.getSynchedProjectionMatrix=function(){return this._syncedCamera?d.Matrix.createFromArray(this._syncedCamera.projectionMatrix()):new d.Matrix};a.prototype.getPrimaryModelKey=function(){return this._sc.primaryModelKey()};a.prototype.getPartsBounding=function(a,c,f){return this.getBounding(a,c,!1,f)};a.prototype.getDrawnPartsBounding=function(a){return __awaiter(this,void 0,void 0,
function(){var c,f;return __generator(this,function(b){switch(b.label){case 0:return[4,this._sc.MeshInstance.getDrawnWorldSpaceBounding(a)];case 1:return c=b.sent(),f=new d.Box,f.min.fromArray(c.min),f.max.fromArray(c.max),[2,f]}})})};a.prototype.getBounding=function(a,c,f,b){return __awaiter(this,void 0,void 0,function(){var k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getWorldSpaceBounding(a,c,f,b)];case 1:return k=l.sent(),e=new d.Box,e.min.fromArray(k.min),
e.max.fromArray(k.max),[2,e]}})})};a.prototype.getLooseBounding=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(f){switch(f.label){case 0:return[4,this._sc.getLooseBounding()];case 1:return a=f.sent(),c=new d.Box,c.min.fromArray(a.min),c.max.fromArray(a.max),[2,c]}})})};a.prototype.getClientDimensions=function(){var a=this._sc.container;return[a.clientWidth,a.clientHeight]};a.prototype.getModelBounding=function(a,c,f){return __awaiter(this,void 0,
void 0,function(){return __generator(this,function(b){return[2,this.getBounding([],a,c,f)]})})};a.prototype.pickFromScreen=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.pickFromScreen(a,c,f)]})})};a.prototype.pickAllFromScreen=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.pickAllFromScreen(a,c,f)]})})};a.prototype.compositePickFromScreen=
function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.compositePickFromScreen(a,c,f)]})})};a.prototype.beginScreenAreaSelection=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.beginScreenAreaSelection(a,c,f)]})})};a.prototype.beginRayDrillSelection=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,
this._scSelectionManager.beginRayDrillSelection(a,c,f)]})})};a.prototype.beginConvexPolyhedronSelection=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.beginConvexPolyhedronSelection(a,c,f)]})})};a.prototype.beginSphereSelection=function(a,c,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.beginSphereSelection(a,c,f)]})})};a.prototype.endIncrementalSelection=
function(a){this._scSelectionManager.endIncrementalSelection(a)};a.prototype.advanceIncrementalSelection=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,this._scSelectionManager.advanceIncrementalSelection(a,!1)]})})};a.prototype.flushMetaDataCache=function(){this._sc.flushMetaDataCache()};a.prototype.safeGetMetaDatas=function(a,c){for(var f=[],b=0;b<c.length;b++)f.push(a,c[b]);return this.getDataFromIds(f).then(h.identity,function(){return null})};
a.prototype.safeGetMetaData=function(a,c){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(b){switch(b.label){case 0:return[4,this.safeGetMetaDatas(a,[c])];case 1:return f=b.sent(),null!==f?[2,f[0]]:[2,null]}})})};a.prototype.safeLoadMetaDatas=function(a){return this.getDataFromIds(a).then(h.nop,h.nop)};a.prototype.getDataFromIds=function(a){if(0===this._requestBatchCountByType[0])return this._getDataFromIds(a);a=new c(a);this._pendingRequestsByType[0].push(a);
return a.promise};a.prototype._getDataFromIds=function(a){return this._sc.getMetaData(a)};a.prototype.pickFromRay=function(a,c){return this._scSelectionManager.pickFromRay(a,c)};a.prototype.pickAllFromRay=function(a,c){return this._scSelectionManager.pickAllFromRay(a,c)};a.prototype.updateCamera=function(a){var c=a._getFlags(),f=this._sc.getCamera();(c&h.CameraFlags.Position)===h.CameraFlags.Position&&f.setPosition(this._toVector3(a.getPosition()));(c&h.CameraFlags.Target)===h.CameraFlags.Target&&
f.setTarget(this._toVector3(a.getTarget()));(c&h.CameraFlags.Up)===h.CameraFlags.Up&&f.setUpVector(this._toVector3(a.getUp()));this._setCamera(f);return this.getCamera()};a.prototype._toProjection=function(a){switch(a){default:case d.Projection.Orthographic:return 1;case d.Projection.Perspective:return 0}};a.prototype._toCamera=function(a){var c=this._sc.getCamera();c.reset(this._toProjection(a.getProjection()),this._toVector3(a.getPosition()),this._toVector3(a.getTarget()),this._toVector3(a.getUp()),
a.getWidth(),a.getHeight());c.setNearLimit(a.getNearLimit());return c};a.prototype.setCamera=function(a){a=this._toCamera(a);this._setCamera(a)};a.prototype._setCamera=function(a){this.delayCapping();this._sc.setCamera(a)};a.prototype.markCameraAsEmpty=function(){this._sc.markCameraAsEmpty()};a.prototype.setInstancesMatrix=function(a,c){this._sc.MeshInstance.setAnonymousMatrix(a,c.m)};a.prototype.setMatrices=function(a,c){for(var f=[],b=0;b<c.length;b++)f.push.apply(f,c[b].m);this._sc.MeshInstance.setAnonymousMatrices(a,
f)};a.prototype.highlightParts=function(a,c){this._sc.MeshInstance.setHighlighted(a,c);this._sc.MeshInstance.setXRay(a,c)};a.prototype.highlightElements=function(a,c,f,b,d){c=this._toElementType(c);this._sc.MeshInstance.setElementHighlighted(a,c,f,b,d);this._sc.MeshInstance.setElementXRay(a,c,f,b,d)};a.prototype.getPartHighlighted=function(a){return this._sc.MeshInstance.getHighlighted(a)};a.prototype.getElementHighlighted=function(a,c,f){return this._sc.MeshInstance.getElementHighlighted(a,this._toElementType(c),
f)};a.prototype.setNodeHighlightColor=function(a,c){a?(this._sc.setHighlightedInstanceFilter(3),a=this._toRgba(a,1),this._sc.setHiddenLineHighlightedInstanceFillColor(a),this._sc.setHighlightedInstanceColor(a)):this._sc.setHighlightedInstanceFilter(0);a=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHiddenLineHighlightedInstanceOutlineColor(a);this._sc.setHighlightedInstanceOutlineColor(a)};a.prototype.setElementHighlightColor=function(a,c){a?(this._sc.setHighlightedElementFilter(3),a=this._toRgba(a,1),
this._sc.setHighlightedElementColor(a),this._sc.setHiddenLineHighlightedElementFillColor(a)):this._sc.setHighlightedElementFilter(0);a=c?this._toRgba(c,1):[0,0,0,0];this._sc.setHighlightedElementOutlineColor(a);this._sc.setHiddenLineHighlightedElementOutlineColor(a)};a.prototype.setHighlightColorizeCompression=function(a){this._sc.setHighlightColorizeCompression(a)};a.prototype.computeMinimumBodyBodyDistance=function(a,c){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,
function(b){switch(b.label){case 0:if(2!==a.length||2!==c.length)throw new d.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalBodyBodyDistance(a,c)];case 1:return f=b.sent(),[2,h.makeFaceFaceDistanceItem(f)]}})})};a.prototype.computeMininimumFaceFaceDistance=function(a,c,f,b){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(e){switch(e.label){case 0:if(2!==a.length||2!==f.length)throw new d.CommunicatorError("Invalid instance inc.");
return[4,this._sc.MeshInstance.computeMinimalFaceFaceDistance(a,c,f,b)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};a.prototype.computeMinimumFaceRayDistance=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var b,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==a.length)throw new d.CommunicatorError("Invalid instance inc.");b=h.toScRay(f);return[4,this._sc.MeshInstance.computeMinimalFaceRayDistance(a,c,b)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};
a.prototype.computeMinimumFaceLineDistance=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var b,k;return __generator(this,function(e){switch(e.label){case 0:if(2!==a.length)throw new d.CommunicatorError("Invalid instance inc.");b=h.toScRay(f);return[4,this._sc.MeshInstance.computeMinimalFaceLineDistance(a,c,b)];case 1:return k=e.sent(),[2,h.makeFaceFaceDistanceItem(k)]}})})};a.prototype.pauseRendering=function(a){this._sc.suspendDrawing();if("function"===typeof a)try{a()}finally{this._sc.resumeDrawing()}};
a.prototype.resumeRendering=function(){this._sc.resumeDrawing()};a.prototype.beginRequestBatch=function(a){++this._requestBatchCountByType[a]};a.prototype.endRequestBatch=function(a){0<this._requestBatchCountByType[a]&&--this._requestBatchCountByType[a];this._flushBatchedRequests(a)};a.prototype._flushBatchedRequests=function(a){var c=this._pendingRequestsByType[a];this._pendingRequestsByType[a]=[];for(var f=[],b=0;b<c.length;b++)for(var k=0,e=c[b].ids;k<e.length;k++)f.push(e[k]);switch(a){case 0:return this._flushBatchedMetaDataRequests(c,
f);default:return d.Util.TypeAssert(a),console.assert(!1),Promise.resolve()}};a.prototype._flushBatchedMetaDataRequests=function(a,c){return __awaiter(this,void 0,void 0,function(){var f,b,d,k,e,l,g,h,v;return __generator(this,function(n){switch(n.label){case 0:return[4,this._getDataFromIds(c)];case 1:f=n.sent();d=b=0;for(k=a;d<k.length;d++){e=k[d];l=[];g=e.ids.length/2;for(h=0;h<g;++h)v=f[b++],l.push(v);e.promise.resolve(l)}console.assert(b===f.length);return[2]}})})};a.prototype.clearHighlight=
function(){this._sc.unsetAllHighlighted();this._sc.unsetAllXRay()};a.prototype.resetColors=function(){this._sc.unsetAllColors()};a.prototype.resetOpacity=function(){this._sc.unsetAllOpacity()};a.prototype.setPartOpacity=function(a,c){var f=this;this.pauseRendering(function(){f._sc.MeshInstance.setOpacity(a,0,c);f._sc.MeshInstance.setOpacity(a,1,c)})};a.prototype.unsetPartOpacity=function(a){var c=this;this.pauseRendering(function(){c._sc.MeshInstance.unsetOpacity(a,0);c._sc.MeshInstance.unsetOpacity(a,
1)})};a.prototype.getPartOpacity=function(a){return this._sc.MeshInstance.getOpacity(a,0)};a.prototype.getEffectivePartOpacity=function(a,c){return this._sc.MeshInstance.getEffectiveOpacity(a,this._toElementType(c))};a.prototype.getPartHasTransparency=function(a){return __awaiter(this,void 0,void 0,function(){var c,f,b,d,k;return __generator(this,function(e){switch(e.label){case 0:return c=[],c.push(this._sc.MeshInstance.hasTransparency(a,0)),c.push(this._sc.MeshInstance.hasTransparency(a,1)),[4,
Promise.all(c)];case 1:f=e.sent();b=f[0];d=f[1];for(k=0;k<b.length;++k)b[k]||(b[k]=d[k]);return[2,b]}})})};a.prototype.setPartColor=function(a,c,f){this._sc.MeshInstance.setColor(a,this._toElementType(c),f.getFloatArray())};a.prototype.unsetPartColor=function(a,c){this._sc.MeshInstance.unsetColor(a,this._toElementType(c))};a.prototype.getPartColor=function(a,c){return this._sc.MeshInstance.getColor(a,this._toElementType(c)).then(b)};a.prototype.getEffectivePartColor=function(a,c){return __awaiter(this,
void 0,void 0,function(){var f,d;return __generator(this,function(k){switch(k.label){case 0:return f=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveColor(a,f)];case 1:return d=k.sent(),[2,b(d)]}})})};a.prototype.setElementColor=function(a,c,f,b,d){this._sc.MeshInstance.setElementColor(a,this._toElementType(c),f,b,d.getFloatArray())};a.prototype.unsetElementColor=function(a,c,f,b){this._sc.MeshInstance.unsetElementColor(a,this._toElementType(c),f,b)};a.prototype.getElementColor=function(a,
c,f){return this._sc.MeshInstance.getElementColor(a,this._toElementType(c),f).then(b)};a.prototype.getEffectiveElementColor=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var d,k;return __generator(this,function(e){switch(e.label){case 0:return d=this._toElementType(c),[4,this._sc.MeshInstance.getEffectiveElementColor(a,d,f)];case 1:return k=e.sent(),[2,b(k)]}})})};a.prototype.synchronizeVisibilities=function(a,c){0<a.length&&this._sc.MeshInstance.synchronizeVisibilities(a,c)};a.prototype.setPartVisibility=
function(a,c,f){0<a.length&&this._sc.MeshInstance.setVisible(a,c,f)};a.prototype.setVisibilityByAttachment=function(a,c){this._sc.setVisibilityByAttachment(a,c)};a.prototype.requestMeshInstances=function(a){this._sc.demandMeshInstances(a)};a.prototype.getRendererType=function(){return this._rendererType};a.prototype._toMeshDataBuilder=function(a){for(var c=a._getFaceData(),f=a._getPointData(),b=a._getPolylineData(),k=new this._sc.MeshDataBuilder,e=0;e<c.length;e++){var g=c[e];k.addFace(g.vertexData,
{normals:g.normalData,rgba32s:g.rgba32data,uvs:g.uvData,bits:g.bits})}for(c=0;c<f.length;c++)g=f[c],k.addPoints(g.vertexData,{rgba32s:g.rgba32data,bits:g.bits});for(f=0;f<b.length;f++)g=b[f],k.addPolyline(g.vertexData,{rgba32s:g.rgba32data,bits:g.bits});switch(a.getFaceWinding()){case d.FaceWinding.Clockwise:b=1;break;case d.FaceWinding.CounterClockwise:b=2;break;default:b=0}g=a.getBackfacesEnabled()?4:0;a=a.isManifold()?65536:0;k.formatBits=k.formatBits|b|g|a;return k};a.prototype.createMesh=function(a){a=
this._toMeshDataBuilder(a);return this._sc.MeshData.create(a)};a.prototype.replaceMesh=function(a,c){c=this._toMeshDataBuilder(c);return this._sc.MeshData.replace(a,c)};a.prototype.destroyMeshes=function(a){return this._sc.MeshData.destroy(a)};a.prototype._toImageFormat=function(a){switch(a){case d.ImageFormat.Gray8:return 2;case d.ImageFormat.GrayAlpha16:return 3;case d.ImageFormat.Rgb24:return 1;case d.ImageFormat.Rgba32:return 0;case d.ImageFormat.Jpeg:return 4;case d.ImageFormat.Png:return 5}};
a.prototype._validateImage=function(a){if(void 0===a.format)throw new d.ParseError("missing 'format' property");if(void 0===a.data)throw new d.ParseError("missing 'data' property");if((a.format===d.ImageFormat.Gray8||a.format===d.ImageFormat.GrayAlpha16||a.format===d.ImageFormat.Rgb24||a.format===d.ImageFormat.Rgba32)&&(void 0===a.width||0>=a.width||void 0===a.height||0>=a.height))throw new d.ParseError("uncompressed format requested but missing width or height");};a.prototype.createImage=function(a,
c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){this._validateImage(a);return void 0!==c?(this._validateImage(c),[2,this._sc.Image.create(this._toImageFormat(a.format),a.data,a.width,a.height,this._toImageFormat(c.format),c.data,c.width,c.height)]):[2,this._sc.Image.create(this._toImageFormat(a.format),a.data,a.width,a.height)]})})};a.prototype.destroyImages=function(a){return this._sc.Image.destroy(a)};a.prototype._toTextureTiling=function(a){switch(a){default:case d.TextureTiling.Repeat:return 0;
case d.TextureTiling.Clamp:return 1}};a.prototype._toTextureInterpolation=function(a){return!1===a?1:0};a.prototype._toTextureMipMapping=function(a){return!1===a?1:0};a.prototype._toTextureParameterization=function(a){switch(a){default:case d.TextureParameterization.UV:return 0}};a.prototype._toTextureModifier=function(a){switch(a){default:case 0:return 0;case d.TextureModifier.Decal:return 1}};a.prototype.setTexture=function(a,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(f){if(void 0===c.imageId)throw new d.ParseError("missing 'imageId' property");return[2,this._sc.MeshInstance.setTexture(a,0,c.imageId,void 0!==c.matrix?c.matrix.m:(new d.Matrix).m,this._toTextureTiling(c.tiling),this._toTextureInterpolation(c.interpolation),this._toTextureMipMapping(c.mipMapping),this._toTextureParameterization(c.parameterization),this._toTextureModifier(c.modifiers))]})})};a.prototype.unsetTexture=function(a){this._sc.MeshInstance.unsetTexture(a,0)};a.prototype.createMaterial=
function(){return this._sc.Material.create()};a.prototype._getMaterialPromiseWithDiffuseColor=function(a,c,f,b){var d=new h.MaterialInfo;d.setDiffuseColor(null!==a?a:f);d.setDiffuseTransparency(null!==c?c:b);return this._materialCache.getOrCreateMaterial(d)};a.prototype.createMatrix=function(a){return this._sc.Matrix.create(a)};a.prototype.createIdentityMatrix=function(){return this._sc.Matrix.create()};a.prototype.createMeshInstance=function(a){return __awaiter(this,void 0,void 0,function(){var c,
f,b,k,e,g,h,t,u,v;return __generator(this,function(l){switch(l.label){case 0:c=a.getMeshId();if(null===c)throw new d.CommunicatorError("MeshId is not set");e=this._matrixCache.getIdentityInc();g=[];if(h=a.getMatrix())t=this.createMatrix(h.m).then(function(a){e=a}),g.push(t);u=new d.Color(255,0,0);g.push(this._getMaterialPromiseWithDiffuseColor(a.getFaceColor(),a.getOpacity(),u,1).then(function(a){f=a}));g.push(this._getMaterialPromiseWithDiffuseColor(a.getLineColor(),a.getLineOpacity(),u,1).then(function(a){b=
a}));g.push(this._getMaterialPromiseWithDiffuseColor(a.getPointColor(),a.getPointOpacity(),u,1).then(function(a){k=a}));return[4,Promise.all(g)];case 1:return l.sent(),[4,this._sc.MeshInstance.create(c,e,f,b,k,a.getCreationFlags(),a.getOverlayIndex())];case 2:return v=l.sent(),this._callbackManager.trigger("_geometryCreated",v),[2,v]}})})};a.prototype.destroyLocalInstances=function(a){return this._sc.MeshInstance.destroy(a)};a.prototype._fromScCamera=function(a){var c=d.Projection.Orthographic;0===
a.projection()&&(c=d.Projection.Perspective);return d.Camera.create(d.Point3.createFromArray(a.position()),d.Point3.createFromArray(a.target()),d.Point3.createFromArray(a.upVector()),c,a.fieldWidth(),a.fieldHeight(),a.nearLimit())};a.prototype.getCameraPromise=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._sc.getCameraPromise()];case 1:return a=c.sent(),[2,this._fromScCamera(a)]}})})};a.prototype.getCamera=
function(){var a=this._sc.getCamera();return this._fromScCamera(a)};a.prototype.resize=function(){this._sc.onResize();this._windowSize.set(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight)};a.prototype.setFaceVisibility=function(a){this._sc.setFacesVisible(a)};a.prototype.setLineVisibility=function(a){this._sc.setLinesVisible(a)};a.prototype.getCanvasSize=function(){return this._windowSize.copy()};a.prototype.setBackgroundGradient=function(a,c){this._sc.setBackgroundGradient(a?
this._toRgba(a,1):[0,0,0,0],c?this._toRgba(c,1):[0,0,0,0])};a.prototype.setServerRenderQuality=function(a,c,f,b){this._sc.setSsrQuality({jpegQualityLow:a,jpegQualityHigh:c,scaleLow:f,scaleHigh:b})};a.prototype.setMinimumFramerate=function(a){this._sc.setMinFrameRate(a)};a.prototype.getMinimumFramerate=function(){return this._sc.getMinFrameRate()};a.prototype.setBackFacesVisible=function(a){this._sc.setBackFacesVisible(a)};a.prototype.setDrawMode=function(a){this._sc.setDrawMode(a)};a.prototype.enableHiddenLineRendering=
function(a){this.setDrawMode(2);this._sc.setHiddenLineVisibleLineColor(this._toRgba(a.getVisibleLineColor(),a.getVisibleLineOpacity()));this._sc.setHiddenLineHiddenLineColor(this._toRgba(a.getObscuredLineColor(),a.getObscuredLineOpacity()))};a.prototype.setAntiAliasingMode=function(a){switch(a){case d.AntiAliasingMode.None:this._sc.setAntiAliasingMode(0);break;case d.AntiAliasingMode.SMAA:this._sc.setAntiAliasingMode(1)}};a.prototype.setInstanceModifier=function(a,c,f){switch(a){case d.InstanceModifier.DoNotCut:this._sc.MeshInstance.setDoNotCut(c,
f);break;case d.InstanceModifier.DoNotExplode:this._sc.MeshInstance.setDoNotExplode(c,f);break;case d.InstanceModifier.DoNotSelect:this._sc.MeshInstance.setDoNotSelect(c,f);break;case d.InstanceModifier.SuppressCameraScale:this._sc.MeshInstance.setSuppressCameraScale(c,f);break;case d.InstanceModifier.OverrideSceneVisibility:this._sc.MeshInstance.setOverrideSceneVisibility(c,f);break;case d.InstanceModifier.DoNotLight:this._sc.MeshInstance.setDoNotLight(c,f);break;case d.InstanceModifier.DoNotOutlineHighlight:this._sc.MeshInstance.setDoNotOutlineHighlight(c,
f);break;case d.InstanceModifier.ExcludeBounding:this._sc.MeshInstance.setExcludeBounding(c,f);break;case d.InstanceModifier.DoNotUseVertexColors:this._sc.MeshInstance.setDoNotUseVertexColors(c,f);break;case d.InstanceModifier.AlwaysDraw:this._sc.MeshInstance.setAlwaysDraw(c,f);break;case d.InstanceModifier.DoNotXRay:this._sc.MeshInstance.setDoNotXRay(c,f);break;case d.InstanceModifier.ScreenOriented:this._sc.MeshInstance.setScreenOriented(c,f);break;case d.InstanceModifier.ScreenSpace:this._sc.MeshInstance.setScreenSpace(c,
f);break;case d.InstanceModifier.ScreenSpaceStretched:this._sc.MeshInstance.setScreenSpaceStretched(c,f)}};a.prototype.attachModel=function(a,c,f,b,d){return this._attachModels(a,[[c,f]],b,d)};a.prototype.attachScsModelByKey=function(a,c,f,b,d){console.assert(2===this._sessionType);return this._sc.attachScsModelByKey(a,f,c,b,d)};a.prototype._attachModels=function(a,c,f,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.attachModels(a,
c,f,b)];case 1:return d.sent(),this._callbackManager.trigger("_attached",a),[2]}})})};a.prototype.attachScsBuffer=function(a,c,f,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(k){switch(k.label){case 0:return[4,this._sc.attachScsBuffer(a,c,f,b,d,e)];case 1:return k.sent(),this._callbackManager.trigger("_attached",a),[2]}})})};a.prototype.feedScsBuffer=function(a,c){this._sc.feedScsBuffer(a,c)};a.prototype._parseKeyInfo=function(a,c,f){if(a||c)return f;a=new Map;
for(c=0;c<f.length;++c){for(var b=f[c++],d=[];c<f.length&&4294967295!==f[c];++c)d.push(f[c]);a.set(b,d)}return a};a.prototype.instanceKeyInfo=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var b,d,k;return __generator(this,function(e){switch(e.label){case 0:return b=1===c,d=1===f,[4,this._sc.meshInstanceKeyInfo(a,b,d)];case 1:return k=e.sent(),[2,this._parseKeyInfo(b,d,k)]}})})};a.prototype.metaDataKeyInfo=function(a,c,f){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(d){switch(d.label){case 0:return[4,this._sc.metaDataKeyInfo(a,c,f)];case 1:return b=d.sent(),[2,this._parseKeyInfo(c,f,b)]}})})};a.prototype.modelKeysFromInclusionKeys=function(a){return this._sc.modelKeysFromInclusionKeys(a)};a.prototype.detachInclusions=function(a){return this._sc.detachInclusions(a)};a.prototype.resetToEmpty=function(a,c){return __awaiter(this,void 0,void 0,function(){var f,b,d,k;return __generator(this,function(e){switch(e.label){case 0:for(f=0;f<this._requestBatchCountByType.length;++f){b=
this._requestBatchCountByType[f]=0;for(d=this._pendingRequestsByType[f];b<d.length;b++)k=d[b],k.promise.reject(k.ids);this._pendingRequestsByType[f].length=0}return[4,this._sc.resetToEmpty(a,c)];case 1:return e.sent(),this.flushMetaDataCache(),[2]}})})};a.prototype.redraw=function(){this._sc.queueRedraw()};a.prototype.disconnectNetwork=function(){this._sc.disconnectNetwork()};a.prototype.shutdown=function(){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=
null);this._sessionType=0;this._sc.shutDown()};a.prototype.getVersionString=function(){return this._sc.getStreamVersion().toString()};a.prototype.setAllowHighDpi=function(a){this._sc.allowHighDpi=a;this.resize()};a.prototype.getAllowHighDpi=function(){return this._sc.allowHighDpi};a.prototype.setMeshLevel=function(a,c){this._sc.MeshInstance.setMeshLevel(a,c)};a.prototype.setOverlayVisibility=function(a,c){this._sc.Overlay.setVisible(a,c)};a.prototype.setOverlayCamera=function(a,c){c=this._toCamera(c);
this._sc.Overlay.setCamera(a,c)};a.prototype.destroyOverlay=function(a){this._sc.Overlay.destroy(a)};a.prototype._overlayUnit=function(a){switch(a){case d.OverlayUnit.ProportionOfCanvas:return 1;case d.OverlayUnit.ProportionOfOtherDimension:return 2;default:return 0}};a.prototype.getMaxOverlayIndex=function(){return this._sc.Overlay.maxIndex()};a.prototype._overlayAnchor=function(a){switch(a){case d.OverlayAnchor.BottomCenter:return 7;case d.OverlayAnchor.Center:return 8;case d.OverlayAnchor.LeftCenter:return 5;
case d.OverlayAnchor.LowerLeftCorner:return 1;case d.OverlayAnchor.LowerRightCorner:return 2;case d.OverlayAnchor.RightCenter:return 6;case d.OverlayAnchor.TopCenter:return 4;case d.OverlayAnchor.UpperRightCorner:return 3;default:return 0}};a.prototype.setOverlayViewport=function(a,c,f,b,d,e,g,h,t,u){this._sc.Overlay.setViewport(a,this._overlayAnchor(c),f,this._overlayUnit(b),d,this._overlayUnit(e),g,this._overlayUnit(h),t,this._overlayUnit(u))};a.prototype.addNodesToOverlay=function(a,c){this._sc.MeshInstance.setOverlayIndex(a,
c)};a.prototype.getInstancesMeshData=function(a){return this._sc.MeshInstance.getMeshData(a)};a.prototype.getMeshData=function(a){return this._sc.MeshData.getData(a)};a.prototype._toElementType=function(a){switch(a){case d.ElementType.Faces:return 0;case d.ElementType.Lines:return 1;case d.ElementType.Points:return 2}};a.prototype._toXRayGroup=function(a){switch(a){case d.XRayGroup.Selected:return 0;case d.XRayGroup.Unselected:return 1}};a.prototype.setXRayColor=function(a,c,f){var b=this._xRayMaterials[a][c];
if(b.color&&b.color.equals(f))return Promise.resolve();b.color=f;this.setDiffuseColor(b.id,this._toRgba(f,1));return this._sc.setXRayMaterial(this._toXRayGroup(a),this._toElementType(c),b.id)};a.prototype.unsetXRayColor=function(a,c){if(!this._xRayMaterials[a][c].color)return Promise.resolve();this._xRayMaterials[a][c].color=null;return this._sc.unsetXRayMaterial(this._toXRayGroup(a),this._toElementType(c))};a.prototype.setXRayOpacity=function(a,c){void 0!==c?this._sc.setXRayOpacity(this._toElementType(c),
a):(this._sc.setXRayOpacity(0,a),this._sc.setXRayOpacity(1,a),this._sc.setXRayOpacity(2,a))};a.prototype._xRayTransparencyMode=function(a){switch(a){case d.XRayTransparencyMode.Unsorted:return 0;case d.XRayTransparencyMode.SingleLayer:return 1}};a.prototype.setXRayTransparencyMode=function(a){this._sc.setXRayTransparencyMode(this._xRayTransparencyMode(a))};a.prototype._transparencyMode=function(a){switch(a){case d.TransparencyMode.Unsorted:return 0;case d.TransparencyMode.SingleLayer:return 1}};a.prototype.setTransparencyMode=
function(a){this._sc.setTransparencyMode(this._transparencyMode(a))};a.prototype._toPointSizeUnit=function(a){switch(a){case d.PointSizeUnit.ScreenPixels:return 0;case d.PointSizeUnit.CSSPixels:return 1;case d.PointSizeUnit.World:return 2;case d.PointSizeUnit.ProportionOfScreenWidth:return 3;case d.PointSizeUnit.ProportionOfScreenHeight:return 4;case d.PointSizeUnit.ProportionOfBoundingDiagonal:return 5}};a.prototype._toPointShape=function(a){switch(a){case d.PointShape.Square:return 0;case d.PointShape.Disk:return 1;
case d.PointShape.Sphere:return 2}};a.prototype._fromPointSizeUnit=function(a){switch(a){default:case 0:return d.PointSizeUnit.ScreenPixels;case 1:return d.PointSizeUnit.CSSPixels;case 2:return d.PointSizeUnit.World;case 3:return d.PointSizeUnit.ProportionOfScreenWidth;case 4:return d.PointSizeUnit.ProportionOfScreenHeight;case 5:return d.PointSizeUnit.ProportionOfBoundingDiagonal}};a.prototype._fromPointShape=function(a){switch(a){default:case 0:return d.PointShape.Square;case 1:return d.PointShape.Disk;
case 2:return d.PointShape.Sphere}};a.prototype.setPointSize=function(a,c){this._sc.setPointSize(a,this._toPointSizeUnit(c))};a.prototype.getPointSize=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,Promise.all([this._sc.getPointSize(),this._sc.getPointSizeUnit()])];case 1:return a=c.sent(),[2,[a[0],this._fromPointSizeUnit(a[1])]]}})})};a.prototype.setPointShape=function(a){this._sc.setPointShape(this._toPointShape(a))};
a.prototype.getPointShape=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=this._fromPointShape,[4,this._sc.getPointShape()];case 1:return[2,a.apply(this,[c.sent()])]}})})};a.prototype.setEyeDomeLightingEnabled=function(a){this._sc.setEyeDomeLightingEnabled(a)};a.prototype.getEyeDomeLightingEnabled=function(){return this._sc.getEyeDomeLightingEnabled()};a.prototype.setEyeDomeLightingBlurSamples=function(a){this._sc.setEyeDomeLightingBlurSamples(a)};
a.prototype.getEyeDomeLightingBlurSamples=function(){return this._sc.getEyeDomeLightingBlurSamples()};a.prototype.setEyeDomeLightingBlurInterval=function(a){this._sc.setEyeDomeLightingBlurInterval(a)};a.prototype.getEyeDomeLightingBlurInterval=function(){return this._sc.getEyeDomeLightingBlurInterval()};a.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._sc.setEyeDomeLightingBlurEdgeDistance(a)};a.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._sc.getEyeDomeLightingBlurEdgeDistance()};
a.prototype.setEyeDomeLightingShadingEdgeDistance=function(a){this._sc.setEyeDomeLightingShadingEdgeDistance(a)};a.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._sc.getEyeDomeLightingShadingEdgeDistance()};a.prototype.setEyeDomeLightingOpacity=function(a){this._sc.setEyeDomeLightingOpacity(a)};a.prototype.getEyeDomeLightingOpacity=function(){return this._sc.getEyeDomeLightingOpacity()};a.prototype.setDisplayIncompleteFrames=function(a){this._sc.setDisplayIncompleteFrames(a)};
a.prototype.setInteractiveDrawDelay=function(a){this._sc.setPostInputDelay(a)};a.prototype.setInteractiveDrawLimitIncreaseEnabled=function(a){this._sc.setInteractiveDrawLimitIncreaseEnabled(a)};a.prototype.getInteractiveDrawLimitIncreaseEnabled=function(){return this._sc.getInteractiveDrawLimitIncreaseEnabled()};a.prototype._toCullingVectorSpace=function(a){switch(a){case d.CullingVectorSpace.Object:return 0;case d.CullingVectorSpace.World:return 1}};a.prototype._fromCullingVectorSpace=function(a){switch(a){default:case 0:return d.CullingVectorSpace.Object;
case 1:return d.CullingVectorSpace.World}};a.prototype.setCullingVector=function(a,c,f,b){this._sc.MeshInstance.setCullingVector(a,this._toCullingVectorSpace(c),[f.x,f.y,f.z],b)};a.prototype.unsetCullingVector=function(a){this._sc.MeshInstance.unsetCullingVector(a)};a.prototype.getCullingVector=function(a){return __awaiter(this,void 0,void 0,function(){var c,f,b,k,e;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sc.MeshInstance.getCullingVector(a)];case 1:c=l.sent();f=[];
b=0;for(k=c;b<k.length;b++)e=k[b],0===e.vector[0]&&0===e.vector[1]&&0===e.vector[2]?f.push(null):f.push({space:this._fromCullingVectorSpace(e.space),vector:d.Point3.createFromArray(e.vector),toleranceDegrees:e.toleranceDegrees});return[2,f]}})})};a.prototype._setStreamCutoffScale=function(a){this._streamCutoffScale=Math.max(0,Math.min(a,2))};a.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);this._sc.setStreamCutoffScale(this._streamCutoffScale)};a.prototype.getStreamCutoffScale=
function(){return this._streamCutoffScale};a.prototype.loseWebGlContext=function(){return this._sc._loseWebGlContext()};a.prototype.triangulatePolygon=function(a,c){a=this._sc.triangulatePolygon(a,c);return new Float32Array(a)};a.prototype.debug_log=function(a){return this._sc.debug_log(a)};a.prototype.debug_stateFailure=function(a){return this._sc.debug_stateFailure(a)};a.prototype.debug_sync=function(){return this._sc.debug_sync()};a.prototype._toLinePatternLengthUnit=function(a){switch(a){case d.LinePatternLengthUnit.Object:return 0;
case d.LinePatternLengthUnit.World:return 1;case d.LinePatternLengthUnit.ProportionOfScreenWidth:return 2;case d.LinePatternLengthUnit.ProportionOfScreenHeight:return 3}};a.prototype.setLinePattern=function(a,c,f,b){this._sc.MeshInstance.setLinePattern(a,c,f,this._toLinePatternLengthUnit(b))};a.prototype.unsetLinePattern=function(a){this._sc.MeshInstance.unsetLinePattern(a)};a.prototype.createFloorplanMesh=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){return[2,
this._sc.createFloorplanMesh(a)]})})};a.prototype.exportToSvg=function(a){return __awaiter(this,void 0,void 0,function(){var c,f;return __generator(this,function(b){switch(b.label){case 0:return[4,this._sc.exportToSvg(a)];case 1:return c=b.sent(),f=c.map(function(a){return String.fromCharCode(a)}),[2,f.join("")]}})})};a.prototype.waitForImageDecoding=function(){return this._sc.waitForImageDecoding()};a.prototype.registerBimInstances=function(a,c){return this._sc.registerBimInstances(a,c)};a.prototype.setAmbientLightColor=
function(a){this._sc.setAmbientLightColor(this._toRgb(a))};a.prototype.clearLights=function(){this._sc.clearLights()};a.prototype._toLightType=function(a){switch(a){default:case d.LightType.Directional:return 0}};a.prototype._toLightSpace=function(a){switch(a){case d.LightSpace.World:return 0;default:case d.LightSpace.Camera:return 1}};a.prototype.addLight=function(a){return this._sc.addLight(this._toLightType(a.type),this._toLightSpace(a.space),this._toVector3(a.position),this._toRgb(a.color))};
a.prototype.removeLight=function(a){this._sc.removeLight(a)};a.prototype.updateLight=function(a,c){this._sc.updateLight(a,this._toLightType(c.type),this._toLightSpace(c.space),this._toVector3(c.position),this._toRgb(c.color))};a.prototype.setBloomEnabled=function(a){this._sc.setBloomEnabled(a)};a.prototype.setBloomThreshold=function(a){this._sc.setBloomThreshold(a)};a.prototype.setBloomThresholdRampWidth=function(a){this._sc.setBloomThresholdRampWidth(a)};a.prototype.setBloomIntensityScale=function(a){this._sc.setBloomIntensityScale(a)};
a.prototype._toBlurIntervalUnit=function(a){switch(a){default:case d.BlurIntervalUnit.Pixels:return 0;case d.BlurIntervalUnit.ProportionOfWidth:return 1;case d.BlurIntervalUnit.ProportionOfHeight:return 2}};a.prototype.setBloomLayers=function(a){for(var c=0;c<a.length;c++){var f=a[c];if(void 0!==f.blurInterval&&2!==f.blurInterval.length)throw new d.CommunicatorError("'blurInterval' must be an array containing a number followed by a BlurIntervalUnit");}this._sc.suspendDrawing();this._sc.setBloomLayerCount(a.length);
for(c=0;c<a.length;++c)f=a[c],void 0!==f.intensity&&this._sc.setBloomIntensity(c,f.intensity),void 0!==f.blurSamples&&this._sc.setBloomBlurSamples(c,f.blurSamples),void 0!==f.blurInterval&&this._sc.setBloomBlurInterval(c,f.blurInterval[0],this._toBlurIntervalUnit(f.blurInterval[1]));this._sc.resumeDrawing()};a.prototype.startComparison=function(a,c,f){var b=f&&f.sameColor?this._toRgb(f.sameColor):[0,0,0],d=f&&f.only1Color?this._toRgb(f.only1Color):[1,0,0];f=f&&f.only2Color?this._toRgb(f.only2Color):
[0,1,0];this._sc.setComparisonColors(b,d,f);this._sc.startComparison(a,c)};a.prototype.endComparison=function(){this._sc.endComparison()};a.prototype.setSimpleShadowColor=function(a){this._sc.setSimpleShadowColor(this._toRgb(a))};a.prototype.setSimpleShadowEnabled=function(a){this._sc.setSimpleShadowEnabled(a)};a.prototype.setSimpleShadowOpacity=function(a){this._sc.setSimpleShadowOpacity(a)};a.prototype.setGroundPlane=function(a,c){void 0!==c?this._sc.setGroundPlaneWithPosition(this._toVector3(a),
this._toVector3(c)):this._sc.setGroundPlane(this._toVector3(a))};a.prototype.setSimpleShadowResolution=function(a){this._sc.setSimpleShadowResolution(a)};a.prototype.setSimpleShadowBlurSamples=function(a){this._sc.setSimpleShadowBlurSamples(a)};a.prototype.setSimpleShadowBlurInterval=function(a){this._sc.setSimpleShadowBlurInterval(a)};a.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._sc.setSimpleShadowInteractiveUpdateEnabled(a)};a.prototype.setSilhouetteColor=
function(a){this._sc.setSilhouetteColor(this._toRgb(a))};a.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._sc.setSilhouetteEnabled(a)};a.prototype.setSilhouetteOpacity=function(a){this._sc.setSilhouetteOpacity(a)};a.prototype.setSilhouetteThreshold=function(a){this._sc.setSilhouetteThreshold(a)};a.prototype.setSilhouetteThresholdRampWidth=function(a){this._sc.setSilhouetteThresholdRampWidth(a)};a.prototype.setHardEdgeColor=function(a){this._sc.setHardEdgeColor(this._toRgb(a))};
a.prototype.setHardEdgesEnabled=function(a){void 0===a&&(a=!0);this._sc.setHardEdgesEnabled(a)};a.prototype.setHardEdgeOpacity=function(a){this._sc.setHardEdgeOpacity(a)};a.prototype.setHardEdgeThreshold=function(a){this._sc.setHardEdgeThreshold(a)};a.prototype.setHardEdgeThresholdRampWidth=function(a){this._sc.setHardEdgeThresholdRampWidth(a)};a.prototype.setSimpleReflectionEnabled=function(a){void 0===a&&(a=!0);this._sc.setSimpleReflectionEnabled(a)};a.prototype.setSimpleReflectionBlurInterval=
function(a,c){this._sc.setSimpleReflectionBlurInterval(a,this._toBlurIntervalUnit(c))};a.prototype.setSimpleReflectionBlurSamples=function(a){this._sc.setSimpleReflectionBlurSamples(a)};a.prototype.setSimpleReflectionFadeAngle=function(a){this._sc.setSimpleReflectionFadeAngle(a)};a.prototype.setSimpleReflectionOpacity=function(a){this._sc.setSimpleReflectionOpacity(a)};a.prototype.setSimpleReflectionAttenuation=function(a,c,f){void 0===f&&(f=d.SimpleReflectionAttenuationUnit.World);this._sc.setSimpleReflectionAttenuation(a,
c,f)};a.prototype.throttleLoad=function(a,c){this._sc.throttleLoad(a,c)};a.prototype._toVector3Array=function(a){for(var c=[],f=0;f<a.length;f++){var b=a[f];c.push([b.x,b.y,b.z])}return c};a.prototype.testPointVisibility=function(a){return this._sc.testPointVisibility(this._toVector3Array(a))};a.prototype.setPointVisibilityTest=function(a){this._sc.setPointVisibilityTest(this._toVector3Array(a))};return a}();h.ScEngine=a})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function a(a,c,b,d,e,g,h){this._position=a.copy();this._normal=c.copy();this._elementIndex=b;this._elementBits=e;this._bounding=g.copy();this._overlayIndex=d;this._isProximityFace=h}a.prototype.isProximityFace=function(){return this._isProximityFace};a.prototype.isCappingGeometry=function(){return-1===this._elementIndex};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){return{position:this._position.toJson(),normal:this._normal.toJson(),
cadFaceIndex:this._elementIndex,cadFaceBits:this._elementBits,bounding:this._bounding.toJson(),overlayIndex:this._overlayIndex,isProximityFace:this._isProximityFace}};a.prototype.forJson=function(){return this.toJson()};a.fromJson=function(c){var f=d.Point3.fromJson(c.position),b=d.Point3.fromJson(c.normal),e=d.Box.fromJson(c.bounding);return new a(f,b,c.cadFaceIndex,c.overlayIndex,c.cadFaceBits,e,!0===c.isProximityFace)};a.construct=function(c){return a.fromJson(c)};a.prototype.getPosition=function(){return this._position.copy()};
a.prototype.getNormal=function(){return this._normal.copy()};a.prototype.getCadFaceIndex=function(){return this._elementIndex};a.prototype.getCadFaceBits=function(){return this._elementBits};a.prototype.getBounding=function(){return this._bounding.copy()};a.prototype.overlayIndex=function(){return this._overlayIndex};return a}();h.FaceEntity=g;var b=function(){function a(a,c,b,e,g,p,h){this._lineSegmentVertices=[];this._elementIndex=a;this._elementBits=h;this._position=c.copy();this._bounding=g.copy();
this._overlayIndex=p;if(b)for(0<=e&&(a=3*e,this._bestLineSegmentVertexIndex=new d.Point3(b[a],b[a+1],b[a+2])),this._lineSegmentVertices.push(new d.Point3(b[0],b[1],b[2])),a=3;a<b.length;a+=6)this._lineSegmentVertices.push(new d.Point3(b[a],b[a+1],b[a+2]))}a.prototype.isCappingGeometry=function(){return-1===this._elementIndex};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){for(var a=[],c=0,b=this._lineSegmentVertices;c<b.length;c++)a.push(b[c].toJson());return{lineId:this._elementIndex,
lineBits:this._elementBits,position:this._position.toJson(),linePoints:a,bounding:this._bounding.copy(),overlayIndex:this._overlayIndex}};a.prototype.forJson=function(){return this.toJson()};a.fromJson=function(c){var f=d.Point3.fromJson(c.position),b=d.Box.fromJson(c.bounding);f=new a(c.lineId,f,null,-1,b,c.overlayIndex,0);b=0;for(c=c.linePoints;b<c.length;b++){var e=d.Point3.fromJson(c[b]);f._lineSegmentVertices.push(e)}return f};a.construct=function(c){return a.fromJson(c)};a.prototype.getLineId=
function(){return this._elementIndex};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.getPoints=function(){return this._lineSegmentVertices};a.prototype.getBestVertex=function(){return this._bestLineSegmentVertexIndex?this._bestLineSegmentVertexIndex.copy():null};a.prototype.getLineBits=function(){return this._elementBits};a.prototype.getBounding=function(){return this._bounding.copy()};a.prototype.overlayIndex=function(){return this._overlayIndex};return a}();h.LineEntity=
b;var e=function(){function a(a,c,b,d){this._position=a.copy();this._elementIndex=c;this._overlayIndex=b;this._elementBits=d}a.fromJson=function(c){var f=d.Point3.fromJson(c.position);return new a(f,c.pointId,c.pointBits,c.overlayIndex)};a.construct=function(c){return a.fromJson(c)};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=function(){return{pointId:this._elementIndex,pointBits:this._elementBits,position:this._position.toJson(),overlayIndex:this._overlayIndex}};a.prototype.forJson=
function(){return this.toJson()};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.getPointBits=function(){return this._elementBits};a.prototype.getPointId=function(){return this._elementIndex};a.prototype.overlayIndex=function(){return this._overlayIndex};return a}();h.PointEntity=e;var c=function(){return function(a){this._handle=a}}();h.IncrementalSelectionId=c;c=function(){function a(a,c,b,d,e){void 0===a&&(a=null);void 0===c&&(c=null);void 0===b&&(b=null);void 0===
d&&(d=null);void 0===e&&(e=null);this._nodeId=a;this._inclusionKey=c;this._faceEntity=b;this._lineEntity=d;this._pointEntity=e}a.create=function(c,b,d,e,g){return new a(c,b,d,e,g)};a.prototype.getSelectionType=function(){return null===this._nodeId?d.SelectionType.None:null!==this._faceEntity?d.SelectionType.Face:null!==this._lineEntity?d.SelectionType.Line:null!==this._pointEntity?d.SelectionType.Point:d.SelectionType.Part};a.prototype.toJson=function(){return this._toJson()};a.prototype._toJson=
function(){return{nodeId:this._nodeId,includeId:this._inclusionKey,faceEntity:this._faceEntity?this._faceEntity.toJson():null,lineEntity:this._lineEntity?this._lineEntity.toJson():null,pointEntity:this._pointEntity?this._pointEntity.toJson():null}};a.prototype.forJson=function(){return this.toJson()};a._fromJson=function(c){return new a(c.nodeId,c.includeId,c.faceEntity?g.fromJson(c.faceEntity):null,c.lineEntity?b.fromJson(c.lineEntity):null,c.pointEntity?e.fromJson(c.pointEntity):null)};a.prototype.getFaceEntity=
function(){return this._faceEntity};a.prototype.getLineEntity=function(){return this._lineEntity};a.prototype.getPointEntity=function(){return this._pointEntity};a.prototype.getNodeId=function(){return this._nodeId};a.prototype.getInclusionKey=function(){return this._inclusionKey};a.prototype.getIncludeId=function(){return this.getInclusionKey()};a.prototype.getPosition=function(){return null!==this._faceEntity?this._faceEntity.getPosition():null!==this._lineEntity?this._lineEntity.getPosition():
null!==this._pointEntity?this._pointEntity.getPosition():null};a.prototype.overlayIndex=function(){return this._faceEntity?this._faceEntity.overlayIndex():this._lineEntity?this._lineEntity.overlayIndex():this._pointEntity?this._pointEntity.overlayIndex():null};a.prototype._setNodeId=function(a){this._nodeId=a};a.prototype.equals=function(a){return this._nodeId!==a._nodeId||this.getSelectionType()!==a.getSelectionType()?!1:this._faceEntity&&a._faceEntity?this._faceEntity.getCadFaceIndex()===a._faceEntity.getCadFaceIndex():
this._lineEntity&&a._lineEntity?this._lineEntity.getLineId()===a._lineEntity.getLineId():this._pointEntity&&a._pointEntity?this._pointEntity.getPointId()===a._pointEntity.getPointId():!0};a.prototype._hash=function(){var a=null!==this._nodeId?this._nodeId.toString(36):"";a+=";"+this.getSelectionType()+";";this._faceEntity&&(a+=this._faceEntity.getCadFaceIndex().toString(36));a+=";";this._lineEntity&&(a+=this._lineEntity.getLineId().toString(36));a+=";";this._pointEntity&&(a+=this._pointEntity.getPointId().toString(36));
return a};a.prototype.isEntitySelection=function(){return null!==this._faceEntity||null!==this._lineEntity||null!==this._pointEntity};a.prototype.isNodeSelection=function(){return null!==this._nodeId};a.prototype.isNodeEntitySelection=function(){return null!==this._nodeId&&this.isEntitySelection()};a.prototype.isFaceSelection=function(){return null!==this._nodeId&&null!==this._faceEntity};a.prototype.isLineSelection=function(){return null!==this._nodeId&&null!==this._lineEntity};a.prototype.isPointSelection=
function(){return null!==this._nodeId&&null!==this._pointEntity};return a}();h.SelectionItem=c;c=function(){function a(a,c,b){this.faceItem=a;this.lineItem=c;this.pointItem=b}a.prototype.fetchMostRelevant=function(a){return null!==this.pointItem&&0!==(a&d.SelectionMask.Point)?this.pointItem:null!==this.lineItem&&0!==(a&d.SelectionMask.Line)?this.lineItem:null!==this.faceItem&&0!==(a&d.SelectionMask.Face)?this.faceItem:null};return a}();h.CompositeSelectionItem=c})(d.Selection||(d.Selection={}))})(Communicator||
(Communicator={}));(function(d){(function(d){d.sleep=function(d){return new Promise(function(b){setTimeout(b,d)})}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.hasBits=function(d,b){return(d&b)===b};h.setBit=function(d,b,e){return e?d|b:d&~b};h.classFromString=function(d){d=d.split(".");for(var b=window||this,e=0;e<d.length;e++){if(void 0===b)return null;b=b[d[e]]}return"function"!==typeof b?null:b};h.projectOnto=function(g,b){g=d.Point3.dot(b,g);var e=b.squaredLength();return d.Point3.scale(b,g/e)};h.majorAxis=function(g){var b=Math.abs(g.x),e=Math.abs(g.y);g=Math.abs(g.z);b=+b.toFixed(6);e=+e.toFixed(6);g=+g.toFixed(6);return b>
e&&b>g?new d.Point3(1,0,0):e>b&&e>g?new d.Point3(0,1,0):g>b&&g>e?new d.Point3(0,0,1):null};h.deepClone=function(d){return JSON.parse(JSON.stringify(d))};h.getWithDefault=function(d,b){return void 0===d?b:d};h.versionAtLeast=function(d,b){for(var e=d.length>b.length?d.length:b.length,c=0;c<e;++c){var a=d[c]||0,f=b[c]||0;if(a>f)break;else if(a<f)return!1}return!0};h.versionString=function(d){if(0===d.length)return"";for(var b=""+d[0],e=1;e<d.length;++e)b+="."+d[e];return b}})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){var h=function(){return function(b){this.futureItemHash=null;this.pastItemHash=b}}(),g=function(){function b(){this.part=this.point=this.line=this.face=this.none=0}b.prototype.update=function(c,a){switch(c.getSelectionType()){case d.SelectionType.None:0===a?--this.none:++this.none;break;case d.SelectionType.Face:0===a?--this.face:++this.face;break;case d.SelectionType.Line:0===a?--this.line:++this.line;break;case d.SelectionType.Point:0===a?--this.point:++this.point;break;case d.SelectionType.Part:0===
a?--this.part:++this.part}};b.prototype.sum=function(){return this.none+this.face+this.line+this.point+this.part};return b}(),b=function(){function b(c,a,f,b,e){var k=this;this._selectedItemsPruned=new Map;this._selectedItemsFull=new Map;this._selectedNodeCounts=new Map;this._temporalLinks=new Map;this._newestItemHash=this._oldestItemHash=null;this._selectedLayers=new Set;this._selectedTypes=new Set;this._nodeSelectionColor=new d.Color(255,255,0);this._nodeSelectionOutlineColor=new d.Color(255,255,
0);this._elementSelectionColor=d.Color.red();this._elementSelectionOutlineColor=d.Color.red();this._nodeElementHighlightMode=this._nodeHighlightMode=d.SelectionHighlightMode.HighlightAndOutline;this._pruneSelectionDescendants=this._selectParentIfSelected=this._highlightPointElementSelection=this._highlightLineElementSelection=this._highlightFaceElementSelection=this._highlightNodeSelection=!0;this._selectionFilter=null;this._incrementalBlacklistedInstanceNodes=new Set;this._engine=a;this._view=f;
this._model=b;this._modelStructure=e;this._callbackManager=c;this._callbackManager.bind({_subtreeLoaded:function(a){for(var c=0;c<a.length;c++)k._onSubtreeLoaded(a[c]);return Promise.resolve()}})}b.deprecated=function(c,a,f){var b=f.value;f.value=function(){for(var c=[],f=0;f<arguments.length;f++)c[f]=arguments[f];this._callbackManager.trigger("deprecated","SelectionManager",a);return b.apply(this,c)};return f};b.prototype._init=function(){this._updateHighlightingMode();this._engine.setHighlightColorizeCompression(.7)};
b.prototype.setSelectionFilter=function(c){this._selectionFilter=c};b.prototype.getSelectionFilter=function(){return this._selectionFilter};b.prototype.setPruneSelectionDescendants=function(c){this._pruneSelectionDescendants=c;this.clear()};b.prototype.getPruneSelectionDescendants=function(){return this._pruneSelectionDescendants};b.prototype.setSelectParentIfSelected=function(c){this._selectParentIfSelected=c};b.prototype.getSelectParentIfSelected=function(){return this._selectParentIfSelected};
b.prototype.selectFromPoint=function(c,a,f){void 0===f&&(f=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromPoint(c,a)];case 1:return b=d.sent(),this._onSelectionItem(b,f),[2]}})})};b.prototype.selectAllFromPoint=function(c,a,f){void 0===f&&(f=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromPoint(c,
a)];case 1:return b=d.sent(),this._onSelectionItems(b,f),[2]}})})};b.prototype.selectFromRay=function(c,a,f){void 0===f&&(f=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromRay(c,a)];case 1:return b=d.sent(),this._onSelectionItem(b,f),[2]}})})};b.prototype.selectAllFromRay=function(c,a,f){void 0===f&&(f=d.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(d){switch(d.label){case 0:return[4,this._view.pickAllFromRay(c,a)];case 1:return b=d.sent(),this._onSelectionItems(b,f),[2]}})})};b.prototype._onSelectionItem=function(c,a){c.isNodeEntitySelection()?this._processSelection(c,a):this._triggerNullSelection()};b.prototype._onSelectionItems=function(c,a){a===d.SelectionMode.Set&&this.clear(!1);if(0===c.length)this._triggerNullSelection();else switch(a){case d.SelectionMode.Add:case d.SelectionMode.Set:this.add(c);break;case d.SelectionMode.Toggle:for(a=
0;a<c.length;a++)this.toggle(c[a]);break;default:d.Util.TypeAssertNever(a)}};b.prototype.beginScreenSelectByArea=function(c,a,f){return this._view.beginScreenSelectByArea(c,a,f)};b.prototype.beginRayDrillSelection=function(c,a,f){return this._view.beginRayDrillSelection(c,a,f)};b.prototype.beginConvexPolyhedronSelection=function(c,a,f){return this._view.beginConvexPolyhedronSelection(c,a,f)};b.prototype.beginSphereSelection=function(c,a,f){return this._view.beginSphereSelection(c,a,f)};b.prototype.endIncrementalSelection=
function(c){this._callbackManager.trigger("incrementalSelectionEnd");this._view.endIncrementalSelection(c);return Promise.resolve()};b.prototype.endVolumeSelection=function(c){return this.endIncrementalSelection(c)};b.prototype.advanceIncrementalSelection=function(c,a){void 0===a&&(a=null);return __awaiter(this,void 0,void 0,function(){var f,b;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.advanceIncrementalSelection(c)];case 1:return f=d.sent(),null===f?[2,!1]:null===
a?[3,3]:[4,Promise.all(f.map(a))];case 2:b=d.sent(),f=f.filter(function(a,c){return b[c]}),d.label=3;case 3:return this.add(f),[2,!0]}})})};b.prototype.advanceVolumeSelection=function(c,a){void 0===a&&(a=null);return this.advanceIncrementalSelection(c,a)};b.prototype.isSelected=function(c){return this.contains(c)?!0:c.isNodeSelection()?null!==this._findAncestor(c):!1};b.prototype.contains=function(c){return this._selectedItemsPruned.has(c._hash())};b.prototype.containsParent=function(c){return this._findAncestor(c)};
b.prototype._findAncestor=function(c){if(0<this._selectedItemsPruned.size)for(;;){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);var a=c._hash();if(this._selectedItemsPruned.has(a))return c}return null};b.prototype.selectLayer=function(c,a){a===d.SelectionMode.Set&&this.clear();var f=[],b=this._model.getLayerIdsFromName(c);if(null!==b)for(var e=0;e<b.length;e++){var g=this._model.getNodesFromLayer(b[e],!0);if(null!==g)for(var m=0;m<g.length;m++)f.push(d.Selection.SelectionItem.create(g[m]))}b=
this._selectedLayers.has(c);a===d.SelectionMode.Toggle&&b?this.remove(f):(this.add(f),this._selectedLayers.add(c))};b.prototype.getSelectedLayers=function(){var c=[];this._selectedLayers.forEach(function(a){c.push(a)});return c};b.prototype.selectType=function(c,a){a===d.SelectionMode.Set&&this.clear();var f=[],b=this._model.getNodesByGenericType(c);null!==b&&b.forEach(function(a){f.push(d.Selection.SelectionItem.create(a))});b=this._selectedTypes.has(c);if(a===d.SelectionMode.Toggle&&b)for(c=0;c<
f.length;c++)this.remove(f[c]);else this.add(f),this._selectedTypes.add(c)};b.prototype.getSelectedTypes=function(){var c=[];this._selectedTypes.forEach(function(a){c.push(a)});return c};b.prototype.selectNode=function(c,a){void 0===a&&(a=d.SelectionMode.Set);if(null!==c&&this._modelStructure.isIdValid(c))return c=d.Selection.SelectionItem.create(c),this._processSelection(c,a),c.getSelectionType();this._processSelection(null,a);return d.SelectionType.None};b.prototype._triggerNullSelection=function(){this._callbackManager.trigger("selectionArray",
[],!1)};b.prototype._isInAxisOverlay=function(c){var a=c.getFaceEntity();return a||(a=c.getLineEntity())?1===a.overlayIndex():(c=c.getPointEntity())?1===c.overlayIndex():!1};b.prototype._getNodeCounts=function(c){c=c.getNodeId();var a=this._selectedNodeCounts.get(c);a||(a=new g,this._selectedNodeCounts.set(c,a));return a};b.prototype._addToFull=function(c,a){for(;this._selectedItemsFull.set(a,c);){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c);a=
c._hash()}};b.prototype._addItems=function(c){var a=c.length;if(0!==a){this._callbackManager.trigger("incrementalSelectionBatchBegin");for(var f=[],b=0;b<a;++b){var e=this._filterItem(c[b]);null!==e&&this._addImpl(e,e._hash())&&(e=new d.Event.NodeSelectionEvent(e),f.push(e))}0===f.length?this._triggerNullSelection():this._callbackManager.trigger("selectionArray",f,!1);this._callbackManager.trigger("incrementalSelectionBatchEnd")}};b.prototype._addItem=function(c){c=this._filterItem(c);null!==c&&this._addImpl(c,
c._hash())?(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1)):this._triggerNullSelection()};b.prototype.add=function(c){null===c?this._triggerNullSelection():Array.isArray(c)?this._addItems(c):this._addItem(c)};b.prototype._filterItem=function(c){if(null===this._selectionFilter)return c;var a=c.getNodeId(),f=this._selectionFilter(a,this._model);return f===a?c:null===f?null:d.Selection.SelectionItem.create(f)};b.prototype._addImpl=function(c,a){if(c.getSelectionType()===
d.SelectionType.None)return!1;if(this._isInAxisOverlay(c))return!0;if(this._selectedItemsPruned.has(a))return!1;if(this._pruneSelectionDescendants){if(null!==this._findAncestor(c))return!1;this._removeDescendants(c)}this._selectedItemsPruned.set(a,c);this._addToFull(c,a);this._getNodeCounts(c).update(c,1);var f=this._newestItemHash;this._newestItemHash=a;this._oldestItemHash||(this._oldestItemHash=a);if(null!==f){var b=this._temporalLinks.get(f);b&&(b.futureItemHash=a)}f=new h(f);this._temporalLinks.set(a,
f);this._updateItemHighlight(c,!0,!0);if(this._modelStructure.getType(c.getNodeId())===d.NodeType.Pmi&&(c=this._modelStructure.getPmiTopologyReferences(c.getNodeId()),null!==c))for(a=0;a<c.length;a++){b=c[a];f=b.body.getRuntimeId();for(var e=0,g=b.faceIds;e<g.length;e++)this._model.setNodeFaceHighlighted(f,g[e],!0);e=0;for(b=b.edgeIds;e<b.length;e++)this._model.setNodeLineHighlighted(f,b[e],!0)}return!0};b.prototype._removeUpdateLayers=function(c){0<this._selectedLayers.size&&(c=c.getNodeId(),null!==
c&&(c=this._model.getNodeLayerId(c),null!==c&&(c=this._model.getLayerName(c),null!==c&&this._selectedLayers.delete(c))))};b.prototype._removeUpdateTypes=function(c){0<this._selectedTypes.size&&(c=c.getNodeId(),null!==c&&(c=this._model.getNodeGenericType(c),null!==c&&this._selectedTypes.delete(c)))};b.prototype._removeFromFull=function(c,a){this._removeUpdateLayers(c);this._removeUpdateTypes(c);if(this._selectedItemsFull.delete(a))for(a=0,c=this._model.getNodeChildren(c.getNodeId());a<c.length;a++){var f=
d.Selection.SelectionItem.create(c[a]);this._removeFromFull(f,f._hash())}};b.prototype._removeItems=function(c){var a=this,f=[];c.forEach(function(c){a._removeImpl(c,c._hash())&&f.push(new d.Event.NodeSelectionEvent(c))});this._callbackManager.trigger("selectionArray",f,!0)};b.prototype._removeItem=function(c){this._removeImpl(c,c._hash())&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0))};b.prototype.remove=function(c){Array.isArray(c)?this._removeItems(c):
this._removeItem(c)};b.prototype._removeImpl=function(c,a){if(!this._selectedItemsPruned.delete(a))return!1;this._removeFromFull(c,a);var f=this._getNodeCounts(c);f.update(c,0);var b=this._temporalLinks.get(a);if(void 0!==b){this._temporalLinks.delete(a);if(null!==b.pastItemHash){var d=this._temporalLinks.get(b.pastItemHash);d&&(d.futureItemHash=b.futureItemHash)}null!==b.futureItemHash&&(d=this._temporalLinks.get(b.futureItemHash))&&(d.pastItemHash=b.pastItemHash);this._oldestItemHash===a&&(this._oldestItemHash=
b.futureItemHash);this._newestItemHash===a&&(this._newestItemHash=b.pastItemHash)}a=!0;0===f.sum()&&(a=!1,f=c.getNodeId(),this._selectedNodeCounts.delete(f));this._updateItemHighlight(c,a,!1);return!0};b.prototype.toggle=function(c){var a=this._findAncestor(c);null!==a?null===c.getFaceEntity()&&null===c.getLineEntity()&&null===c.getPointEntity()&&this._removeImplicit(c,a):(a=c._hash(),this._selectedItemsPruned.has(a)?this._removeImpl(c,a)&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",
[c],!0)):(c=this._filterItem(c),null!==c&&this._addImpl(c,c._hash())&&(c=new d.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1))))};b.prototype.set=function(c){this.clear(!1);this.add(c)};b.prototype.getResults=function(){var c=[];this.each(function(a){c.push(a)});return c};b.prototype.getResult=function(c){var a=this.size();if(0>c||c>=a)return null;a=a-c-1;return c<=a?this._getItemFromOldest(c):this._getItemFromNewest(a)};b.prototype._getItemFromOldest=function(c){for(var a=
this._oldestItemHash;a;){if(0===c--)return this._selectedItemsPruned.get(a)||null;a=this._temporalLinks.get(a).futureItemHash}return null};b.prototype._getItemFromNewest=function(c){for(var a=this._newestItemHash;a;){if(0===c--)return this._selectedItemsPruned.get(a)||null;a=this._temporalLinks.get(a).pastItemHash}return null};b.prototype.getFirst=function(){return null!==this._oldestItemHash?this._selectedItemsPruned.get(this._oldestItemHash)||null:null};b.prototype.getLast=function(){return null!==
this._newestItemHash?this._selectedItemsPruned.get(this._newestItemHash)||null:null};b.prototype.size=function(){return this._selectedItemsPruned.size};b.prototype.each=function(c){for(var a=this._oldestItemHash;a;){var f=this._selectedItemsPruned.get(a);c(f);a=this._temporalLinks.get(a).futureItemHash}};b.prototype.clear=function(c){void 0===c&&(c=!0);this._selectedLayers.clear();this._selectedTypes.clear();this._clearHighlight();this._selectedItemsPruned.clear();this._selectedItemsFull.clear();
this._selectedNodeCounts.clear();this._temporalLinks.clear();this._newestItemHash=this._oldestItemHash=null;c&&this._triggerNullSelection()};b.prototype.setNodeSelectionColor=function(c){this._setNodeSelectionColor(c);return Promise.resolve()};b.prototype._setNodeSelectionColor=function(c){this._nodeSelectionColor.assign(c);this._updateHighlightingMode()};b.prototype.getNodeSelectionColor=function(){return this._nodeSelectionColor.copy()};b.prototype.setNodeSelectionOutlineColor=function(c){this._setNodeSelectionOutlineColor(c);
return Promise.resolve()};b.prototype._setNodeSelectionOutlineColor=function(c){this._nodeSelectionOutlineColor.assign(c);this._updateHighlightingMode()};b.prototype.getNodeSelectionOutlineColor=function(){return this._nodeSelectionOutlineColor.copy()};b.prototype.setNodeElementSelectionColor=function(c){this._setNodeElementSelectionColor(c);return Promise.resolve()};b.prototype._setNodeElementSelectionColor=function(c){this._elementSelectionColor.assign(c);this._updateHighlightingMode()};b.prototype.getNodeElementSelectionColor=
function(){return this._elementSelectionColor.copy()};b.prototype.setNodeElementSelectionOutlineColor=function(c){this._setNodeElementSelectionOutlineColor(c);return Promise.resolve()};b.prototype._setNodeElementSelectionOutlineColor=function(c){this._elementSelectionOutlineColor.assign(c);this._updateHighlightingMode()};b.prototype.getNodeElementSelectionOutlineColor=function(){return this._elementSelectionOutlineColor.copy()};b.prototype.getHighlightFaceElementSelection=function(){return this._highlightFaceElementSelection};
b.prototype.setHighlightFaceElementSelection=function(c){this._highlightFaceElementSelection=c;this._updateHighlight();return Promise.resolve()};b.prototype.setNodeSelectionHighlightMode=function(c){this._setNodeSelectionHighlightMode(c);return Promise.resolve()};b.prototype._setNodeSelectionHighlightMode=function(c){this._nodeHighlightMode=c;this._updateHighlightingMode()};b.prototype.getNodeSelectionHighlightMode=function(){return this._nodeHighlightMode};b.prototype.setNodeElementSelectionHighlightMode=
function(c){this._setNodeElementSelectionHighlightMode(c);return Promise.resolve()};b.prototype._setNodeElementSelectionHighlightMode=function(c){this._nodeElementHighlightMode=c;this._updateHighlightingMode()};b.prototype.getNodeElementSelectionHighlightMode=function(){return this._nodeElementHighlightMode};b.prototype.setHighlightNodeSelection=function(c){this._highlightNodeSelection=c;this._updateHighlight();return Promise.resolve()};b.prototype.getHighlightNodeSelection=function(){return this._highlightNodeSelection};
b.prototype.getHighlightLineElementSelection=function(){return this._highlightLineElementSelection};b.prototype.getHighlightPointElementSelection=function(){return this._highlightPointElementSelection};b.prototype.setHighlightLineElementSelection=function(c){this._highlightLineElementSelection=c;this._updateHighlight();return Promise.resolve()};b.prototype.setHighlightPointElementSelection=function(c){this._highlightPointElementSelection=c;this._updateHighlight();return Promise.resolve()};b.prototype.setPickTolerance=
function(c){this._engine.setPickTolerance(c)};b.prototype.getPickTolerance=function(){return this._engine.getPickTolerance()};b.prototype.exportSelectionData=function(){for(var c=[],a=0,f=this.getResults();a<f.length;a++)c.push(f[a].toJson());return c};b.prototype.loadSelectionData=function(c){this.clear(!1);if("string"===typeof c&&(c=JSON.parse(c),!Array.isArray(c)))throw new d.ParseError("Expected JSON depicting an Array.");for(var a=[],f=0;f<c.length;f++){var b=d.Selection.SelectionItem._fromJson(c[f]);
b.isNodeSelection()&&a.push(b)}this.add(a)};b.prototype._pathToParent=function(c,a){for(var f=[];!c.equals(a);){f.push(c);c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=d.Selection.SelectionItem.create(c)}return f};b.prototype._removeImplicit=function(c,a){for(var f=this._pathToParent(c,a),b=a;0<f.length;){this.remove(b);a=[];var e=0;for(b=this._model.getNodeChildren(b.getNodeId());e<b.length;e++){var g=d.Selection.SelectionItem.create(b[e]);a.push(g)}this.add(a);b=f.pop()}console.assert(c===
b);this.remove(c)};b.prototype._removeDescendants=function(c){var a=0;for(c=this._model.getNodeChildren(c.getNodeId());a<c.length;a++){var f=d.Selection.SelectionItem.create(c[a]);this._removeDescendantsRecursive(f)}};b.prototype._removeDescendantsRecursive=function(c){var a=c._hash();if(this._selectedItemsFull.delete(a))for(this._removeImpl(c,a),a=0,c=this._model.getNodeChildren(c.getNodeId());a<c.length;a++){var f=d.Selection.SelectionItem.create(c[a]);this._removeDescendantsRecursive(f)}};b.prototype._processSelection=
function(c,a){switch(a){case d.SelectionMode.Add:this.add(c);break;case d.SelectionMode.Set:this.set(c);break;case d.SelectionMode.Toggle:null!==c&&this.toggle(c)}};b.prototype._clearHighlight=function(){0<this._selectedItemsPruned.size&&this._engine.clearHighlight()};b.prototype._updateHighlight=function(){var c=this;this._clearHighlight();this._selectedItemsPruned.forEach(function(a){a&&c._updateItemHighlight(a,!0,!0)});this._highlightNodeSelection&&this._model.setNodesHighlighted([],!0)};b.prototype._updateItemHighlight=
function(c,a,f){var b=c.getNodeId();this._highlightNodeSelection&&this._model.setNodesHighlighted([b],a);this._model.getNodeType(b)!==d.NodeType.Pmi&&(a=c.getFaceEntity(),this._highlightFaceElementSelection&&null!==a&&!a.isCappingGeometry()&&this._model.setNodeFaceHighlighted(b,a.getCadFaceIndex(),f),a=c.getLineEntity(),this._highlightLineElementSelection&&null!==a&&!a.isCappingGeometry()&&this._model.setNodeLineHighlighted(b,a.getLineId(),f),c=c.getPointEntity(),this._highlightPointElementSelection&&
null!==c&&this._model.setNodePointHighlighted(b,c.getPointId(),f))};b.prototype._updateHighlightingMode=function(){switch(this._nodeHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setNodeHighlightColor(this._nodeSelectionColor,null);break;case d.SelectionHighlightMode.OutlineOnly:this._engine.setNodeHighlightColor(null,this._nodeSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setNodeHighlightColor(this._nodeSelectionColor,this._nodeSelectionOutlineColor)}switch(this._nodeElementHighlightMode){case d.SelectionHighlightMode.HighlightOnly:this._engine.setElementHighlightColor(this._elementSelectionColor,
null);break;case d.SelectionHighlightMode.OutlineOnly:this._nodeHighlightMode===d.SelectionHighlightMode.OutlineOnly?this._engine.setElementHighlightColor(null,this._elementSelectionOutlineColor):this._engine.setElementHighlightColor(this._nodeSelectionColor,this._elementSelectionOutlineColor);break;case d.SelectionHighlightMode.HighlightAndOutline:this._engine.setElementHighlightColor(this._elementSelectionColor,this._elementSelectionOutlineColor)}};b.prototype._onSubtreeLoaded=function(c){c=d.Selection.SelectionItem.create(c);
if(this.isSelected(c))return this._updateItemHighlight(c,!0,!0)};b.ifcSelectionFilter=function(c,a){if(a.getNodeType(c)===d.NodeType.BodyInstance)for(var f=c;null!==f;){if(null!==a.getNodeGenericId(f))return f;f=a.getNodeParent(f)}return c};__decorate([b.deprecated],b.prototype,"endVolumeSelection",null);__decorate([b.deprecated],b.prototype,"advanceVolumeSelection",null);return b}();d.SelectionManager=b})(Communicator||(Communicator={}));
(function(d){var h;(function(b){b[b.Background=0]="Background";b[b.Shadow=1]="Shadow";b[b.Selection=2]="Selection"})(h||(h={}));var g=function(){function b(b,c,a,f){var k=this;this._backgroundSheetMeshId=this._activeSheetId=null;this._sheetIds=[null,null,null];this._backgroundSelectionEnabled=this._backgroundSheetEnabled=!1;this._backgroundColor=new d.Color(180,180,180);this._sheetColor=d.Color.white();this._sheetShadowColor=new d.Color(75,75,75);this._viewer=b;this._engine=c;this._callbackManager=
a;var e=function(){return __awaiter(k,void 0,void 0,function(){var a,c;return __generator(this,function(f){switch(f.label){case 0:if(!this._viewer.model.isDrawing())return[2];a=this._viewer.sheetManager.getActiveSheetId();return null!=a?[3,4]:[4,this.deactivateSheets(!1)];case 1:return f.sent(),c=this.getSheetIds(),0===this.get3DNodes().length&&0<c.length?[4,this.setActiveSheetId(c[0],!0,!0)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[3,6];case 4:return[4,this._activateSheetId(a,!0,!0)];case 5:f.sent(),
f.label=6;case 6:return[2]}})})};this._viewer.setCallbacks({_modelStructureHeaderParsed:function(){return __awaiter(k,void 0,void 0,function(){return __generator(this,function(a){return this._viewer.model.isDrawing()&&!f?[2,this.setBackgroundSheetEnabled(!0)]:[2]})})},_firstModelLoaded:function(){return __awaiter(k,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,e()];case 1:return a.sent(),[2]}})})},_resetAssemblyTreeBegin:function(){return __awaiter(k,
void 0,void 0,function(){var a,c;return __generator(this,function(f){switch(f.label){case 0:return[4,this.setBackgroundSheetEnabled(!1)];case 1:return f.sent(),[4,this.setBackgroundSelectionEnabled(!1)];case 2:return f.sent(),this._backgroundSheetMeshId=this._activeSheetId=null,a=this._viewer.view,c=a.getBackgroundColor(),a.setBackgroundColor(c.top,c.bottom),[2]}})})},_resetDrawing:function(){return __awaiter(k,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,
e()];case 1:return a.sent(),[2]}})})}})}b.prototype.getSheetIds=function(){var b=this._viewer.model,c=b.getAbsoluteRootNode();c=b.getNodeChildren(c);var a=b.getNodeChildren(c[0]);c=[];var f=0;for(a=b.getNodeChildren(a[0]);f<a.length;f++){var k=a[f];b.getNodeType(k)===d.NodeType.DrawingSheet&&c.push(k)}return c};b.prototype.get3DNodes=function(){var b=this._viewer.model,c=b.getAbsoluteRootNode();c=b.getNodeChildren(c);var a=b.getNodeChildren(c[0]);c=[];var f=0;for(a=b.getNodeChildren(a[0]);f<a.length;f++){var k=
a[f];b.getNodeType(k)!==d.NodeType.DrawingSheet&&c.push(k)}return c};b.prototype.deactivateSheets=function(b){void 0===b&&(b=!0);return __awaiter(this,void 0,void 0,function(){var c,a,f,d;return __generator(this,function(k){switch(k.label){case 0:return this._activeSheetId=null,this._viewer.pauseRendering(),c=this.get3DNodes(),a=0<c.length,[4,this._viewer.view.isolateNodes(c,0,a)];case 1:return k.sent(),[4,this._refreshBackgroundSheets()];case 2:return k.sent(),f=this._viewer.view,d=f.getBackgroundColor(),
f.setBackgroundColor(d.top,d.bottom),this._viewer.resumeRendering(),b&&this._callbackManager.trigger("sheetDeactivated"),[2]}})})};b.prototype.setActiveSheetId=function(b,c,a){void 0===c&&(c=!0);void 0===a&&(a=!0);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:if(this._activeSheetId===b)return[2];this._activeSheetId=b;return[4,this._activateSheetId(b,c,a)];case 1:return f.sent(),[2]}})})};b.prototype._activateSheetId=function(b,c,a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,this._markupManager._setActiveMarkupView(null)];case 1:f.sent();if(!c)return[3,4];this._viewer.pauseRendering();return[4,this._viewer.view.isolateNodes([b],0,a)];case 2:return f.sent(),[4,this._refreshBackgroundSheets()];case 3:f.sent(),this._viewer.resumeRendering(),f.label=4;case 4:return this._callbackManager.trigger("sheetActivated",this._activeSheetId),[2]}})})};b.prototype.getActiveSheetId=function(){return this._activeSheetId};
b.prototype.isDrawingSheetActive=function(){return this._viewer.model.isDrawing()&&null!==this._activeSheetId};b.prototype.setMarkupManager=function(b){this._markupManager=b};b.prototype._createBackgroundSheetMesh=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a;return __generator(this,function(f){b=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];c=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];a=new d.MeshData;a.addFaces(b,c);a.setBackfacesEnabled(!0);return[2,this._viewer.model.createMesh(a)]})})};
b.prototype._createBackgroundSheetMatrix=function(b,c){var a=b.min,f=b.max,k=this._viewer.view.getCamera();b=k.getPosition();var e=k.getTarget(),g=d.Point3.subtract(e,b);b=f.x-a.x;e=f.y-a.y;var m=Math.max(.1*b,.1*(f.z-a.z)),p=a.x+.5*b,h=a.y+.5*e,r=Math.max(.05*b,.05*e);b+=r;e+=r;p-=.5*b;h-=.5*e;a=0<g.z?f.z+m:a.z-m;c&&(c=k.getUp(),k=.3*r,p+=k,0<c.y&&(k=-k),h+=k,a+=0<g.z?m:-m);c=new d.Matrix;c.setTranslationComponent(p,h,a);c.setScaleComponent(b,e,1);return c};b.prototype._createBackgroundSheetInstance=
function(b,c,a,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p;return __generator(this,function(n){switch(n.label){case 0:return e=d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.DoNotLight|d.MeshInstanceCreationFlags.DoNotOutlineHighlight|d.MeshInstanceCreationFlags.AlwaysDraw|d.MeshInstanceCreationFlags.ExcludeBounding,l||(e|=d.MeshInstanceCreationFlags.DoNotSelect),g=new d.MeshInstanceData(b,
a,c,f,null,null,e),[4,this._viewer.model.createMeshInstance(g,null,!1,!0)];case 1:return p=n.sent(),this._viewer.model.setNodesOpacity([p],k),[2,p]}})})};b.prototype._deleteBackgroundSheetInstances=function(b){void 0===b&&(b=[h.Background,h.Selection,h.Shadow]);return __awaiter(this,void 0,void 0,function(){var c,a,f,d,e;return __generator(this,function(k){c=[];a=0;for(f=b;a<f.length;a++)d=f[a],e=this._sheetIds[d],null!==e&&(this._sheetIds[d]=null,c.push(e));return 0<c.length?[2,this._viewer.model.deleteMeshInstances(c)]:
[2]})})};b.prototype._createOrUpdateSheet=function(b,c,a,f,k,l){return __awaiter(this,void 0,void 0,function(){var e,g,p,h;return __generator(this,function(n){switch(n.label){case 0:e=this._viewer.model;if(null!==this._sheetIds[b])return[3,2];g=this._sheetIds;p=b;return[4,this._createBackgroundSheetInstance(this._backgroundSheetMeshId,c,a,f,k,l)];case 1:return g[p]=n.sent(),[2,Promise.resolve()];case 2:return h=this._sheetIds[b],e.setNodesFaceColor([h],f),e.setNodesOpacity([h],k),null!==l&&e.setInstanceModifier(d.InstanceModifier.DoNotSelect,
[h],!l),[2,e.setNodeMatrix(h,a,!0)]}})})};b.prototype._refreshBackgroundSheets=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,f,k,l;return __generator(this,function(e){switch(e.label){case 0:b=this._viewer.model;if(!this.isDrawingSheetActive())return this._backgroundSelectionEnabled=!1,[2,this._deleteBackgroundSheetInstances()];if(null!==this._backgroundSheetMeshId)return[3,2];c=this;return[4,this._createBackgroundSheetMesh()];case 1:c._backgroundSheetMeshId=e.sent(),e.label=
2;case 2:return[4,b.getModelBounding(!0,!1)];case 3:return a=e.sent(),f=this._createBackgroundSheetMatrix(a,!1),k=[],this._backgroundSelectionEnabled?[4,this._createOrUpdateSheet(h.Selection,"2d_drawing_background_selection_sheet",f,d.Color.black(),0,!0)]:[3,5];case 4:return e.sent(),[3,6];case 5:k.push(h.Selection),e.label=6;case 6:this._engine.setBackgroundGradient(this._backgroundColor,this._backgroundColor);if(!this._backgroundSheetEnabled)return[3,9];l=this._createBackgroundSheetMatrix(a,!0);
return[4,this._createOrUpdateSheet(h.Background,"2d_drawing_background_sheet",f,this._sheetColor,1,!1)];case 7:return e.sent(),[4,this._createOrUpdateSheet(h.Shadow,"2d_drawing_background_shadow_sheet",l,this._sheetShadowColor,1,!1)];case 8:return e.sent(),[3,10];case 9:k.push(h.Background,h.Shadow),e.label=10;case 10:return 0<k.length?[2,this._deleteBackgroundSheetInstances(k)]:[2]}})})};b.prototype.setSheetColors=function(b,c,a){this._backgroundColor=b.copy();this._sheetColor=c.copy();this._sheetShadowColor=
a.copy();return this._refreshBackgroundSheets()};b.prototype.getSheetBackgroundColor=function(){return this._backgroundColor};b.prototype.getSheetColor=function(){return this._sheetColor};b.prototype.getSheetShadowColor=function(){return this._sheetShadowColor};b.prototype.setBackgroundSheetEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(b===this._backgroundSheetEnabled)return[2];this._backgroundSheetEnabled=b;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};b.prototype.getBackgroundSheetEnabled=function(){return this._backgroundSheetEnabled};b.prototype.setBackgroundSelectionEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:this.isDrawingSheetActive()||(b=!1);if(b===this._backgroundSelectionEnabled)return[2];this._backgroundSelectionEnabled=b;this._viewer.pauseRendering();
return[4,this._refreshBackgroundSheets()];case 1:return c.sent(),this._viewer.resumeRendering(),[2]}})})};b.prototype.getBackgroundSelectionEnabled=function(){return this._backgroundSelectionEnabled};b.prototype.startComparison=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return f=this._viewer.view,f.startComparison([b],[c],a),[4,this.setActiveSheetId(b,!1,!1)];case 1:return d.sent(),[4,f.isolateNodes([b,c],0,!0)];
case 2:return d.sent(),[4,this._refreshBackgroundSheets()];case 3:return d.sent(),[2]}})})};b.prototype.endComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._activeSheetId?[2]:[4,this.setActiveSheetId(this._activeSheetId,!0,!1)];case 1:return b.sent(),this._viewer.view.endComparison(),[2]}})})};return b}();d.SheetManager=g})(Communicator||(Communicator={}));
(function(d){var h;(function(b){b[b.Model=1]="Model";b[b.Svg=2]="Svg";b[b.Html=4]="Html";b[b.All=7]="All"})(h=d.SnapshotLayer||(d.SnapshotLayer={}));var g=function(){return function(b,d,c){void 0===b&&(b=0);void 0===d&&(d=0);void 0===c&&(c=h.All);this.width=b;this.height=d;this.layers=c}}();d.SnapshotConfig=g})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a){var c=document.createElement("canvas");c.width=a.width;c.height=a.height;c.getContext("2d").drawImage(a,0,0);return c}function b(a){if(a instanceof HTMLCanvasElement&&0<a.clientWidth&&0<a.clientHeight)return a;for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c);if(d=b(d))return d}return null}function e(a,c){var b=a.getContext("2d");if(null===b)throw new d.CommunicatorError("failed to create 2D canvas context");for(var f=0;f<c.length;f++)b.drawImage(c[f],
0,0);var e=h.OpenPromise.create(),g=new Image;g.src=a.toDataURL();g.onload=function(){e.resolve(g)};return e}var c=function(){function a(a,c){this._domElements=a;this._config=c}a.prototype._extractMarkupSvgAsCanvas=function(){var a=this._domElements.getMarkupSvgElement(),c=(new XMLSerializer).serializeToString(a);a=c;var b=(new DOMParser).parseFromString(a,"text/xml");c=b.getElementsByTagName("defs");for(var d=[],e=0;e<c.length;e++)for(var p=c.item(e).getElementsByTagName("marker"),h=0;h<p.length;h++){var r=
p.item(h);d.push(r)}c=[];p=b.getElementsByTagName("line");for(e=0;e<p.length;e++)if(b=p.item(e),null!==b.style.marker&&0<b.style.marker.length){h=b.style.marker.indexOf("#")+1;r=b.style.marker.indexOf('"',h+1);r=b.style.marker.substring(h,r);var w=null,t=null;for(h=0;h<d.length;h++)if(d[h].id===r){w=d[h];t=d[h+1];break}c.push({line:b,start:w,end:t})}for(d=a.indexOf("marker: url");0<=d;){e=a.indexOf(")",d)+1;b=a.substring(d,e);h=b.indexOf("#")+1;p=b.indexOf('"',h);r=b.indexOf("&quot",h+11+1);w=p;if(0>
p||r<p)w=r;h=b.substring(h,w);p=0;for(r=c;p<r.length;p++)if(b=r[p],w=b.start,b=b.end,null!==w&&null!==b&&w.id===h){h="marker-start: url('#"+w.id+"');";h+="marker-end: url('#"+b.id+"')";a=a.slice(0,d)+h+a.slice(e);break}d=a.indexOf("marker: url",e+1)}c=a;a=document.createElement("canvas");document.body.appendChild(a);canvg(a,c);c=g(a);document.body.removeChild(a);return c};a.prototype._extractRedlineSvgAsCanvas=function(a,c){var b=this._domElements.getRedlineSvgElement();b.setAttribute("width",""+
a);b.setAttribute("height",""+c);b=(new XMLSerializer).serializeToString(b);b=b.replace("width: 100%;","width: "+a+";");b=b.replace("height: 100%;","height: "+c+";");a=document.createElement("canvas");document.body.appendChild(a);canvg(a,b);c=g(a);document.body.removeChild(a);return c};a.prototype._extractRedlineAsCanvas=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){a=this._domElements.getRedlineElement();return[2,html2canvas(a,{background:void 0})]})})};
a.prototype.capture=function(a){return __awaiter(this,void 0,void 0,function(){var c,f,n,m,p;return __generator(this,function(k){switch(k.label){case 0:c=b(a);if(null===c)throw new d.CommunicatorError("failed to find canvas");f=document.createElement("canvas");f.width=this._config.width||a.clientWidth;f.height=this._config.height||a.clientHeight;f.style.width="100%";f.style.height="100%";n=[];this._config.layers&d.SnapshotLayer.Model&&n.push(g(c));this._config.layers&d.SnapshotLayer.Svg&&(n.push(this._extractMarkupSvgAsCanvas()),
n.push(this._extractRedlineSvgAsCanvas(f.width,f.height)));if(!(this._config.layers&d.SnapshotLayer.Html))return[3,2];p=(m=n).push;return[4,this._extractRedlineAsCanvas()];case 1:p.apply(m,[k.sent()]),k.label=2;case 2:return[2,e(f,n)]}})})};return a}();h.Snapshot=c})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function a(){this._strokeWidth=1;this._strokeColor=d.Color.black()}a.prototype._assign=function(a){this._strokeWidth=a._strokeWidth;this._strokeColor.assign(a._strokeColor)};a.prototype.setStrokeColor=function(a){this._strokeColor.assign(a)};a.prototype.getStrokeColor=function(){return this._strokeColor.copy()};a.prototype.setStrokeWidth=function(a){this._strokeWidth=a};a.prototype.getStrokeWidth=function(){return this._strokeWidth};return a}();
g.StrokedShape=b;var e=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._fillColor=d.Color.black();c._fillOpacity=1;return c}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._fillColor.assign(c._fillColor);this._fillOpacity=c._fillOpacity};c.prototype.getFillOpacity=function(){return this._fillOpacity};c.prototype.setFillOpacity=function(a){this._fillOpacity=a};c.prototype.setFillColor=function(a){this._fillColor.assign(a)};c.prototype.getFillColor=
function(){return this._fillColor.copy()};return c}(b);g.FilledShape=e;var c;(function(a){a[a.None=0]="None";a[a.Arrowhead=1]="Arrowhead";a[a.Circle=2]="Circle"})(c=g.EndcapType||(g.EndcapType={}));b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._startEndcapType=c.None;b._startEndcapColor=d.Color.black();b._startEndcapSize=9;b._endEndcapType=c.None;b._endEndcapColor=d.Color.black();b._endEndcapSize=9;b._endcapsInverted=!1;return b}__extends(b,a);b.prototype._assign=function(c){a.prototype._assign.call(this,
c);this._startEndcapType=c._startEndcapType;this._startEndcapColor.assign(c._startEndcapColor);this._startEndcapSize=c._startEndcapSize;this._endEndcapType=c._endEndcapType;this._endEndcapColor.assign(c._endEndcapColor);this._endEndcapSize=c._endEndcapSize;this._endcapsInverted=c._endcapsInverted};b.prototype.getStartEndcapType=function(){return this._startEndcapType};b.prototype.setStartEndcapType=function(a){this._startEndcapType=a};b.prototype.getStartEndcapColor=function(){return this._startEndcapColor.copy()};
b.prototype.setStartEndcapColor=function(a){this._startEndcapColor.assign(a)};b.prototype.getStartEndcapSize=function(){return this._startEndcapSize};b.prototype.setStartEndcapSize=function(a){this._startEndcapSize=a};b.prototype.getEndEndcapType=function(){return this._endEndcapType};b.prototype.setEndEndcapType=function(a){this._endEndcapType=a};b.prototype.setEndcapType=function(a){this._endEndcapType=this._startEndcapType=a};b.prototype.getEndEndcapSize=function(){return this._endEndcapSize};
b.prototype.setEndEndcapSize=function(a){this._endEndcapSize=a};b.prototype.getEndEndcapColor=function(){return this._endEndcapColor.copy()};b.prototype.setEndEndcapColor=function(a){this._endEndcapColor.assign(a)};b.prototype.getEndcapsInverted=function(){return this._endcapsInverted};b.prototype.setEndcapsInverted=function(a){this._endcapsInverted=a};return b}(b);g.EndcapShape=b})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._borderRadius=0;return c}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._borderRadius=c._borderRadius};c.prototype.getBorderRadius=function(){return this._borderRadius};c.prototype.setBorderRadius=function(a){this._borderRadius=a};return c}(g.FilledShape);g.RectangleBase=b;var e=function(a){function c(c,b){var f=a.call(this)||this;f._position=
d.Point2.zero();f._size=d.Point2.zero();c&&f._position.assign(c);b&&f._size.assign(b);return f}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._position.assign(c._position);this._size.assign(c._size)};c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(a){this._size.assign(a)};c.prototype.getSize=function(){return this._size.copy()};return c}(b);g.Rectangle=
e;var c=function(){return function(a,c){this.position=a.copy();this.size=c.copy()}}();g._MarkupRectangleData=c;b=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c._rectangles=[];return c}__extends(b,a);b.prototype.clear=function(){this._rectangles=[]};b.prototype.addRectangle=function(a,b){this._rectangles.push(new c(a,b))};b.prototype.getRectangles=function(){return this._rectangles};return b}(b);g.RectangleCollection=b})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var b=function(a){function c(){var c=a.call(this)||this;c._fontFamily=null;c._fontSize=12;c.setStrokeWidth(0);return c}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._fontFamily=c._fontFamily;this._fontSize=c._fontSize};c.prototype.getFontFamily=function(){return this._fontFamily};c.prototype.setFontFamily=function(a){this._fontFamily=a};c.prototype.setFontSize=function(a){this._fontSize=a};c.prototype.getFontSize=function(){return this._fontSize};
return c}(g.FilledShape);g.TextMarkupBase=b;var e=function(a){function c(c,b){var f=a.call(this)||this;f._position=d.Point2.zero();f._text="";b&&(f._position=b.copy());c&&f.setText(c);return f}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._text=c._text;this._position.assign(c._position)};c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position};c.prototype.setText=function(a){this._text=a};c.prototype.getText=
function(){return this._text};return c}(b);g.Text=e;var c=function(){return function(a,c){this.text=a;this.position=c.copy()}}();g._MarkupTextData=c;b=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c._textStrings=[];return c}__extends(b,a);b.prototype.clear=function(){this._textStrings=[]};b.prototype.addString=function(a,b){this._textStrings.push(new c(a,b))};b.prototype.getStrings=function(){return this._textStrings};return b}(b);g.TextCollection=b})(h.Shape||(h.Shape={}))})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this._behindView=!1}b.prototype.remove=function(){};b.prototype.draw=function(){};b.prototype.hit=function(b){b;return!1};b.prototype.hitWithTolerance=function(b,c){b;c;return!1};b.prototype.onSelect=function(){};b.prototype.onDeselect=function(){};b.prototype.toJson=function(){return{}};b.prototype.forJson=function(){return this.toJson()};b.prototype.getClassName=function(){return"Communicator.Markup.MarkupItem"};return b}();d.MarkupItem=g})(d.Markup||
(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(c){function a(a){var b=c.call(this)||this;b._position=new d.Point2(10,10);b._nextItemPosition=d.Point2.zero();b._statItemOffset=new d.Point2(5,5);b._maxStatWidth=0;b._viewer=a;b._backgroundPanel=new d.Markup.Shape.Rectangle(b._position,new d.Point2(300,100));b._backgroundPanel.setFillColor(d.Color.white());b._backgroundPanel.setStrokeWidth(0);b._statsText=new d.Markup.Shape.TextCollection;return b}__extends(a,c);a.prototype.draw=function(){this._updateBackgroundSize();
var a=this._viewer.markupManager.getRenderer();a.drawRectangle(this._backgroundPanel);a.drawTexts(this._statsText)};a.prototype.clearStatsText=function(){this._statsText.clear();this._nextItemPosition.assign(this._position)};a.prototype.setPosition=function(a){this._position.assign(a);this._backgroundPanel.setPosition(this._position)};a.prototype.addStatistic=function(a,c){var b=d.Point2.add(this._nextItemPosition,this._statItemOffset);this._statsText.addString(a+": "+c,b);this._nextItemPosition.y+=
this._statsText.getFontSize()};a.prototype._updateBackgroundSize=function(){for(var a=this._viewer.markupManager.getRenderer(),c=this._statsText.getStrings(),b=this._statsText.getFontSize(),e=0;e<c.length;e++){var g=a.measureText(c[e].text,this._statsText);this._maxStatWidth=Math.max(this._maxStatWidth,g.x)}this._backgroundPanel.setSize(new d.Point2(2*this._statItemOffset.x+this._maxStatWidth,c.length*(b+this._statItemOffset.y)))};return a}(d.Markup.MarkupItem),b=function(){return function(){this.total_triangle_count=
this.total_element_count=0}}();h.StatisticMap=b;var e=function(){function c(a,c){var f=this;this._statisticsDisplayHandle=null;this._statistics=new b;this._viewer=c;this._callbackManager=a;this._callbackManager.bind({frameDrawn:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.update()];case 1:return a.sent(),[2]}})})}});this._statisticsDisplay=new g(this._viewer)}c.prototype.update=function(){return __awaiter(this,void 0,
void 0,function(){var a,c,b,d,e,g,p;return __generator(this,function(f){switch(f.label){case 0:return[4,this._viewer.getStatistics()];case 1:this._statistics=a=f.sent();this._statisticsDisplay.clearStatsText();c=Object.keys(this._statistics);b=0;for(d=c;b<d.length;b++)g=e=d[b],p=this._statistics[g],this._statisticsDisplay.addStatistic(g,p.toString());return[2]}})})};c.prototype.isShown=function(){return null!==this._statisticsDisplayHandle};c.prototype.getStatistics=function(){return this._statistics};
c.prototype.showDisplay=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this.isShown()?[3,2]:[4,this.update()];case 1:a.sent(),this._statisticsDisplayHandle=this._viewer.markupManager.registerMarkup(this._statisticsDisplay),a.label=2;case 2:return[2]}})})};c.prototype.hideDisplay=function(){this.isShown()&&(this._viewer.markupManager.unregisterMarkup(this._statisticsDisplayHandle),this._statisticsDisplayHandle=null)};return c}();
h.Statistics=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){var h=function(){return function(){this.svgXmlPrologEnabled=!0;this.svgBackgroundCssColor="";this.linesDrawModelLinesEnabled=this.silhouettesEnabled=!0;this.linesStrokeWidth=20;this.linesCssColor="#000000";this.linesClipZNudgeFactor=this.linesClipProximityToPlane=5.5;this.polygonsForceDrawCssColor="";this.logDiagnostics=this.logProgress=!1}}();d.SvgConfig=h})(Communicator||(Communicator={}));
(function(d){(function(d){d[d.Rgba32=0]="Rgba32";d[d.Rgb24=1]="Rgb24";d[d.Gray8=2]="Gray8";d[d.GrayAlpha16=3]="GrayAlpha16";d[d.Jpeg=4]="Jpeg";d[d.Png=5]="Png"})(d.ImageFormat||(d.ImageFormat={}));(function(d){d[d.Clamp=0]="Clamp";d[d.Repeat=1]="Repeat"})(d.TextureTiling||(d.TextureTiling={}));(function(d){d[d.UV=0]="UV"})(d.TextureParameterization||(d.TextureParameterization={}));(function(d){d[d.Decal=1]="Decal"})(d.TextureModifier||(d.TextureModifier={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b){this._timeoutDurationMinutes=15;this._timeoutWarningMinutes=14;this._timer=new d.Util.Timer;this._enabled=!0;this._callbackManager=b;this.resetTimeout()}b.prototype.setTimeoutDurations=function(b,c){this._timeoutDurationMinutes=b;this._timeoutWarningMinutes=c;this.resetTimeout();return!0};b.prototype.shutdown=function(){this._enabled=!1;this._timer.clear()};b.prototype.resetTimeout=function(){var b=this;this._enabled&&this._timer.set(Math.round(6E4*
this._timeoutWarningMinutes),function(){b._warn()})};b.prototype._warn=function(){var b=this;console.assert(this._timer.isIdle(0));var c=this._timeoutDurationMinutes-this._timeoutWarningMinutes,a=Math.round(6E4*c);this._callbackManager.trigger("timeoutWarning",c);this._timer.set(a,function(){b._timeout()})};b.prototype._timeout=function(){this._callbackManager.trigger("timeout");this._callbackManager.trigger("_timeout")};return b}();h.TimeoutMonitor=g})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));(function(d){(function(d){d.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=16*Math.random()|0;return("x"===d?b:b&3|8).toString(16)})}})(d.UUID||(d.UUID={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.create=function(){return d.UUID.create()}})(d.GUID||(d.GUID={}))})(Communicator||(Communicator={}));
var __assign=this&&this.__assign||function(){__assign=Object.assign||function(d){for(var h,g=1,b=arguments.length;g<b;g++){h=arguments[g];for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(d[e]=h[e])}return d};return __assign.apply(this,arguments)};
(function(d){var h=function(){function g(b,e,c,a,f,k,l,g){this._backfacesVisible=!1;this._initialCamera=null;this._boundingCalculationIgnoresInvisible=this._faceVisibility=this._lineVisibility=!0;this._backgroundColorBottom=this._backgroundColorTop=null;this._drawMode=d.DrawMode.WireframeOnShaded;this._ambientOcclusionEnabled=!1;this._ambientOcclusionRadius=.03;this._antiAliasingMode=d.AntiAliasingMode.SMAA;this._lightingEnabled=!0;this._ambientLightColor=d.Color.black();this._bloomEnabled=!1;this._bloomIntensityScale=
this._bloomThresholdRampWidth=this._bloomThreshold=0;this._bloomLayers=[];this._hardEdgesEnabled=this._silhouetteEnabled=this._simpleReflectionEnabled=this._simpleShadowEnabled=!1;this._hiddenLineSettings=new d.Settings.HiddenLineSettings;this._projectionMode=d.Projection.Orthographic;var n=b.getCreationParameters();this._viewer=b;this._engine=e;this._callbackManager=c;this._interpolationManager=f;this._eventDispatcher=a;this._model=b.model;this._statistics=k;this._navCube=l;this._axisTriad=g;this._determineInitialAxes=
d.Internal.getWithDefault(n.calculateDefaultViewAxes,!0);this._initEvents()}g.deprecated=function(b,d,c){var a=c.value;c.value=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this._callbackManager.trigger("deprecated","View",d);return a.apply(this,c)};return c};g.prototype._initEvents=function(){var b=this;this._callbackManager.bind({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){this._initialCamera=null;return[2]})})},
_firstAttachment:function(e){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(c){return e===d.Internal.AttachType.Direct?[2,this._massageInitialCamera(!1)]:[2]})})},_firstModelLoaded:function(){return b._massageInitialCamera(!1)},_modelSwitched:function(d){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return d?[3,2]:[4,this._massageInitialCamera(!1)];case 1:return c.sent(),[2,this._setInitialView(0)];case 2:return[2]}})})},
hwfParseComplete:function(){return b._massageInitialCamera(!0)},_modelStructureHeaderParsed:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){return this._viewer.sheetManager.isDrawingSheetActive()?(this._model.setViewAxes(new d.Point3(0,0,1),new d.Point3(0,1,0)),[2,this.setViewOrientation(d.ViewOrientation.Front,0)]):[2]})})},_sessionStarted:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){this.clearLights();this.setAmbientLightColor(d.Color.createFromFloatArray([.075,
.075,.075]));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(.5,.5,1),d.Color.createFromFloatArray([.925,.925,.925])));this.addLight(new d.Light(d.LightType.Directional,d.LightSpace.Camera,new d.Point3(-.5,-.5,1),d.Color.createFromFloatArray([.1,.1,.2])));this.setBloomIntensityScale(1);this.setBloomThreshold(.65);this.setBloomThresholdRampWidth(.1);this.setBloomLayers([{intensity:.5,blurSamples:5,blurInterval:[.0025,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,
blurSamples:5,blurInterval:[.005,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:9,blurInterval:[.01,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:1,blurSamples:9,blurInterval:[.02,d.BlurIntervalUnit.ProportionOfHeight]},{intensity:2,blurSamples:11,blurInterval:[.04,d.BlurIntervalUnit.ProportionOfHeight]}]);this.setGroundPlane({normal:new d.Point3(0,0,1),followViewAxes:!0});this.setSimpleShadowColor(d.Color.black());this.setSimpleShadowOpacity(.65);this.setSimpleShadowResolution(512);
this.setSimpleShadowBlurSamples(5);this.setSimpleShadowBlurInterval(1);this.setSimpleShadowInteractiveUpdateEnabled();this.setSimpleReflectionOpacity(.65);this.setSimpleReflectionFadeAngle(10);this.setSimpleReflectionBlurSamples(9);this.setSimpleReflectionBlurInterval(1,d.BlurIntervalUnit.Pixels);this.setSimpleReflectionAttenuation(0,1,d.SimpleReflectionAttenuationUnit.ProportionOfBoundingHeight);this.setSilhouetteColor(d.Color.black());this.setSilhouetteOpacity(1);this.setSilhouetteThreshold(.05);
this.setSilhouetteThresholdRampWidth(.025);this.setHardEdgeColor(d.Color.black());this.setHardEdgeOpacity(1);this.setHardEdgeThreshold(30);this.setHardEdgeThresholdRampWidth(20);return[2]})})},viewAxes:function(d,c){b._updateGroundPlane(d,c)}})};g.prototype._massageInitialCamera=function(b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null!==this._initialCamera)return[2];d=this;return[4,this._engine.getCameraPromise()];case 1:return d._initialCamera=
c.sent(),this._projectionMode=this._initialCamera.getProjection(),!this._determineInitialAxes||this._viewer.sheetManager.isDrawingSheetActive()||this._model.viewAxesHaveBeenSet()||this._determineViewAxes(this._initialCamera),b?[4,this.fitWorld()]:[3,3];case 2:c.sent(),this._initialCamera=this.getCamera(),c.label=3;case 3:return[2]}})})};g.prototype.setLineVisibility=function(b){this._setLineVisibility(b);return Promise.resolve()};g.prototype._setLineVisibility=function(b){b!==this._lineVisibility&&
(this._lineVisibility=b,this._engine.setLineVisibility(b))};g.prototype.getLineVisibility=function(){return this._lineVisibility};g.prototype.setFaceVisibility=function(b){this._setFaceVisibility(b);return Promise.resolve()};g.prototype._setFaceVisibility=function(b){b!==this._faceVisibility&&(this._faceVisibility=b,this._engine.setFaceVisibility(b));return Promise.resolve()};g.prototype.getFaceVisibility=function(){return this._faceVisibility};g.prototype.setProjectionMode=function(b){this._projectionMode!==
b&&(this._projectionMode=b,this._engine.isInit()&&this._engine.setProjection(b),this._eventDispatcher.injectViewOrientationChangeEvent())};g.prototype.getProjectionMode=function(){return this._projectionMode};g.prototype.getViewMatrix=function(){return this._engine.getViewMatrix()};g.prototype.getProjectionMatrix=function(){return this._engine.getProjectionMatrix()};g.prototype.getFullCameraMatrix=function(){return this._engine.getFullCameraMatrix()};g.prototype.raycastFromPoint=function(b){var e=
this.getCanvasSize(),c=this._engine.getViewMatrix(),a=this._engine.getProjectionMatrix(),f=new d.Point3(b.x,e.y-b.y,0);b=this._unproject(f,a,c,e);if(null===b)return null;f.z=.5;e=this._unproject(f,a,c,e);if(null===e)return null;e=d.Point3.subtract(e,b).normalize();return new d.Ray(b,e)};g.prototype._unproject=function(b,e,c,a){e=d.Matrix.multiply(c,e);e=d.Matrix.inverse(e);if(null===e)return null;b=new d.Point4(b.x,b.y,b.z,1);b.x/=a.x;b.y/=a.y;b.x=2*b.x-1;b.y=2*b.y-1;b.z=2*b.z-1;a=e.transform4(b);
if(0===a.w)return null;a.scale(1/a.w);return new d.Point3(a.x,a.y,a.z)};g.prototype._rectifySelectionItem=function(b){var d=b.getInclusionKey(),c=b.getNodeId();d=this._model._getNodeFromInstanceInc(!1,d,c,!0);b._setNodeId(d)};g.prototype.isOutsideCanvasArea=function(b){var d=this.getCanvasSize();return 0>b.x||0>b.y||b.x>=d.x||b.y>=d.y};g.prototype.pickFromPoint=function(b,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:if(this.isOutsideCanvasArea(b))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");
return[4,this._engine.pickFromScreen(b,e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:return(c=a.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};g.prototype.pickAllFromPoint=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f,k;return __generator(this,function(l){switch(l.label){case 0:if(this.isOutsideCanvasArea(b))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickAllFromScreen(b,
e,this._viewer.sheetManager.isDrawingSheetActive())];case 1:c=l.sent();a=0;for(f=c;a<f.length;a++)k=f[a],this._rectifySelectionItem(k);return[2,c]}})})};g.prototype.compositePickFromPoint=function(b,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:if(this.isOutsideCanvasArea(b))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.compositePickFromScreen(b,e,this._viewer.sheetManager.isDrawingSheetActive())];
case 1:return c=a.sent(),null!==c.faceItem&&this._rectifySelectionItem(c.faceItem),null!==c.lineItem&&this._rectifySelectionItem(c.lineItem),null!==c.pointItem&&this._rectifySelectionItem(c.pointItem),[2,c]}})})};g.prototype.pickFromRay=function(b,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,this._engine.pickFromRay(b,e)];case 1:return(c=a.sent())?(this._rectifySelectionItem(c),[2,c]):[2,d.Selection.SelectionItem.create()]}})})};
g.prototype.pickAllFromRay=function(b,d){return __awaiter(this,void 0,void 0,function(){var c,a,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._engine.pickAllFromRay(b,d)];case 1:c=k.sent();a=0;for(f=c;a<f.length;a++)e=f[a],this._rectifySelectionItem(e);return[2,c]}})})};g.prototype.beginScreenSelectByArea=function(b,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isOutsideCanvasArea(b)||this.isOutsideCanvasArea(e))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");
return[2,this._engine.beginScreenAreaSelection(b,e,c)]})})};g.prototype.beginRayDrillSelection=function(b,e,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isOutsideCanvasArea(b))throw new d.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginRayDrillSelection(b,e,c)]})})};g.prototype.beginConvexPolyhedronSelection=function(b,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._engine.beginConvexPolyhedronSelection(b,d,c)]})})};g.prototype.beginSphereSelection=function(b,e,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){a=d.Internal.toVec3(b);return[2,this._engine.beginSphereSelection(a,e,c)]})})};g.prototype.endIncrementalSelection=function(b){this._endIncrementalSelection(b);return Promise.resolve()};g.prototype._endIncrementalSelection=function(b){this._engine.endIncrementalSelection(b)};g.prototype.endVolumeSelection=
function(b){return this.endIncrementalSelection(b)};g.prototype.advanceIncrementalSelection=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,l,g,m,p,h;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._engine.advanceIncrementalSelection(b)];case 1:e=n.sent();if(null===e)return[2,null];c=this._viewer.selectionManager;a=[];f=0;for(k=e;f<k.length;f++)l=k[f],this._rectifySelectionItem(l),g=l,m=g.getNodeId(),(p=c._incrementalBlacklistedInstanceNodes.has(m))||
a.push(g);return[2,a];case 2:h=n.sent();if("advanceVolumeSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 3:return[2]}})})};g.prototype.advanceVolumeSelection=function(b){return this.advanceIncrementalSelection(b)};g.prototype.projectPoint=function(b,d){if(void 0!==d){var c=d.getProjectionMatrix(this._viewer);var a=d.getViewMatrix(this._viewer)}else c=this._engine.getSynchedProjectionMatrix(),a=this._engine.getSynchedViewMatrix();d=this.getCanvasSize();b=this._project(b,
c,a,d);b.y=d.y-b.y;return b};g.prototype._project=function(b,e,c,a){b=new d.Point4(b.x,b.y,b.z,1);c.transform4(b,b);e.transform4(b,b);e=0>=b.w;c=b.w;0>=b.w&&(b.w=.001);b.scale(1/b.w);b.x=.5*b.x+.5;b.y=.5*b.y+.5;b.z=.5*b.z+.5;b.x*=a.x;b.y*=a.y;e&&(b.z=c);return new d.Point3(b.x,b.y,b.z)};g.prototype.unprojectPoint=function(b,e){var c=this.getCanvasSize(),a=this.getProjectionMatrix(),f=this.getViewMatrix();b=new d.Point3(b.x,c.y-b.y,e);return this._unproject(b,a,f,c)};g.prototype.pointToWindowPosition=
function(b){var e=this._engine.getCanvasSize();return new d.Point2(b.x/e.x*2-1,1-b.y/e.y*2)};g.prototype.setCamera=function(b,d){void 0===d&&(d=0);return null===b?!1:this._setCameraImpl(b,d).unsafeValue};g.prototype._setCameraPromise=function(b,d){return this._setCameraImpl(b,d).readyPromise};g.prototype._setCameraImpl=function(b,e){return 0<e?this._interpolateCamera(b,e):this._engine.isInit()?(e=b.getProjection(),this._projectionMode!==e&&this.setProjectionMode(e),this._engine.setCamera(b),e=this._markupManager?
this._markupManager._setActiveMarkupView(null):Promise.resolve(),this._callbackManager.trigger("camera",b),d.Internal.UnsafePromise.create(!0,e)):d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype._interpolateCamera=function(b,e){var c=this;if(this._engine.isInit()){var a=this.getCamera();if(a.equals(b))return this._markupManager&&this._markupManager._update(),d.Internal.UnsafePromise.create(!1,Promise.resolve());this._callbackManager.trigger("transitionBegin",e);var f=d.Util.OpenPromise.create();
this._interpolationManager.start(new d.Internal.CameraInterpolation(a,b,e,function(){c._eventDispatcher.injectViewOrientationChangeEvent();c._callbackManager.trigger("transitionEnd");f.resolve()},this));return d.Internal.UnsafePromise.create(!0,f)}return d.Internal.UnsafePromise.create(!1,Promise.resolve())};g.prototype.updateCamera=function(b){b=this._engine.updateCamera(b);this._callbackManager.trigger("camera",b);return b};g.prototype.resetCamera=function(b){void 0===b&&(b=d.DefaultTransitionDuration);
return this._setInitialView(b)};g.prototype.getCamera=function(){if(this._engine.isInit())return this._engine.getCamera();throw new d.CommunicatorError("getCamera() called before sceneReady");};g.prototype.getViewOrientationCamera=function(b,e,c){void 0===c&&(c=!0);return __awaiter(this,void 0,void 0,function(){var a,f,k,l,g,m,p,h,r,w,t,u,v,z,x,y,A,B,D,C,F,E;return __generator(this,function(n){switch(n.label){case 0:return a=this.getCamera(),f=a.getUp().copy().normalize(),k=this._model.getViewAxes(),
l=k.upVector.copy(),g=k.frontVector.copy(),void 0!==e?[3,2]:[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return e=n.sent(),[3,3];case 2:this._fitCameraToBounding(a,e),n.label=3;case 3:m=e.center();p=m.copy();h=m.copy();r=d.Point3.subtract(a.getPosition(),a.getTarget()).length();w=d.Point3.subtract(a.getPosition(),m).length();t=new d.Point3(0,0,1);u=new d.Point3(-1,0,0);null!==l&&(t=l.copy());null!==g&&(u=g.copy());v=u.copy().scale(-1);z=u.copy();x=t.copy();
y=t.copy().scale(-1);A=d.Point3.cross(x,v);B=A.copy().scale(-1);D=function(a){a=d.Point3.subtract(h,a);var c=t,b=d.Util.computeAngleBetweenVector(a,t);if(0===b||180===b)c=u;var k=d.Point3.cross(a,c),e=k.copy().negate(),l=d.Point3.cross(a,k),g=l.copy().negate();a=Infinity;c=k;b=0;for(k=[k,e,l,g];b<k.length;b++)e=k[b],l=d.Util.computeAngleBetweenVector(f,e),l<=a&&(a=l,c=e);return c.normalize()};C=null;switch(b){case d.ViewOrientation.Front:p=d.Point3.add(h,z);break;case d.ViewOrientation.Back:p=d.Point3.add(h,
v);break;case d.ViewOrientation.Left:p=d.Point3.add(h,A);break;case d.ViewOrientation.Right:p=d.Point3.add(h,B);break;case d.ViewOrientation.Bottom:p=d.Point3.add(h,y);C=v.copy();break;case d.ViewOrientation.Top:p=d.Point3.add(h,x);C=v.copy();break;case d.ViewOrientation.FrontTop:case d.ViewOrientation.TopFront:p=d.Point3.add(h,d.Point3.add(z,x));C=d.Point3.add(v,x).normalize();break;case d.ViewOrientation.FrontTopLeft:case d.ViewOrientation.LeftTopFront:case d.ViewOrientation.TopLeftFront:p=d.Point3.add(h,
d.Point3.add(z,d.Point3.add(A,x)));C=d.Point3.add(v,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.Iso:case d.ViewOrientation.FrontTopRight:case d.ViewOrientation.RightTopFront:case d.ViewOrientation.TopRightFront:p=d.Point3.add(h,d.Point3.add(z,d.Point3.add(B,x)));C=d.Point3.add(v,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.FrontLeft:case d.ViewOrientation.LeftFront:p=d.Point3.add(h,d.Point3.add(z,A));break;case d.ViewOrientation.FrontRight:case d.ViewOrientation.RightFront:p=
d.Point3.add(h,d.Point3.add(z,B));break;case d.ViewOrientation.FrontBottom:case d.ViewOrientation.BottomFront:p=d.Point3.add(h,d.Point3.add(z,y));C=d.Point3.add(z,x).normalize();break;case d.ViewOrientation.FrontBottomLeft:case d.ViewOrientation.LeftBottomFront:case d.ViewOrientation.BottomLeftFront:p=d.Point3.add(h,d.Point3.add(z,d.Point3.add(A,y)));C=d.Point3.add(z,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.FrontBottomRight:case d.ViewOrientation.RightBottomFront:case d.ViewOrientation.BottomRightFront:p=
d.Point3.add(h,d.Point3.add(z,d.Point3.add(B,y)));C=d.Point3.add(z,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.BackTop:case d.ViewOrientation.TopBack:p=d.Point3.add(h,d.Point3.add(v,x));C=d.Point3.add(z,x).normalize();break;case d.ViewOrientation.BackTopLeft:case d.ViewOrientation.LeftTopBack:case d.ViewOrientation.TopLeftBack:p=d.Point3.add(h,d.Point3.add(v,d.Point3.add(A,x)));C=d.Point3.add(z,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.BackTopRight:case d.ViewOrientation.RightTopBack:case d.ViewOrientation.TopRightBack:p=
d.Point3.add(h,d.Point3.add(v,d.Point3.add(B,x)));C=d.Point3.add(z,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackLeft:case d.ViewOrientation.LeftBack:p=d.Point3.add(h,d.Point3.add(v,A));break;case d.ViewOrientation.BackRight:case d.ViewOrientation.RightBack:p=d.Point3.add(h,d.Point3.add(v,B));break;case d.ViewOrientation.BackBottom:case d.ViewOrientation.BottomBack:p=d.Point3.add(h,d.Point3.add(v,y));C=d.Point3.add(v,x).normalize();break;case d.ViewOrientation.BackBottomLeft:case d.ViewOrientation.LeftBottomBack:case d.ViewOrientation.BottomLeftBack:p=
d.Point3.add(h,d.Point3.add(v,d.Point3.add(A,y)));C=d.Point3.add(v,d.Point3.add(A,x)).normalize();break;case d.ViewOrientation.BackBottomRight:case d.ViewOrientation.RightBottomBack:case d.ViewOrientation.BottomRightBack:p=d.Point3.add(h,d.Point3.add(v,d.Point3.add(B,y)));C=d.Point3.add(v,d.Point3.add(B,x)).normalize();break;case d.ViewOrientation.LeftBottom:case d.ViewOrientation.BottomLeft:p=d.Point3.add(h,d.Point3.add(A,y));C=d.Point3.add(A,x).normalize();break;case d.ViewOrientation.LeftTop:case d.ViewOrientation.TopLeft:p=
d.Point3.add(h,d.Point3.add(A,x));C=d.Point3.add(B,x).normalize();break;case d.ViewOrientation.RightBottom:case d.ViewOrientation.BottomRight:p=d.Point3.add(h,d.Point3.add(B,y));C=d.Point3.add(B,x).normalize();break;case d.ViewOrientation.RightTop:case d.ViewOrientation.TopRight:p=d.Point3.add(h,d.Point3.add(B,x));C=d.Point3.add(A,x).normalize();break;default:d.Util.TypeAssertNever(b)}c||(C=D(p));null===C&&(C=t);F=d.Point3.add(d.Point3.subtract(p,m).normalize().scale(w),m);E=d.Point3.add(d.Point3.subtract(p,
m).normalize().scale(w-r),m);a.setPosition(F);a.setTarget(E);a.setUp(C);return[2,a]}})})};g.prototype.setViewOrientation=function(b,e,c,a){void 0===e&&(e=d.DefaultTransitionDuration);void 0===a&&(a=!0);return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getViewOrientationCamera(b,c,a)];case 1:return f=d.sent(),void 0!==c?[3,3]:[4,this.fitWorld(e,f)];case 2:return d.sent(),[3,5];case 3:return[4,this.fitBounding(c,e,f)];case 4:d.sent(),
d.label=5;case 5:return this._callbackManager.trigger("viewOrientation",b),[2]}})})};g.prototype.centerCameraOnNode=function(b,e,c){void 0===e&&(e=0);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){var a,f,k,l,g;return __generator(this,function(n){switch(n.label){case 0:return[4,this._model.getNodesBounding([b])];case 1:a=n.sent();f=a.center();k=c.getPosition();l=c.getTarget();g=d.Point3.subtract(l,f);k.subtract(g);c.setPosition(k);c.setTarget(f);if(0<e)return[2,this._setCameraPromise(c,
e)];this.setCamera(c);return[2]}})})};g.prototype._setInitialView=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(!this._initialCamera)return[2,this.fitWorld(b)];if(0<b)return[2,this._setCameraPromise(this._initialCamera,b)];this.setCamera(this._initialCamera);this._eventDispatcher.injectViewOrientationChangeEvent();return[2]})})};g.prototype.getCanvasSize=function(){return this._engine.getCanvasSize()};g.prototype._setMarkupManager=function(b){this._markupManager=
b};g.prototype.setStatisticsDisplayVisibility=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return b?[4,this._statistics.showDisplay()]:[3,2];case 1:return d.sent(),[3,3];case 2:this._statistics.hideDisplay(),d.label=3;case 3:return[2]}})})};g.prototype.getBackgroundColor=function(){var b=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,e=null!==this._backgroundColorBottom?this._backgroundColorBottom.copy():
null;return new d.VerticalGradient(b,e)};g.prototype.setBackgroundColor=function(b,e){void 0===b&&(b=null);void 0===e&&(e=null);this._backgroundColorTop=null!==b?b.copy():null;this._backgroundColorBottom=null!==e?e.copy():null;this._drawMode===d.DrawMode.HiddenLine||this._viewer.sheetManager.isDrawingSheetActive()||this._engine.setBackgroundGradient(this._backgroundColorTop,this._backgroundColorBottom);return Promise.resolve()};g.prototype.isolateNodes=function(b,e,c,a){void 0===e&&(e=d.DefaultTransitionDuration);
void 0===c&&(c=!0);void 0===a&&(a=null);return __awaiter(this,void 0,void 0,function(){var f,d,l,g,m;return __generator(this,function(k){switch(k.label){case 0:f=this._model.getAbsoluteRootNode();d=new Map;d.set(f,!1);l=0;for(g=b;l<g.length;l++)m=g[l],d.set(m,!0);return[4,this._model.setNodesVisibilities(d,a)];case 1:return k.sent(),c?[2,this.fitNodes(b,e)]:[2]}})})};g.prototype.fitNodes=function(b,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var c;
return __generator(this,function(a){switch(a.label){case 0:return[4,this._model.getNodesBounding(b)];case 1:return c=a.sent(),[2,this.fitBounding(c,e)]}})})};g.prototype.fitWorld=function(b,d){void 0===b&&(b=0);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return d||(d=this.getCamera()),[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return c=a.sent(),[4,this.fitBounding(c,b,d)];case 2:return a.sent(),
[2]}})})};g.prototype._fitCameraToBounding=function(b,e){var c=e.extents().length(),a=b.getWidth(),f=d.Point3.subtract(b.getPosition(),b.getTarget()),k=f.length();a=c*k/a;e=e.center();f=d.Point3.add(e,f.normalize().scale(a));b.setTarget(e);b.setPosition(f);b.setWidth(c);b.setHeight(c)};g.prototype.fitBounding=function(b,e,c){void 0===e&&(e=d.DefaultTransitionDuration);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(b){b.isDegenerate()||
this._fitCameraToBounding(c,b);if(0<e)return[2,this._setCameraPromise(c,e)];this.setCamera(c)}return[2]})})};g.prototype.setBackfacesVisible=function(b){this._backfacesVisible=b;this._engine.setBackFacesVisible(b);return Promise.resolve()};g.prototype.getBackfacesVisible=function(){return this._backfacesVisible};g.prototype.setDrawMode=function(b){this._setDrawMode(b);return Promise.resolve()};g.prototype._setDrawMode=function(b){this._drawMode=b;this._drawMode!==d.DrawMode.HiddenLine&&this.setBackgroundColor(this._backgroundColorTop,
this._backgroundColorBottom);switch(b){case d.DrawMode.Wireframe:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!1);break;case d.DrawMode.Shaded:this._engine.setDrawMode(1);this._setLineVisibility(!1);this._setFaceVisibility(!0);break;case d.DrawMode.WireframeOnShaded:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case d.DrawMode.HiddenLine:b=this._hiddenLineSettings.getBackgroundColor();this._setLineVisibility(!0);this._setFaceVisibility(!0);
this._engine.enableHiddenLineRendering(this._hiddenLineSettings);this._engine.setBackgroundGradient(b,b);break;case d.DrawMode.XRay:this._engine.setDrawMode(3),this._setLineVisibility(!0),this._setFaceVisibility(!0)}};g.prototype.getDrawMode=function(){return this._drawMode};g.prototype.setAntiAliasingMode=function(b){this._setAntiAliasingMode(b);return Promise.resolve()};g.prototype._setAntiAliasingMode=function(b){this._antiAliasingMode=b;this._engine.setAntiAliasingMode(b)};g.prototype.getAntiAliasingMode=
function(){return this._antiAliasingMode};g.prototype.getHiddenLineSettings=function(){return this._hiddenLineSettings};g.prototype.setAmbientOcclusionEnabled=function(b){void 0===b&&(b=!0);this._setAmbientOcclusionEnabled(b);return Promise.resolve()};g.prototype._setAmbientOcclusionEnabled=function(b){void 0===b&&(b=!0);this._ambientOcclusionEnabled=b;this._engine.setAmbientOcclusionEnabled(b)};g.prototype.getAmbientOcclusionEnabled=function(){return this._ambientOcclusionEnabled};g.prototype.setAmbientOcclusionRadius=
function(b){this._setAmbientOcclusionRadius(b);return Promise.resolve()};g.prototype._setAmbientOcclusionRadius=function(b){this._ambientOcclusionRadius=b;this._engine.setAmbientOcclusionRadius(b)};g.prototype.getAmbientOcclusionRadius=function(){return this._ambientOcclusionRadius};g.prototype.setLightingEnabled=function(b){void 0===b&&(b=!0);this._setLightingEnabled(b);return Promise.resolve()};g.prototype._setLightingEnabled=function(b){void 0===b&&(b=!0);this._lightingEnabled=b;this._engine.setLightingEnabled(b)};
g.prototype.getLightingEnabled=function(){return this._lightingEnabled};g.prototype.setTransparencyMode=function(b){this._engine.setTransparencyMode(b)};g.prototype.setXRayOpacity=function(b,d){this._setXRayOpacity(b,d);return Promise.resolve()};g.prototype._setXRayOpacity=function(b,d){this._engine.setXRayOpacity(b,d)};g.prototype.setXRayTransparencyMode=function(b){this._setXRayTransparencyMode(b);return Promise.resolve()};g.prototype._setXRayTransparencyMode=function(b){this._engine.setXRayTransparencyMode(b)};
g.prototype.setXRayColor=function(b,e,c){void 0===c&&(c=d.XRayGroup.Selected);return this._engine.setXRayColor(c,b,e)};g.prototype.unsetXRayColor=function(b,e){void 0===e&&(e=d.XRayGroup.Selected);return this._engine.unsetXRayColor(e,b)};g.prototype.setPointSize=function(b,d){this._setPointSize(b,d);return Promise.resolve()};g.prototype._setPointSize=function(b,d){this._engine.setPointSize(b,d)};g.prototype.getPointSize=function(){return this._engine.getPointSize()};g.prototype.setPointShape=function(b){this._setPointShape(b);
return Promise.resolve()};g.prototype._setPointShape=function(b){this._engine.setPointShape(b)};g.prototype.getPointShape=function(){return this._engine.getPointShape()};g.prototype.setEyeDomeLightingEnabled=function(b){void 0===b&&(b=!0);this._setEyeDomeLightingEnabled(b);return Promise.resolve()};g.prototype._setEyeDomeLightingEnabled=function(b){void 0===b&&(b=!0);this._engine.setEyeDomeLightingEnabled(b)};g.prototype.getEyeDomeLightingEnabled=function(){return this._engine.getEyeDomeLightingEnabled()};
g.prototype.setEyeDomeLightingBlurSamples=function(b){this._setEyeDomeLightingBlurSamples(b);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurSamples=function(b){this._engine.setEyeDomeLightingBlurSamples(b)};g.prototype.getEyeDomeLightingBlurSamples=function(){return this._engine.getEyeDomeLightingBlurSamples()};g.prototype.setEyeDomeLightingBlurInterval=function(b){this._setEyeDomeLightingBlurInterval(b);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurInterval=function(b){this._engine.setEyeDomeLightingBlurInterval(b)};
g.prototype.getEyeDomeLightingBlurInterval=function(){return this._engine.getEyeDomeLightingBlurInterval()};g.prototype.setEyeDomeLightingBlurEdgeDistance=function(b){this._setEyeDomeLightingBlurEdgeDistance(b);return Promise.resolve()};g.prototype._setEyeDomeLightingBlurEdgeDistance=function(b){this._engine.setEyeDomeLightingBlurEdgeDistance(b)};g.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._engine.getEyeDomeLightingBlurEdgeDistance()};g.prototype.setEyeDomeLightingShadingEdgeDistance=
function(b){this._setEyeDomeLightingShadingEdgeDistance(b);return Promise.resolve()};g.prototype._setEyeDomeLightingShadingEdgeDistance=function(b){this._engine.setEyeDomeLightingShadingEdgeDistance(b)};g.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._engine.getEyeDomeLightingShadingEdgeDistance()};g.prototype.setEyeDomeLightingOpacity=function(b){this._setEyeDomeLightingOpacity(b);return Promise.resolve()};g.prototype._setEyeDomeLightingOpacity=function(b){this._engine.setEyeDomeLightingOpacity(b)};
g.prototype.getEyeDomeLightingOpacity=function(){return this._engine.getEyeDomeLightingOpacity()};g.prototype.setBoundingCalculationIgnoresInvisible=function(b){this._boundingCalculationIgnoresInvisible=b};g.prototype.getBoundingCalculationIgnoresInvisible=function(){return this._boundingCalculationIgnoresInvisible};g.prototype.setDisplayIncompleteFrames=function(b){this._setDisplayIncompleteFrames(b);return Promise.resolve()};g.prototype._setDisplayIncompleteFrames=function(b){this._engine.setDisplayIncompleteFrames(b)};
g.prototype.setInteractiveDrawDelay=function(b){this._setInteractiveDrawDelay(b);return Promise.resolve()};g.prototype._setInteractiveDrawDelay=function(b){this._engine.setInteractiveDrawDelay(b)};g.prototype.setInteractiveDrawLimitIncreaseEnabled=function(b){this._engine.setInteractiveDrawLimitIncreaseEnabled(b)};g.prototype.getInteractiveDrawLimitIncreaseEnabled=function(){return this._engine.getInteractiveDrawLimitIncreaseEnabled()};g.prototype.getNavCube=function(){return this._navCube};g.prototype.getAxisTriad=
function(){return this._axisTriad};g.prototype._determineViewAxes=function(b){var e=b.getUp().normalize();b=d.Point3.subtract(b.getTarget(),b.getPosition()).normalize();e=d.Internal.majorAxis(e);b=d.Internal.majorAxis(b);null===e&&null===b?(e=new d.Point3(0,1,0),b=new d.Point3(0,0,1)):null===e?e=0===b.y?new d.Point3(0,1,0):new d.Point3(0,0,1):null===b&&(b=0===e.z?new d.Point3(0,0,1):new d.Point3(0,1,0));this._model.setViewAxes(b,e)};g.prototype.setAmbientLightColor=function(b){this._ambientLightColor=
b;this._engine.setAmbientLightColor(b)};g.prototype.getAmbientLightColor=function(){return this._ambientLightColor};g.prototype.clearLights=function(){this._engine.clearLights()};g.prototype.addLight=function(b){return this._engine.addLight(b)};g.prototype.removeLight=function(b){this._engine.removeLight(b)};g.prototype.updateLight=function(b,d){this._engine.updateLight(b,d)};g.prototype.setBloomEnabled=function(b){void 0===b&&(b=!0);this._engine.setBloomEnabled(b);this._bloomEnabled=b};g.prototype.getBloomEnabled=
function(){return this._bloomEnabled};g.prototype.setBloomThreshold=function(b){this._engine.setBloomThreshold(b);this._bloomThreshold=b};g.prototype.getBloomThreshold=function(){return this._bloomThreshold};g.prototype.setBloomThresholdRampWidth=function(b){this._engine.setBloomThresholdRampWidth(b);this._bloomThresholdRampWidth=b};g.prototype.getBloomThresholdRampWidth=function(){return this._bloomThresholdRampWidth};g.prototype.setBloomIntensityScale=function(b){this._engine.setBloomIntensityScale(b);
this._bloomIntensityScale=b};g.prototype.getBloomIntensityScale=function(){return this._bloomIntensityScale};g.prototype.setBloomLayers=function(b){b=d.Internal.deepClone(b);for(var e=0;e<b.length;e++){var c=b[e];void 0===c.intensity&&(c.intensity=1);void 0===c.blurSamples&&(c.blurSamples=9);void 0===c.blurInterval&&(c.blurInterval=[1,d.BlurIntervalUnit.Pixels])}this._engine.setBloomLayers(b);this._bloomLayers=b};g.prototype.getBloomLayers=function(){return d.Internal.deepClone(this._bloomLayers)};
g.prototype.startComparison=function(b,e,c){var a=this._model._getModelStructure();b=a.gatherInstanceIncsFromNodeIds(b,7,d.Internal.Tree.WalkRestriction.None);e=a.gatherInstanceIncsFromNodeIds(e,7,d.Internal.Tree.WalkRestriction.None);this._engine.startComparison(b,e,c)};g.prototype.endComparison=function(){this._engine.endComparison()};g.prototype.setSimpleShadowEnabled=function(b){void 0===b&&(b=!0);this._simpleShadowEnabled=b;this._engine.setSimpleShadowEnabled(b)};g.prototype.getSimpleShadowEnabled=
function(){return this._simpleShadowEnabled};g.prototype.setSimpleShadowColor=function(b){this._simpleShadowColor=b.copy();this._engine.setSimpleShadowColor(b)};g.prototype.getSimpleShadowColor=function(){return this._simpleShadowColor.copy()};g.prototype.setSimpleShadowOpacity=function(b){this._simpleShadowOpacity=b;this._engine.setSimpleShadowOpacity(b)};g.prototype.getSimpleShadowOpacity=function(){return this._simpleShadowOpacity};g.prototype.setGroundPlane=function(b){this._groundPlane=__assign({},
b);this._updateGroundPlane()};g.prototype._updateGroundPlane=function(b,e){if(this._groundPlane.followViewAxes&&(void 0!==b&&void 0!==e||this._model.viewAxesHaveBeenSet())){if(void 0===b||void 0===e)e=this._model.getViewAxes(),b=e.frontVector,e=e.upVector;b=b.copy().negate();var c=d.Point3.cross(e,b);b=d.Matrix.createFromBasis(b,c,e);e=new d.Point3(0,0,0);b.transform(this._groundPlane.normal,e);this._engine.setGroundPlane(e,this._groundPlane.position)}else this._engine.setGroundPlane(this._groundPlane.normal,
this._groundPlane.position)};g.prototype.getGroundPlane=function(){return __assign({},this._groundPlane)};g.prototype.setSimpleShadowResolution=function(b){this._simpleShadowResolution=b;this._engine.setSimpleShadowResolution(b)};g.prototype.getSimpleShadowResolution=function(){return this._simpleShadowResolution};g.prototype.setSimpleShadowBlurSamples=function(b){this._simpleShadowBlurSamples=b;this._engine.setSimpleShadowBlurSamples(b)};g.prototype.getSimpleShadowBlurSamples=function(){return this._simpleShadowBlurSamples};
g.prototype.setSimpleShadowBlurInterval=function(b){this._simpleShadowBlurInterval=b;this._engine.setSimpleShadowBlurInterval(b)};g.prototype.getSimpleShadowBlurInterval=function(){return this._simpleShadowBlurInterval};g.prototype.setSimpleShadowInteractiveUpdateEnabled=function(b){void 0===b&&(b=!0);this._simpleShadowInteractiveUpdateEnabled=b;this._engine.setSimpleShadowInteractiveUpdateEnabled(b)};g.prototype.getSimpleShadowInteractiveUpdateEnabled=function(){return this._simpleShadowInteractiveUpdateEnabled};
g.prototype.setSilhouetteEnabled=function(b){void 0===b&&(b=!0);this._silhouetteEnabled=b;this._engine.setSilhouetteEnabled(b)};g.prototype.getSilhouetteEnabled=function(){return this._silhouetteEnabled};g.prototype.setSilhouetteColor=function(b){this._silhouetteColor=b.copy();this._engine.setSilhouetteColor(b)};g.prototype.getSilhouetteColor=function(){return this._silhouetteColor.copy()};g.prototype.setSilhouetteOpacity=function(b){this._silhouetteOpacity=b;this._engine.setSilhouetteOpacity(b)};
g.prototype.getSilhouetteOpacity=function(){return this._silhouetteOpacity};g.prototype.setSilhouetteThreshold=function(b){this._silhouetteThreshold=b;this._engine.setSilhouetteThreshold(b)};g.prototype.getSilhouetteThreshold=function(){return this._silhouetteThreshold};g.prototype.setSilhouetteThresholdRampWidth=function(b){this._silhouetteThresholdRampWidth=b;this._engine.setSilhouetteThresholdRampWidth(b)};g.prototype.getSilhouetteThresholdRampWidth=function(){return this._silhouetteThresholdRampWidth};
g.prototype.setHardEdgesEnabled=function(b){void 0===b&&(b=!0);this._hardEdgesEnabled=b;this._engine.setHardEdgesEnabled(b)};g.prototype.getHardEdgesEnabled=function(){return this._hardEdgesEnabled};g.prototype.setHardEdgeColor=function(b){this._hardEdgeColor=b.copy();this._engine.setHardEdgeColor(b)};g.prototype.getHardEdgeColor=function(){return this._hardEdgeColor.copy()};g.prototype.setHardEdgeOpacity=function(b){this._hardEdgeOpacity=b;this._engine.setHardEdgeOpacity(b)};g.prototype.getHardEdgeOpacity=
function(){return this._hardEdgeOpacity};g.prototype.setHardEdgeThreshold=function(b){this._hardEdgeThreshold=b;this._engine.setHardEdgeThreshold(b)};g.prototype.getHardEdgeThreshold=function(){return this._hardEdgeThreshold};g.prototype.setHardEdgeThresholdRampWidth=function(b){this._hardEdgeThresholdRampWidth=b;this._engine.setHardEdgeThresholdRampWidth(b)};g.prototype.getHardEdgeThresholdRampWidth=function(){return this._hardEdgeThresholdRampWidth};g.prototype.setSimpleReflectionEnabled=function(b){void 0===
b&&(b=!0);this._simpleReflectionEnabled=b;this._engine.setSimpleReflectionEnabled(b)};g.prototype.getSimpleReflectionEnabled=function(){return this._simpleReflectionEnabled};g.prototype.setSimpleReflectionBlurInterval=function(b,e){void 0===e&&(e=d.BlurIntervalUnit.Pixels);this._simpleReflectionBlurInterval=[b,e];this._engine.setSimpleReflectionBlurInterval(b,e)};g.prototype.getSimpleReflectionBlurInterval=function(){return[this._simpleReflectionBlurInterval[0],this._simpleReflectionBlurInterval[1]]};
g.prototype.setSimpleReflectionBlurSamples=function(b){this._simpleReflectionBlurSamples=b;this._engine.setSimpleReflectionBlurSamples(b)};g.prototype.getSimpleReflectionBlurSamples=function(){return this._simpleReflectionBlurSamples};g.prototype.setSimpleReflectionFadeAngle=function(b){this._simpleReflectionFadeAngle=b;this._engine.setSimpleReflectionFadeAngle(b)};g.prototype.getSimpleReflectionFadeAngle=function(){return this._simpleReflectionFadeAngle};g.prototype.setSimpleReflectionOpacity=function(b){this._simpleReflectionOpacity=
b;this._engine.setSimpleReflectionOpacity(b)};g.prototype.getSimpleReflectionOpacity=function(){return this._simpleReflectionOpacity};g.prototype.setSimpleReflectionAttenuation=function(b,e,c){void 0===c&&(c=d.SimpleReflectionAttenuationUnit.World);this._simpleReflectionAttenuation={nearDistance:b,farDistance:e,unit:c};this._engine.setSimpleReflectionAttenuation(b,e,c)};g.prototype.getSimpleReflectionAttenuation=function(){return __assign({},this._simpleReflectionAttenuation)};g.prototype.testPointVisibility=
function(b){return this._engine.testPointVisibility(b)};g.prototype.setPointVisibilityTest=function(b){this._engine.setPointVisibilityTest(b)};__decorate([g.deprecated],g.prototype,"endVolumeSelection",null);__decorate([g.deprecated],g.prototype,"advanceVolumeSelection",null);return g}();d.View=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a){return a instanceof e?a.referencedInfo:a}g.MaxModelFileVersion=[9,0,0];var e=function(){return function(a){this.referencedInfo=a}}();g.ReferencedNodeInfo=e;g.modelFileNodeInfoAsProdOccInfo=b;var c=function(){function a(){}a.parseXml=function(a,c,b,n,m){console.assert("ModelFile"===n.localName);var f=new Map,k=new Map,l=new Map;for(n=n.firstElementChild;null!==n;){if("ProductOccurence"!==n.localName)throw new d.XmlParseError('Unexpected element "'+
n.localName+'".');if(null===g.XmlParser.parseNodeId(n,"Id"))throw new d.XmlParseError('Expected "Id" attribute.');var h=n,t=g.ProductOccurrence.parseXml(a,c,b,h,m),u=t.nodeInfo.nodeId;if(l.has(t.nodeInfo.nodeId)){var v=new e(t);f.set(u,v)}else{if(!k.has(t.nodeInfo.nodeId)&&(k.set(t.nodeInfo.nodeId,null),null!==a.additionalMatrix)){v=a.additionalMatrix;var z=t.nodeInfo.localTransform;z=null===z?v:d.Matrix.multiply(z,v);t=__assign({},t,{nodeInfo:__assign({},t.nodeInfo,{localTransform:z})})}f.set(u,
t)}u=0;for(v=g.XmlParser.parseNodeIds(h,"Children")||[];u<v.length;u++)k.set(v[u],t);h=g.XmlParser.parseNodeId(h,"InstanceRef");null!==h&&(u=l.get(h),void 0===u?l.set(h,[t]):u.push(t));n=n.nextElementSibling}a=this._parentMapToChildMap(f,k,l);return{treeInfos:this._childMapRoseTrees(a)}};a._parentMapToChildMap=function(a,c,b){var f=new Map,k=function(a,c){var b=f.get(a);void 0===b?f.set(a,[c]):b.push(c)};c.forEach(function(c,b){b=a.get(b);if(b instanceof e)throw new d.XmlParseError('Expected a referenced node for "InstanceRef".');
k(c,b)});b.forEach(function(c,b){console.assert(0<c.length);b=a.get(b);if(!(b instanceof e))throw new d.XmlParseError('Node is both an "InstanceRef" and contained in another node\'s "Children" list.');for(var f=0;f<c.length;f++)k(c[f],b)});return f};a._childMapRoseTrees=function(a){var c=function(f){var d=[],k=b(f);k=a.get(k);if(void 0!==k){console.assert(0<k.length);for(var e=0;e<k.length;e++){var l=c(k[e]);d.push(l)}}return new h.RoseTree(f,d)},f=a.get(null);if(void 0===f)return console.assert(0===
a.size),[];for(var d=[],g=0;g<f.length;g++){var p=f[g];p instanceof e?console.assert(!1):(p=c(p),d.push(p))}return d};a.reify=function(a,c,b,g,m,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,p,v,z,x;return __generator(this,function(q){switch(q.label){case 0:f=[];k=[];l=[];n=0;for(p=h.treeInfos;n<p.length;n++)v=p[n],v.value instanceof e?console.assert(!1):(z=this._reifyProductOccurrence(a,c,b,g,m,m,v,f),k.push(z),l.push(z.getRuntimeId()));x=c.promiseTrigger("_subtreeLoaded","subtreeLoaded",
l,d.NodeSource.LoadModel).then(function(){for(var a=0,b=l;a<b.length;a++)c.trigger("shatteredXmlStructureReady",b[a])});f.push(x);return[4,d.Util.waitForAll(f)];case 1:return q.sent(),[2,k]}})})};a._rectifyExternalModelInfo=function(a,c){c=c.referencedInfo.externalModelInfo;if(null===c)throw new d.XmlParseError('"InstanceRef" node does not contain "ExternalModel".');if(!g.ExternalModel.isNameInfo(c))throw new d.InternalLogicError;console.assert(0===c.reservedNodeIdOffset);a=a.newNodeIdOffset();return c=
__assign({},c,{reservedNodeIdOffset:a})};a._reifyProductOccurrence=function(a,c,l,n,m,h,q,r){var f=this,k=b(q.value);if(0!==k.childDataKeys.length)throw new d.InternalLogicError;if(null!==k.externalModelInfo)throw new d.LoadError('Unexpected "ExternalModel". Should be a child of an "InstanceRef".');var p=g.ProductOccurrence.reifySync(a,l,n,m,k,h);h.addProductOccurrence(p);p.markLoaded();h=0;for(q=q.kids;h<q.length;h++)k=q[h],k.value instanceof e?(console.assert(0===k.kids.length),k=this._rectifyExternalModelInfo(n,
k.value),g.ExternalModel.canImplicitlyLoad(k)?(k=l.attachByExternalModelInfo(k,p,m).then(function(a){return __awaiter(f,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:return null===a?[2]:[4,g.markContextsLoaded([a])];case 1:return f.sent(),p.addAttachContext(a),b=a.getChildren().map(function(a){return a.getRuntimeId()}),[4,c.promiseTrigger("_subtreeLoaded","subtreeLoaded",b,d.NodeSource.LoadModel)];case 2:return f.sent(),[2]}})})}),r.push(k)):p.addPendingExternalModel(k)):
(console.assert(null===k.value.externalModelInfo),this._reifyProductOccurrence(a,c,l,n,m,p,k,r));return p};a._parseBounding=function(a,c){var f=b(a.value),k=SC.UnspecifiedMeasurementUnit;null!==f.measurementUnit&&(k=f.measurementUnit);var e=1;k===SC.UnspecifiedMeasurementUnit?k=c:c!==SC.UnspecifiedMeasurementUnit&&(e=k/c);e=(new d.Matrix).setScaleComponent(e,e,e);var h=f.nodeInfo.localTransform;null!==h&&(e=d.Matrix.multiply(h,e));h=d.Box.invalid();var q=0;for(a=a.kids;q<a.length;q++){var r=this._parseBounding(a[q],
k);r=e.transformBox(r);h.addBox(r)}a=f.externalModelInfo;if(null!==a){if(!g.ExternalModel.isNameInfo(a))throw new d.InternalLogicError;f=a.bounding;null===f||f.isDegenerate()||(a=a.measurementUnit||SC.UnspecifiedMeasurementUnit,c!==SC.UnspecifiedMeasurementUnit&&a!==SC.UnspecifiedMeasurementUnit&&(c=a/k,c=(new d.Matrix).setScaleComponent(c,c,c),e=d.Matrix.multiply(c,e)),f=e.transformBox(f),h.addBox(f))}return h};a.parseBounding=function(a,c){var b=d.Box.invalid(),f=0;for(a=a.treeInfos;f<a.length;f++)for(var k=
0,e=a[f].kids;k<e.length;k++){var g=this._parseBounding(e[k],c);b.addBox(g)}return b};return a}();g.ModelFile=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b){var e=this;this._callbackManager=new d.Internal.CallbackManager;this._interpolationManager=new d.Internal.InterpolationManager;this._streamingMode=d.StreamingMode.Interactive;this._rendererType=d.RendererType.Client;this._alreadyShutDown=!1;this._sceneReadyPromise=d.Util.OpenPromise.create();this._seenPriorityMetaDataSent=!1;this._params=__assign({},b);this._contextMenuActiveFlag=!1;if(void 0!==this._params.containerId){b=d.Internal.DomElements.createFromId(this._params.containerId);
if(null===b)throw new d.ParseError("'containerId' is invalid");this._domElements=b}else if(void 0!==this._params.container)this._domElements=d.Internal.DomElements.createFromElement(this._params.container);else throw new d.ParseError("must supply 'container' or 'containerId'");this.operatorManager=new d.OperatorManager(this);this._eventDispatcher=new d.Internal.EventDispatcher(this._callbackManager,this.operatorManager);this._timeoutMonitor=new d.Internal.TimeoutMonitor(this._callbackManager);this._inputMonitor=
new d.Internal.InputMonitor(this._eventDispatcher,this._timeoutMonitor);this._setInitialOptions(this._params);this._engine=new d.Internal.ScEngine(this._callbackManager,this._params);this._statistics=new d.Internal.Statistics(this._callbackManager,this);b=new d.NavCube(this);var c=new d.AxisTriad(this);this.model=new d.Model(this._engine,this._callbackManager);this.view=new d.View(this,this._engine,this._callbackManager,this._eventDispatcher,this._interpolationManager,this._statistics,b,c);this.cuttingManager=
new d.CuttingManager(this,this.model,this._callbackManager,this._engine);b={disableAutomaticFitWorld:d.Internal.getWithDefault(this._params.disableAutomaticFitWorld,!1),markImplicitNodesOutOfHierarchy:d.Internal.getWithDefault(this._params._markImplicitNodesOutOfHierarchy,!0),streamingMode:d.Internal.getWithDefault(this._params.streamingMode,d.StreamingMode.Default)};this._modelStructure=d.Internal.Tree.ModelStructure.unsafeCreate(b,this._engine,this._callbackManager,this.cuttingManager,this.view,
this.model,this._params._maxConcurrentAttachments||null);this.model._setModelStructure(this._modelStructure);this.measureManager=new d.MeasureManager(this,this._callbackManager);this.lineManager=new d.LineManager(this,this._callbackManager);this.explodeManager=new d.ExplodeManager(this.model,this._engine,this._callbackManager);this.overlayManager=new d.OverlayManager(this,this._engine);this.BCFManager=new d.BCFManager(this);this.selectionManager=new d.SelectionManager(this._callbackManager,this._engine,
this.view,this.model,this._modelStructure);b=new d.FloorplanConfig;d.Internal.getWithDefault(this._params.disableAutomaticFloorplanOverlay,!1)&&(b.autoActivate=d.FloorplanAutoActivation.Never);this.floorplanManager=new d.FloorplanManager(this,this.model,this.overlayManager,this._engine,this._modelStructure,b);b=d.Internal.getWithDefault(this._params.disableAutomaticBackgroundSheets,!1);this.sheetManager=new d.SheetManager(this,this._engine,this._callbackManager,b);this.noteTextManager=new d.Markup.Note.NoteTextManager(this);
this.markupManager=new d.MarkupManager(this._domElements,this.measureManager,this.lineManager,this._callbackManager,this.sheetManager,this.noteTextManager,this);this.view._setMarkupManager(this.markupManager);this._initEventDispatcher();var a=function(a){if(!e.sheetManager.isDrawingSheetActive()){e.model._setInstanceModifier(d.InstanceModifier.OverrideSceneVisibility,a,!0,6);for(var c=0;c<a.length;c++)e.model.setPmiColorOverride(!0,a[c])}},f=function(a){return __awaiter(e,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return a?[4,Promise.all([this.view.setPointSize(.003,d.PointSizeUnit.ProportionOfBoundingDiagonal),this.view.setEyeDomeLightingEnabled(!0),this.view.setPointShape(d.PointShape.Disk)])]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,Promise.all([this.view.setPointSize(1,d.PointSizeUnit.ScreenPixels),this.view.setEyeDomeLightingEnabled(!1),this.view.setPointShape(d.PointShape.Square)])];case 3:c.sent(),c.label=4;case 4:return[2]}})})},k=function(a){return __awaiter(e,
void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return c=this.model.getModelFileTypeFromNode(a[0]),null===c||c===d.FileType.Unknown?[3,2]:[4,f(!1)];case 1:b.sent(),b.label=2;case 2:return[2]}})})},l=function(a){return __awaiter(e,void 0,void 0,function(){var c,b,f,k,e;return __generator(this,function(l){switch(l.label){case 0:c=[];if(this.model.getModelFileTypeFromNode(a[0])===d.FileType.Ifc)for(b=0,f=a;b<f.length;b++)k=f[b],e=this.model.registerIfcNodes(k),
c.push(e);return[4,Promise.all(c)];case 1:return l.sent(),[2]}})})},g=function(a){var c=e.selectionManager.getSelectionFilter();a=e.model.getModelFileTypeFromNode(a[0])===d.FileType.Ifc;!c&&a?e.selectionManager.setSelectionFilter(d.SelectionManager.ifcSelectionFilter):c!==d.SelectionManager.ifcSelectionFilter||a||e.selectionManager.setSelectionFilter(null)};this.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(a){e.model.setPmiColor(d.Color.black());
return[2]})})},_sessionStarted:function(){return f(!0)},_firstModelLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return e.model.setPmiColor(d.Color.black()),g(c),a([this.model.getAbsoluteRootNode()]),[4,Promise.all([l(c),k(c)])];case 1:return b.sent(),[2]}})})},_modelSwitched:function(c,b){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return g(b),a(b),[4,Promise.all([l(b),
k(b)])];case 1:return c.sent(),[2]}})})},_subtreeLoaded:function(c){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return a(c),[4,l(c)];case 1:return b.sent(),[2]}})})},subtreeLoaded:function(a,c){e._callbackManager.trigger("modelLoaded",a,c)}})}g.deprecated=function(b,d,c){var a=c.value;c.value=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this._callbackManager.trigger("deprecated","WebViewer",d);return a.apply(this,c)};
return c};g.prototype.setContextMenuStatus=function(b){this._contextMenuActiveFlag=b};g.prototype.getContextMenuStatus=function(){return this._contextMenuActiveFlag};g.prototype.deactivateSheets=function(){return this.sheetManager.deactivateSheets()};g.prototype.setActiveSheetId=function(b){return this.sheetManager.setActiveSheetId(b,!0,!0)};g.prototype.getActiveSheetId=function(){return this.sheetManager.getActiveSheetId()};g.prototype.getSheetIds=function(){return this.sheetManager.getSheetIds()};
g.prototype.isDrawingSheetActive=function(){return this.sheetManager.isDrawingSheetActive()};g.prototype.setBackgroundSheetEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this.sheetManager.setBackgroundSheetEnabled(b)]})})};g.prototype.getBackgroundSheetEnabled=function(){return this.sheetManager.getBackgroundSheetEnabled()};g.prototype.setBackgroundSelectionEnabled=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(d){return[2,this.sheetManager.setBackgroundSelectionEnabled(b)]})})};g.prototype.getBackgroundSelectionEnabled=function(){return this.sheetManager.getBackgroundSelectionEnabled()};g.prototype.setSheetColors=function(b,d,c){return this.sheetManager.setSheetColors(b,d,c)};g.prototype.getSheetBackgroundColor=function(){return this.sheetManager.getSheetBackgroundColor()};g.prototype.getSheetColor=function(){return this.sheetManager.getSheetColor()};g.prototype.getSheetShadowColor=function(){return this.sheetManager.getSheetShadowColor()};
g.prototype.getCreationParameters=function(){return __assign({},this._params)};g.prototype._setInitialOptions=function(b){this._inputMonitor.setOptions(b);void 0!==b.streamingMode?this._streamingMode=b.streamingMode:b.streamingMode=this._streamingMode;void 0!==b.rendererType?this._rendererType=b.rendererType:b.rendererType=this._rendererType};g.prototype._initEventDispatcher=function(){var b=new d.Operator.CameraOrbitOperator(this),e=new d.Operator.CameraPanOperator(this),c=new d.Operator.CameraZoomOperator(this),
a=new d.Operator.CameraNavigationOperator(this,b,e,c),f=new d.Operator.CameraWalkOperator(this),k=new d.Operator.CameraKeyboardWalkOperator(this),l=new d.Operator.CameraWalkModeOperator(this,f,k),g=new d.Operator.CameraTurntableOperator(this),m=new d.Operator.SelectionOperator(this,this.noteTextManager),h=new d.Operator.AreaSelectionOperator(this),q=new d.Operator.RayDrillSelectionOperator(this),r=new d.Operator.RedlineCircleOperator(this),w=new d.Operator.RedlineTextOperator(this),t=new d.Operator.RedlineRectangleOperator(this),
u=new d.Operator.RedlinePolylineOperator(this),v=new d.Operator.MeasureEdgeLengthOperator(this,this.measureManager),z=new d.Operator.MeasureFaceFaceDistanceOperator(this,this.measureManager),x=new d.Operator.MeasureLineLineAngleOperator(this,this.measureManager),y=new d.Operator.MeasurePointPointDistanceOperator(this,this.measureManager),A=new d.Operator.MeasureFaceFaceAngleOperator(this,this.measureManager),B=new d.Operator.MeasurePolylineDistanceOperator(this,this.measureManager),D=new d.Operator.MeasurePolygonAreaOperator(this,
this.measureManager),C=new d.Operator.NoteOperator(this,this.noteTextManager),F=new d.Operator.CuttingPlaneOperator(this,this.cuttingManager),E=new d.Operator.HandleOperator(this),H=new d.Operator.NavCubeOperator(this),G=new d.Operator.AxisTriadOperator(this),I=new d.Operator.FloorplanOperator(this);this.operatorManager._registerOperator(d.OperatorId.Navigate,a);this.operatorManager._registerOperator(d.OperatorId.Orbit,b);this.operatorManager._registerOperator(d.OperatorId.Pan,e);this.operatorManager._registerOperator(d.OperatorId.Zoom,
c);this.operatorManager._registerOperator(d.OperatorId.Walk,f);this.operatorManager._registerOperator(d.OperatorId.KeyboardWalk,k);this.operatorManager._registerOperator(d.OperatorId.WalkMode,l);this.operatorManager._registerOperator(d.OperatorId.Turntable,g);this.operatorManager._registerOperator(d.OperatorId.Select,m);this.operatorManager._registerOperator(d.OperatorId.AreaSelect,h);this.operatorManager._registerOperator(d.OperatorId.RayDrillSelect,q);this.operatorManager._registerOperator(d.OperatorId.RedlineCircle,
r);this.operatorManager._registerOperator(d.OperatorId.RedlineText,w);this.operatorManager._registerOperator(d.OperatorId.RedlineRectangle,t);this.operatorManager._registerOperator(d.OperatorId.RedlinePolyline,u);this.operatorManager._registerOperator(d.OperatorId.MeasureEdgeLength,v);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceDistance,z);this.operatorManager._registerOperator(d.OperatorId.MeasureLineLineAngle,x);this.operatorManager._registerOperator(d.OperatorId.MeasurePointPointDistance,
y);this.operatorManager._registerOperator(d.OperatorId.MeasureFaceFaceAngle,A);this.operatorManager._registerOperator(d.OperatorId.MeasurePolylineDistance,B);this.operatorManager._registerOperator(d.OperatorId.MeasurePolygonArea,D);this.operatorManager._registerOperator(d.OperatorId.Note,C);this.operatorManager._registerOperator(d.OperatorId.Cutting,F);this.operatorManager._registerOperator(d.OperatorId.Handle,E);this.operatorManager._registerOperator(d.OperatorId.NavCube,H);this.operatorManager._registerOperator(d.OperatorId.AxisTriad,
G);this.operatorManager._registerOperator(d.OperatorId.Floorplan,I);a.setBimNavigationEnabled(!1);v.addMapping(d.Button.Left);z.addMapping(d.Button.Left);y.addMapping(d.Button.Left);y.addMapping(d.Button.Left,d.KeyModifiers.Alt);A.addMapping(d.Button.Left);F.addMapping(d.Button.Left);h.addMapping(d.Button.Left);h.addMapping(d.Button.Left,d.KeyModifiers.Control);this.operatorManager.set(d.OperatorId.Navigate,0);this.operatorManager.set(d.OperatorId.Select,1);this.operatorManager.push(d.OperatorId.Cutting);
this.operatorManager.push(d.OperatorId.Handle);this.operatorManager.push(d.OperatorId.NavCube);this.operatorManager.push(d.OperatorId.AxisTriad);this.operatorManager.push(d.OperatorId.Floorplan)};g.prototype.getViewerVersionString=function(){return g.VIEWER_VERSION_STRING};g.prototype.getFormatVersionString=function(){return this._engine.getVersionString()};g.prototype.getView=function(){return this.view};g.prototype.getModel=function(){return this.model};g.prototype.getOverlayManager=function(){return this.overlayManager};
g.prototype.getMeasureManager=function(){return this.measureManager};g.prototype.getLineManager=function(){return this.lineManager};g.prototype.getCuttingManager=function(){return this.cuttingManager};g.prototype.getMarkupManager=function(){return this.markupManager};g.prototype.getSelectionManager=function(){return this.selectionManager};g.prototype.getExplodeManager=function(){return this.explodeManager};g.prototype.getOperatorManager=function(){return this.operatorManager};g.prototype._getNoteTextManager=
function(){return this.noteTextManager};g.prototype.start=function(){var b=this,d=this._domElements.getCanvasContainerElement();return this._engine.start(d,{enginePath:this._params.enginePath,engineReady:function(c){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,c];case 1:return a.sent(),[4,this._modelStructure.waitForReady()];case 2:return a.sent(),[4,this._scEngineReady()];case 3:return a.sent(),[2]}})})},sceneReady:function(){b._sceneReady()},
renderComplete:function(){b._renderComplete()},streamingActivated:function(){b._streamingActivated()},streamingDeactivated:function(){b._streamingDeactivated()},priorityMetaDataSent:function(c,a){b._priorityMetaDataSent(c,a)}})};g.prototype.registerCustomOperator=function(b){return this.operatorManager.registerCustomOperator(b)};g.prototype.unregisterCustomOperator=function(b){this.operatorManager.unregisterCustomOperator(b)};g.prototype.focusInput=function(b){this._inputMonitor.focusInput(b)};g.prototype.setCallbacks=
function(b){this._callbackManager.bind(b)};g.prototype.unsetCallbacks=function(b){this._callbackManager.unbind(b)};g.prototype.resizeCanvas=function(){this._alreadyShutDown||(this._engine.resize(),this._inputMonitor.elementResize())};g.prototype.moveToWindow=function(b){this._inputMonitor.setDocument(b.document)};g.prototype.redraw=function(b){var d=this;if(b){var c=function(){d._callbackManager.unbind({_drawComplete:c});b()};this._callbackManager.bind({_drawComplete:c})}this._engine.redraw()};g.prototype.selectPart=
function(b,e){void 0===e&&(e=d.SelectionMode.Set);return this.selectionManager.selectNode(b,e)};g.prototype.trigger=function(b){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];this._callbackManager.unsafeTrigger(b,d)};g.prototype.triggerEvent=function(b,d){this._callbackManager.unsafeTrigger(b,d)};g.prototype._getCallbackManager=function(){return this._callbackManager};g.prototype._setStreamIdleMarker=function(){return this._engine.setStreamIdleMarker()};g.prototype.getStatistics=function(b){void 0===
b&&(b=!1);return this._engine.getStatistics(b)};g.prototype.setMinimumFramerate=function(b){this._setMinimumFramerate(b);return Promise.resolve()};g.prototype._setMinimumFramerate=function(b){this._engine.setMinimumFramerate(b)};g.prototype.getMinimumFramerate=function(){return this._engine.getMinimumFramerate()};g.prototype.setServerRenderQuality=function(b,d,c,a){return this._engine.setServerRenderQuality(b,d,c,a)};g.prototype.getStreamingMode=function(){return this._streamingMode};g.prototype.getRendererType=
function(){return this._engine.getRendererType()};g.prototype.getViewElement=function(){return this._domElements.getCanvasContainerElement()};g.prototype.shutdown=function(){this._alreadyShutDown||(console.assert(this._modelStructure.isReady()),this._callbackManager.trigger("_shutdownBegin"),this.operatorManager._shutdown(),this._inputMonitor.shutdown(),this.markupManager._shutdown(),this._timeoutMonitor.shutdown(),this._modelStructure.shutdown(),this._domElements.shutdown(),this._engine.shutdown(),
this._alreadyShutDown=!0)};g.prototype.setClientTimeout=function(b,d){return this._timeoutMonitor.setTimeoutDurations(b,d)};g.prototype.resetClientTimeout=function(){this._timeoutMonitor.resetTimeout()};g.prototype.pauseRendering=function(b){this._pauseRendering(b);return Promise.resolve()};g.prototype._pauseRendering=function(b){this._engine.pauseRendering(b)};g.prototype.resumeRendering=function(){this._resumeRendering();return Promise.resolve()};g.prototype._resumeRendering=function(){this._engine.resumeRendering()};
g.prototype.delayCapping=function(){this.cuttingManager.delayCapping()};g.prototype.reset=function(b){void 0===b&&(b=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return(d=null!==this.model.getDefaultCadConfiguration())?[4,this._modelStructure.cadConfigurationsEnabled()]:[3,2];case 1:d=c.sent(),c.label=2;case 2:return d?[4,this.model.activateDefaultCadConfiguration()]:[3,4];case 3:return c.sent(),[3,7];
case 4:return[4,this.model.reset()];case 5:return c.sent(),this.sheetManager.isDrawingSheetActive()?[3,7]:[4,this.view.resetCamera(b)];case 6:c.sent(),c.label=7;case 7:return[2]}})})};g.prototype.closeConnection=function(){this.view.setCamera(this.view.getCamera());this._engine.disconnectNetwork();this._timeoutMonitor.shutdown()};g.prototype.setAllowHighDpi=function(b){this._engine.setAllowHighDpi(b)};g.prototype.setAllowHighDPI=function(b){this.setAllowHighDpi(b)};g.prototype.getAllowHighDpi=function(){return this._engine.getAllowHighDpi()};
g.prototype.getAllowHighDPI=function(){return this.getAllowHighDpi()};g.prototype.takeSnapshot=function(b){var e=this;void 0===b&&(b=new d.SnapshotConfig);var c=d.Util.OpenPromise.create(),a=new d.Internal.Snapshot(this._domElements,b),f=this._domElements.getCanvasContainerElement(),k=this._domElements.getRedlineElement(),l=0<b.width&&0<b.height;if(l){var g=b.width/f.clientWidth*100+"%";b=b.height/f.clientHeight*100+"%";f.style.width=g;f.style.height=b;k.style.width=g;k.style.height=b}var m=this.getAllowHighDpi();
this._engine.setAllowHighDpi(!1);this._engine.resize();this.redraw(function(){return __awaiter(e,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,a.capture(f)];case 1:return b=d.sent(),l&&(f.style.width="100%",f.style.height="100%",k.style.width="100%",k.style.height="100%"),this._engine.setAllowHighDpi(m),this._engine.resize(),c.resolve(b),[2]}})})});return c};g.prototype.fitWorld=function(b){void 0===b&&(b=d.DefaultTransitionDuration);return this.view.fitWorld(b)};
g.prototype.setViewOrientation=function(b,e){void 0===e&&(e=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this.view.setViewOrientation(b,e)];case 1:return c.sent(),this._eventDispatcher.injectViewOrientationChangeEvent(),[2]}})})};g.prototype._scEngineReady=function(){return __awaiter(this,void 0,void 0,function(){var b,e,c,a,f,k,l;return __generator(this,function(g){switch(g.label){case 0:console.assert(this._modelStructure.isReady()),
b=this.model.getAbsoluteRootNode(),e=this._engine.getSessionType(),g.label=1;case 1:return g.trys.push([1,,17,18]),this.cuttingManager._init(),[4,this._sceneReadyPromise];case 2:return g.sent(),[4,this._callbackManager.promiseTrigger("_assemblyTreeReady","assemblyTreeReady")];case 3:g.sent(),c="",g.label=4;case 4:g.trys.push([4,15,,16]);a=new d.LoadSubtreeConfig;a._allowSubtreeLoadedCallback=!1;f=0;if(1!==e)return[3,8];c=this._engine.getNetworkModelName();return c!==d.EmptyModelName?[3,5]:[3,7];case 5:return[4,
this.model.loadSubtreeFromModel(b,c,a)];case 6:g.sent(),g.label=7;case 7:return[3,14];case 8:if(2!==e)return[3,13];this._timeoutMonitor.shutdown();k=this._engine.getScsInfo();return"string"!==typeof k?[3,10]:[4,this.model.loadSubtreeFromScsFile(b,k,a)];case 9:return g.sent(),[3,12];case 10:return null===k?[3,12]:[4,this.model.loadSubtreeFromScsBuffer(b,k,a)];case 11:return g.sent(),[3,12];case 12:return void 0!==this._params.streamCutoffScale&&(f=this._params.streamCutoffScale),[3,14];case 13:throw new d.InternalLogicError;
case 14:return this._modelStructure.setPrefetchScsCutoffScale(f),[3,16];case 15:throw l=g.sent(),this._callbackManager.trigger("modelLoadFailure",c,""+l,l),l;case 16:return[3,18];case 17:return console.assert(this._modelStructure.isReady()),[2,this._callbackManager.promiseTrigger("_modelStructureReady","modelStructureReady")];case 18:return[2]}})})};g.prototype._sceneReady=function(){var b=this;this._inputMonitor.bindEvents(this._domElements.getCanvasContainerElement());this.selectionManager._init();
this._callbackManager.bind({_timeout:function(){b.shutdown()}});this._callbackManager.trigger("sceneReady");this._sceneReadyPromise&&this._sceneReadyPromise.resolve()};g.prototype._priorityMetaDataSent=function(b,e){this._callbackManager.trigger("_priorityMetaDataSent",b,e);if(!this._seenPriorityMetaDataSent){if(0!==b||0!==e)throw new d.InternalLogicError;this._seenPriorityMetaDataSent=!0;this._callbackManager.trigger("_attached",0)}};g.prototype._renderComplete=function(){this.markupManager._update()};
g.prototype._streamingActivated=function(){this._callbackManager.trigger("streamingActivated")};g.prototype._streamingDeactivated=function(){this._callbackManager.trigger("streamingDeactivated")};g.prototype.setStreamCutoffScale=function(b){this._setStreamCutoffScale(b);return Promise.resolve()};g.prototype._setStreamCutoffScale=function(b){this._engine.setStreamCutoffScale(b);this._modelStructure.setPrefetchScsCutoffScale(b)};g.prototype.getStreamCutoffScale=function(){return this._engine.getStreamCutoffScale()};
g.prototype._loseWebGlContext=function(){return this._engine.loseWebGlContext()};g.prototype._getScEngine=function(){return this._engine};g.prototype._debug_log=function(b){return this._engine.debug_log(b)};g.prototype._debug_stateFailure=function(b){return this._engine.debug_stateFailure(b)};g.prototype._debug_sync=function(){return this._engine.debug_sync()};g.prototype.exportToSvg=function(b){void 0===b&&(b=new d.SvgConfig);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,
function(c){switch(c.label){case 0:return[4,this.cuttingManager._setStandinGeometryVisible(!1)];case 1:c.sent(),c.label=2;case 2:return c.trys.push([2,,5,7]),[4,this.waitForIdle({redraw:!1})];case 3:return c.sent(),[4,this._engine.exportToSvg(b)];case 4:return d=c.sent(),[3,7];case 5:return[4,this.cuttingManager._setStandinGeometryVisible(!0)];case 6:return c.sent(),[7];case 7:return[2,d]}})})};g.prototype.waitForIdle=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a;return __generator(this,
function(f){switch(f.label){case 0:return this._alreadyShutDown?[2]:[4,this._setStreamIdleMarker()];case 1:return f.sent(),e=[],this.cuttingManager.hasActiveCuttingSection()?[4,this.cuttingManager.enableCappingIdleCallback(!0)]:[3,3];case 2:(c=f.sent())||e.push(this.cuttingManager.waitForCappingIdle()),f.label=3;case 3:return e.push(this._engine.waitForImageDecoding()),[4,Promise.all(e)];case 4:f.sent();if(!b||!1===b.redraw)return[3,6];a=d.Util.OpenPromise.create();this.redraw(function(){a.resolve()});
return[4,a];case 5:f.sent(),f.label=6;case 6:return[2]}})})};g.prototype.startSheetComparison=function(b,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.sheetManager.startComparison(b,d,c)];case 1:return a.sent(),[2]}})})};g.prototype.endSheetComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.sheetManager.endComparison()];case 1:return b.sent(),
[2]}})})};g.BUILD_ID="2fc2526";g.VIEWER_VERSION_STRING=d.Internal.versionString(d.Internal.Tree.MaxModelFileVersion)+" Build "+g.BUILD_ID;__decorate([g.deprecated],g.prototype,"deactivateSheets",null);__decorate([g.deprecated],g.prototype,"setActiveSheetId",null);__decorate([g.deprecated],g.prototype,"getActiveSheetId",null);__decorate([g.deprecated],g.prototype,"getSheetIds",null);__decorate([g.deprecated],g.prototype,"isDrawingSheetActive",null);__decorate([g.deprecated],g.prototype,"setBackgroundSheetEnabled",
null);__decorate([g.deprecated],g.prototype,"getBackgroundSheetEnabled",null);__decorate([g.deprecated],g.prototype,"setBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"getBackgroundSelectionEnabled",null);__decorate([g.deprecated],g.prototype,"setSheetColors",null);__decorate([g.deprecated],g.prototype,"getSheetBackgroundColor",null);__decorate([g.deprecated],g.prototype,"getSheetColor",null);__decorate([g.deprecated],g.prototype,"getSheetShadowColor",null);__decorate([g.deprecated],
g.prototype,"getView",null);__decorate([g.deprecated],g.prototype,"getModel",null);__decorate([g.deprecated],g.prototype,"getOverlayManager",null);__decorate([g.deprecated],g.prototype,"getMeasureManager",null);__decorate([g.deprecated],g.prototype,"getLineManager",null);__decorate([g.deprecated],g.prototype,"getCuttingManager",null);__decorate([g.deprecated],g.prototype,"getMarkupManager",null);__decorate([g.deprecated],g.prototype,"getSelectionManager",null);__decorate([g.deprecated],g.prototype,
"getExplodeManager",null);__decorate([g.deprecated],g.prototype,"getOperatorManager",null);__decorate([g.deprecated],g.prototype,"setAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"getAllowHighDPI",null);__decorate([g.deprecated],g.prototype,"startSheetComparison",null);__decorate([g.deprecated],g.prototype,"endSheetComparison",null);return g}();d.WebViewer=h})(Communicator||(Communicator={}));
(function(d){(function(h){function g(c){for(var a=2*Math.PI/c,b=[],d=0;d<c;d++){var e=d*a,g=Math.sin(e);b.push(Math.cos(e));b.push(g)}return b}function b(c,a,b,k){void 0===k&&(k=1);var f=d.Point3.cross(b,new d.Point3(0,1,0));.001>f.length()&&(f=d.Point3.cross(b,new d.Point3(0,0,1)));b=d.Point3.cross(f,b);for(var e=2*Math.PI/c,g=[],h=0;h<c;h++){var q=h*e,r=Math.sin(q);q=Math.cos(q);r=f.copy().scale(r).add(b.copy().scale(q)).scale(k).add(a);g.push(r)}return g}function e(c,a,b,k,e){for(var f=[],l=[],
g=0;g<b.length;g++){var h=(g+1)%b.length;f.push(b[g]);f.push(b[h]);f.push(k[g]);f.push(b[h]);f.push(k[h]);f.push(k[g]);l.push(d.Point3.subtract(b[g],c));l.push(d.Point3.subtract(b[h],c));l.push(d.Point3.subtract(k[g],a));l.push(d.Point3.subtract(b[h],c));l.push(d.Point3.subtract(k[h],a));l.push(d.Point3.subtract(k[g],a))}if(e)for(c=d.Point3.subtract(c,a),a=0;a<l.length;a++)l[a].add(c).normalize();return[f,l]}h.generateSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,a=Math.sqrt(10+2*Math.sqrt(5))/
(4*c),b=a/2;c=a/(2*c);var k=[];k[0]=new d.Point3(-c,b,0);k[1]=new d.Point3(c,b,0);k[2]=new d.Point3(-c,-b,0);k[3]=new d.Point3(c,-b,0);k[4]=new d.Point3(0,-c,b);k[5]=new d.Point3(0,c,b);k[6]=new d.Point3(0,-c,-b);k[7]=new d.Point3(0,c,-b);k[8]=new d.Point3(b,0,-c);k[9]=new d.Point3(b,0,c);k[10]=new d.Point3(-b,0,-c);k[11]=new d.Point3(-b,0,c);for(b=0;b<k.length;b++)k[b].normalize();var e=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,
6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],g=12;b=function(a){var c=[];e.map(function(a){var b=k[a[0]],f=k[a[1]],e=k[a[2]];k[g++]=(new d.Point3(b.x+f.x,b.y+f.y,b.z+f.z)).scale(.5).normalize();k[g++]=(new d.Point3(f.x+e.x,f.y+e.y,f.z+e.z)).scale(.5).normalize();k[g++]=(new d.Point3(e.x+b.x,e.y+b.y,e.z+b.z)).scale(.5).normalize();c.push([a[0],g-3,g-1]);c.push([g-3,g-2,g-1]);c.push([g-3,a[1],g-2]);c.push([g-2,a[2],g-1])});e=c};for(c=0;2>c;c++)b(c);b=[];c=[];a=0;for(var m=e;a<m.length;a++)for(var h=
m[a],q=0;3>q;q++){var r=h[q];b.push(k[r].x);b.push(k[r].y);b.push(k[r].z);r=k[r].normalize();c.push(r.x);c.push(r.y);c.push(r.z)}a=new d.MeshData;a.addFaces(b,c);a.setFaceWinding(d.FaceWinding.CounterClockwise);return a};h.generateConeCylinderMeshData=function(c,a,f,k,l,n){var m=new d.Matrix,h,q=f+n,r=g(a);for(h=0;h<r.length;h++)r[h]*=k;l=new d.Point3(0,q+l,0);h=new d.Point3(0,q,0);var w=m.transform(l),t=m.transform(h);l=[];var u=[];for(h=0;h<r.length;h+=2){var v=r[h],z=r[h+1],x=(h+2)%r.length,y=
r[x],A=r[x+1],B=r[h],D=r[h+1],C=r[x];x=r[x+1];var F=new d.Point3(v,q,z),E=new d.Point3(y,q,A);F=m.transform(F);E=m.transform(E);l.push(w);l.push(F);l.push(E);E=new d.Point3(0,1,0);B=new d.Point3(B,0,D);C=new d.Point3(C,0,x);D=m.transform(E);B=m.transform(B);C=m.transform(C);u.push(D);u.push(B);u.push(C);v=new d.Point3(v,q,z);y=new d.Point3(y,q,A);A=m.transform(v);y=m.transform(y);l.push(t);l.push(y);l.push(A);y=new d.Point3(0,-1,0);y=m.transform(y);u.push(y);u.push(y);u.push(y)}q=[];r=[];for(h=0;h<
l.length;h++)w=l[h],q.push(w.x),q.push(w.y),q.push(w.z),w=u[h],r.push(w.x),r.push(w.y),r.push(w.z);h=[q,r];l=[];u=[];r=g(a);for(q=0;q<r.length;q++)r[q]*=c;w=[];t=[];for(q=0;q<r.length;q+=2){y=r[q];A=r[q+1];x=(q+2)%r.length;v=r[x];z=r[x+1];C=r[q];B=r[q+1];D=r[x];x=r[x+1];w[0]=new d.Point3(y,f,A);w[1]=new d.Point3(y,0,A);w[2]=new d.Point3(v,0,z);w[3]=new d.Point3(v,0,z);w[4]=new d.Point3(v,f,z);w[5]=new d.Point3(y,f,A);t[0]=new d.Point3(C,0,B);t[1]=new d.Point3(C,0,B);t[2]=new d.Point3(D,0,x);t[3]=
new d.Point3(D,0,x);t[4]=new d.Point3(D,0,x);t[5]=new d.Point3(C,0,B);for(C=0;C<w.length;C++)B=m.transform(w[C]),l.push(B),B=m.transform(t[C]),u.push(B);w[0]=new d.Point3(v,0,z);w[1]=new d.Point3(y,0,A);w[2]=d.Point3.zero();t[0]=new d.Point3(0,-1,0);t[1]=new d.Point3(0,-1,0);t[2]=new d.Point3(0,-1,0);for(C=0;3>C;C++)B=m.transform(w[C]),l.push(B),B=m.transform(t[C]),u.push(B)}m=[];r=[];for(q=0;q<l.length;q++)w=l[q],m.push(w.x),m.push(w.y),m.push(w.z),w=u[q],r.push(w.x),r.push(w.y),r.push(w.z);m=[m,
r];l=new d.Point3(0,0,f);f=new d.Point3(0,0,f+n);n=new d.Point3(0,0,1);c=b(a,l,n,c);a=b(a,f,n,k);a=e(l,f,c,a,!0);k=[];c=[];for(f=0;f<a[0].length;f++)k.push(a[0][f].x),k.push(a[0][f].z),k.push(a[0][f].y),c.push(a[1][f].x),c.push(a[1][f].z),c.push(a[1][f].y);k=[k,c];a=h[0].concat(m[0]).concat(k[0]);k=h[1].concat(m[1]).concat(k[1]);c=new d.MeshData;c.setFaceWinding(d.FaceWinding.Clockwise);c.addFaces(a,k);return c};h.createCylinderMeshDataFromArc=function(c,a,f,k){for(var l=[],g=[],m,h=0;h<c.length-
3;h+=3){var q=new d.Point3(c[h],c[h+1],c[h+2]),r=new d.Point3(c[h+3],c[h+4],c[h+5]),w=b(f,q,a,k),t=b(f,r,a,k);m=e(q,r,w,t,!1);Array.prototype.push.apply(l,m[0]);Array.prototype.push.apply(g,m[1])}q=c.length;h=new d.Point3(c[q-3],c[q-2],c[q-1]);t=h.copy().subtract(new d.Point3(c[q-6],c[q-5],c[q-4])).normalize();q=b(2*f,h,a,k);r=h.copy().add(t.copy().scale(2/3));w=b(2*f,r,a,2*k);t=r.copy().add(t.copy().scale(2));m=e(h,r,q,w,!1);Array.prototype.push.apply(l,m[0]);Array.prototype.push.apply(g,m[1]);for(h=
0;h<q.length;h++)m=(h+1)%q.length,l.push(t),l.push(w[h]),l.push(w[m]),m=w[h].copy().subtract(r).normalize().add(t.copy().normalize()).normalize(),g.push(m),g.push(m),g.push(m);h=new d.Point3(c[0],c[1],c[2]);t=h.copy().subtract(new d.Point3(c[3],c[4],c[5])).normalize();q=b(2*f,h,a,k);r=h.copy().add(t.copy().scale(2/3));w=b(2*f,r,a,2*k);t=r.copy().add(t.copy().scale(2));m=e(r,h,w,q,!1);Array.prototype.push.apply(l,m[0]);Array.prototype.push.apply(g,m[1]);for(h=0;h<q.length;h++)m=(h+1)%q.length,l.push(t),
l.push(w[m]),l.push(w[h]),m=w[h].copy().subtract(r).normalize().add(t.copy().normalize()).normalize(),g.push(m),g.push(m),g.push(m);c=[];a=[];for(h=0;h<l.length;h++)f=l[h],c.push(f.x),c.push(f.y),c.push(f.z),m=g[h],a.push(m.x),a.push(m.y),a.push(m.z);l=new d.MeshData;l.setFaceWinding(d.FaceWinding.CounterClockwise);l.addFaces(c,a);return l}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c){this._mode=b;this._impl=new d.Internal.IncrementalSelectionImpl(c)}b.create=function(d,c){return new b(d,c)};b.prototype.performSelection=function(b,c,a){var f=this._impl.viewer;"View"===this._mode?(f=f.view,void 0===a&&(a=[])):(h.TypeAssert(this._mode),f=f.selectionManager);void 0===c&&(c=null);return this._impl.performSelection(f,b,c,a)};b.prototype.isIdle=function(){return this._impl.isIdle()};b.prototype.waitForIdle=function(){return this._impl.waitForIdle()};
b.prototype.stopSelection=function(){return this._impl.stopSelection()};b.prototype.clearSelection=function(){return this._impl.clearSelection()};return b}();h.IncrementalSelection=g;(function(b){b.isScreenByAreaConfig=function(b){return"areaCssMin"in b};b.isRayDrillConfig=function(b){return"rayCssBoxRadius"in b};b.isConvexPolyhedronConfig=function(b){return"volumePlanes"in b};b.isSphereConfig=function(b){return"sphereRadius"in b}})(g=h.IncrementalSelection||(h.IncrementalSelection={}))})(d.Util||
(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b){this._killHandles=[];this._activeSelectionCount=0;this._inactivityPromise=null;this.viewer=b}b.prototype.isIdle=function(){return 0===this._activeSelectionCount};b.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(0===this._activeSelectionCount)return console.assert(null===this._inactivityPromise),[2,Promise.resolve()];null===this._inactivityPromise&&(this._inactivityPromise=
h.OpenPromise.create());return[2,this._inactivityPromise]})})};b.prototype.stopSelection=function(){return __awaiter(this,void 0,void 0,function(){var b,c,a,f;return __generator(this,function(k){console.assert(this._killHandles.length===this._activeSelectionCount);b=[];c=0;for(a=this._killHandles;c<a.length;c++)f=a[c],b.push(f());return[2,d.Util.waitForAll(b)]})})};b.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return b=
this.viewer.selectionManager,b.clear(),[4,this.stopSelection()];case 1:return c.sent(),b.clear(),[2]}})})};b.prototype._advanceBySelectionManager=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){a=this.viewer.selectionManager;return[2,a.advanceIncrementalSelection(b,c)]})})};b.prototype._advanceByView=function(b,c,a){return __awaiter(this,void 0,void 0,function(){var f,d,e,g,m,h;return __generator(this,function(k){switch(k.label){case 0:return f=
this.viewer.view,[4,f.advanceIncrementalSelection(b)];case 1:return d=k.sent(),null===d?[2,!1]:c?[4,Promise.all(d.map(c))]:[3,3];case 2:e=k.sent(),d=d.filter(function(a,c){return e[c]}),k.label=3;case 3:g=0;for(m=d;g<m.length;g++)h=m[g],a.push(h);return[2,!0]}})})};b.prototype._wrapBeginSelection=function(b,c){return d.Util.IncrementalSelection.isScreenByAreaConfig(c)?b.beginScreenSelectByArea(c.areaCssMin,c.areaCssMax,c.pickConfig):d.Util.IncrementalSelection.isRayDrillConfig(c)?b.beginRayDrillSelection(c.rayCssOrigin,
c.rayCssBoxRadius,c.pickConfig):d.Util.IncrementalSelection.isConvexPolyhedronConfig(c)?b.beginConvexPolyhedronSelection(c.volumePlanes,c.heuristicOrigin,c.pickConfig):d.Util.IncrementalSelection.isSphereConfig(c)?b.beginSphereSelection(c.sphereCenter,c.sphereRadius,c.pickConfig):d.Util.TypeAssertNever(c)};b.prototype.performSelection=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return void 0!==f?[3,1]:[2,this._performSelection(b,
c,a,null)];case 1:return[4,this._performSelection(b,c,a,f)];case 2:return d.sent(),[2,f]}})})};b.prototype._performSelection=function(b,c,a,f){return __awaiter(this,void 0,void 0,function(){var k,e,g,m,p,q,r,w,t=this;return __generator(this,function(l){switch(l.label){case 0:k=this._wrapBeginSelection(b,c);if(null===k)return[2];++this._activeSelectionCount;e=this.viewer.selectionManager;g=null===f;m=!1;p=h.Lazy.create(function(){return __awaiter(t,void 0,void 0,function(){var a,c;return __generator(this,
function(b){switch(b.label){case 0:m=!0,b.label=1;case 1:return b.trys.push([1,,7,8]),[4,k];case 2:return a=b.sent(),g?[4,e.endIncrementalSelection(a)]:[3,4];case 3:return b.sent(),[3,6];case 4:return[4,this.viewer.view.endIncrementalSelection(a)];case 5:b.sent(),b.label=6;case 6:return[3,8];case 7:return c=this._killHandles.indexOf(q),console.assert(0<=c),this._killHandles.splice(c,1),--this._activeSelectionCount,0===this._activeSelectionCount&&null!==this._inactivityPromise&&(this._inactivityPromise.resolve(),
this._inactivityPromise=null),[7];case 8:return[2]}})})});q=function(){return p.get()};this._killHandles.push(q);l.label=1;case 1:return l.trys.push([1,,11,13]),[4,k];case 2:r=l.sent(),w=!0,l.label=3;case 3:return!w||m?[3,10]:g?[4,this._advanceBySelectionManager(r,a)]:[3,5];case 4:return w=l.sent(),[3,7];case 5:return[4,this._advanceByView(r,a,f)];case 6:w=l.sent(),l.label=7;case 7:return!w||m?[3,9]:[4,d.Util.sleep(1)];case 8:l.sent(),l.label=9;case 9:return[3,3];case 10:return[3,13];case 11:return[4,
q()];case 12:return l.sent(),[7];case 13:return[2]}})})};return b}();h.IncrementalSelectionImpl=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this.diffuseColor=[1,1,1,1]}b.prototype.setDiffuseTransparency=function(b){this.diffuseColor[3]=b};b.prototype.setDiffuseColor=function(b){b.toFloatArray(this.diffuseColor)};b.prototype.setDiffuseColorFromArray=function(b){this.diffuseColor[0]=b[0];this.diffuseColor[1]=b[1];this.diffuseColor[2]=b[2]};b.prototype.hash=function(){return this.diffuseColor.join(",")};return b}();d.MaterialInfo=g;g=function(){function b(b){this._materials=new Map;
this._engine=b}b.prototype.getOrCreateMaterial=function(b){var c=this,a=b.hash(),f=this._materials.get(a);if(void 0!==f)return f;f=this._engine.createMaterial().then(function(a){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.setDiffuseColor(a,b.diffuseColor)];case 1:return c.sent(),[2,a]}})})});this._materials.set(a,f);return f};return b}();d.ScMaterialCache=g;g=function(){function b(b){this._engine=b}b.prototype.getIdentityInc=
function(){return this._identityInc};b.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.createIdentityMatrix()];case 1:return this._identityInc=b=c.sent(),[2]}})})};return b}();d.ScMatrixCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a,c,b){if(a.selectionMask===d.SelectionMask.None)throw new d.CommunicatorError("selectionMask is None");return __assign({},a,{cullSuboptimalEntities:c,enableOcclusionChecks:c,restrictLinesAndPointsToSelectedFaceInstances:b?!1:a.restrictLinesAndPointsToSelectedFaceInstances})}function b(a,c){var b=d.Point3.createFromArray(a.rayPoint),f=d.Point3.createFromArray(a.normal),k=new d.Point3(a.bounding.min[0],a.bounding.min[1],a.bounding.min[2]),e=new d.Point3(a.bounding.max[0],
a.bounding.max[1],a.bounding.max[2]);k=new d.Box(k,e);c=new d.Selection.FaceEntity(b,f,a.elementIndex,a.overlayIndex,a.elementBits,k,c);a=a.instanceInc;return d.Selection.SelectionItem.create(a[1],a[0],c,null,null)}function e(a){var c=new d.Point3(a.bounding.min[0],a.bounding.min[1],a.bounding.min[2]),b=new d.Point3(a.bounding.max[0],a.bounding.max[1],a.bounding.max[2]);c=new d.Box(c,b);c=new d.Selection.LineEntity(a.elementIndex,d.Point3.createFromArray(a.point),a.lineSegmentVertices,a.bestLineSegmentVertexIndex,
c,a.overlayIndex,a.elementBits);a=a.instanceInc;return d.Selection.SelectionItem.create(a[1],a[0],null,c,null)}function c(a){var c=new d.Selection.PointEntity(d.Point3.createFromArray(a.point),a.elementIndex,a.overlayIndex,a.elementBits);a=a.instanceInc;return d.Selection.SelectionItem.create(a[1],a[0],null,null,c)}function a(a){return null!==a.point?(a=a.point.entities[0],c(a)):null!==a.line?(a=a.line.entities[0],e(a)):null!==a.face?(a=a.face.entities[0],b(a,!1)):null!==a.proximityFace?(a=a.proximityFace.entities[0],
b(a,!0)):null}function f(a){var f=null;if(null!==a.face){var k=a.face.entities[0];f=b(k,!1)}else null!==a.proximityFace&&(k=a.proximityFace.entities[0],f=b(k,!0));var l=null;null!==a.line&&(k=a.line.entities[0],l=e(k));k=null;null!==a.point&&(k=a.point.entities[0],k=c(k));return new d.Selection.CompositeSelectionItem(f,l,k)}function k(a){var f=[];if(null!==a.face)for(var d=0,k=a.face.entities;d<k.length;d++){var l=b(k[d],!1);f.push(l)}a:for(l=a.line,d=a.point,k=a.proximityFace,a=null!==l?l.entities:
[],d=null!==d?d.entities:[],k=null!==k?k.entities:[],l=[a,d,k];;){for(var g,n=g=Number.POSITIVE_INFINITY,m=null,h=0;h<l.length;h++){var x=l[h];if(0<x.length){var y=x[0];y.radialMetric<g?(g=y.radialMetric,n=y.zMetric,m=x):y.radialMetric===g&&y.zMetric<n&&(n=y.zMetric,m=x)}}g=m;if(null===g){console.assert(0===a.length);console.assert(0===d.length);console.assert(0===k.length);break a}console.assert(0<g.length);g===a?(g=a.pop(),g=e(g)):g===d?(g=d.pop(),g=c(g)):(console.assert(g===k),g=k.pop(),g=b(g,
!0));f.push(g)}return f}var l;(function(a){a[a.Batch=1E3]="Batch";a[a.Chunk=100]="Chunk"})(l=h.AdvanceSelectionCapacity||(h.AdvanceSelectionCapacity={}));var n=function(){function c(a){this._pickTolerance=20;this._incrementalChunkedItems=new Map;this._sc=a}c.prototype.setPickTolerance=function(a){this._pickTolerance=a};c.prototype.getPickTolerance=function(){return this._pickTolerance};c.prototype.beginScreenAreaSelection=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,e;return __generator(this,
function(g){switch(g.label){case 0:f=b,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginScreenAreaSelection(a.x,a.y,c.x,c.y,f)];case 2:return k=g.sent(),[3,4];case 3:e=g.sent();if(SC.isError(e)&&"beginScreenAreaSelection"===e.scFunction)throw new d.SelectionInvalidatedError;throw e;case 4:return[2,new d.Selection.IncrementalSelectionId(k)]}})})};c.prototype.beginRayDrillSelection=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,e;return __generator(this,function(g){switch(g.label){case 0:f=
b,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginRayDrillSelection(a.x,a.y,c,f)];case 2:return k=g.sent(),[3,4];case 3:e=g.sent();if(SC.isError(e)&&"beginRayDrillSelection"===e.scFunction)throw new d.SelectionInvalidatedError;throw e;case 4:return[2,new d.Selection.IncrementalSelectionId(k)]}})})};c.prototype.beginConvexPolyhedronSelection=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,k,e,g,l,n,m,h;return __generator(this,function(p){switch(p.label){case 0:f=
b;k=[];e=0;for(g=a;e<g.length;e++)l=g[e],k.push(l.getCoefficients());n=[c.x,c.y,c.z];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._sc.beginConvexPolyhedronSelection(k,n,f)];case 2:return m=p.sent(),[3,4];case 3:h=p.sent();if(SC.isError(h)&&"beginConvexPolyhedronSelection"===h.scFunction)throw new d.SelectionInvalidatedError;throw h;case 4:return[2,new d.Selection.IncrementalSelectionId(m)]}})})};c.prototype.beginSphereSelection=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,
k,e;return __generator(this,function(g){switch(g.label){case 0:f=b,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._sc.beginSphereSelection(a,c,f)];case 2:return k=g.sent(),[3,4];case 3:e=g.sent();if(SC.isError(e)&&"beginSphereSelection"===e.scFunction)throw new d.SelectionInvalidatedError;throw e;case 4:return[2,new d.Selection.IncrementalSelectionId(k)]}})})};c.prototype.endIncrementalSelection=function(a){this._incrementalChunkedItems.delete(a._handle);this._sc.endVolumeSelection(a._handle)};
c.prototype.advanceIncrementalSelection=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,f,k,e,g,n,m,p;return __generator(this,function(q){switch(q.label){case 0:if((b=this._incrementalChunkedItems.get(a._handle))&&b.length)return[2,b.pop()];q.label=1;case 1:return q.trys.push([1,3,,4]),[4,this._sc.advanceVolumeSelection(a._handle,l.Batch)];case 2:return f=q.sent(),[3,4];case 3:k=q.sent();if(SC.isError(k)&&"advanceVolumeSelection"===k.scFunction)throw new d.SelectionInvalidatedError;
throw k;case 4:return 2!==f.length||4294967295!==f[1]?[3,7]:c?[4,this._sc.setStreamIdleMarker()]:[3,6];case 5:return q.sent(),[2,this.advanceIncrementalSelection(a,!1)];case 6:return[2,null];case 7:e=[];for(g=0;g<f.length;g+=2)n=f[g],m=f[g+1],e.push(d.Selection.SelectionItem.create(m,n));if(e.length<=l.Chunk)return[2,e];p=h.chunkify(e,l.Chunk).reverse();this._incrementalChunkedItems.set(a._handle,p);return[2,p.pop()]}})})};c.prototype._screenSelectByRay=function(a,c,b,f){return __awaiter(this,void 0,
void 0,function(){var k,e,l,n;return __generator(this,function(m){k=g(c,b,f);e=c.selectionMask;n=(l=c.selectionMask!==d.SelectionMask.Face||c.enableProximityFaces)?this._pickTolerance:-1;return[2,this._sc.screenSelectByRay(e,a.x,a.y,n,k)]})})};c.prototype._worldSelectByRay=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,d;return __generator(this,function(k){f=g(c,b,!1);d=h.toScRay(a);return[2,this._sc.worldSelectByRay(d,f)]})})};c.prototype.pickFromScreen=function(c,b,f){return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(k){switch(k.label){case 0:return[4,this._screenSelectByRay(c,b,!0,f)];case 1:return d=k.sent(),[2,a(d)]}})})};c.prototype.pickAllFromScreen=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._screenSelectByRay(a,c,!1,b)];case 1:return f=d.sent(),[2,k(f)]}})})};c.prototype.compositePickFromScreen=function(a,c,b){return __awaiter(this,void 0,void 0,
function(){var d;return __generator(this,function(k){switch(k.label){case 0:return[4,this._screenSelectByRay(a,c,!0,b)];case 1:return d=k.sent(),[2,f(d)]}})})};c.prototype.pickFromRay=function(c,b){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(d){switch(d.label){case 0:return[4,this._worldSelectByRay(c,b,!0)];case 1:return f=d.sent(),[2,a(f)]}})})};c.prototype.pickAllFromRay=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(f){switch(f.label){case 0:return[4,this._worldSelectByRay(a,c,!1)];case 1:return b=f.sent(),[2,k(b)]}})})};c.prototype.pickCompositeFromRay=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d,k;return __generator(this,function(e){switch(e.label){case 0:return b=g(c,!0,!1),d=h.toScRay(a),[4,this._sc.worldSelectByRay(d,b)];case 1:return k=e.sent(),[2,f(k)]}})})};return c}();h.ScSelectionManager=n})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){d=d.Internal||(d.Internal={});(d.Test||(d.Test={})).AdvanceSelectionCapacity=d.AdvanceSelectionCapacity})(Communicator||(Communicator={}));
(function(d){(function(h){h.toScRay=function(d){var b={origin:[],direction:[]};d.origin.toArray(b.origin);d.direction.toArray(b.direction);return b};h.makeFaceFaceDistanceItem=function(g){var b=new d.FaceFaceDistanceItem;b.pos1.fromArray(g.point1);b.pos2.fromArray(g.point2);b.distance=g.distance;return b}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b){this.attributes=b}d.prototype.copy=function(){return new d(this.attributes.map(function(b){return b.copy()}))};return d}();d.SubentityAttributes=h})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(b){b.isFace=function(b){return b instanceof d.SubentityProperties.CylinderElement||b instanceof d.SubentityProperties.PlaneElement||b instanceof d.SubentityProperties.ConeElement||b instanceof d.SubentityProperties.SphereElement||b instanceof d.SubentityProperties.TorusElement||b instanceof d.SubentityProperties.Blend01Element||b instanceof d.SubentityProperties.Blend02Element||b instanceof d.SubentityProperties.Blend03Element||b instanceof d.SubentityProperties.NurbsElement||
b instanceof d.SubentityProperties.CylindricalElement||b instanceof d.SubentityProperties.OffsetElement||b instanceof d.SubentityProperties.PipeElement||b instanceof d.SubentityProperties.RuledElement||b instanceof d.SubentityProperties.RevolutionElement||b instanceof d.SubentityProperties.ExtrusionElement||b instanceof d.SubentityProperties.FromCurvesElement||b instanceof d.SubentityProperties.TransformElement||b instanceof d.SubentityProperties.OtherFaceElement};b.isEdge=function(b){return b instanceof
d.SubentityProperties.LineElement||b instanceof d.SubentityProperties.CircleElement||b instanceof d.SubentityProperties.OtherEdgeElement}})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(b){(function(b){b.parseBinary=function(b){var l=d.SubentityProperties.FaceType,n=b.parseFaceType();switch(n){case l.Cylinder:return c.parseBinary(b);case l.Plane:return a.parseBinary(b);case l.Cone:return f.parseBinary(b);case l.Other:return g.parseBinary(b);case l.Sphere:return k.parseBinary(b);case l.Torus:return e.parseBinary(b);case l.Blend01:return m.parseBinary(b);case l.Blend02:return h.parseBinary(b);case l.Blend03:return q.parseBinary(b);case l.Nurbs:return r.parseBinary(b);
case l.Cylindrical:return w.parseBinary(b);case l.Offset:return t.parseBinary(b);case l.Pipe:return u.parseBinary(b);case l.Ruled:return v.parseBinary(b);case l.Revolution:return z.parseBinary(b);case l.Extrusion:return x.parseBinary(b);case l.FromCurves:return y.parseBinary(b);case l.Transform:return A.parseBinary(b);default:throw d.Util.TypeAssert(n),new d.AssemblyDataParseError("Unexpected measurement face type.");}};var c=function(){function a(){}a.parseBinary=function(a){var c=a.parseFloat_32(),
b=a.parsePoint3_32();a=a.parsePoint3_32();return new d.SubentityProperties.CylinderElement(c,b,a)};return a}();b.Cylinder=c;var a=function(){function a(){}a.parseBinary=function(a){var c=a.parsePoint3_32();a=a.parsePoint3_32();return new d.SubentityProperties.PlaneElement(c,a)};return a}();b.Plane=a;var f=function(){function a(){}a.parseBinary=function(a){var c=a.parseFloat_32(),b=a.parsePoint3_32(),f=a.parsePoint3_32();a=a.parseFloat_32();return new d.SubentityProperties.ConeElement(c,b,f,a)};return a}();
b.Cone=f;var k=function(){function a(){}a.parseBinary=function(a){var c=a.parseFloat_32(),b=a.parsePoint3_32();a=a.parsePoint3_32();return new d.SubentityProperties.SphereElement(c,b,a)};return a}();b.Sphere=k;var e=function(){function a(){}a.parseBinary=function(a){var c=a.parseFloat_32(),b=a.parseFloat_32(),f=a.parsePoint3_32();a=a.parsePoint3_32();return new d.SubentityProperties.TorusElement(c,b,f,a)};return a}();b.Torus=e;var g=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.OtherFaceElement};
return a}();b.Other=g;var m=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.Blend01Element};return a}();b.Blend01=m;var h=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.Blend02Element};return a}();b.Blend02=h;var q=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.Blend03Element};return a}();b.Blend03=q;var r=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.NurbsElement};
return a}();b.Nurbs=r;var w=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.CylindricalElement};return a}();b.Cylindrical=w;var t=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.OffsetElement};return a}();b.Offset=t;var u=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.PipeElement};return a}();b.Pipe=u;var v=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.RuledElement};
return a}();b.Ruled=v;var z=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.RevolutionElement};return a}();b.Revolution=z;var x=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.ExtrusionElement};return a}();b.Extrusion=x;var y=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.FromCurvesElement};return a}();b.FromCurves=y;var A=function(){function a(){}a.parseBinary=function(a){return new d.SubentityProperties.TransformElement};
return a}();b.Transform=A})(b.Face||(b.Face={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(b){(function(b){b.parseBinary=function(b){var k=d.SubentityProperties.EdgeType,e=b.parseEdgeType();switch(e){case k.Line:return c.parseBinary(b);case k.Circle:return a.parseBinary(b);case k.Other:return f.parseBinary(b);default:throw d.Util.TypeAssert(e),new d.AssemblyDataParseError("Unexpected measurement edge type.");}};var c=function(){function a(){}a.parseBinary=function(a){a=a.parseFloat_32();return new d.SubentityProperties.LineElement(a)};return a}();
b.Line=c;var a=function(){function a(){}a.parseBinary=function(a){var c=a.parseFloat_32(),b=a.parsePoint3_32();a=a.parsePoint3_32();return new d.SubentityProperties.CircleElement(c,b,a)};return a}();b.Circle=a;var f=function(){function a(){}a.parseBinary=function(a){a=a.parseFloat_32();return new d.SubentityProperties.OtherEdgeElement(a)};return a}();b.Other=f})(b.Edge||(b.Edge={}))})(g.MeasurementProperty||(g.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||
(Communicator={}));
(function(d){(function(d){var g;(function(c){c[c.Undefined=0]="Undefined";c[c.Line=1]="Line";c[c.Circle=2]="Circle";c[c.Other=6]="Other"})(g=d.EdgeType||(d.EdgeType={}));var b;(function(c){c[c.Undefined=0]="Undefined";c[c.Cylinder=3]="Cylinder";c[c.Plane=4]="Plane";c[c.Cone=5]="Cone";c[c.Other=6]="Other";c[c.Sphere=7]="Sphere";c[c.Torus=8]="Torus";c[c.Blend01=9]="Blend01";c[c.Blend02=10]="Blend02";c[c.Blend03=11]="Blend03";c[c.Nurbs=12]="Nurbs";c[c.Cylindrical=13]="Cylindrical";c[c.Offset=14]="Offset";
c[c.Pipe=15]="Pipe";c[c.Ruled=16]="Ruled";c[c.Revolution=17]="Revolution";c[c.Extrusion=18]="Extrusion";c[c.FromCurves=19]="FromCurves";c[c.Transform=20]="Transform"})(b=d.FaceType||(d.FaceType={}));var e=function(){function c(a){this.length=a}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Line};return c}();d.LineElement=e;e=function(){function c(a,c,b){this.radius=a;this.origin=c.copy();this.normal=b.copy()}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal)};c.prototype.type=function(){return g.Circle};return c}();d.CircleElement=e;e=function(){function c(a){this.length=a}c.prototype.copy=function(){return new c(this.length)};c.prototype.type=function(){return g.Other};return c}();d.OtherEdgeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Other};return c}();d.OtherFaceElement=e;e=function(){function c(a,c,b){this.radius=a;this.origin=c.copy();this.normal=b.copy()}
c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return b.Cylinder};return c}();d.CylinderElement=e;e=function(){function c(a,c){this.origin=a.copy();this.normal=c.copy()}c.prototype.copy=function(){return new c(this.origin,this.normal)};c.prototype.type=function(){return b.Plane};return c}();d.PlaneElement=e;e=function(){function c(a,c,b,d){this.radius=a;this.origin=c.copy();this.normal=b.copy();this.halfAngle=d}c.prototype.copy=function(){return new c(this.radius,
this.origin,this.normal,this.halfAngle)};c.prototype.type=function(){return b.Cone};return c}();d.ConeElement=e;e=function(){function c(a,c,b){this.radius=a;this.origin=c.copy();this.normal=b.copy()}c.prototype.copy=function(){return new c(this.radius,this.origin,this.normal)};c.prototype.type=function(){return b.Sphere};return c}();d.SphereElement=e;e=function(){function c(a,c,b,d){this.majorRadius=a;this.minorRadius=c;this.origin=b.copy();this.normal=d.copy()}c.prototype.copy=function(){return new c(this.majorRadius,
this.minorRadius,this.origin,this.normal)};c.prototype.type=function(){return b.Torus};return c}();d.TorusElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Blend01};return c}();d.Blend01Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Blend02};return c}();d.Blend02Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Blend03};
return c}();d.Blend03Element=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Nurbs};return c}();d.NurbsElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Cylindrical};return c}();d.CylindricalElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Offset};return c}();d.OffsetElement=e;e=function(){function c(){}c.prototype.copy=
function(){return new c};c.prototype.type=function(){return b.Pipe};return c}();d.PipeElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Ruled};return c}();d.RuledElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Revolution};return c}();d.RevolutionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Extrusion};
return c}();d.ExtrusionElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.FromCurves};return c}();d.FromCurvesElement=e;e=function(){function c(){}c.prototype.copy=function(){return new c};c.prototype.type=function(){return b.Transform};return c}();d.TransformElement=e})(d.SubentityProperties||(d.SubentityProperties={}))})(Communicator||(Communicator={}));
(function(d){d=d.StaticGenericType||(d.StaticGenericType={});d.IfcColumn="IFCCOLUMN";d.IfcCovering="IFCCOVERING";d.IfcCurtainWall="IFCCURTAINWALL";d.IfcDoor="IFCDOOR";d.IfcRamp="IFCRAMP";d.IfcRoof="IFCROOF";d.IfcSlab="IFCSLAB";d.IfcSpace="IFCSPACE";d.IfcStair="IFCSTAIR";d.IfcStairFlight="IFCSTAIRFLIGHT";d.IfcTransportElement="IFCTRANSPORTELEMENT";d.IfcWall="IFCWALL";d.IfcWallStandardCase="IFCWALLSTANDARDCASE";d.IfcWindow="IFCWINDOW"})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a,c,b,f){return __awaiter(this,void 0,void 0,function(){var k,e,l,n,m,h,v,z;return __generator(this,function(p){switch(p.label){case 0:return[4,c.getNodeOrRepItem(b)];case 1:k=p.sent();if(null===k||k instanceof g.RepresentationItem||k instanceof g.PartDefinition)return[2,d.BimMask.None];e=g.getNodeGenericType(k);return null!==e?[3,3]:null===f?[2,d.BimMask.None]:[4,k.getAttributes()];case 2:l=p.sent();n=0;for(m=l;n<m.length;n++)if(h=m[n],v=h.getTitle(),
v===f){e=h.getValue();break}if(null===e)return[2,d.BimMask.None];p.label=3;case 3:return z=a(e),z!==d.BimMask.None?[2,z]:[2,d.BimMask.None]}})})}function e(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(f){switch(f.label){case 0:return c=[],b={enterAnyBody:function(a){a instanceof g.BodyInstance&&c.push(a)}},[4,g.WalkerAsync.walk(b,a,g.WalkRestriction.None)];case 1:return f.sent(),[2,c]}})})}function c(a){return __awaiter(this,void 0,void 0,function(){var c,
b,f,k,g,h;return __generator(this,function(l){switch(l.label){case 0:return[4,e(a)];case 1:c=l.sent();b=new Set;f=0;for(k=c;f<k.length;f++)g=k[f],h=g.getParent(),b.add(h);return[2,d.Util.setToArray(b)]}})})}function a(a,c,f,e){return __awaiter(this,void 0,void 0,function(){var k,g,l,n,m,h,v,z,x,y,A;return __generator(this,function(p){switch(p.label){case 0:k=[];g=0;for(l=f;g<l.length;g++)n=l[g],m=b(a,c,n,e),k.push(m);return[4,Promise.all(k)];case 1:h=p.sent();v=[];z=[];x=[];for(y=0;y<f.length;++y)n=
f[y],A=h[y],A!==d.BimMask.None&&(0!==(A&d.BimMask.Floor)&&v.push(n),0!==(A&d.BimMask.Wall)&&z.push(n),0!==(A&d.BimMask.Door)&&x.push(n));return[2,{floors:v,walls:z,doors:x}]}})})}function f(a){for(var c=[],b=0;b<a.length;b++)for(var f=0,d=a[b].getBodyInstances();f<d.length;f++){var k=d[f].getInstanceInc();c.push(k[0],k[1])}return c}g.hasEffectiveGenericType=function(a,c){for(;null!==a;){if(a.getName()===c||g.getNodeGenericType(a)===c)return!0;a=g.towardProductOccurrence(a.getParent())}return!1};g.ifcAttributeToBimMask=
function(a){switch(a){case d.StaticGenericType.IfcColumn:case d.StaticGenericType.IfcCurtainWall:case d.StaticGenericType.IfcStair:case d.StaticGenericType.IfcStairFlight:case d.StaticGenericType.IfcWall:case d.StaticGenericType.IfcWallStandardCase:case d.StaticGenericType.IfcWindow:return d.BimMask.Wall|d.BimMask.Floor;case d.StaticGenericType.IfcCovering:case d.StaticGenericType.IfcRamp:case d.StaticGenericType.IfcRoof:case d.StaticGenericType.IfcSlab:return d.BimMask.Floor;case d.StaticGenericType.IfcDoor:case d.StaticGenericType.IfcTransportElement:return d.BimMask.Door|
d.BimMask.Floor}return d.BimMask.None};g.registerBimNodes=function(b,d,e,g,h){return __awaiter(this,void 0,void 0,function(){var k,l,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return[4,c(g)];case 1:return k=q.sent(),[4,a(b,e,k,h)];case 2:return l=q.sent(),n=f(l.floors),d.registerBimInstances(n,0),m=f(l.walls),d.registerBimInstances(m,1),p=f(l.doors),d.registerBimInstances(p,2),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function c(a,c,b,d,e,g,h){this.headerVersion=a;this._rootAssemblyDataKey=c;this.isDrawing=b;this.isMeasurable=d;this.originalFileName=e;this.originalFileType=g;this.doublePrecisionMatrices=h}c.prototype.rootAssemblyDataKey=function(){console.assert(4294967295!==this._rootAssemblyDataKey);return this._rootAssemblyDataKey};c.parseBinary=function(a){if(0===a.length)return null;a=new g.AssemblyDataParser(new e(null,a));var b=new g.NodeParseBits;
b.parseBits1(a);if(!b.hasBits1(8388608))return null;var k=a.parseAssemblyDataHeaderVersion();if(k>c._maxHeaderVersion)throw new d.AssemblyDataParseError("Unknown header version: "+k);if(4<=k){var l=a.parseAssemblyDataVersion(3);if(!h.versionAtLeast(g.MaxModelFileVersion,l))throw new d.AssemblyDataParseError("Invalid version: "+h.versionString(l));}b.parseBits2(a);l=a.parseDataKey();var n=a.parseBoolean(),m="",p=d.FileType.Unknown,q=!1;var r=1<=k?a.parseBoolean():!0;3<=k&&(q=b.hasBits2(64),b.hasBits2(4)&&
(m=a.parseCString()),p=a.parseIndex_32());return new c(k,l,n,r,m,p,q)};c._maxHeaderVersion=4;c.dynamic=new c(c._maxHeaderVersion,4294967295,!1,!1,"",d.FileType.Unknown,!0);return c}();g.AssemblyDataHeader=b;var e=function(){return function(c,a){this.header=c;this.bytes=a}}();g.AssemblyData=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){return function(){this.prototypes=new Map;this.partDefinitions=new Map}}(),e=function(){return function(){this.bodies=new Map;this.contexts=[]}}(),c=function(){function a(a,c,b,e,m,p){this._centralQueueClock=new h.Clock;this._productOccurrences=new Map;this._pmis=new Map;this._cadViews=new Map;this._bodyInstances=new Map;this._pmiBodies=new Map;this._viewFrames=new Map;this._partDefinitions=new Map;this._representationItems=new Map;this._partToInstance=
new Map;this._filters=[];this._layers=new Map;this._layersIds=new Map;this._nextLayerId=0;this._genericTypeToNodes=new Map;this._genericIdToNode=new Map;this._cadConfigurations=new Set;this._modelContents=new Map;this._inclusionContents=new Map;this._nodeDeletionBlackList=new Set;this._meshDeletionBlackList=new Set;this._dynamicNodeIdSeed=g.invalidNodeId;this._currentNodeIdOffset=0;this._initialEmptyNodeIdOffsetObtained=!1;this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=
this._activeCadView=null;this._isMeasurable=this._containsDrawings=!1;this._initiallyHiddenStayHidden=this._automaticMeasurementUnitScaling=!0;this._completedLoadTimestamp=this._activeLoadTimestamp=0;this._requestedNodes=new Map;this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0;this._seenExternalModel=this._isInitialized=!1;this._config=__assign({},a);this._engine=c;this._callbackManager=b;this._cuttingManager=e;this._view=m;this._model=
p;this._isScs=2===this._engine.getSessionType();console.assert(!this._isScs||this._engine.getRendererType()===d.RendererType.Client)}a.prototype.initialize=function(a){var c=this;console.assert(void 0===this._rootLoadContext);console.assert(void 0===this._rootNode);console.assert(!this._isInitialized);this._isInitialized=!0;console.assert(void 0===this._centralQueue);this._centralQueue=new h.PromiseQueue(a.maxConcurrentAttachments(),!1);this._callbackManager.bind({_inputInteraction:function(a,b){c._onUserInteraction(a,
b)}});this._rootLoadContext=new g.LoadContext(null,d.EmptyModelName,null);a=new g.AttachContext(new g.ScKeyRemapper,0,!1,0,this._rootLoadContext);this._rootLoadContext.addAttachContext(a);var b=new g.InclusionContext(this,a,0,0);a.addInclusionContext(b);this._rootNode=g.ProductOccurrence.createDynamic(this,b,"Models",null,null,!0);b.addProductOccurrence(this._rootNode);console.assert(this._rootNode.isAbsoluteRoot());this.preventNodeDeletion(this._rootLoadContext);this.preventNodeDeletion(a);this.preventNodeDeletion(b);
this.preventNodeDeletion(this._rootNode);this._rootNode.markLoaded()};a.prototype.isInitialized=function(){return this._isInitialized};a.prototype.getRootNode=function(){return this._rootNode};a.prototype.getAbstractScEngine=function(){return this._engine};a.prototype.generateDynamicNodeId=function(){return--this._dynamicNodeIdSeed};a.prototype.newNodeIdOffset=function(){if(!this._initialEmptyNodeIdOffsetObtained)return this._initialEmptyNodeIdOffsetObtained=!0,console.assert(0===this._currentNodeIdOffset),
0;var a=this._currentNodeIdOffset;this._currentNodeIdOffset+=4294967296;return a};a.prototype.getLowestAvailableNodeId=function(){return this._currentNodeIdOffset};a.prototype.tryParseHeader=function(a){var c=this,b=g.AssemblyDataHeader.parseBinary(a);if(null===b)return null;this._containsDrawings=this._containsDrawings||b.isDrawing;this._isMeasurable=this._isMeasurable||b.isMeasurable;return this._callbackManager.promiseTrigger("_modelStructureHeaderParsed",null,b).then(function(){c._callbackManager.trigger("modelStructureHeaderParsed",
b.originalFileName,b.originalFileType);return b})};a.prototype._isRegistered=function(a){return this._productOccurrences.has(a)||this._pmis.has(a)||this._cadViews.has(a)||this._bodyInstances.has(a)||this._pmiBodies.has(a)||this._viewFrames.has(a)||this._partDefinitions.has(a)||this._representationItems.has(a)};a.prototype.registerProductOccurrence=function(a){if(!a.isMissing()){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._productOccurrences.set(c,a);c=g.getNodeGenericType(a);
null!==c&&this.registerGenericType(a,c);c=a.getGenericId();null!==c&&this.registerGenericGlobalId(a,c);a.isAConfigurationNode()&&this._registerCadConfiguration(a);if(a.isADrawingSheetNode()||a.isADrawingViewNode())this._containsDrawings=!0}};a.prototype.lookupProductOccurrence=function(a){a=this._productOccurrences.get(a);return void 0!==a?a:null};a.prototype.registerPmi=function(a){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._pmis.set(c,a)};a.prototype.lookupPmi=function(a){a=
this._pmis.get(a);return void 0!==a?a:null};a.prototype.registerCadView=function(a){null===this._firstProductOccurrenceWithView&&(this._firstProductOccurrenceWithView=a.getParent());var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._cadViews.set(c,a)};a.prototype.getFirstProductOccurrenceWithView=function(){return this._firstProductOccurrenceWithView};a.prototype.lookupCadView=function(a){a=this._cadViews.get(a);return void 0!==a?a:null};a.prototype.registerBodyInstance=function(a){var c=
a.getRuntimeId();console.assert(!this._isRegistered(c));this._bodyInstances.set(c,a);this._registerAnyBodyByInstanceInc(a)};a.prototype.lookupBodyInstance=function(a){a=this._bodyInstances.get(a);return void 0!==a?a:null};a.prototype.registerPmiBody=function(a){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._pmiBodies.set(c,a);this._registerAnyBodyByInstanceInc(a)};a.prototype.lookupPmiBody=function(a){a=this._pmiBodies.get(a);return void 0!==a?a:null};a.prototype.registerViewFrame=
function(a){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._viewFrames.set(c,a);this._registerAnyBodyByInstanceInc(a)};a.prototype.lookupViewFrame=function(a){a=this._viewFrames.get(a);return void 0!==a?a:null};a.prototype.registerPartDefinition=function(a){if(!a.isMissing()){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._partDefinitions.set(c,a)}};a.prototype.lookupPartDefinition=function(a){a=this._partDefinitions.get(a);return void 0!==a?a:null};a.prototype.registerRepresentationItem=
function(a){var c=a.getRuntimeId();console.assert(!this._isRegistered(c));this._representationItems.set(c,a)};a.prototype.lookupRepresentationItem=function(a){a=this._representationItems.get(a);return void 0!==a?a:null};a.prototype.lookupAnyBody=function(a){return this.lookupBodyInstance(a)||this.lookupPmiBody(a)||this.lookupViewFrame(a)};a.prototype.lookupAnyTreeNode=function(a){return this.lookupProductOccurrence(a)||this.lookupPmi(a)||this.lookupCadView(a)||this.lookupAnyBody(a)};a.prototype.lookupAnyNonTreeNode=
function(a){return this.lookupRepresentationItem(a)||this.lookupPartDefinition(a)};a.prototype.lookupAnyNode=function(a){return this.lookupAnyTreeNode(a)||this.lookupAnyNonTreeNode(a)};a.prototype._registerCadConfiguration=function(a){console.assert(a.isAConfigurationNode());console.assert(!this._cadConfigurations.has(a));this._cadConfigurations.add(a);a.isADefaultNode()&&null===this._defaultCadConfiguration&&(this._defaultCadConfiguration=a)};a.prototype.getInstanceCountByInclusion=function(a){return this._getInclusionContent(a).bodies.size};
a.prototype.lookupAnyBodyByInstanceInc=function(a,c){a=this._getInclusionContent(a).bodies.get(c);return void 0!==a?a:null};a.prototype._registerAnyBodyByInstanceInc=function(a){var c=a.getInstanceInc(),b=this._getInclusionContent(c[0]),f=b.bodies.get(c[1]);if(void 0!==f){console.assert(a.hasAuthoredId());if(f.hasAuthoredId()){console.assert(f.constructor===a.constructor);h.CompileTime.disable&&console.assert(!1);return}console.assert(f.constructor===g.BodyInstance);f=f.getRuntimeId();a instanceof
g.BodyInstance?this._bodyInstances.set(f,a):a instanceof g.PmiBody?this._pmiBodies.set(f,a):(d.Util.TypeAssert(a),this._viewFrames.set(f,a))}b.bodies.set(c[1],a)};a.prototype._getInclusionContent=function(a){console.assert(4294967295!==a);var c=this._inclusionContents.get(a);void 0===c&&(c=new e,this._inclusionContents.set(a,c));return c};a.prototype._getModelContent=function(a,c){console.assert(4294967295!==c);var f=this._modelContents.get(a);void 0===f&&(f=new Map,this._modelContents.set(a,f));
a=f.get(c);void 0===a&&(a=new b,f.set(c,a));return a};a.prototype.registerPrototypeByDataId=function(a,c,b,d){a=this._getModelContent(a,c);console.assert(!a.prototypes.has(b));a.prototypes.set(b,d)};a.prototype.registerPartDefinitionByDataId=function(a,c,b,d){a=this._getModelContent(a,c);console.assert(!a.partDefinitions.has(b));a.partDefinitions.set(b,d)};a.prototype.lookupPrototypeByDataId=function(a,c,b){a=this._getModelContent(a,c).prototypes.get(b);return void 0!==a?a:null};a.prototype.lookupPartDefinitionByDataId=
function(a,c,b){a=this._getModelContent(a,c).partDefinitions.get(b);return void 0!==a?a:null};a.prototype.registerInclusionContext=function(a){var c=a.getInclusionKey();this._getInclusionContent(c).contexts.push(a)};a.prototype.getInclusionContexts=function(a){return this._getInclusionContent(a).contexts};a.prototype._createLayer=function(a,c,b,d){b=new g.Layer(a,c,b,d);console.assert(!this._layers.has(a));this._layers.set(a,b);null!==c&&this._updateNameToLayersMap(c,a);return b};a.prototype._updateNameToLayersMap=
function(a,c){var b=this._layersIds.get(a);void 0!==b?b.push(c):this._layersIds.set(a,[c])};a.prototype.createLayer=function(a,c,b){var f=this._nextLayerId++;c=this._createLayer(f,c,[],[]);b.addLayerIdToMap(f,a);return c};a.prototype.updateLayerName=function(a,c){var b=this._layers.get(a);void 0!==b&&(b.name=c,this._updateNameToLayersMap(c,a))};a.prototype._registerNodeInLayer=function(a,c,b){var f=g.towardLoadContext(a),d=f.getRuntimeLayerId(c);null===d&&(d=this._nextLayerId++,this._createLayer(d,
null,[a],[]),f.addLayerIdToMap(d,c));var k=this._layers.get(d);void 0!==k?b(k).push(a):(console.assert(!1,"Layer has mapping in LoadContext but not represented in AssemblyTree"),this._createLayer(d,null,[a],[]),f.addLayerIdToMap(d,c))};a.prototype.registerNodeInLayer=function(a,c){return this._registerNodeInLayer(a,c,function(a){return a.nodes})};a.prototype.registerTreeNodeInLayer=function(a,c){return this._registerNodeInLayer(a,c,function(a){return a.treeNodes})};a.prototype.addFilter=function(a,
c){this._filters.push({filter:a,loadContext:c})};a.prototype.getFilters=function(){for(var a=new Map,c=0;c<this._filters.length;c++){var b=this.getFilterName(c)||"";a.set(c,b)}return a};a.prototype.getFilterName=function(a){return a<this._filters.length?this._filters[a].filter.name||"":null};a.prototype.getFiltersWithNode=function(a){for(var c=a.getAuthoredId(),b=this._filters,f=[],d=0;d<b.length;d++){var e=b[d],g=e.filter;e=e.loadContext;if(null!==g.layers)for(var h=0,w=g.layers.authoredIds;h<w.length;h++){var t=
e.getRuntimeLayerId(w[h]);if(null!==t){var u=this.getNodesFromLayer(t);if(null!==u)for(t=0;t<u.length;t++)a===u[t]&&f.push(d)}}if(null!==g.entities)for(e=0,g=g.entities.ids;e<g.length;e++)c===g[e]&&f.push(d)}return f};a.prototype.getNodesFromFilterIds=function(a){for(var c=new Set,b=new Set,f=null,e=0;e<a.length;e++){var g=this._filters[a[e]],h=g.filter,r=g.loadContext,w=h.layers;if(null!==w){g=w.isInclusive;null===f&&(f=g);var t=0;for(w=w.authoredIds;t<w.length;t++){var u=r.getRuntimeLayerId(w[t]);
if(null!==u&&(u=this._layers.get(u))&&null!==u.nodes)for(var v=0,z=u.nodes;v<z.length;v++)u=z[v].getRuntimeId(),g?(c.add(u),b.delete(u)):(c.delete(u),b.add(u))}}r=h.entities;if(null!==r)for(g=r.isInclusive,null===f&&(f=g),h=0,r=r.ids;h<r.length;h++)u=r[h],g?(c.add(u),b.delete(u)):(c.delete(u),b.add(u))}return null===f?null:f?new d.FilteredNodes(!0,c):new d.FilteredNodes(!1,b)};a.prototype.getLayers=function(){var a=new Map;this._layers.forEach(function(c,b){a.set(b,c.name||"")});return a};a.prototype.getUniqueLayerNames=
function(){var a=new Set,c=[];this._layers.forEach(function(b){b=b.name;null===b||a.has(b)||(a.add(b),c.push(b))});return c};a.prototype.getLayerName=function(a){a=this._layers.get(a);return void 0!==a?a.name||"":null};a.prototype.getLayersIdFromName=function(a){a=this._layersIds.get(a);return void 0!==a?a:null};a.prototype.getNodesFromLayer=function(a,c){a=this._layers.get(a);return void 0!==a?c?a.treeNodes:a.nodes:null};a.prototype.getNodesFromLayers=function(a,c){for(var b=[],f=0;f<a.length;f++){var d=
this.getNodesFromLayer(a[f],c);if(null!==d)for(var e=0;e<d.length;e++)b.push(d[e])}return b};a.prototype.getNodesFromLayerName=function(a,c){a=this._layersIds.get(a);return void 0!==a?this.getNodesFromLayers(a,c):null};a.prototype.generateProductName=function(){return"Product "+this._unnamedProductCount++};a.prototype.generateGroupName=function(){return"Product "+this._unnamedGroupCount++};a.prototype.generateDrawingSheetName=function(){return"Product "+this._unnamedDrawingSheetCount++};a.prototype.generateDrawingViewName=
function(){return"Product "+this._unnamedDrawingViewCount++};a.prototype.forEachCadView=function(a){this._cadViews.forEach(a)};a.prototype.forEachPmi=function(a){this._pmis.forEach(a)};a.prototype.forEachCadConfiguration=function(a){this._cadConfigurations.forEach(a)};a.prototype.hasActiveCadView=function(){return null!==this._activeCadView};a.prototype.activateCadView=function(a,c){console.assert(null===this._activeCadView);this._activeCadView=a;return a.activate(this,this._engine,this._callbackManager,
this._cuttingManager,this._view,c,this._activeCadConfiguration)};a.prototype.deactivateActiveCadView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeCadView?[2]:[4,this._activeCadView.deactivate(this._cuttingManager)];case 1:return a.sent(),console.assert(null!==this._activeCadView),this._activeCadView=null,[2]}})})};a.prototype.getCadViewPmis=function(a){var c=[];this._pmis.forEach(function(b){a.hasPmi(b)&&
c.push(b)});return c};a.prototype.isMeasureable=function(){return this._isMeasurable};a.prototype.containsDrawings=function(){return this._containsDrawings};a.prototype.getDefaultCadConfiguration=function(){return this._defaultCadConfiguration};a.prototype.getActiveCadConfiguration=function(){return this._activeCadConfiguration};a.prototype.activateCadConfiguration=function(a){console.assert(a.isAConfigurationNode());this._activeCadConfiguration=a;a=a.getRuntimeId();return this._view.isolateNodes([a],
d.DefaultTransitionDuration,!0)};a.prototype.massageAuthoredUserId=function(a,c){if(null===c)return this.generateDynamicNodeId();a=a.toRuntimeId(c);return null!==this.lookupAnyNode(a)?this.generateDynamicNodeId():c};a.prototype.createNode=function(a,c,b,d,e,h){void 0===h&&(h=null);c=g.ProductOccurrence.createDynamic(this,a,c,b,d,e,!1,h);a.addProductOccurrence(c);c.markLoaded();return c};a.prototype.createPart=function(a){a=g.PartDefinition.createDynamic(this,a,null);a.markLoaded();return a};a.prototype.setPart=
function(a,c){c.addReferrer(a);var b=this._partToInstance.get(c);if(void 0===b){b=g.towardInclusionContext(this._rootNode);var d=h.LazyObject.create(function(){console.assert(void 0!==f);return new g.SharedPrototypeContext(h.LazyPromise.create(f))});b=new g.PrototypeContext(d,b);var f=g.ProductOccurrence.createDynamic(this,b,null,null,null,!0);f.setPartDefinition(c);f.markLoaded()}a.setPrototype(b)};a.prototype._createCadView=function(a,c,b,d,e,h,q,r){c=g.CadView.createDynamic(this,a,c,b,d,e,h,q,
r);a.addCadView(c);c.markLoaded();return c};a.prototype._createCadViewInstance=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,h,t,u,v;return __generator(this,function(n){switch(n.label){case 0:return null===b?[3,2]:[4,a.createMeshInstance(b)];case 1:d=n.sent(),f=d[0],e=d[1],k=this.generateDynamicNodeId(),l={nodeId:k,bits:786432,name:null,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,
userDatas:null},h={nodeInfo:l,inclusionKey:f,instanceKey:e,bits:0},t=g.towardAttachContext(c),u=t.getMasterModelKey(),console.assert(c.isLoaded()),v=g.ViewFrame.reify(this,u,c,h),c.setViewFrame(v),v.markLoaded(),n.label=2;case 2:return[2]}})})};a.prototype.createCadView=function(a,c,b,d,e,g,h,r,w,t){c=this._createCadView(c,b,d,e,g,h,r,w);null!==t&&(a=this._createCadViewInstance(a,c,t),a);return c};a.prototype.createMeshInstance=function(a,c,b,d,e,h,q,r){var f=0;q&&(f|=16384);r&&(f|=268435456);c=g.BodyInstance.createDynamic(this,
c,b,d,e,h,f);h.addBodyInstance(c);a&&c.markLoaded();return c};a.prototype.createPmiInstance=function(a,c,b,d,e,h,q,r){var f=g.towardInclusionContext(e);a={nodeInfo:{nodeId:this.massageAuthoredUserId(f,b),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:a,instanceKey:c,bits:0};d=g.Pmi.createDynamic(this,f,e,d,h,q,[a],r);e.addPmi(d);d.markLoaded();return d};a.prototype.getAutomaticMeasurementUnitScaling=
function(){return this._automaticMeasurementUnitScaling};a.prototype.setAutomaticMeasurementUnitScaling=function(a){this._automaticMeasurementUnitScaling=a};a.prototype.getInitiallyHiddenStayHidden=function(){return this._initiallyHiddenStayHidden};a.prototype.setInitiallyHiddenStayHidden=function(a){this._initiallyHiddenStayHidden=a};a.prototype._removeIdMappingsRecursive=function(a){var c=this;return g.WalkerAsync.walk({enterProductOccurrence:function(a){c._productOccurrences.delete(a.getRuntimeId())},
enterAnyBody:function(a){var b=a.getRuntimeId();a instanceof g.BodyInstance?c._bodyInstances.delete(b):a instanceof g.PmiBody?c._pmiBodies.delete(b):(d.Util.TypeAssert(a),c._viewFrames.delete(b))},enterCadView:function(a){c._cadViews.delete(a.getRuntimeId())},enterPmi:function(a){c._pmis.delete(a.getRuntimeId())}},a,g.WalkRestriction.None)};a.prototype.deleteNode=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,f,e,h,q,r;return __generator(this,function(k){switch(k.label){case 0:if(!this._canDeleteNode(a))throw c=
a.getRuntimeId(),new d.CommunicatorError("Cannot delete node ("+c+")");b=g.gatherInstanceIncsSync(a,7,!0,new Set,g.WalkRestriction.None);this._engine.setPartVisibility(b,!1,!1);this._engine.setInstanceModifier(d.InstanceModifier.DoNotSelect,b,!0);if(!(a instanceof g.ProductOccurrence))return[3,2];this._cadConfigurations.delete(a)&&(a===this._activeCadConfiguration&&(this._activeCadConfiguration=null),a===this._defaultCadConfiguration&&(this._defaultCadConfiguration=null));f=a.getParent();console.assert(null!==
f);null!==f&&(e=void 0,e=f instanceof g.PrototypeContext?f.removeReferrer(a):f.removeProductOccurrence(a),console.assert(e));this._productOccurrences.delete(a.getRuntimeId());return[4,this._removeIdMappingsRecursive(a)];case 1:return k.sent(),[2,a.purgeContents()];case 2:d.Util.TypeAssert(a),h=a.getParent(),h.removeBodyInstance(a),q=a.getInstanceInc(),r=this._getInclusionContent(q[0]),r.bodies.delete(q[1]),this._bodyInstances.delete(a.getRuntimeId()),k.label=3;case 3:return[2]}})})};a.prototype._canDeleteNode=
function(a){return!this._nodeDeletionBlackList.has(a)};a.prototype.allowNodeDeletion=function(a){this._nodeDeletionBlackList.delete(a)};a.prototype.preventNodeDeletion=function(a){var c=a.getParent();if(c instanceof g.PrototypeContext)throw new d.InternalLogicError;null!==c&&(console.assert(null===c||this._nodeDeletionBlackList.has(c)),a instanceof g.ProductOccurrence?(console.assert(!a.hasAuthoredId()),console.assert(!a.isOutOfHierarchy())):a instanceof g.BodyInstance&&(c=a.getInstanceInc(),console.assert(!a.hasAuthoredId()),
console.assert(0===c[0]),console.assert(a.isOutOfHierarchy())));this._nodeDeletionBlackList.add(a)};a.prototype.preventMeshDeletion=function(a){this._meshDeletionBlackList.add(a)};a.prototype._resetContents=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){switch(c.label){case 0:return this.hasActiveCadView()?[4,this.deactivateActiveCadView()]:[3,2];case 1:return c.sent(),[2,this._resetContents()];case 2:return[4,this._rootLoadContext.purgeContents()];
case 3:return c.sent(),this._productOccurrences.clear(),this._pmis.clear(),this._cadViews.clear(),this._bodyInstances.clear(),this._pmiBodies.clear(),this._viewFrames.clear(),this._partDefinitions.clear(),this._representationItems.clear(),this._partToInstance.clear(),this._filters.length=0,this._layers.clear(),this._layersIds.clear(),this._genericTypeToNodes.clear(),this._genericIdToNode.clear(),this._cadConfigurations.clear(),this._modelContents.clear(),this._inclusionContents.clear(),this._currentNodeIdOffset=
0,this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=null,this._isMeasurable=this._containsDrawings=!1,this._completedLoadTimestamp=this._activeLoadTimestamp=0,this._requestedNodes.clear(),this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0,this._seenExternalModel=!1,this._rootNode.unsetMeasurementUnit(),this._nodeDeletionBlackList.forEach(function(c){if(c instanceof g.ProductOccurrence){var b=
c.getRuntimeId();a._productOccurrences.set(b,c);b=c.getParent();b instanceof g.PrototypeContext?console.assert(!1):b.addProductOccurrence(c);c.setVisibility(!0);c.unsetMeasurementUnit();c.hasLocalTransformOverride()&&c.removeLocalTransformOverride()}else if(c instanceof g.BodyInstance){b=c.getRuntimeId();a._bodyInstances.set(b,c);b=c.getInstanceInc();var f=b[0];console.assert(0===f);f=a._getInclusionContent(f);f.bodies.set(b[1],c);c.getParent().addBodyInstance(c)}else c instanceof g.LoadContext?(b=
c.getParent(),null!==b&&b.addLoadContext(c)):c instanceof g.AttachContext?c.getParent().addAttachContext(c):(d.Util.TypeAssert(c),f=c.getInclusionKey(),console.assert(0===f),f=a._getInclusionContent(f),f.contexts.push(c),c.getParent().addInclusionContext(c))}),[2]}})})};a.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._callbackManager.promiseTrigger("_resetAssemblyTreeBegin",null)];case 1:return b.sent(),
[4,this._resetContents()];case 2:return b.sent(),a=[],this._nodeDeletionBlackList.forEach(function(c){c instanceof g.BodyInstance&&(c=c.getInstanceInc(),console.assert(0===c[0]),a.push(c[1]))}),c=[],this._meshDeletionBlackList.forEach(function(a){c.push(a)}),[4,this._engine.resetToEmpty(a,c)];case 3:return b.sent(),[4,this._resetContents()];case 4:return b.sent(),[2]}})})};a.prototype.setViewAxes=function(a,c){this._model.setViewAxes(a,c)};a.prototype._requestIncsOfNodes=function(a){return __awaiter(this,
void 0,void 0,function(){var c,b,f,e,h,q,r,w,t;return __generator(this,function(k){switch(k.label){case 0:if(this._config.streamingMode!==d.StreamingMode.OnDemand)return[2];c=new Set;b=[];f=[];e=0;for(h=a;e<h.length;e++)q=h[e],r=g.gatherInstanceIncs(q,7,!1,c).then(function(a){for(var c=0;c<a.length;c++)b.push(a[c])}),f.push(r);return[4,d.Util.waitForAll(f)];case 1:return k.sent(),w=[],t=[],c.forEach(function(a){if(!a.isRequested()){a.setRequested();var c=a.isInitiallyShown();c!==a.isVisible()&&(c?
(a.setVisibility(!0),w.push(a.getRuntimeId())):(a.setVisibility(!1),t.push(a.getRuntimeId())))}}),0<w.length+t.length&&this._callbackManager.trigger("visibilityChanged",w,t),this._engine.requestMeshInstances(b),[2]}})})};a.prototype._requestExternalModelsLocal=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadPendingExternalModels(a)];case 1:return d=f.sent(),0===d.length?[3,4]:[4,g.markContextsLoaded(d)];
case 2:return f.sent(),[4,this._requestNodes(a,[c],b)];case 3:f.sent(),f.label=4;case 4:return[2,d]}})})};a.prototype._requestExternalModelsNonLocal=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,l,w,t,u;return __generator(this,function(n){switch(n.label){case 0:return[4,g.gatherParentsOfPendingExternalModels(c)];case 1:d=n.sent();if(0===d.length)return[2,[]];f=[];e=0;for(k=d;e<k.length;e++)l=k[e],w=this._requestExternalModelsLocal(a,l,b),f.push(w);u=h.concatAll;return[4,
Promise.all(f)];case 2:return t=u.apply(void 0,[n.sent()]),[2,t]}})})};a.prototype._requestExternalModelsOfNodes=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d,f,e,k,g,l,t;return __generator(this,function(n){switch(n.label){case 0:d=[];f=0;for(e=c;f<e.length;f++)k=e[f],g=this._requestExternalModelsNonLocal(a,k,b),d.push(g);t=h.concatAll;return[4,Promise.all(d)];case 1:return l=t.apply(void 0,[n.sent()]),[2,l]}})})};a.prototype._requestNodes=function(a,c,b){return __awaiter(this,
void 0,void 0,function(){var d,f,e,k,l,h,t;return __generator(this,function(n){switch(n.label){case 0:if(!b)for(d=0,f=c;d<f.length;d++)e=f[d],this._activeLoadTimestamp!==this._completedLoadTimestamp&&this._requestedNodes.set(e,this._activeLoadTimestamp),e instanceof g.ProductOccurrence&&a.notifyDirectRequest(e);k=this._requestIncsOfNodes(c);l=this._requestExternalModelsOfNodes(a,c,b);h=[k,l];return[4,Promise.all(h)];case 1:return t=n.sent()[1],[2,t]}})})};a.prototype.requestNodes=function(a,c,b){return __awaiter(this,
void 0,void 0,function(){var f,e,k,g,l,w,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this._requestNodes(a,c,b)];case 1:f=n.sent();e=[];k=0;for(g=f;k<g.length;k++)l=g[k],w=l.getChildren(),h.concatInPlace(e,w);if(!(0<e.length))return[3,3];t=e.map(function(a){return a.getRuntimeId()});return[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",t,d.NodeSource.LoadModel)];case 2:n.sent(),n.label=3;case 3:return[2]}})})};a.prototype.isBeingRequested=function(a){for(;;)if(a instanceof
g.NodeMixin){if(this._requestedNodes.has(a))return!0;a=a.getParent()}else if(a instanceof g.AttachContext)a=a.getParent();else if(a instanceof g.InclusionContext)a=a.getParent();else if(a instanceof g.LoadContext){if(a=a.getParent(),null===a)return!1}else return d.Util.TypeAssert(a),console.assert(!1),!1};a.prototype.onDemandRequestsActive=function(){return 0!==this._requestedNodes.size};a.prototype.onLoadBegin=function(){++this._activeLoadTimestamp};a.prototype.onLoadEnd=function(){var a=this;console.assert(this._completedLoadTimestamp<
this._activeLoadTimestamp);++this._completedLoadTimestamp;console.assert(this._completedLoadTimestamp===this._activeLoadTimestamp);var c=[];this._requestedNodes.forEach(function(b,d){b<=a._completedLoadTimestamp&&(console.assert(b===a._completedLoadTimestamp),c.push(d))});for(var b=0;b<c.length;b++)this._requestedNodes.delete(c[b])};a.prototype.markSeenExternalModel=function(){this._seenExternalModel=!0};a.prototype.seenExternalModel=function(){return this._seenExternalModel};a.prototype.getNodeByGenericId=
function(a){return this._genericIdToNode.get(a)||null};a.prototype.getNodesByGenericType=function(a){return this._genericTypeToNodes.get(a)||null};a.prototype.genericTypeToNodes=function(){return this._genericTypeToNodes};a.prototype.registerGenericGlobalId=function(a,c){this._genericIdToNode.set(c,a)};a.prototype.registerGenericType=function(a,c){var b=this._genericTypeToNodes.get(c);void 0===b&&(b=new Set);b.add(a);this._genericTypeToNodes.set(c,b)};a.prototype.disableAutomaticFitWorld=function(){return this._config.disableAutomaticFitWorld};
a.prototype.markImplicitNodesOutOfHierarchy=function(){return this._config.markImplicitNodesOutOfHierarchy};a.prototype._throttleLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._engine.throttleLoad(200,200),[4,this._engine.sleep(20)];case 1:return a.sent(),[2]}})})};a.prototype.enqueue=function(a){var c=this,b="function"===typeof a?h.Lazy.create(a):a;return this._centralQueue.push(function(){return __awaiter(c,void 0,
void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:return(a=this._isScs&&this._centralQueueClock.isTicking())?[4,this._throttleLoad()]:[3,2];case 1:d.sent(),d.label=2;case 2:return[4,b.get()];case 3:return c=d.sent(),a?[4,this._throttleLoad()]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2,c]}})})})};a.prototype._onUserInteraction=function(a,c){if(this._isScs){var b=!1;switch(c){case d.EventType.MouseDown:case d.EventType.MouseUp:case d.EventType.Mousewheel:case d.EventType.TouchStart:case d.EventType.TouchMove:case d.EventType.TouchEnd:case d.EventType.KeyDown:case d.EventType.KeyUp:case d.EventType.ViewOrientationChange:b=
!0;break;case d.EventType.MouseMove:b=a.getButtons()!==d.Buttons.None;break;default:d.Util.TypeAssertNever(c)}b&&this._centralQueueClock.tickFor(1E3)}};return a}();g.AssemblyTree=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(c){var a=this;return function(b,d){return __awaiter(a,void 0,void 0,function(){var a,f;return __generator(this,function(e){switch(e.label){case 0:return a=h.versionAtLeast(d,[7,3])?b+".scs":b,[4,c(a)];case 1:return f=e.sent(),"string"===typeof f?h.FetchApi.isSupported()?[2,h.FetchApi.request(f)]:[2,h.httpRequestBuffer(f)]:[2,f]}})})}}var e=function(){function c(a,c,b,d,e,m){this._clearQueue=new h.PromiseQueue(1,!1);this._clearInProgress=!1;this._cadConfigurationsEnabled=
!0;this._engine=c;this._callbackManager=b;this._cuttingManager=d;this._view=e;this._model=m;this._assemblyTree=new g.AssemblyTree(a,this._engine,this._callbackManager,this._cuttingManager,this._view,this._model);this._readyPromise=h.TrackedOpenPromise.create()}c.unsafeCreate=function(a,c,b,d,e,g,h){return this._create(a,c,b,d,e,g,h).unsafeValue};c.create=function(a,c,b,d,e,g,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,this._create(a,c,b,d,e,g,h)]})})};
c._create=function(a,b,d,e,g,m,p){a=new c(a,b,d,e,g,m);p=a._init(p);return h.UnsafePromise.create(a,p)};c.prototype._init=function(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(d){switch(d.label){case 0:return[4,g.ScAttacher.createWithEmptyModel(this._engine,this._view,this._callbackManager,a)];case 1:return c=d.sent(),this._assemblyTree.initialize(c),b=new g.TreeLoader(this._assemblyTree,c,this._engine,this._view,this._callbackManager),this._callbackManager.trigger("modelStructureLoadBegin"),
this._callbackManager.trigger("modelStructureLoadEnd"),this._callbackManager.trigger("modelStructureParseBegin"),console.assert(void 0===this._treeLoader),this._treeLoader=b,this._readyPromise.resolve(),[2]}})})};c.prototype._loadSubtreePrologue=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:if(this._engine.getSessionType()!==a)throw new d.LoadError("Incompatible load types.");return b?[4,this._clearQueue.waitOnLatest()]:
[3,2];case 1:e.sent(),e.label=2;case 2:if(this._clearInProgress)throw new d.LoadCancelledError;f=this._assemblyTree.lookupProductOccurrence(c);if(null===f)throw new d.InvalidNodeTypeError(c,0);return[2,f]}})})};c.prototype._loadSubtreeEpilogue=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,f;return __generator(this,function(e){switch(e.label){case 0:return a.isFirstLoad()&&2===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,
2];case 1:e.sent(),e.label=2;case 2:return b=a.getChildren(),f=b.map(function(a){return a.getRuntimeId()}),c?[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",f,d.NodeSource.LoadModel)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2,f]}})})};c.prototype.loadSubtreeFromXmlFile=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,
this._loadSubtreePrologue(1,a,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlFile(d,f,c,b)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromXmlDoc=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._disableCadConfigurations()];case 1:return k.sent(),[4,this._loadSubtreePrologue(1,a,!0)];case 2:return f=k.sent(),[4,this._treeLoader.loadByXmlDoc(d,
f,c,b)];case 3:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,!1)]}})})};c.prototype.loadSubtreeFromScsXmlFile=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,a,!0)];case 2:return f=l.sent(),k=b(d),[4,this._treeLoader.loadByXmlFile(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype.loadSubtreeFromScsXmlDoc=
function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._disableCadConfigurations()];case 1:return l.sent(),[4,this._loadSubtreePrologue(2,a,!0)];case 2:return f=l.sent(),k=b(d),[4,this._treeLoader.loadByXmlDoc(e,f,c,k)];case 3:return g=l.sent(),[2,this._loadSubtreeEpilogue(g,!1)]}})})};c.prototype._loadSubtreeFromStream=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,
function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,a,b)];case 1:return f=k.sent(),[4,this._treeLoader.loadByStream(d,f,c)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,d._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromStream=function(a,c,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._loadSubtreeFromStream(a,c,!0,b)]})})};c.prototype.loadSubtreeFromScsFile=function(a,c,b){return __awaiter(this,void 0,
void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,a,!0)];case 1:return d=e.sent(),[4,this._treeLoader.loadByScsFile(b,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,b._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromScsBuffer=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:return[4,this._loadSubtreePrologue(2,a,!0)];
case 1:return d=e.sent(),[4,this._treeLoader.loadByScsBuffer(b,d,c)];case 2:return f=e.sent(),[2,this._loadSubtreeEpilogue(f,b._allowSubtreeLoadedCallback)]}})})};c.prototype.loadSubtreeFromAssemblyData=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(1,a,!0)];case 1:return f=k.sent(),[4,this._treeLoader.loadByAssemblyData(d,f,c,b)];case 2:return e=k.sent(),[2,this._loadSubtreeEpilogue(e,
d._allowSubtreeLoadedCallback)]}})})};c.prototype._clearImpl=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:console.assert(!this._clearInProgress),this._clearInProgress=!0,c.label=1;case 1:return c.trys.push([1,6,,7]),[4,this._treeLoader.cancelActiveAttachmentProcess()];case 2:return c.sent(),[4,this._treeLoader.cancelPendingLoads()];case 3:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),
[4,this._treeLoader.reset()];case 4:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._assemblyTree.reset()];case 5:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),this._clearInProgress=!1,[3,7];case 6:throw a=c.sent(),console.assert(this._clearInProgress),this._clearInProgress=!1,a;case 7:return[2]}})})};c.prototype.clear=function(){var a=this;return this._clearQueue.push(function(){return __awaiter(a,
void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!0),[4,this._clearImpl()];case 1:return a.sent(),[2,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",!0,[],h.AttachType.Direct)]}})})})};c.prototype.switchToModel=function(a){var c=this,b=a===d.EmptyModelName;return this._clearQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return this._callbackManager.trigger("modelSwitchStart",
!1),[4,this._clearImpl()];case 1:f.sent();if(!b)return[3,2];c=[];return[3,4];case 2:return[4,this._loadSubtreeFromStream(this.getAbsoluteRootNodeId(),a,!1,new d.LoadSubtreeConfig)];case 3:c=f.sent(),f.label=4;case 4:return[4,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",b,c,h.AttachType.Direct)];case 5:return f.sent(),[2,c]}})})})};c.prototype.getAbsoluteRootNodeId=function(){return this._assemblyTree.getRootNode().getRuntimeId()};c.prototype.isIdValid=function(a){return null!==
this._assemblyTree.lookupAnyNode(a)};c.prototype._getNodeChildren=function(a,c){var b=a.getChildrenSync();c||(b=b.filter(function(a){return!a.isOutOfHierarchy()}));for(var d=0,f=a.getBodyInstances();d<f.length;d++){var e=f[d];e.isOutOfHierarchy()&&!c||b.push(e)}c=0;for(a=a.getPmis();c<a.length;c++)b.push(a[c]);return b};c.prototype.getChildIds=function(a,c){var b=this._assemblyTree.lookupProductOccurrence(a);if(null===b)return[];a=[];var d=0;for(c=this._getNodeChildren(b,c);d<c.length;d++)a.push(c[d].getRuntimeId());
return a};c.prototype.isOutOfHierarchy=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a&&g.isOutOfHierarchy(a)};c.prototype.getParentId=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return null;a=g.towardContainerNode(a.getParent());return null===a?null:a.getRuntimeId()};c.prototype.getPartReferrers=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,h,p,q,r,w,t,u,v,z;return __generator(this,function(f){switch(f.label){case 0:c=this._assemblyTree.lookupProductOccurrence(a);
if(null===c)return[2,null];b=this._assemblyTree.getRootNode();return[4,g.forcePrototypes(b)];case 1:return f.sent(),[4,g.forcePartDefinitions(b)];case 2:f.sent();d=c.getPartDefinitionSync();if(null===d)return[2,null];e=d.getReferrers();h=new Set;p=0;for(q=e;p<q.length;p++)for(r=q[p],w=r.getParent(),t=w.getReferrers(),u=0,v=t;u<v.length;u++)z=v[u],h.add(z.getRuntimeId());return[2,Array.from(h)]}})})};c.prototype.getAttributes=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(b){switch(b.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=b.sent(),null===c?[2,[]]:[2,c.getAttributes()]}})})};c.prototype.getProperties=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,e,n,m,p,q=this;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:c=f.sent();if(null===c)return[2,null];b=null;e=[];n=c.getAttributes().then(function(a){null===b&&(b={});for(var c=0;c<a.length;c++){var d=a[c],
f=d.getTitle();d=d.getValue();b[f]=d}});e.push(n);m=function(c){null===b&&(b={});var f=q.getNetMatrix(a),e=new d.Point3(f.m[0],f.m[1],f.m[2]),k=q.getUnit(a),g=e.length()/k;e=c.volume*g*g*g;g=d.Util.formatWithUnit(c.surfaceArea*g*g,k);b["Surface Area"]=""+g+h.Unicode.Subscript2;e=d.Util.formatWithUnit(e,k);b.Volume=""+e+h.Unicode.Subscript3;c=f.transform(c.centerOfGravity);f=d.Point3.scale(c,1/k);k=f.x.toLocaleString();c=f.y.toLocaleString();f=f.z.toLocaleString();b.COG="x:"+k+" y:"+c+" z:"+f};c instanceof
g.RepresentationItem?(p=c.getPhysicalProperties(),null!==p&&m(p)):c instanceof g.ProductOccurrence&&(n=Promise.resolve(g.forcePartDefinition(c)).then(function(){return __awaiter(q,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,c.getPhysicalProperties()];case 1:return a=b.sent(),null!==a&&m(a),[2]}})})}),e.push(n));return[4,d.Util.waitForAll(e)];case 2:return f.sent(),[2,b]}})})};c.prototype.addProperty=function(a,c,b){a=this._assemblyTree.lookupAnyNode(a);
if(null===a)return!1;c=new g.Attribute(d.AttributeType.String,c,b);a.addAttribute(c);return!0};c.prototype.setPhysicalProperties=function(a,c,b,d){a=this._assemblyTree.lookupRepresentationItem(a);if(null===a)return!1;c=new g.PhysicalProperties(b,d,c);a.setPhysicalProperties(c);return!0};c.prototype.getUserDataIndices=function(a){var c=this._assemblyTree.lookupAnyTreeNode(a);if(null===c)throw new d.InvalidNodeIdError(a);return c.getUserDataIndices()};c.prototype.getUserData=function(a,c){var b=this._assemblyTree.lookupAnyTreeNode(a);
if(null===b)throw new d.InvalidNodeIdError(a);return b.getUserData(c)};c.prototype.getInstanceIncs=function(a,c){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return console.assert(!1),[];var b=g.isOutOfHierarchy(a),d=new Set;return g.gatherInstanceIncsSync(a,c,b,d,g.WalkRestriction.None)};c.prototype.getNodeFromInstanceInc=function(a,c,b,d){var f=this._assemblyTree.lookupAnyBodyByInstanceInc(c,b);null===f?(f=a?this._rectifyParent(c,null):this._assemblyTree.getRootNode(),f=this._assemblyTree.createMeshInstance(a,
c,b,null,null,f,!1,d)):f instanceof g.PmiBody?f=f.getParent():f instanceof g.ViewFrame&&(a=f.getParent(),a);return f.getRuntimeId()};c.prototype._getAssociatedModelKey=function(a){if(a instanceof g.PartDefinition)return a.getModelKey();d.Util.TypeAssert(a);return this._getAssociatedModelKey(a.getParent())};c.prototype.getAssociatedModelKey=function(a){var c=this._assemblyTree.lookupAnyTreeNode(a);return null===c?(c=this._assemblyTree.lookupAnyNonTreeNode(a),null===c?null:this._getAssociatedModelKey(c)):
g.towardAttachContext(c).getMasterModelKey()};c.prototype.getMatrix=function(a){a=this._assemblyTree.lookupAnyNode(a);if(null===a)return new d.Matrix;a=a.getLocalTransform();return null===a?new d.Matrix:a.copy()};c.prototype.setMatrix=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){d=this._assemblyTree.lookupAnyTreeNode(a);if(null===d)return[2];b?d.setLocalTransformAsInitial(c):d.overrideLocalTransform(c);f=g.isOutOfHierarchy(d);return[2,
g.updateScMatrices(this._engine,this._callbackManager,[d],f)]})})};c.prototype.setMatrices=function(a,c,b){for(var d=[],f=!1,e=0;e<a.length;e++){var k=this._assemblyTree.lookupAnyTreeNode(a[e]),h=c[e];null!==k&&(b?k.setLocalTransformAsInitial(h):k.overrideLocalTransform(h),f=f||g.isOutOfHierarchy(k),d.push(k))}return g.updateScMatrices(this._engine,this._callbackManager,d,f)};c.prototype.resetToInitialMatrix=function(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,
function(d){c=this._assemblyTree.lookupAnyTreeNode(a);return null===c?[2]:c.hasLocalTransformOverride()?(c.removeLocalTransformOverride(),b=g.isOutOfHierarchy(c),[2,g.updateScMatrices(this._engine,this._callbackManager,[c],b)]):[2]})})};c.prototype.getNetMatrix=function(a){a=this._assemblyTree.lookupAnyNode(a);return null===a?new d.Matrix:g.getNetMatrix(a)};c.prototype._getBodyInstanceIndexFrom=function(a,c,b){void 0===b&&(b={});for(var d=0,f=a.getBodyInstances();d<f.length;d++){var e=f[d];void 0!==
b.value?b.value++:b.value=0;if(e===c)return b.value}d=0;for(f=a.getChildrenSync();d<f.length;d++)if(a=this._getBodyInstanceIndexFrom(f[d],c,b),void 0!==a)return a};c.prototype.getNodeOrRepItem=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,h,p;return __generator(this,function(f){switch(f.label){case 0:if(!(a instanceof g.BodyInstance))return[3,8];c=void 0;b=a.getParent();d=void 0;e=b;f.label=1;case 1:return e instanceof g.ProductOccurrence?[4,g.forcePartDefinition(e)]:[2,null];
case 2:return f.sent(),[4,e.getPartDefinition()];case 3:return h=f.sent(),null===h?[3,5]:[4,h.value];case 4:return d=f.sent(),[3,7];case 5:e=e.getParent(),f.label=6;case 6:return[3,1];case 7:return c=this._getBodyInstanceIndexFrom(e,a),p=d.getRepresentationItems(),void 0!==c&&c<p.length?[2,p[c]]:[2,null];case 8:if(a instanceof g.ProductOccurrence||a instanceof g.Pmi||a instanceof g.CadView||a instanceof g.PartDefinition||a instanceof g.RepresentationItem)return[2,a];f.label=9;case 9:return[2,null]}})})};
c.prototype._getNodeOrRepItemFromId=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._assemblyTree.lookupAnyNode(a);return null===c?[2,null]:[2,this.getNodeOrRepItem(c)]})})};c.prototype.getEdgeCount=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=b.sent(),c instanceof g.RepresentationItem?[2,c.getEdgeCount()]:
[2,0]}})})};c.prototype.getEdgeAttributes=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return b=f.sent(),b instanceof g.RepresentationItem&&(d=b.getEdgeAttributes(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getEdgeProperty=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(f){switch(f.label){case 0:return[4,
this._getNodeOrRepItemFromId(a)];case 1:return b=f.sent(),b instanceof g.RepresentationItem&&(d=b.getEdgeMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceCount=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=b.sent(),c instanceof g.RepresentationItem?[2,c.getFaceCount()]:[2,0]}})})};c.prototype.getFaceAttributes=function(a,c){return __awaiter(this,
void 0,void 0,function(){var b,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return b=f.sent(),b instanceof g.RepresentationItem&&(d=b.getFaceAttributes(c),null!=d)?[2,d.copy()]:[2,null]}})})};c.prototype.getFaceProperty=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return b=f.sent(),b instanceof g.RepresentationItem&&
(d=b.getFaceMeasurementProperty(c),null!==d)?[2,d.copy()]:[2,null]}})})};c.prototype.setEdgeProperty=function(a,c,b){a=this._assemblyTree.lookupRepresentationItem(a);null!==a&&g.MeasurementProperty.isEdge(b)&&a.setEdgeMeasurementProperty(c,b)};c.prototype.setFaceProperty=function(a,c,b){a=this._assemblyTree.lookupRepresentationItem(a);null!==a&&g.MeasurementProperty.isFace(b)&&a.setFaceMeasurementProperty(c,b)};c.prototype.getName=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?
a.getName():null};c.prototype.getNodeExchangeId=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.getExchangeId():null};c.prototype.getFilters=function(){return this._assemblyTree.getFilters()};c.prototype.getFilterName=function(a){return this._assemblyTree.getFilterName(a)};c.prototype.getFiltersWithNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null===a?[]:this._assemblyTree.getFiltersWithNode(a)};c.prototype.getNodesFromFilterIds=function(a){return this._assemblyTree.getNodesFromFilterIds(a)};
c.prototype.getLayers=function(){return this._assemblyTree.getLayers()};c.prototype.getUniqueLayerNames=function(){return this._assemblyTree.getUniqueLayerNames()};c.prototype.getLayerName=function(a){return this._assemblyTree.getLayerName(a)};c.prototype.getLayerIdsFromName=function(a){return this._assemblyTree.getLayersIdFromName(a)};c.prototype.getNodeLayerId=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return null;var c=a.getAuthoredLayerId();return null===c?null:g.towardLoadContext(a).getRuntimeLayerId(c)};
c.prototype.getAuthoredNodesFromLayer=function(a,c){a=this._assemblyTree.getNodesFromLayer(a,c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.getAuthoredNodesFromLayers=function(a,c){a=this._assemblyTree.getNodesFromLayers(a,c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.getRuntimeNodesFromLayer=function(a,c){a=this._assemblyTree.getNodesFromLayer(a,c);return null===a?null:a.map(function(a){return a.getRuntimeId()})};c.prototype.getRuntimeNodesFromLayers=
function(a,c){a=this._assemblyTree.getNodesFromLayers(a,c);return null===a?null:a.map(function(a){return a.getRuntimeId()})};c.prototype.getNodesFromLayerName=function(a,c){a=this._assemblyTree.getNodesFromLayerName(a,c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.createCadView=function(a,c,b,d,e,g,h,q,r){if(null===this._assemblyTree.lookupProductOccurrence(a))return null;a=this._assemblyTree.lookupProductOccurrence(a);if(null===a)return null;for(var f=[],k=0;k<
d.length;k++){var l=this._assemblyTree.lookupPmi(d[k]);null!==l&&f.push(l)}d=new Map;for(k=0;k<h.length;k++)l=h[k],d.set(l[0],l[1]);return this._assemblyTree.createCadView(this._engine,a,c,b,f,e,g,d,q,r).getRuntimeId()};c.prototype.getCadViewMap=function(){var a=this._assemblyTree.getFirstProductOccurrenceWithView(),c=new Map;this._assemblyTree.forEachCadView(function(b){var d=b.getRuntimeId(),f=b.getParent();b=f===a?b.getName()||"(null)":f.getName()+" - "+b.getName();c.set(d,b)});return c};c.prototype.activateCadView=
function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:return d.sent(),[2,this.activateCadView(a,c)];case 2:return b=this._assemblyTree.lookupCadView(a),null===b?[2]:[2,this._assemblyTree.activateCadView(b,c)]}})})};c.prototype.getCadViewPmis=function(a){var c=this._assemblyTree.lookupCadView(a);if(null===c)return[];a=[];
var b=0;for(c=this._assemblyTree.getCadViewPmis(c);b<c.length;b++)a.push(c[b].getRuntimeId());return a};c.prototype._disableCadConfigurations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._cadConfigurationsEnabled=!1,[4,this._assemblyTree.deactivateActiveCadView()];case 1:return a.sent(),[2]}})})};c.prototype.cadConfigurationsEnabled=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return this._cadConfigurationsEnabled&&this._assemblyTree.seenExternalModel()?[4,this._disableCadConfigurations()]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2,this._cadConfigurationsEnabled]}})})};c.prototype.getCadConfigurations=function(){var a={};this._assemblyTree.forEachCadConfiguration(function(c){var b=c.getRuntimeId();c=c.getName()||"(null)";a[b]=c});return a};c.prototype.getDefaultCadConfiguration=function(){var a=this._assemblyTree.getDefaultCadConfiguration();
return null!==a?a.getRuntimeId():null};c.prototype.getActiveCadConfiguration=function(){var a=this._assemblyTree.getActiveCadConfiguration();return null!==a?a.getRuntimeId():null};c.prototype._activateCadConfiguration=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._assemblyTree.activateCadConfiguration(a)];case 1:return b.sent(),c=a.getRuntimeId(),this._callbackManager.trigger("configurationActivated",c),[2]}})})};
c.prototype.activateCadConfiguration=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._assemblyTree.lookupProductOccurrence(a);return null===c?[2]:[2,this._activateCadConfiguration(c)]})})};c.prototype.activateDefaultCadConfiguration=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=this._assemblyTree.getDefaultCadConfiguration(),null===a?[3,2]:[4,this._activateCadConfiguration(a)];
case 1:c.sent(),c.label=2;case 2:return[2]}})})};c.prototype.getPmis=function(){var a={};this._assemblyTree.forEachPmi(function(c){var b=c.getRuntimeId();c=c.getName()||"(null)";a[b]=c});return a};c.prototype.getPmiType=function(a){a=this._assemblyTree.lookupPmi(a);return null===a?g.PmiType.Unknown:a.getPmiType()};c.prototype.getPmiSubType=function(a){a=this._assemblyTree.lookupPmi(a);return null===a?d.PmiSubType.Unknown:a.getPmiSubType()};c.prototype.getUnit=function(a){a=this._assemblyTree.lookupAnyNode(a);
return a instanceof g.ProductOccurrence?a.getMeasurementUnit():a instanceof g.BodyInstance?a.getParent().getMeasurementUnit():1};c.prototype._rectifyParent=function(a,c){if(null!==c){c=this._assemblyTree.lookupProductOccurrence(c);if(null!==c)return c;console.assert(!1)}a=this._assemblyTree.getInclusionContexts(a);return 0<a.length?(a=a[0].getChildren(),console.assert(0<a.length),a[0]):this._assemblyTree.getRootNode()};c.prototype.createMeshInstance=function(a,c,b,d,e,g){d=this._rectifyParent(a,d);
return this._assemblyTree.createMeshInstance(!0,a,c,null,b,d,e,g).getRuntimeId()};c.prototype.createPmiInstance=function(a,c,b,d,e,g,h){h=this._rectifyParent(a,h);return this._assemblyTree.createPmiInstance(a,c,null,g,h,b,d,e).getRuntimeId()};c.prototype.setVisibilitiesByMap=function(a,c,b){var d=this,f=new Map;a.forEach(function(a,c){c=d._assemblyTree.lookupAnyTreeNode(c);null!==c&&f.set(c,a)});a=this._assemblyTree.getRootNode();return g.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,
a,f,!1,c,null,b)};c.prototype.setVisibilitiesByValue=function(a,c,b,d){for(var f=new Map,e=0;e<a.length;e++){var k=this._assemblyTree.lookupAnyTreeNode(a[e]);null!==k&&f.set(k,c)}c=this._assemblyTree.getRootNode();1===a.length&&(a=this._assemblyTree.lookupAnyTreeNode(a[0]),a instanceof g.ProductOccurrence&&(c=a));return g.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,c,f,!1,b,null,d)};c.prototype.resetAllVisibilities=function(){var a=new Map,c=this._assemblyTree.getRootNode(),
b=this._assemblyTree.getActiveCadConfiguration();return g.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,c,a,!0,null,b,d.TreeWalkMode.Default)};c.prototype.resetAllTransforms=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(b){switch(b.label){case 0:return a=this._assemblyTree.getRootNode(),[4,g.resetTransforms(a)];case 1:return(c=b.sent())?[2,g.updateScMatrices(this._engine,this._callbackManager,[a],!1)]:[2]}})})};c.prototype.reset=
function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return this._cadConfigurationsEnabled=!0,this.isACadDrawing()?[2,this._callbackManager.promiseTrigger("_resetDrawing",null)]:this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:c.sent(),c.label=2;case 2:return a=[this.resetAllVisibilities(),this.resetAllTransforms()],[4,d.Util.waitForAll(a)];case 3:return c.sent(),[2]}})})};c.prototype.setPmiColor=
function(a,c){void 0===c&&(c=this.getAbsoluteRootNodeId());c=this.getInstanceIncs(c,6);0<c.length&&(this._engine.setPartColor(c,d.ElementType.Faces,a),this._engine.setPartColor(c,d.ElementType.Lines,a))};c.prototype.resetPmiColor=function(a){void 0===a&&(a=this.getAbsoluteRootNodeId());a=this.getInstanceIncs(a,6);0<a.length&&(this._engine.unsetPartColor(a,d.ElementType.Faces),this._engine.unsetPartColor(a,d.ElementType.Lines))};c.prototype.getPmiTopologyReferences=function(a){a=this._assemblyTree.lookupPmi(a);
return null===a?null:a.getPmiTopologyReferences(this._assemblyTree)};c.prototype.createNode=function(a,c,b,e,n,h){void 0===e&&(e=null);void 0===n&&(n=!0);void 0===h&&(h=null);var f=null;null!==a&&(f=this._assemblyTree.lookupProductOccurrence(a));null===f&&(f=this._assemblyTree.getRootNode());null===b||g.isAuthoredId(b)||(b=null);h&&(a=h/f.getMeasurementUnit(),a=(new d.Matrix).setScaleComponent(a,a,a),e=e?d.Matrix.multiply(e,a):a);return this._assemblyTree.createNode(f,c,b,e,n,h).getRuntimeId()};c.prototype.deleteNode=
function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._assemblyTree.lookupAnyTreeNode(a);if(null!==c){if(c instanceof g.ProductOccurrence||c instanceof g.BodyInstance)return[2,this._assemblyTree.deleteNode(c)];throw new d.InvalidNodeTypeError(a,0,2);}return[2]})})};c.prototype.createPart=function(a){return this._assemblyTree.createPart(a).getRuntimeId()};c.prototype.setPart=function(a,c){a=this._assemblyTree.lookupProductOccurrence(a);if(null===
a)return!1;c=this._assemblyTree.lookupPartDefinition(c);if(null===c)return!1;this._assemblyTree.setPart(a,c);return!0};c.prototype.createAndAddRepItem=function(a,c){a=this._assemblyTree.lookupPartDefinition(a);return null===a?null:a.createRepItem(this._assemblyTree,c).getRuntimeId()};c.prototype.getLowestAvailableNodeId=function(){return this._assemblyTree.getLowestAvailableNodeId()};c.prototype.getType=function(a){a=this._assemblyTree.lookupAnyNode(a);return null===a?d.NodeType.Unknown:g.getNodeType(a)};
c.prototype.isVisible=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.isVisible():!1};c.prototype.getBranchVisibility=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?g.getBranchVisibility(a):1};c.prototype.setMeshLevel=function(a,c){for(var b=[],d=0;d<a.length;d++){var f=this._assemblyTree.lookupAnyTreeNode(a[d]);null!==f&&b.push(f)}return g.setMeshLevels(this._engine,b,c)};c.prototype.setEnableAutomaticUnitScaling=function(a){this._assemblyTree.setAutomaticMeasurementUnitScaling(a)};
c.prototype.setBehaviorInitiallyHidden=function(a){this._assemblyTree.setInitiallyHiddenStayHidden(a)};c.prototype.isACadDrawing=function(){return this._assemblyTree.containsDrawings()};c.prototype.isMeasurable=function(){return this._assemblyTree.isMeasureable()};c.prototype.getModelFileNameFromNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?g.towardAttachContext(a).getOriginalFileName():null};c.prototype.getModelFileTypeFromNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);
return null!==a?g.towardAttachContext(a).getOriginalFileType():null};c.prototype.isAnnotationView=function(a){var c=this._assemblyTree.lookupCadView(a);if(null!==c)return c.isAnnotationView();throw new d.InvalidNodeTypeError(a,3);};c.prototype.allowNodeDeletion=function(a){a=this._assemblyTree.lookupBodyInstance(a);if(null===a)throw new d.InternalLogicError;this._assemblyTree.allowNodeDeletion(a)};c.prototype.preventNodeDeletion=function(a){a=this._assemblyTree.lookupBodyInstance(a);if(null===a)throw new d.InternalLogicError;
this._assemblyTree.preventNodeDeletion(a)};c.prototype.preventMeshDeletion=function(a){this._assemblyTree.preventMeshDeletion(a)};c.prototype.getBounding=function(a,c,b,d){return g.getBoundingByNodeId(this._assemblyTree,this._engine,a,c,b,d)};c.prototype.getIdOffset=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?(a instanceof g.PartDefinition?a.getInclusionContextForNodeId():a instanceof g.RepresentationItem?a.getParent().getInclusionContextForNodeId():g.towardInclusionContext(a)).getIdOffset():
0};c.prototype.isNodeLoaded=function(a){var c=this._assemblyTree.lookupAnyNode(a);if(null===c)throw new d.InvalidNodeIdError(a);return c.isLoaded()};c.prototype.shutdown=function(){var a=this._treeLoader.cancelPendingLoads();a};c.prototype.isReady=function(){console.assert(2!==this._readyPromise.state);return 0!==this._readyPromise.state};c.prototype.waitForReady=function(){return this._readyPromise};c.prototype.lookupAnyTreeNode=function(a){return this._assemblyTree.lookupAnyTreeNode(a)};c.prototype.lookupAnyBody=
function(a){return this._assemblyTree.lookupAnyBody(a)};c.prototype.lookupBodyInstance=function(a){return this._assemblyTree.lookupBodyInstance(a)};c.prototype.gatherInstanceIncsFromNodeIds=function(a,c,b){return g.gatherInstanceIncsByNodeIdsSync(this._assemblyTree,a,c,b)};c.prototype.requestNodes=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,g;return __generator(this,function(f){c=[];b=0;for(d=a;b<d.length;b++)e=d[b],g=this._assemblyTree.lookupAnyTreeNode(e),null!==g&&c.push(g);
return[2,this._assemblyTree.requestNodes(this._treeLoader,c,!1)]})})};c.prototype.isWithinExternalModel=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return!1;for(a=g.towardProductOccurrence(a);null!==a;){if(a.isExternalModelRoot())return!0;a=g.towardProductOccurrence(a.getParent())}return!1};c.prototype.getNodeGenericType=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?g.getNodeGenericType(a):null};c.prototype.getNodeGenericId=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);
return null!==a?a.getGenericId():null};c.prototype.getNodeByGenericId=function(a){a=this._assemblyTree.getNodeByGenericId(a);return null!==a?a.getRuntimeId():null};c.prototype.getNodesByGenericType=function(a){a=this._assemblyTree.getNodesByGenericType(a);if(null!==a){var c=new Set;a.forEach(function(a){c.add(a.getRuntimeId())});return c}return null};c.prototype.getGenericTypes=function(){var a=[];this._assemblyTree.genericTypeToNodes().forEach(function(c,b){a.push(b)});return a};c.prototype.getGenericTypeIdMap=
function(){var a=new Map;this._assemblyTree.genericTypeToNodes().forEach(function(c,b){var d=new Set;c.forEach(function(a){d.add(a.getRuntimeId())});a.set(b,d)});return a};c.prototype.hasEffectiveGenericType=function(a,c){var b=this.lookupAnyTreeNode(a);if(null===b)throw new d.InvalidNodeIdError(a);return g.hasEffectiveGenericType(b,c)};c.prototype.registerGenericId=function(a,c){return this._assemblyTree.registerGenericGlobalId(a,c)};c.prototype.registerGenericType=function(a,c){return this._assemblyTree.registerGenericType(a,
c)};c.prototype.firstAssemblyDataHeader=function(){return this._treeLoader.firstAssemblyDataHeader()};c.prototype.setPrefetchScsCutoffScale=function(a){this._treeLoader.setPrefetchScsCutoffScale(a)};return c}();g.ModelStructure=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(b){for(;;)if(b instanceof g.InclusionContext)b=b.getParent();else{if(b instanceof g.AttachContext)return b;if(b instanceof g.NodeMixin)b=b.getParent();else if(b instanceof g.LoadContext){if(b=b.getParent(),null===b)throw new d.InternalLogicError;}else d.Util.TypeAssert(b),b=b.getInclusionContext()}}g.getNetMatrix=function(b){for(var c=new d.Matrix;null!==b;)if(b instanceof g.NodeMixin){var a=b.getLocalTransform();a&&(c=d.Matrix.multiply(c,a));b=b instanceof
g.PartDefinition?null:b.getParent()}else if(b instanceof g.InclusionContext)b=b.getParent();else if(b instanceof g.AttachContext)b=b.getParent();else if(b instanceof g.LoadContext)b=b.getParent();else{d.Util.TypeAssert(b);break}return c};g.towardContainerNode=function(b){for(;;)if(b instanceof g.NodeMixin)if(b instanceof g.BodyMixin)b=b.getParent();else return b;else if(b instanceof g.LoadContext)b=b.getParent();else if(b instanceof g.InclusionContext)b=b.getParent();else if(b instanceof g.AttachContext)b=
b.getParent();else{if(null===b)return null;d.Util.TypeAssert(b);console.assert(!1);b=b.getInclusionContext()}};g.isOutOfHierarchy=function(b){return b instanceof g.BodyMixin||b instanceof g.ProductOccurrence?b.isOutOfHierarchy():!1};g.getBranchVisibility=function(b){return b instanceof g.ProductOccurrence||b instanceof g.Pmi||b instanceof g.CadView?b.getBranchVisibility():b.isVisible()?2:1};g.getNodeType=function(b){if(b instanceof g.ProductOccurrence)return b.hasBodyInstances()?b.isADrawingSheetNode()?
d.NodeType.DrawingSheet:d.NodeType.PartInstance:d.NodeType.AssemblyNode;if(b instanceof g.PartDefinition)return d.NodeType.Part;if(b instanceof g.PmiBody)return d.NodeType.PmiBody;if(b instanceof g.ViewFrame)return d.NodeType.ViewFrame;if(b instanceof g.BodyInstance)return d.NodeType.BodyInstance;if(b instanceof g.RepresentationItem)switch(b.getBodyType()){case g.BodyType.BRep:return d.NodeType.BrepBody;case g.BodyType.Tessellation:return d.NodeType.TessBody;case g.BodyType.Wireframe:return d.NodeType.WireBody;
case g.BodyType.PointCloud:return d.NodeType.PointsBody;default:return d.NodeType.Body}else{if(b instanceof g.Pmi)return d.NodeType.Pmi;d.Util.TypeAssert(b);return d.NodeType.CadView}};g.getNodeGenericType=function(d){var c=d.getGenericTypeId();return null!==c&&(d=b(d).getGenericTypeMaps(),null!==d)?d.getRight(c)||null:null};g.towardInclusionContext=function(b){for(;;)if(b instanceof g.NodeMixin)b=b.getParent();else{if(b instanceof g.InclusionContext)return b;if(b instanceof g.PmiBody)b=b.getParent();
else if(b instanceof g.ViewFrame)b=b.getParent();else return d.Util.TypeAssert(b),b.getInclusionContext()}};g.towardLoadContext=function(b){for(;;)if(b instanceof g.AttachContext)b=b.getParent();else{if(b instanceof g.LoadContext)return b;b instanceof g.NodeMixin?b=b.getParent():b instanceof g.InclusionContext?b=b.getParent():(d.Util.TypeAssert(b),b=b.getInclusionContext())}};g.towardAttachContext=b;g.towardAttachRoot=function(b){for(var c=null;;)if(b instanceof g.ProductOccurrence)c=b,b=b.getParent();
else if(b instanceof g.NodeMixin)b=b.getParent();else{if(b instanceof g.InclusionContext){if(null===c)throw new d.InternalLogicError;return c}d.Util.TypeAssert(b);b=b.getInclusionContext()}};g.towardProductOccurrence=function(b){for(;;){if(b instanceof g.ProductOccurrence)return b;if(b instanceof g.AttachContext)b=b.getParent();else if(b instanceof g.InclusionContext)b=b.getParent();else if(b instanceof g.LoadContext){if(b=b.getParent(),null===b)return null}else if(b instanceof g.BodyMixin)b=b.getParent();
else if(b instanceof g.Pmi)b=b.getParent();else if(b instanceof g.CadView)b=b.getParent();else return d.Util.TypeAssert(b),console.assert(!1),null}}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(b){})(g.GenericTypeId||(g.GenericTypeId={}));var b=function(){function b(c,a,b,e,g){this._inclusionContexts=this._reservedNodeIdOffset=null;this._originalFileName="";this._originalFileType=d.FileType.Unknown;this._genericTypeMaps=null;console.assert(4294967295!==e);this._remapper=c;this._attachScope=a;this._attachedInvisibly=b;this._masterModelKey=e;this._parent=g}b.prototype.getRootNodeMetaData=function(c){return __awaiter(this,void 0,void 0,function(){var a,
b,d,e,n,h;return __generator(this,function(f){switch(f.label){case 0:if(4294967295===this._masterModelKey)return[2,null];a=c.getAbstractScEngine();b=this._masterModelKey;return[4,a.safeGetMetaData(b,1)];case 1:d=f.sent();if(null===d)return[3,4];e=c.tryParseHeader(d);return null===e?[2,new g.AssemblyData(null,d)]:[4,e];case 2:return n=f.sent(),this._originalFileName=n.originalFileName,this._originalFileType=n.originalFileType,[4,a.safeGetMetaData(b,n.rootAssemblyDataKey())];case 3:return h=f.sent(),
null!==h?[2,new g.AssemblyData(n,h)]:[2,null];case 4:return[2,null]}})})};b.prototype.getAttachScope=function(){return this._attachScope};b.prototype.attachedInvisibly=function(){return this._attachedInvisibly};b.prototype.getMasterModelKey=function(){return this._masterModelKey};b.prototype.addInclusionContext=function(c){console.assert(c.getParent()===this);this._inclusionContexts=h.TerseArray.push(this._inclusionContexts,c)};b.prototype.getRemapper=function(){return this._remapper};b.prototype.getParent=
function(){return this._parent};b.prototype.getChildren=function(){var c=this._inclusionContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var a=c[0].getChildren(),b=1;b<c.length;++b)h.append(a,c[b].getChildren());return a}return c.getChildren()};b.prototype.split=function(c,a,d){return new b(this._remapper,c,a,this._masterModelKey,d)};b.prototype.hasChildren=function(){return null!==this._inclusionContexts};b.prototype.removeProductOccurrence=function(c){for(var a=
null,b=h.TerseArray.toArray(this._inclusionContexts),d=0,e=b;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){a=g;break}}if(null===a)return!1;b=b.filter(function(a){return a.hasChildren()});this._inclusionContexts=0===b.length?null:h.TerseArray.fromArray(b);return!0};b.prototype.purgeContents=function(){for(var c=[],a=0,b=h.TerseArray.toArray(this._inclusionContexts);a<b.length;a++){var e=b[a].purgeContents();c.push(e)}this._inclusionContexts=null;return d.Util.waitForAll(c)};b.prototype.isLoaded=
function(){if(this._inclusionContexts instanceof g.InclusionContext)return this._inclusionContexts.isLoaded();if(null!==this._inclusionContexts)for(var c=0,a=this._inclusionContexts;c<a.length;c++)if(!a[c].isLoaded())return!1;return!0};b.prototype.setReservedNodeIdOffset=function(c){console.assert(null===this._reservedNodeIdOffset);this._reservedNodeIdOffset=c};b.prototype.getReservedNodeIdOffset=function(){return this._reservedNodeIdOffset};b.prototype.forgetReservedNodeIdOffset=function(){console.assert(null!==
this._reservedNodeIdOffset);this._reservedNodeIdOffset=null};b.prototype.getOriginalFileName=function(){return this._originalFileName};b.prototype.getOriginalFileType=function(){return this._originalFileType};b.prototype.setGenericTypeMaps=function(c){this._genericTypeMaps=c};b.prototype.getGenericTypeMaps=function(){return this._genericTypeMaps};return b}();g.AttachContext=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a,b,d){this._productOccurrences=null;console.assert(void 0!==b);console.assert(0===b===(0===d));this._attachContext=a;this._inclusionKey=b;this._modelKey=d;b=a.getReservedNodeIdOffset();null!==b?a.forgetReservedNodeIdOffset():b=c.newNodeIdOffset();this._nodeIdOffset=b;c.registerInclusionContext(this)}b.prototype.split=function(c,a){return new b(c,a,this._inclusionKey,this._modelKey)};b.prototype.getIdOffset=function(){return this._nodeIdOffset};
b.prototype.toRuntimeId=function(c){console.assert(g.isAuthoredId(c));return c+this._nodeIdOffset};b.prototype.getInclusionKey=function(){return this._inclusionKey};b.prototype.getModelKey=function(){return this._modelKey};b.prototype.getParent=function(){return this._attachContext};b.prototype.getAttachContext=function(){return this._attachContext};b.prototype.addProductOccurrence=function(c){console.assert(c.getParent()===this);this._productOccurrences=h.TerseArray.push(this._productOccurrences,
c)};b.prototype.getChildren=function(){console.assert(null!==this._productOccurrences);return h.TerseArray.toArray(this._productOccurrences)};b.prototype.removeProductOccurrence=function(c){var a=h.TerseArray.toArray(this._productOccurrences),b=a.length;a=a.filter(function(a){return a!==c});0===a.length?delete this._productOccurrences:this._productOccurrences=h.TerseArray.fromArray(a);return a.length<b};b.prototype.purgeContents=function(){for(var c=[],a=0,b=h.TerseArray.toArray(this._productOccurrences);a<
b.length;a++){var e=b[a].purgeContents();c.push(e)}this._productOccurrences=null;return d.Util.waitForAll(c)};b.prototype.hasChildren=function(){return null!==this._productOccurrences};b.prototype.isLoaded=function(){if(this._productOccurrences instanceof g.ProductOccurrence)return this._productOccurrences.isLoaded();if(null!==this._productOccurrences)for(var c=0,a=this._productOccurrences;c<a.length;c++)if(!a[c].isLoaded())return!1;return!0};return b}();g.InclusionContext=b})(h.Tree||(h.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a,b){this._attachContexts=this._handledExternalModels=null;this._registeredScsModelKeys=new Map;this._layerIdMap=new h.Bimap;this._parent=c;this._debugLoadString=a;this._debugLoadString;this._scsBufferCache=b}b.prototype.handleExternalModel=function(c,a,b){a=a.getInclusionKey();c=h.compressUint(b)+" "+h.compressUint(a)+" "+h.compressUint(c);null===this._handledExternalModels&&(this._handledExternalModels=new Set);if(this._handledExternalModels.has(c))return!1;
this._handledExternalModels.add(c);return!0};b.prototype.getParent=function(){return this._parent};b.prototype.addAttachContext=function(c){this._attachContexts=h.TerseArray.push(this._attachContexts,c)};b.prototype.getChildren=function(){var c=this._attachContexts;if(null===c)return[];if(Array.isArray(c)){console.assert(0<c.length);for(var a=c[0].getChildren(),b=1;b<c.length;++b)h.append(a,c[b].getChildren());return a}return c.getChildren()};b.prototype.hasChildren=function(){return null!==this._attachContexts};
b.prototype.removeProductOccurrence=function(c){for(var a=null,b=h.TerseArray.toArray(this._attachContexts),d=0,e=b;d<e.length;d++){var g=e[d];if(g.removeProductOccurrence(c)){a=g;break}}if(null===a)return!1;b=b.filter(function(a){return a.hasChildren()});this._attachContexts=0===b.length?null:h.TerseArray.fromArray(b);return!0};b.prototype.purgeContents=function(){for(var c=[],a=0,b=h.TerseArray.toArray(this._attachContexts);a<b.length;a++){var e=b[a].purgeContents();c.push(e)}this._attachContexts=
null;return d.Util.waitForAll(c)};b.prototype.isLoaded=function(){if(this._attachContexts instanceof g.AttachContext)return this._attachContexts.isLoaded();if(null!==this._attachContexts)for(var c=0,a=this._attachContexts;c<a.length;c++)if(!a[c].isLoaded())return!1;return!0};b.prototype.initializeScsModelKeysOf=function(c){console.assert(void 0===this._registeredScsModelKeys.get(c));this._registeredScsModelKeys.set(c,h.TrackedOpenPromise.create())};b.prototype.getScsModelKeysOf=function(c){c=this._registeredScsModelKeys.get(c);
return void 0===c?null:c};b.prototype.markAsFirstLoad=function(){console.assert(void 0===this._isFirstLoad);this._isFirstLoad=!0};b.prototype.isFirstLoad=function(){return!0===this._isFirstLoad};b.prototype.toScsBuffer=function(c,a){return __awaiter(this,void 0,void 0,function(){var b,e=this;return __generator(this,function(f){b=h.LazyPromise.create(function(){return __awaiter(e,void 0,void 0,function(){var b;return __generator(this,function(f){switch(f.label){case 0:return[4,a(c)];case 1:f=b=f.sent();
if("string"===typeof f)throw new d.InternalLogicError;return[2,f]}})})});return null===this._scsBufferCache?[2,b]:[2,this._scsBufferCache.load(c,b)]})})};b.prototype.onLoadComplete=function(){this._scsBufferCache=null};b.prototype.addLayerIdToMap=function(c,a){this._layerIdMap.set(c,a)};b.prototype.getAuthoredLayerId=function(c){c=this._layerIdMap.getRight(c);return void 0!==c?c:null};b.prototype.getRuntimeLayerId=function(c){c=this._layerIdMap.getLeft(c);return void 0!==c?c:null};return b}();g.LoadContext=
b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(){function c(a){this._referrers=null;this._prototype=a}c.prototype._addReferrer=function(a){this._referrers=d.TerseArray.push(this._referrers,a)};c.prototype._getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype._getPrototype=function(){return this._prototype};c.prototype._removeReferrer=function(a){var c=!1,b=d.TerseArray.toArray(this._referrers);b=b.filter(function(b){return b===a?(c=!0,!1):!0});if(!c)return!1;0===
b.length?delete this._referrers:this._referrers=d.TerseArray.fromArray(b);return!0};c.prototype._purgeContents=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return this._prototype.isUnforced()?[3,3]:[4,this._prototype];case 1:return a=c.sent(),[4,a.purgeContents()];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._isLoaded=function(){return this._prototype.isResolved()&&this._prototype.getResolved().isLoaded()};
return c}();g.SharedPrototypeContext=b;var e=function(){function c(a,c){a instanceof b&&(a=d.LazyObject.create(a));this._shared=a;this._inclusionContext=c}c.prototype.getInclusionContext=function(){return this._inclusionContext};c.prototype.addReferrer=function(a){this._shared.get()._addReferrer(a)};c.prototype.getReferrers=function(){return this._shared.get()._getReferrers()};c.prototype.getProductOccurrence=function(){return this._shared.get()._getPrototype()};c.prototype.removeReferrer=function(a){return this._shared.get()._removeReferrer(a)?
(a=a.removePrototype(),console.assert(this===a),!0):!1};c.prototype.removeAllReferrers=function(){for(var a=0,c=this.getReferrers();a<c.length;a++)this.removeReferrer(c[a])||console.assert(!1)};c.prototype.purgeContents=function(){return this._shared.get()._purgeContents()};c.prototype.isLoaded=function(){return this._shared.get()._isLoaded()};return c}();g.PrototypeContext=e})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function a(){this._bits2=this._bits1=0}a.prototype.hasBits1=function(a){return h.hasBits(this._bits1,a)};a.prototype.hasBits2=function(a){return h.hasBits(this._bits2,a)};a.prototype.parseBits1=function(a){this._bits1=a.parseIndex_32()};a.prototype.parseBits2=function(a){this.hasBits1(1073741824)&&(this._bits2=a.parseIndex_32())};return a}();g.NodeParseBits=b;var e=function(){return function(a,c){this.shown=a;this.removed=c}}();g.AssemblyVisibility=
e;var c=function(){function a(a){this._bytes=a.bytes;this._header=a.header;this._dataView=new DataView(this._bytes.buffer,this._bytes.byteOffset,this._bytes.byteLength);this._currentPos=0}a.prototype.hasNext=function(){return this._currentPos<this._bytes.length};a.prototype.parseCount_32=function(){return this._parseUint_32()};a.prototype.parseIndex_32=function(){return this._parseUint_32()};a.prototype.parseAssemblyDataVersion=function(a){for(var c=[],b=0;b<a;++b)c.push(this._parseUint_32());return c};
a.prototype.parseAssemblyDataHeaderVersion=function(){return this._parseUint_32()};a.prototype.parseVisibility=function(){var a=this._parseInt_8(),c=h.hasBits(a,2);a=h.hasBits(a,1);return new e(c,a)};a.prototype.parseProductBits=function(){var a=this._parseUint_8();return null!==this._header&&2<=this._header.headerVersion||!h.hasBits(a,6)?a:a&-7|32};a.prototype.parseCString=function(){for(var a=this._currentPos,c=this._bytes[this._currentPos++];0!==c;)c=this._bytes[this._currentPos++];return h.utf8ArrayToStr(this._bytes.subarray(a,
this._currentPos-1))};a.prototype.parseBytes=function(a){var c=this._currentPos;this._currentPos+=a;a=this._bytes.subarray(c,this._currentPos);return new Uint8Array(a)};a.prototype.parseNodeId=function(){var a=this._parseUint_32();console.assert(a!==g.invalidNodeId);return a};a.prototype.parseLayerId=function(){var a=this._parseUint_32();console.assert(a!==g.invalidNodeId);return a};a.prototype.parseGenericTypes=function(){for(var a=this._parseUint_32(),c=new h.Bimap,b=0;b<a;b++){var d=this.parseCString(),
e=this._parseUint_32();c.set(e,d)}return c};a.prototype.parseGenericTypeId=function(){return this._parseUint_32()};a.prototype.parseGenericId=function(){return this.parseCString()};a.prototype._parseScKey=function(){var a=this._parseUint_32();console.assert(4294967295!==a);return a};a.prototype.parseDataKey=function(){return this._parseScKey()};a.prototype.parseInstanceKey=function(){return this._parseScKey()};a.prototype.parseMeshKey=function(){return this._parseScKey()};a.prototype.parseModelKey=
function(a){var c=this._parseScKey();return null!==a?a.getEffectiveModelKey(c):c};a.prototype.parseInclusionKey=function(a,c){var b=this._parseScKey();return null!==a?a.getEffectiveInclusionKey(b,c):b};a.prototype.parseMatrix=function(){for(var a=this,c=null!==this._header&&this._header.doublePrecisionMatrices?function(){return a.parseFloat_64()}:function(){return a.parseFloat_32()},b=new d.Matrix,e=0;4>e;++e)for(var g=0;3>g;++g)b.m[4*e+g]=c();return b};a.prototype._parseInt_8=function(){return this._dataView.getInt8(this._currentPos++)};
a.prototype._parseUint_8=function(){return this._dataView.getUint8(this._currentPos++)};a.prototype._parseUint_32=function(){var a=this._dataView.getUint32(this._currentPos,!0);this._currentPos+=4;return a};a.prototype._parseFloat_32=function(){var a=this._dataView.getFloat32(this._currentPos,!0);this._currentPos+=4;return a};a.prototype._parseFloat_64=function(){var a=this._dataView.getFloat64(this._currentPos,!0);this._currentPos+=8;return a};a.prototype.parseFloat_32=function(){return this._parseFloat_32()};
a.prototype.parseFloat_64=function(){return this._parseFloat_64()};a.prototype.parseAttributeType=function(){return this._parseInt_8()};a.prototype.parseNodeParseBits=function(){var a=new b;a.parseBits1(this);a.parseBits2(this);return a};a.prototype.parseViewParseBits=function(){return this._parseUint_32()};a.prototype.parsePmiParseBits=function(){return this._parseUint_32()};a.prototype.parseLayerParseBits=function(){return this._parseUint_32()};a.prototype.parseBoolean=function(){return 0!==this._parseUint_8()};
a.prototype.parsePoint3_32=function(){return new d.Point3(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};a.prototype.parsePoint3_64=function(){return new d.Point3(this._parseFloat_64(),this._parseFloat_64(),this._parseFloat_64())};a.prototype.parsePlane3_32=function(){return d.Plane.createFromCoefficients(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};a.prototype.parsePmiType=function(){return this._parseUint_32()};a.prototype.parsePmiSubType=
function(){return this._parseUint_32()};a.prototype.parsePmiTopoRef=function(){return this._parseInt_8()};a.prototype.parseBodyType=function(){return this._parseUint_8()};a.prototype.parseFaceType=function(){return this._parseInt_8()};a.prototype.parseEdgeType=function(){return this._parseInt_8()};a.prototype.parseUserDataIndex=function(){var a=this._parseUint_32(),c=this._parseUint_32();return 2097151>=c?4294967296*c+a:(""+c.toString(16)+h.zeroPadHex32(a)).toUpperCase()};a.prototype.getHeader=function(){return this._header};
return a}();g.AssemblyDataParser=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(c,a){this._inclusionsOf=new Map;this._masterModelKey=4294967295;this._prototypeInstanceCount=-1;this._attachScope=c;this._attachedInvisibly=a}b.prototype.getAttachScope=function(){return this._attachScope};b.prototype.getMasterModelKey=function(){console.assert(4294967295!==this._masterModelKey);return this._masterModelKey};b.prototype.getModelKeys=function(){var c=[];this._inclusionsOf.forEach(function(a,b){c.push(b)});return c};
b.prototype.hasInclusions=function(){return 0<this._inclusionsOf.size};b.prototype.getAllInclusions=function(){var c=[];this._inclusionsOf.forEach(function(a,b){for(var d=0;d<a.length;d++)c.push(a[d],b)});return c};b.prototype.getInclusionsOf=function(c){var a=this._inclusionsOf.get(c);if(void 0===a)return[];for(var b=[],d=0;d<a.length;d++)b.push(a[d],c);return b};b.prototype.hasModelIncluded=function(c){return this._inclusionsOf.has(c)};b.prototype.attachedInvisibly=function(){return this._attachedInvisibly};
b.prototype.prototypeInstanceCount=function(){console.assert(0<=this._prototypeInstanceCount);return this._prototypeInstanceCount};b.prototype.registerInclusion=function(c,a){var b=this._inclusionsOf.get(a);void 0===b?this._inclusionsOf.set(a,[c]):b.push(c)};b.prototype.registerMasterModelKey=function(c){console.assert(4294967295===this._masterModelKey);this._masterModelKey=c};b.prototype.registerPrototypeInstanceCount=function(c){console.assert(-1===this._prototypeInstanceCount);this._prototypeInstanceCount=
c};return b}();d.AttachInfoBuilder=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(){this._calculatedCutoff=0;this._requireBoundingInfo=!1;this._prevPriorityValue=1;this._priorityProxies=new Map}b.prototype.getPriorityCompareValue=function(c){if("number"===typeof c)return c;c=this._priorityProxies.get(c);null!==c.worldBounding&&console.assert(1>=c.priorityHeuristic);return c.priorityHeuristic};b.prototype.setRequireBoundingInfo=function(c){this._requireBoundingInfo=c};b.prototype.comparePriority=function(c,a){c=
this.getPriorityCompareValue(c);a=this.getPriorityCompareValue(a);return c<a};b.prototype._updateHeuristicInfo=function(c,a){if(null!==a.worldBounding){var b=h.toVec3(a.worldBounding.center()),d=h.toVec3(a.worldBounding.extents());c=c.calculateAttachHeuristic(d,b);a.priorityHeuristic=c}null!==a.xmlAttachInfo&&a.xmlAttachInfo.directlyRequested&&(null===a.worldBounding&&(a.priorityHeuristic=0),a.priorityHeuristic+=-1E6)};b.prototype.createPriority=function(c,a,b){if(null===b)return++this._prevPriorityValue;
var d=Object.create(null);if(null!==b.bounding){a=a.transformBox(b.bounding);var f=0}else{if(this._requireBoundingInfo)throw Error("WorldBounding must be specified when streamCutoff is enabled");a=null;f=++this._prevPriorityValue}b={xmlAttachInfo:b,worldBounding:a,priorityHeuristic:f};this._updateHeuristicInfo(c,b);this._priorityProxies.set(d,b);return d};b.prototype.destroyPriority=function(c){"object"===typeof c&&this._priorityProxies.delete(c)};b.prototype.onViewChange=function(c,a,b){var d=this;
this._calculateCutoff(b.getProjectionMatrix(a.getCamera()));this._priorityProxies.forEach(function(a){d._updateHeuristicInfo(c,a)})};b.prototype.reset=function(){this._priorityProxies.clear()};b.prototype._calculateCutoff=function(c){var a=.98;0!==c.m[11]&&(a=(1-c.m[15])/c.m[11]*c.m[10]+c.m[14]);var b=d.Matrix.inverse(c);if(!b)throw Error();c=h.toVec4(b.transform4(new d.Point4(0,0,a,1)));var e=h.toVec4(b.transform4(new d.Point4(.0125,0,a,1)));a=h.toVec4(b.transform4(new d.Point4(0,.0125,a,1)));h.scale4(1/
c[3],c);h.scale4(1/e[3],e);h.scale4(1/a[3],a);this._calculatedCutoff=Math.min(h.squaredNorm4(h.sub4(e,c)),h.squaredNorm4(h.sub4(a,c)))};b.prototype.getCalculatedCutoff=function(){return this._calculatedCutoff};return b}();g.AttachPriorityManager=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){(function(b){function d(c){return"modelName"in c}b.isNameInfo=d;b.isIncInfo=function(c){return!d(c)};b.canImplicitlyLoad=function(c){return c.config.implicitlyLoadXmlExternalModels||!d(c)}})(d.ExternalModel||(d.ExternalModel={}))})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a,b,d){var f=this;this._cameraTimeoutId=null;this._isFirstAttachment=!0;this._attachScope=0;null===d&&(d=13);console.assert(0<d);this._engine=c;this._view=a;this._callbackManager=b;this._parentToXmlAttachInfos=new Map;this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager=new g.AttachPriorityManager;this._comparePriority=function(a,c){return f._attachPriorityManager.comparePriority(a,c)};this._attachQueue=this._createAttachQueue(d);
this._prefetchScsQueue=this._createPrefetchScsQueue(d);this._registerCameraListener()}b.createWithEmptyModel=function(c,a,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,c.loadEmpty()];case 1:return f.sent(),[2,new b(c,a,d,e)]}})})};b.prototype.setPrefetchScsCutoffScale=function(c){this._prefetchScsQueue.setCutoffScale(c);this._attachPriorityManager.setRequireBoundingInfo(this._prefetchScsQueue.cutoffEnabled())};b.prototype._createAttachQueue=
function(c){return new h.PriorityPromiseQueue(c,this._comparePriority,!1)};b.prototype._createPrefetchScsQueue=function(c){var a=this;return new h.StreamCutoffAttachQueue(0,this._attachPriorityManager,c+15,function(c,b){return a._comparePriority(c,b)},!1)};b.prototype._reprioritizeAttachments=function(){this._viewInfo=new g.ViewInfo(this._view);this._attachPriorityManager.onViewChange(this._viewInfo,this._view,this._engine);this._attachQueue.markDirty();this._prefetchScsQueue.update()};b.prototype._registerCameraListener=
function(){var c=this,a=function(){c._onCameraChange()};this._callbackManager.bind({camera:a,_shutdownBegin:function(){null!==c._cameraTimeoutId&&(clearTimeout(c._cameraTimeoutId),c._cameraTimeoutId=null);c._callbackManager.unbind({camera:a})}})};b.prototype.reprioritizeAttachmentsNow=function(){null!==this._cameraTimeoutId&&(clearTimeout(this._cameraTimeoutId),this._cameraTimeoutId=null);this._reprioritizeAttachments()};b.prototype._onCameraChange=function(){var c=this;null!==this._cameraTimeoutId&&
clearTimeout(this._cameraTimeoutId);this._cameraTimeoutId=this._engine.setTimeout(function(){c._cameraTimeoutId=null;c._reprioritizeAttachments()},500)};b.prototype._awaitAttachInfo=function(c,a,b,e,l){var f=this,k=null===e,p=new g.AttachInfoBuilder(a,b),q=!1,r=[],w=h.OpenPromise.create(),t=h.OpenPromise.create(),u=!1,v=function(){console.assert(!u);u=!0;f._cleanupAttachLowLevel();f._callbackManager.unbind(x)},z=null,x={_priorityMetaDataSent:function(c,b){c===a&&(p.registerPrototypeInstanceCount(b),
w.resolve())},_announceModel:function(c,b){c===a&&(q=!0,p.registerMasterModelKey(b))},_inclusion:function(c,b,d){c===a&&(p.registerInclusion(b,d),r.push(d))},_remapModel:function(b,d,f){b===a&&c.remapModel(d,f)},_remapInclusion:function(b,d,f,e){b===a&&c.remapInclusion(d,f,e)},_missingModel:function(c,b){c===a&&(z=b)},_attached:function(c){if(c===a){if(!q){if(null!==z&&(k||l)){console.assert(0===r.length);t.reject(new d.MissingModelError(z));return}if(1!==r.length){t.reject(new d.LoadError("Bad model: Could not find master model key."));
return}p.registerMasterModelKey(r[0])}c=[w];var b=f._isFirstAttachment;if(b){f._isFirstAttachment=!1;var e=f._callbackManager.promiseTrigger("_firstAttachment",null,k?h.AttachType.Direct:h.AttachType.Indirect);c.push(e)}return d.Util.waitForAll(c).catch(function(a){console.assert(!1);throw a;}).then(function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return b&&1===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",
null)]:[3,2];case 1:a.sent(),a.label=2;case 2:return v(),t.resolve(p),[2]}})})})}}};this._callbackManager.bind(x);return t.catch(function(a){v();throw a;})};b.prototype._createPriority=function(c,a){return this._attachPriorityManager.createPriority(this._viewInfo,c,a)};b.prototype._cleanupAttachLowLevel=function(){};b.prototype._cleanupAttachHighLevel=function(c,a,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,,2,
3]),[4,c];case 1:return[2,d.sent()];case 2:return null!==b&&this._forgetXmlAttachment(b),this._attachPriorityManager.destroyPriority(a),[7];case 3:return[2]}})})};b.prototype.newAttachScope=function(){return++this._attachScope};b.prototype._attachByStream=function(c,a,b,e,g,n,h,p){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,h);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(m){switch(m.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(a,d,n.get(),h,p),m.label=1;case 1:return m.trys.push([1,4,,5]),[4,c.enqueue(function(){return l._engine.attachModel(d,b,k,g,n.get())})];case 2:return m.sent(),[4,f];case 3:return[2,m.sent()];case 4:throw e=m.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,h)};b._getAllModelKeys=function(c){var a=c.getMasterModelKey();c=c.getAllInclusions();if(c[1]!==a)for(var b=2;b<c.length;b+=2)if(c[b+1]===a){var d=
c[b];c[b]=c[0];c[b+1]=c[1];c[0]=d;c[1]=a;break}a=[];b=0;for(d=1;d<c.length;++b,d+=2)a[b]=c[d];return a};b.prototype.attachByNamedScsBuffer=function(c,a,f,e,l,n,m,p){return __awaiter(this,void 0,void 0,function(){var k,r,w,t,u,v=this;return __generator(this,function(q){c.getAutomaticMeasurementUnitScaling()||(n=SC.UnspecifiedMeasurementUnit);k=g.towardLoadContext(p.parent);r=d.Matrix.toMatrix12(l.m);w=this._createPriority(l,p);t=function(e){return __awaiter(v,void 0,void 0,function(){var l,q,w,t,u,
v,x,z,G,I,K,J,L=this;return __generator(this,function(y){switch(y.label){case 0:return[4,function(){return __awaiter(L,void 0,void 0,function(){var c;return __generator(this,function(b){c=k.getScsModelKeysOf(a);return null===c?(k.initializeScsModelKeysOf(a),[2,e]):[2,c]})})}()];case 1:l=y.sent();q=k.getScsModelKeysOf(a);if(null===q)throw new d.InternalLogicError;w=this.newAttachScope();if(!(l instanceof Uint8Array||h.FetchApi.isSupported()&&l instanceof Response))return[3,7];u=!0;v=this._awaitAttachInfo(f,
w,m.get(),p,!1);y.label=2;case 2:return y.trys.push([2,5,,6]),[4,c.enqueue(function(){var a=L._engine.attachScsBuffer(w,l instanceof Uint8Array?l:null,r,n,m.get(),u);l instanceof Uint8Array||L.streamScsData(w,l);return a})];case 3:return y.sent(),[4,v];case 4:return t=y.sent(),[3,6];case 5:throw x=y.sent(),this._cleanupAttachLowLevel(),x;case 6:return 0===q.state&&(z=b._getAllModelKeys(t),q.resolve(z)),[3,8];case 7:if(null===l)t=null,0===q.state&&q.resolve(null);else if(l instanceof Array){console.assert(0!==
q.state);G=new g.AttachInfoBuilder(w,m.get());G.registerPrototypeInstanceCount(0);for(I=0;I<l.length;++I)K=l[I],J=this._engine.attachScsModelByKey(w,K,r,n,m.get()),G.registerInclusion(J,K),0===I&&G.registerMasterModelKey(K);t=G}else throw new d.InternalLogicError;y.label=8;case 8:return[2,t]}})})};u=function(){return __awaiter(v,void 0,void 0,function(){var c,b=this;return __generator(this,function(d){switch(d.label){case 0:return[4,this._prefetchScsQueue.push(function(){return __awaiter(b,void 0,
void 0,function(){return __generator(this,function(c){return[2,k.toScsBuffer(a,e)]})})},w)];case 1:return c=d.sent(),p.directlyRequested=!0,[2,this._attachQueue.push(function(){return t(c)},w)]}})})}();return[2,this._cleanupAttachHighLevel(u,w,p)]})})};b.prototype.streamScsData=function(c,a){var b=this;this._callbackManager.trigger("_fetchBegin",a.url,c);var d=a.body.getReader();this._engine.setTimeout(function(){return __awaiter(b,void 0,void 0,function(){var b,f,e;return __generator(this,function(k){switch(k.label){case 0:return[4,
d.read()];case 1:b=k.sent();f=b.done;e=b.value;if(f)return this._engine.feedScsBuffer(c,null),this._callbackManager.trigger("_fetchEnd",a.url,c),[2];this._engine.feedScsBuffer(c,e);return[3,0];case 2:return[2]}})})},0)};b.prototype._attachByScsBuffer=function(c,a,b,e,g,n){var f=this,k=d.Matrix.toMatrix12(e.m);e=this._createPriority(e,null);var l=this._attachQueue.push(function(){return __awaiter(f,void 0,void 0,function(){var d,f,e,l=this;return __generator(this,function(h){switch(h.label){case 0:d=
this.newAttachScope(),f=this._awaitAttachInfo(a,d,n.get(),null,!1),h.label=1;case 1:return h.trys.push([1,4,,5]),[4,c.enqueue(function(){var a=l._engine.attachScsBuffer(d,b instanceof Uint8Array?b:null,k,g,n.get(),!1);b instanceof Uint8Array||l.streamScsData(d,b);return a})];case 2:return h.sent(),[4,f];case 3:return[2,h.sent()];case 4:throw e=h.sent(),this._cleanupAttachLowLevel(),e;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(l,e,null)};b.prototype.simpleAttach=function(c,a,b,e,
g,n,h,p){c.getAutomaticMeasurementUnitScaling()||(g=SC.UnspecifiedMeasurementUnit);if("string"===typeof b)return this._attachByStream(c,a,b,e,g,n,h,p);if(null===h)return this._attachByScsBuffer(c,a,b,e,g,n);d.Util.TypeAssert(b);d.Util.TypeAssert(h);throw new d.InternalLogicError;};b.prototype.reset=function(){this._isFirstAttachment=!0;this._attachScope=0;this._parentToXmlAttachInfos.clear();this._attachPriorityManager.reset();return this.clearAttachQueues()};b.prototype.clearAttachQueues=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._prefetchScsQueue.killDeferred(),this._attachQueue.killDeferred(),[4,this._prefetchScsQueue.waitForIdle()];case 1:return c.sent(),[2,this._attachQueue.waitForIdle()]}})})};b.prototype.isIdle=function(){return this._attachQueue.isIdle()};b.prototype.notifyDirectRequest=function(c){c=this._parentToXmlAttachInfos.get(c);if(void 0!==c){for(var a=!1,b=0;b<c.length;b++){var d=c[b];d.directlyRequested||(a=d.directlyRequested=
!0)}a&&this._reprioritizeAttachments()}};b.prototype.registerXmlAttachInfo=function(c){var a=c.parent,b=this._parentToXmlAttachInfos.get(a);void 0===b&&(b=[],this._parentToXmlAttachInfos.set(a,b));b.push(c)};b.prototype._forgetXmlAttachment=function(c){var a=c.parent,b=this._parentToXmlAttachInfos.get(a);1===b.length?(console.assert(b[0]===c),this._parentToXmlAttachInfos.delete(a)):(console.assert(1<b.length),c=b.indexOf(c),console.assert(0<=c),b.splice(c,1))};b.prototype.maxConcurrentAttachments=
function(){return this._attachQueue.maxActivePromises()};return b}();g.ScAttacher=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(){this._remappedModelKeys=new Map;this._remappedInclusionKeys=new Map}b.prototype.remapModel=function(c,a){this._remappedModelKeys.set(a,c);this._remappedInclusionKeys.has(c)||this._remappedInclusionKeys.set(c,new Map)};b.prototype.remapInclusion=function(c,a,b){c=this._remappedInclusionKeys.get(c);console.assert(void 0!==c);c.set(b,a)};b.prototype.getEffectiveModelKey=function(c){var a=this._remappedModelKeys.get(c);return void 0!==
a?a:c};b.prototype.getEffectiveInclusionKey=function(c,a){a=this._remappedInclusionKeys.get(a);return void 0!==a&&(a=a.get(c),void 0!==a)?a:c};return b}();d.ScKeyRemapper=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a){return(new DOMParser).parseFromString(a,"application/xml")}function e(a){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,h.httpRequest(a)];case 1:return c=f.sent(),d=c.responseXML,null===d&&(d=b(c.responseText)),[2,d]}})})}function c(a){if(!a.hasChildNodes)return null;a=a.firstChild;if(!(a instanceof Comment))return null;a=a.data.split(" ");if(2!==a.length||"HC"!==a[0])return null;
a=a[1].split(".");if(2>a.length)return null;for(var c=[],b=0;b<a.length;b++){var d=a[b];if(!h.isBase10Number(d))return null;c.push(parseInt(d,10))}return c}function a(a){a=a.getElementsByTagName("parsererror");if(0<a.length)throw new d.XmlParseError(a[0].textContent||"unknown error");}function f(a,c,b,d){return{getAttachScope:function(){return a},getMasterModelKey:function(){return d},getModelKeys:function(){return[d]},hasInclusions:function(){return!0},getAllInclusions:function(){return[b,d]},getInclusionsOf:function(a){return a===
d?[b,d]:[]},hasModelIncluded:function(a){return a===d},attachedInvisibly:function(){return c},prototypeInstanceCount:function(){return 0}}}var k=function(){function k(a,c,b,d,f){this._loadQueue=new h.PromiseQueue(1,!1);this._activeLoadGeneration=this._activeLoadCount=0;this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;console.assert(a.isInitialized());this._assemblyTree=a;this._scAttacher=c;this._engine=b;this._view=d;this._callbackManager=f;this._isScsSession=2===this._engine.getSessionType();
this._nodesUntilNextSleep=2E3}k.prototype._resolveMeasurementUnits=function(a){if(this._assemblyTree.getAutomaticMeasurementUnitScaling()){var c=g.towardProductOccurrence(a.getParent());if(null===c)throw new d.InternalLogicError;var b=c.getMeasurementUnit(),f=a.getMeasurementUnit();b!==f&&(c=a.getLocalTransform(),null===c&&(c=new d.Matrix),b=f/b,c.m[0]*=b,c.m[5]*=b,c.m[10]*=b,a.setLocalTransformAsInitial(c))}};k.prototype._patchImplicitNodesByModelInc=function(a,c,b,d,f){var e=this,k=0;if(0!==d.length)for(var l,
n=h.Lazy.create(function(){var d=a.get(),k=g.towardAttachContext(d),n=k.getAttachScope();l=k.attachedInvisibly();k=k.split(n,l,d);d.addAttachContext(k);d=new g.InclusionContext(e._assemblyTree,k,c,b);k.addInclusionContext(d);k=g.ProductOccurrence.createDynamic(e._assemblyTree,d,"Of Inclusion ("+c+")",null,null,!l,f);d.addProductOccurrence(k);return k}),m=0;m<d.length;m++){var p=d[m],q=this._assemblyTree.lookupAnyBodyByInstanceInc(c,p);if(null===q){q=n.get();var r="Implicit Body "+ ++k;q=this._assemblyTree.createMeshInstance(!0,
c,p,null,r,q,!1,!1);l&&q.setVisibility(!1)}}};k.prototype._getPrototypeInstanceCountByAttachment=function(a){var c=new Set,b=0;a=a.getAllInclusions();for(var d=0;d<a.length;d+=2){var f=a[d],e=a[d+1];c.has(e)||(c.add(e),b+=this._assemblyTree.getInstanceCountByInclusion(f))}return b};k.prototype._patchImplicitNodesByAttachment=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,m,p,x,y,A,B=this;return __generator(this,function(q){switch(q.label){case 0:return console.assert(a.isLoaded()),
f=null,e=h.Lazy.create(function(){var d=new g.ScKeyRemapper,e=c.getMasterModelKey();f=new g.AttachContext(d,c.getAttachScope(),c.attachedInvisibly(),e,a);d=new g.InclusionContext(B._assemblyTree,f,0,0);f.addInclusionContext(d);e=g.ProductOccurrence.createDynamic(B._assemblyTree,d,"Implicit Bodies",null,null,!c.attachedInvisibly(),b);d.addProductOccurrence(e);return e}),k=c.prototypeInstanceCount(),0!==k?[3,2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,1)];case 1:k=q.sent()[0],q.label=2;
case 2:return l=this._getPrototypeInstanceCountByAttachment(c),l===k?[2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,0)];case 3:n=q.sent();m=c.getAllInclusions();for(p=0;p<m.length;p+=2)x=m[p],y=m[p+1],A=n.get(y),void 0!==A&&this._patchImplicitNodesByModelInc(e,x,y,A,b);l=this._getPrototypeInstanceCountByAttachment(c);if(l<k)throw new d.InternalLogicError;return null===f?[2]:[4,g.markContextsLoaded([f])];case 4:return q.sent(),a.addAttachContext(f),[2]}})})};k.prototype._updateOnDemandRequests=
function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,f,e;return __generator(this,function(k){if(!this._assemblyTree.onDemandRequestsActive())return[2];c=a.getChildren();b=[];d=0;for(f=c;d<f.length;d++)e=f[d],this._assemblyTree.isBeingRequested(e)&&b.push(e);return[2,this._assemblyTree.requestNodes(this,b,!0)]})})};k.prototype._populateAttachment=function(a,c,b,d,f,e){return __awaiter(this,void 0,void 0,function(){var k;return __generator(this,function(g){switch(g.label){case 0:return console.assert(f===
h.AttachType.Indirect===(null!==e)),[4,this._parseRootNodes(a,c,b,d,e)];case 1:return k=g.sent(),[4,this._postProcessAttachContext(c,d,f,k)];case 2:return g.sent(),[2,k]}})})};k.prototype._postProcessAttachContext=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var f,e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return[4,g.WalkerAsync.forceLazyPromises(d)];case 1:return n.sent(),[4,this._assemblyTree.enqueue(function(){return g.synchronizePmiVisibilities(l._engine,
d)})];case 2:return n.sent(),(f=this._assemblyTree.markImplicitNodesOutOfHierarchy())&&(f=0<d.getChildren().length||b===h.AttachType.Indirect),[4,this._patchImplicitNodesByAttachment(a,c,f)];case 3:return n.sent(),[4,this._updateOnDemandRequests(d)];case 4:return n.sent(),e=d.getChildren(),k=e.map(function(a){return a.getRuntimeId()}),this._callbackManager.trigger("_attachmentPopulated",k),[2]}})})};k.prototype._parseRootNodes=function(a,c,b,d,f){return __awaiter(this,void 0,void 0,function(){var e,
k,l,n,m,p,q,r=this;return __generator(this,function(w){switch(w.label){case 0:return e=d.getMasterModelKey(),k=d.getInclusionsOf(e),4294967295===e&&(console.assert(0===k.length),k.push(4294967295,4294967295)),l=new g.AttachContext(b,d.getAttachScope(),d.attachedInvisibly(),e,c),null!==f&&l.setReservedNodeIdOffset(f),n=new h.PromiseQueue(1,!0),[4,this._assemblyTree.enqueue(function(){return l.getRootNodeMetaData(r._assemblyTree)})];case 1:m=w.sent();p=function(c){n.push(function(){return r._parseRootNode(a,
l,m,k[c],k[c+1])})};for(q=0;q<k.length;q+=2)p(q);return[4,n.waitForIdle()];case 2:return w.sent(),[2,l]}})})};k.prototype._parseRootNode=function(a,c,b,d,f){return __awaiter(this,void 0,void 0,function(){var e,k;return __generator(this,function(l){switch(l.label){case 0:return console.assert(0!==d),[4,this._populateInclusion(a,c,b,d,f)];case 1:return e=l.sent(),e.hasAuthoredId()?(console.assert(!e.isLoaded()),k=g.towardInclusionContext(e),l=k.getParent(),l=l instanceof g.AttachContext&&l.getParent()instanceof
g.LoadContext?!0:!1,l&&this._setupRootNode(e,!1)):null===e.getName()&&(c.removeProductOccurrence(e)||console.assert(!1)),[2]}})})};k.prototype._setupRootNode=function(a,c){console.assert(!a.isAbsoluteRoot());c&&a.markIsExternalModelRoot(this._assemblyTree);this._resolveMeasurementUnits(a)};k.prototype._populateInclusion=function(a,c,b,d,f){return __awaiter(this,void 0,void 0,function(){var e,k,l=this;return __generator(this,function(n){switch(n.label){case 0:return console.assert(0!==d),e=new g.InclusionContext(this._assemblyTree,
c,d,f),c.addInclusionContext(e),[4,function(){return __awaiter(l,void 0,void 0,function(){var d,f,k;return __generator(this,function(l){if(null===b||0===b.bytes.length)return d=null,null===b&&(d="Missing"),[2,g.ProductOccurrence.createDynamic(this._assemblyTree,e,d,null,null,!c.attachedInvisibly())];f=new g.AssemblyDataParser(b);k=g.ProductOccurrence.parseBinary(a,this._assemblyTree,e,f);return[2,g.ProductOccurrence.reify(a,this,this._assemblyTree,e,k,e)]})})}()];case 1:return k=n.sent(),e.addProductOccurrence(k),
[2,k]}})})};k.prototype._rectifyLateVisibilityChange=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d,f,e;return __generator(this,function(k){b=g.towardAttachContext(c.getParent());d=g.towardProductOccurrence(c.getParent());console.assert(d===g.towardProductOccurrence(b));if(a.attachInvisibly||null===d||!d.isLoaded())return[2];f=d.isVisible();if(b.attachedInvisibly()===!f)return[2];e=f?2:0;return[2,g.updateVisibilitiesByAttachment(this._assemblyTree,this._engine,b,e)]})})};k.prototype._loadCleanup=
function(a,c){console.assert(0<this._activeLoadCount);a.onLoadComplete();null!==c&&this._callbackManager.unbind(c);--this._activeLoadCount;this._assemblyTree.onLoadEnd();this._callbackManager.trigger("visibilityChanged",[],[])};k.prototype._wrap=function(a,c,b,f){var e=this,k=this._activeLoadGeneration;return this._loadQueue.push(function(){return __awaiter(e,void 0,void 0,function(){var e,g,l,n,m,p,q,r,w,C,F,E,H,G=this;return __generator(this,function(t){switch(t.label){case 0:this._assemblyTree.onLoadBegin();
e=null;if(k!==this._activeLoadGeneration)throw this._loadCleanup(c,e),new d.LoadCancelledError;null===this._firstAssemblyDataHeader&&(e={_modelStructureHeaderParsed:function(a){return __awaiter(G,void 0,void 0,function(){return __generator(this,function(c){null!==e&&(null===this._firstAssemblyDataHeader&&(this._firstAssemblyDataHeader=a),this._callbackManager.unbind(e),e=null);return[2]})})}},this._callbackManager.bind(e,!0));t.label=1;case 1:return t.trys.push([1,3,,5]),[4,b];case 2:return t.sent(),
[3,5];case 3:return g=t.sent(),[4,c.purgeContents()];case 4:throw t.sent(),this._loadCleanup(c,e),g;case 5:l=c.getParent();if(null===l)throw this._loadCleanup(c,e),new d.InternalLogicError;n=f===h.AttachType.Direct;if(!n)return[3,8];if(!c.hasChildren())return[3,6];l.addLoadContext(c);return[3,8];case 6:return[4,c.purgeContents()];case 7:t.sent(),t.label=8;case 8:this._loadCleanup(c,e);m=c.getChildren();p=[];q=0;for(r=m;q<r.length;q++)w=r[q],C=this._rectifyLateVisibilityChange(a,w),p.push(C);return[4,
d.Util.waitForAll(p)];case 9:t.sent();if(!this._isFirstLoad)return[3,13];this._isFirstLoad=!1;c.markAsFirstLoad();F=m.map(function(a){return a.getRuntimeId()});E=!1;t.label=10;case 10:return t.trys.push([10,12,,13]),[4,this._callbackManager.promiseTrigger("_firstModelLoaded","firstModelLoaded",F,E,f)];case 11:return t.sent(),[3,13];case 12:throw H=t.sent(),console.assert(!1),H;case 13:return[2,c]}})})})};k.prototype._initLoad=function(a,c,b){++this._activeLoadCount;b=this._isScsSession&&b?new h.PromiseCache:
null;return new g.LoadContext(a,c,b)};k._getNetMatrix=function(a,c){a=g.getNetMatrix(a);null!==c&&(a=d.Matrix.multiply(c,a));return a};k.prototype._lazyAttachInvisibly=function(a,c){return h.Lazy.create(function(){return c.attachInvisibly||!a.isVisible()})};k.prototype._loadBySingleAttach=function(a,c,b,d){var f=this,e=this._initLoad(c,d,!1);d=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var d,f,l,n,m,p,q;return __generator(this,function(r){switch(r.label){case 0:return[4,
b];case 1:return d=r.sent(),f=new g.ScKeyRemapper,l=k._getNetMatrix(c,a.additionalMatrix),n=c.getMeasurementUnit(),m=this._lazyAttachInvisibly(c,a),[4,this._scAttacher.simpleAttach(this._assemblyTree,f,d,l,n,m,null,!1)];case 2:return p=r.sent(),[4,this._populateAttachment(a,e,f,p,h.AttachType.Direct,null)];case 3:return q=r.sent(),[4,g.markContextsLoaded([e,q])];case 4:return r.sent(),q.hasChildren()&&e.addAttachContext(q),[2,{}]}})})});return this._wrap(a,e,d,h.AttachType.Direct)};k.prototype._populateFromXml=
function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,p,q,A,B,D;return __generator(this,function(r){switch(r.label){case 0:e=b.documentElement;k=e.firstElementChild;for(l=null;null!==k;)"ModelFile"===k.localName&&(console.assert(null===l),l=g.ModelFile.parseXml(a,this._assemblyTree,c,k,f)),k=k.nextElementSibling;if(null===l)throw new d.XmlParseError('Expected "ModelFile" element.');n=!1;if(!this._isFirstLoad)return[3,2];h=SC.UnspecifiedMeasurementUnit;this._assemblyTree.getAutomaticMeasurementUnitScaling()&&
(m=g.towardProductOccurrence(c),h=m.getMeasurementUnit());p=g.ModelFile.parseBounding(l,h);if(p.isDegenerate())return[3,2];n=!0;return[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0,p)];case 1:r.sent(),r.label=2;case 2:return[4,g.ModelFile.reify(a,this._callbackManager,this,this._assemblyTree,c,l)];case 3:q=r.sent();A=0;for(B=q;A<B.length;A++)D=B[A],this._setupRootNode(D,!1);return!this._isFirstLoad||n?[3,5]:[4,this._view.setViewOrientation(d.ViewOrientation.Iso,0)];case 4:r.sent(),r.label=
5;case 5:return[2]}})})};k.prototype._loadByXml=function(b,f,e,k,l){var n=this,m=this._initLoad(f,l,!0);l=h.LazyPromise.create(function(){return __awaiter(n,void 0,void 0,function(){var l,n,p,q,r,w,t,D,C;return __generator(this,function(u){switch(u.label){case 0:return[4,e];case 1:l=u.sent();a(l);n=c(l);if(null===n||!h.versionAtLeast(g.MaxModelFileVersion,n))throw new d.XmlParseError("Bad version.");p=function(a){return k(a,n)};this._scAttacher.reprioritizeAttachmentsNow();f.addLoadContext(m);q=g.towardInclusionContext(f);
r=g.towardAttachContext(q);w=this._scAttacher.newAttachScope();t=this._lazyAttachInvisibly(f,b);D=r.split(w,t.get(),m);m.addAttachContext(D);C=q.split(this._assemblyTree,D);D.addInclusionContext(C);return[4,this._populateFromXml(b,C,l,p)];case 2:return u.sent(),[4,g.markContextsLoaded([m,D])];case 3:return u.sent(),[2,{}]}})})});return this._wrap(b,m,l,h.AttachType.Indirect)};k.prototype._attachExternalModelByInc=function(a,c){return __awaiter(this,void 0,void 0,function(){var b,d,f,e,k,l;return __generator(this,
function(n){switch(n.label){case 0:return console.assert(0!==a.inclusionKey),b=g.towardAttachContext(c).getAttachScope(),d=a.modelKey,f=this._lazyAttachInvisibly(c,a.config),e=new g.ScKeyRemapper,k=new g.AttachContext(e,b,f.get(),d,c),[4,k.getRootNodeMetaData(this._assemblyTree)];case 1:return l=n.sent(),[4,this._populateInclusion(a.config,k,l,a.inclusionKey,a.modelKey)];case 2:return n.sent(),[2,k]}})})};k.prototype._attachExternalModelInfoByName=function(a,c,b){return __awaiter(this,void 0,void 0,
function(){var f,e,k,l,n,m,p,x,y,A,B=this;return __generator(this,function(q){switch(q.label){case 0:f=new g.ScKeyRemapper;e=this._lazyAttachInvisibly(c,a.config);k=c.getMeasurementUnit();q=g.getNetMatrix(c);if(0>=k||!B._assemblyTree.getAutomaticMeasurementUnitScaling())l=q;else{var r=b.getAttachContext().getParent();null===r?r=SC.UnspecifiedMeasurementUnit:(r=r.getParent(),r=null===r?SC.UnspecifiedMeasurementUnit:r.getMeasurementUnit());r=r===SC.UnspecifiedMeasurementUnit?1:k/r;l=1===r?q:d.Matrix.multiply(q,
(new d.Matrix).setScaleComponent(r,r,r))}n={bounding:a.bounding,parent:c,directlyRequested:!1};if(!this._isScsSession)return[3,2];this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.attachByNamedScsBuffer(this._assemblyTree,a.modelName,f,a.toAttachData,l,k,e,n)];case 1:return m=q.sent()||0,[3,8];case 2:return q.trys.push([2,7,,8]),[4,a.toAttachData(a.modelName)];case 3:p=q.sent();if(null!==p&&p!==d.EmptyModelName)return[3,4];m=0;return[3,6];case 4:if("string"!==typeof p)throw d.Util.TypeAssert(p),
new d.InternalLogicError;d.Util.TypeAssert(p);this._scAttacher.registerXmlAttachInfo(n);return[4,this._scAttacher.simpleAttach(this._assemblyTree,f,p,l,k,e,n,a.config.allowMissingExternalModels)];case 5:m=q.sent(),q.label=6;case 6:return[3,8];case 7:x=q.sent();if(a.config.allowMissingExternalModels&&x instanceof d.MissingModelError)m=1;else throw x;return[3,8];case 8:if("number"===typeof m){d.Util.TypeAssert(m);y=this._scAttacher.newAttachScope();A=!e.get();a:{r=this._assemblyTree;var w=m,t=A;q=new g.AttachContext(f,
y,t,0,c);switch(w){case 0:break a;case 1:w=new g.InclusionContext(r,q,0,0);q.addInclusionContext(w);r=g.ProductOccurrence.createDynamic(r,w,"Missing",null,null,!t);w.addProductOccurrence(r);break a;default:q=d.Util.TypeAssertNever(w)}}return[2,q]}return[2,this._populateAttachment(a.config,c,f,m,h.AttachType.Indirect,a.reservedNodeIdOffset)]}})})};k.prototype.setPrefetchScsCutoffScale=function(a){this._scAttacher.setPrefetchScsCutoffScale(a)};k.prototype.isIdle=function(){return 0===this._activeLoadCount?
(console.assert(this._scAttacher.isIdle()),!0):!1};k.prototype.waitOnCurrentLoads=function(){return this._loadQueue.waitOnLatest()};k.prototype.cancelPendingLoads=function(){++this._activeLoadGeneration;return this.waitOnCurrentLoads()};k.prototype.cancelActiveAttachmentProcess=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._scAttacher.clearAttachQueues()]})})};k.prototype.loadByStream=function(a,c,b){return b===d.EmptyModelName?(a=new g.LoadContext(c,
d.EmptyModelName,null),Promise.resolve(a)):this._loadBySingleAttach(a,c,Promise.resolve(b),b)};k.prototype.loadByScsBuffer=function(a,c,b){return this._loadBySingleAttach(a,c,Promise.resolve(b),"*SCS Buffer*")};k.prototype.loadByScsFile=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){if(h.FetchApi.isSupported())return[2,this._loadBySingleAttach(a,c,h.FetchApi.request(b),b)];d=h.httpRequestBuffer(b);return[2,this._loadBySingleAttach(a,c,d,b)]})})};
k.prototype.loadByXmlDoc=function(a,c,d,f){d="string"===typeof d?b(d):d;return this._loadByXml(a,c,Promise.resolve(d),f,"*XML Document*")};k.prototype.loadByXmlFile=function(a,c,b,d){var f=e(b);return this._loadByXml(a,c,f,d,b)};k.prototype.attachByExternalModelInfo=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var f,e,k,l,n,h,m;return __generator(this,function(p){switch(p.label){case 0:return g.ExternalModel.isNameInfo(a)?[4,this._attachExternalModelInfoByName(a,c,b)]:[3,2];case 1:return f=
p.sent(),[3,4];case 2:return[4,this._attachExternalModelByInc(a,c)];case 3:f=p.sent(),p.label=4;case 4:e=[];k=f.getChildren();l=0;for(n=k;l<n.length;l++)h=n[l],this._setupRootNode(h,!0),m=this._rectifyLateVisibilityChange(a.config,h),e.push(m);return[4,d.Util.waitForAll(e)];case 5:return p.sent(),[2,f]}})})};k.prototype.loadByAssemblyData=function(a,c,b,d){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,m,p,q,y,A=this;return __generator(this,function(r){e=h.AttachType.Direct;k=b[0];l=b[1];
n=this._scAttacher.newAttachScope();m=!c.isVisible();p=f(n,m,k,l);q=this._initLoad(c,"*Assembly Data*",!1);y=h.LazyPromise.create(function(){return __awaiter(A,void 0,void 0,function(){var c,b,f;return __generator(this,function(h){switch(h.label){case 0:return c=new g.ScKeyRemapper,b=p.getMasterModelKey(),f=new g.AttachContext(c,n,p.attachedInvisibly(),b,q),[4,this._parseRootNode(a,f,d,k,l)];case 1:return h.sent(),[4,this._postProcessAttachContext(q,p,e,f)];case 2:return h.sent(),[4,g.markContextsLoaded([q,
f])];case 3:return h.sent(),f.hasChildren()&&q.addAttachContext(f),[2,{}]}})})});return[2,this._wrap(a,q,y,e)]})})};k.prototype.reset=function(){this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;return this._scAttacher.reset()};k.prototype.notifyDirectRequest=function(a){this._scAttacher.notifyDirectRequest(a)};k.prototype.onLoadChildProductOccurrence=function(){if(0===this._nodesUntilNextSleep)return this._nodesUntilNextSleep=2E3,this._engine.sleep(10);--this._nodesUntilNextSleep};k.prototype.firstAssemblyDataHeader=
function(){return this._firstAssemblyDataHeader};return k}();g.TreeLoader=k})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c){var a=c.getCamera(),b=a.getPosition(),e=a.getTarget();e=d.Point3.subtract(e,b);var g=e.length();1E-7>g&&(g=1E-7);this._eyeDistanceInverse=1/g;e.scale(this._eyeDistanceInverse);c=c.getFullCameraMatrix();this._frustum=h.ConvexVolume.createFrustumFromMatrix(c);this._viewProjectionW=h.col4(c,3);this._cameraIsOrtho=a.getProjection()===d.Projection.Orthographic;this._position=h.toVec3(b);this._eye=h.toVec3(e)}b.prototype.calculateAttachHeuristic=
function(c,a){var b=0;if(this._frustum.axisAlignedBoxNotOutside(a,c))return c=h.squaredNorm3(c),c=h.projectSquaredSize(a,c,this._viewProjectionW),0<c&&(b=h.sub3(a,this._position),a=1/(h.dot3(this._eye,b)*this._eyeDistanceInverse+1E-5),b=h.scale3(1/h.norm3(b),b),b=h.dot3(this._eye,b),a=Math.pow(a,6),this._cameraIsOrtho||(a*=5*Math.pow(b,10)),1E-5>a&&(a=1E-5),b=c*a),console.assert(0<=b),-b-1;b=1/(1+Math.exp(h.norm3(c)));console.assert(0<=b&&1>b);return b};return b}();g.ViewInfo=b})(h.Tree||(h.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(){}b._parseUint_32=function(c){if(!h.isBase10Number(c))return null;c=parseInt(c,10);return 4294967295>=c?c:null};b._parseFloat=function(c){c=parseFloat(c);return isNaN(c)?null:c};b.parseFloat=function(c,a){c=c.getAttribute(a);return null===c?null:this._parseFloat(c)};b._parseScKey=function(c,a){c=c.getAttribute(a);return null===c?null:this._parseUint_32(c)};b.parseDataKey=function(c,a){return this._parseScKey(c,a)};b.parseMeshKey=
function(c,a){return this._parseScKey(c,a)};b.parseInstanceKeyFromInc=function(c,a){c=c.getAttribute(a);if(null===c)return null;c=c.split(" ");return 2!==c.length||null===this._parseUint_32(c[0])?null:this._parseUint_32(c[1])};b.parseNodeId=function(c,a){c=c.getAttribute(a);return null===c?null:this._parseUint_32(c)};b.parseLayerId=function(c,a){c=c.getAttribute(a);return null===c?null:this._parseUint_32(c)};b.parseUint=function(c,a){c=c.getAttribute(a);return null===c?null:this._parseUint_32(c)};
b.parseUints=function(c,a){var b=c.getAttribute(a);if(null===b)return null;c=[];a=0;for(b=b.match(/[0-9]+/g)||[];a<b.length;a++){var d=this._parseUint_32(b[a]);if(null===d)return null;c.push(d)}return c};b.parseFloats=function(c,a){var b=c.getAttribute(a);if(null===b)return null;c=[];a=0;for(b=b.match(/\S+/g)||[];a<b.length;a++){var d=this._parseFloat(b[a]);if(null===d)return null;c.push(d)}return c};b.parseNodeIds=function(c,a){return this.parseUints(c,a)};b._parsePoint3=function(c,a){c=c.getAttribute(a);
if(null===c)return null;c=c.split(" ");if(3!==c.length)return null;a=[];for(var b=0;b<c.length;b++){var e=Number(c[b]);if(isNaN(e))return null;a.push(e)}return new d.Point3(a[0],a[1],a[2])};b.parseBounding=function(c,a){c=c.getElementsByTagName(a);if(1!==c.length)return null;a=c[0];c=this._parsePoint3(a,"Min");if(null===c)return null;a=this._parsePoint3(a,"Max");return null===a?null:new d.Box(c,a)};return b}();g.XmlParser=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){(function(g){function b(c,a){var b="number"===typeof c;return b===("number"===typeof a)?c<a?-1:c>a?1:0:b?-1:1}var e=function(){function c(){console.assert(!1)}c.parseXml=function(a,c){var b=g.XmlParser.parseNodeId(c,"Id");null===b&&(console.assert(!1),b=a.generateDynamicNodeId());a=c.getAttribute("Name");for(var d=null,f=[],e=c.firstElementChild;null!==e;){if("Transformation"===e.localName)console.assert(null===d),d=g.Transform.parseXml(e),d.isIdentity()&&(d=null);else if("Attributes"===e.localName)for(var h=
e.firstElementChild;null!==h;){console.assert("Attr"===h.localName);var q=g.Attribute.parseXml(h);f.push(q);h=h.nextElementSibling}e=e.nextElementSibling}e=c.getAttribute("ExchangeId");c=g.XmlParser.parseLayerId(c,"LayerId");return{nodeId:b,bits:1073741824,name:a,localTransform:d,attributes:f,header:g.AssemblyDataHeader.dynamic,exchangeId:e,layerId:c,genericTypeId:null,genericId:null,userDatas:null}};c.parseBinary=function(a,c,b){b.hasBits1(1)?a=c.parseNodeId():(console.assert(!1),a=a.generateDynamicNodeId());
var d=b.hasBits1(2)?c.parseCString():null,f=1073741824;if(b.hasBits1(4)){var e=c.parseVisibility();e.shown||(f&=-1073741825);e.removed&&(f|=536870912)}e=null;b.hasBits1(8)&&(e=g.Transform.parseBinary(c),e.isIdentity()&&(e=null));var k=null;b.hasBits1(256)&&(k=c.parseDataKey());var h=b.hasBits1(33554432)?c.parseCString():null,r=b.hasBits1(67108864)?c.parseLayerId():null,w=null;b.hasBits2(16)&&(w=c.parseGenericTypeId());var t=null;b.hasBits2(32)&&(t=c.parseGenericId());var u=null;if(b.hasBits1(536870912)){u=
new Map;b=c.parseCount_32();for(var v=0;v<b;++v){var z=c.parseUserDataIndex(),x=c.parseCount_32();x=c.parseBytes(x);u.set(z,x)}}return{nodeId:a,bits:f,name:d,localTransform:e,attributes:null!==k?k:[],header:c.getHeader(),exchangeId:h,layerId:r,genericTypeId:w,genericId:t,userDatas:u}};return c}();g.Node=e;e=function(){function c(a,b,e){this._bits=0;this._nodeId=e.nodeId;this._bits=e.bits;null!==e.name&&(this._name=e.name);null!==e.localTransform&&(this._localTransform=e.localTransform.copy());"number"===
typeof e.attributes?this._lazyAttributes=c._lazyLoadAttributes(a,b,e.attributes,e.header):0<e.attributes.length&&(this._lazyAttributes=h.LazyPromise.create(e.attributes));null!==e.exchangeId&&(this._exchangeId=e.exchangeId);null!==e.layerId&&(this._layerId=e.layerId);null!==e.genericTypeId&&(this._genericTypeId=e.genericTypeId);null!==e.genericId&&(this._genericId=e.genericId);null!==e.userDatas&&(this._userDatas=d.Util.copyMap(e.userDatas))}c._lazyLoadAttributes=function(a,c,b,d){var f=this;return h.LazyPromise.create(function(){return __awaiter(f,
void 0,void 0,function(){var f,e,k,l,n,h;return __generator(this,function(m){switch(m.label){case 0:return f=a.getAbstractScEngine(),[4,a.enqueue(function(){return f.safeGetMetaData(c,b)})];case 1:e=m.sent();k=[];if(null!==e)for(l=new g.AssemblyData(d,e),n=new g.AssemblyDataParser(l);n.hasNext();)h=g.Attribute.parseBinary(n),k.push(h);return[2,k]}})})})};c.prototype.hasAuthoredId=function(){return g.isAuthoredId(this._nodeId)};c.prototype.getAuthoredId=function(){return g.getAuthoredId(this._nodeId)};
c.prototype.getName=function(){return void 0!==this._name?this._name:null};c.prototype.getExchangeId=function(){return void 0!==this._exchangeId?this._exchangeId:null};c.prototype.getAuthoredLayerId=function(){return void 0!==this._layerId?this._layerId:null};c.prototype.getGenericTypeId=function(){return void 0!==this._genericTypeId?this._genericTypeId:null};c.prototype.getGenericId=function(){return void 0!==this._genericId?this._genericId:null};c.prototype._hasBits=function(a){return h.hasBits(this._bits,
a)};c.prototype.isLoaded=function(){return this._hasBits(-2147483648)};c.prototype.markLoaded=function(){this._bits|=-2147483648};c.prototype._setVisibility=function(a){this._bits|=524288;this._bits=a?this._bits|262144:this._bits&-262145};c.prototype.isVisible=function(){return this._hasBits(524288)?this._hasBits(262144):this.isInitiallyShown()};c.prototype.isInitiallyShown=function(){return this._hasBits(536870912)?!1:this._hasBits(1073741824)};c.prototype.setLocalTransformAsInitial=function(a){this._localTransform=
a.copy()};c.prototype.overrideLocalTransform=function(a){this._localTransformOverride=a.copy()};c.prototype.hasLocalTransformOverride=function(){return void 0!==this._localTransformOverride};c.prototype.removeLocalTransformOverride=function(){console.assert(void 0!==this._localTransformOverride);delete this._localTransformOverride};c.prototype.getLocalTransform=function(){return void 0!==this._localTransformOverride?this._localTransformOverride:void 0!==this._localTransform?this._localTransform:null};
c.prototype.getAttributes=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){return void 0!==this._lazyAttributes?[2,this._lazyAttributes.then(function(c){if(void 0!==a._lazyAttributes){for(var b=0;b<c.length;b++)a.addAttribute(c[b]);delete a._lazyAttributes}return a.getAttributes()})]:[2,h.TerseArray.toArray(this._attributes)]})})};c.prototype.addAttribute=function(a){this._attributes=h.TerseArray.push(this._attributes,a)};c.prototype.getUserDataIndices=
function(){var a=[];void 0!==this._userDatas&&this._userDatas.forEach(function(c,b){a.push(b)});return a.sort(b)};c.prototype.getUserData=function(a){if(void 0!==this._userDatas){var c=this._userDatas.get(a);if(void 0!==c)return c}throw new d.InvalidIndexError(a);};return c}();g.NodeMixin=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(a){function c(c,b,d,f){b=a.call(this,c,b,f.nodeInfo)||this;b._bits|=f.bits;b._parent=d;b._instanceInc=[f.inclusionKey,f.instanceKey];d=b.getAuthoredLayerId();null!==d&&c.registerNodeInLayer(b,d);null===d||b.isOutOfHierarchy()||c.registerTreeNodeInLayer(b,d);return b}__extends(c,a);c.prototype.setRequested=function(){this._bits|=1024};c.prototype.isRequested=function(){return this._hasBits(1024)};c.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};
c.prototype.preventFromResetting=function(){return this._hasBits(16384)};c.prototype.getInstanceInc=function(){return this._instanceInc};c.prototype.getParent=function(){return this._parent};return c}(g.NodeMixin);g.BodyMixin=b;var e=function(a){function c(c,b,d,f){b=a.call(this,c,b,d,f)||this;c.registerBodyInstance(b);return b}__extends(c,a);c.parseXml=function(a,c,b){a=g.Node.parseXml(a,c);c=g.XmlParser.parseInstanceKeyFromInc(c,"MeshInstanceKey");if(null===c)throw new d.XmlParseError('Expected "MeshInstanceKey" attribute.');
return{nodeInfo:a,inclusionKey:b,instanceKey:c,bits:0}};c.parseBinary=function(a,c,b){var f=g.towardAttachContext(c),e=f.getRemapper(),k=f.getMasterModelKey();f=b.parseNodeParseBits();a=g.Node.parseBinary(a,b,f);c=f.hasBits1(131072)?b.parseInclusionKey(e,k):c.getInclusionKey();if(!f.hasBits1(262144))throw new d.AssemblyDataParseError('Expected "ScInstanceKey" in binary data.');b=b.parseInstanceKey();return{nodeInfo:a,inclusionKey:c,instanceKey:b,bits:0}};c.reify=function(a,b,d,f){var e=g.towardAttachContext(d);
a=new c(a,b,d,f);e.attachedInvisibly()&&a.setVisibility(!1);return a};c.createDynamic=function(a,b,d,f,e,h,r){var k=g.towardInclusionContext(h),l=g.towardAttachContext(k).getMasterModelKey();b={nodeInfo:{nodeId:a.massageAuthoredUserId(k,f),bits:1073741824,name:e,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:b,instanceKey:d,bits:r};return new c(a,l,h,b)};c.prototype.getName=function(){var c=
a.prototype.getName.call(this);if(null!==c)return c;c=this.getParent().getBodyInstances();if(1<c.length){for(var b=0;b<c.length;++b)if(this===c[b])return"body "+(b+1);console.assert(!1)}return"body"};c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().markBranchVisibilityDirty();this._setVisibility(a)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(b);g.BodyInstance=e;var c=function(a){function c(c,b,d,f){b=a.call(this,c,b,d,f)||this;
c.registerPmiBody(b);return b}__extends(c,a);c.parseBinary=function(a,c,b,d){a=e.parseBinary(a,c,b);d&&(d=a.nodeInfo,d=__assign({},d,{bits:d.bits&-1073741825}),a=__assign({},a,{nodeInfo:d}));return a};c.reify=function(a,b,d,f){var e=g.towardAttachContext(d);a=new c(a,b,d,f);e.attachedInvisibly()&&a.setVisibility(!1);return a};c.prototype.getName=function(){var a=this.getName();return null!==a?a:"PMI body"};c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();
this._setVisibility(a)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(b);g.PmiBody=c;b=function(a){function c(c,b,d,f){b=a.call(this,c,b,d,f)||this;b._bits&=-1073741825;c.registerViewFrame(b);return b}__extends(c,a);c.parseXml=function(a,c,b){return e.parseXml(a,c,b)};c.parseBinary=function(a,c,b){return e.parseBinary(a,c,b)};c.reify=function(a,b,d,f){var e=g.towardAttachContext(d);a=new c(a,b,d,f);e.attachedInvisibly()&&a.setVisibility(!1);return a};c.prototype.getName=
function(){var a=this.getName();return null!==a?a:"CAD View frame"};c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(a)};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};return c}(b);g.ViewFrame=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a,c){var b=new h.PromiseQueue(1,!0);b.push(function(){return a.clear()});for(var d=function(c){b.push(function(){return a.addPlane(c,null)})},f=0;f<c.length;f++)d(c[f]);return b.waitForIdle()}function e(a,c){c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),a.push(c))}var c=function(a){function c(b,f,e,m,p){var k=this,l=g.towardAttachContext(f).getMasterModelKey();k=a.call(this,b,l,{nodeId:e.nodeId,bits:0,name:e.name,localTransform:null,
attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._parent=p;k._bits|=e.bits;k._activatedCuttingSectionIndex=null;null!==e.camera&&(k._camera={initial:e.camera.copy(),derived:e.camera.copy()});k._instanceMarkupKeysToShow=d.Util.toSet(e.instanceMarkupKeysToShow);c.isAuthoredViewInfo(e,m)?(k._nodesToShow=c._toRuntimeIds(f,e.nodesToShow),k._nodesToHide=c._toRuntimeIds(f,e.nodesToHide),0<e.transformMap.size&&(k._transformMap=
new Map,e.transformMap.forEach(function(a,c){c=f.toRuntimeId(c);k._transformMap.set(c,a.copy())}))):(k._nodesToShow=d.Util.toSet(e.nodesToShow),k._nodesToHide=d.Util.toSet(e.nodesToHide),0<e.transformMap.size&&(k._transformMap=d.Util.copyMap(e.transformMap)));null!==e.viewFrameInfo&&(k._viewFrame=k._loadViewFrame(b,l,e.viewFrameInfo));0<e.cuttingPlanes.length&&(k._cuttingPlanes=h.TerseArray.fromArray(e.cuttingPlanes));b.registerCadView(k);return k}__extends(c,a);c.parseXml=function(a,c,b){var f=0,
e=g.XmlParser.parseNodeId(c,"Id");if(null===e)throw new d.XmlParseError('Expected "Id" attribute.');var k=c.getAttribute("Name");if(null===k)throw new d.XmlParseError('Expected "Name" attribute');var l=function(a,c,b,f){a=a.getAttribute("Enabled");if(null===a)throw new d.XmlParseError("Expected "+b+" attribute");return c=h.setBit(c,f,"1"===a)},n=c.getAttribute("isAnnotationView");f=null===n?h.setBit(f,134217728,!1):h.setBit(f,134217728,"true"===n);var t=n=null,u=[],v=[],z=[],x=new Map,y=[],A=function(a){var c=
g.XmlParser.parseUint(a,"Projection");if(null===c)throw new d.XmlParseError('Expected "Projection" attribute');var b=a.getAttribute("field");if(null===b)throw new d.XmlParseError('Expected "field" attribute');var f=b.split(" ");if(2!==f.length)throw new d.XmlParseError("Expected 2 field values");b=parseFloat(f[0]);f=parseFloat(f[1]);a=a.getAttribute("definition");if(null===a)throw new d.XmlParseError('Expected "definition" attribute');var e=a.split(" ");if(9!==e.length)throw new d.XmlParseError("Expected 9 definition values");
var k=function(a,c){return new d.Point3(parseFloat(a[c]),parseFloat(a[c+1]),parseFloat(a[c+2]))};a=k(e,0);var l=k(e,3);e=k(e,6);return d.Camera.create(a,l,e,c,b,f)},B=function(a){var c=[];if(null===g.XmlParser.parseUint(a,"Count"))throw new d.XmlParseError('Expected "PMIToShow Count" attribute');a=g.XmlParser.parseNodeIds(a,"IDs");if(null===a)throw new d.XmlParseError('Expected "PMIToShow Ids" attribute');for(var b=0;b<a.length;b+=2)c.push(a[b+1]);return c},D=function(a){var c=[],b=g.XmlParser.parseUint(a,
"Count");if(null===b)throw new d.XmlParseError('Expected "ClipPlanes Count" attribute');a=g.XmlParser.parseFloats(a,"Plane");if(null===a)throw new d.XmlParseError('Expected "Plane" attribute');if(a.length/4!==b)throw new d.XmlParseError("Expected "+b+" Planes");for(b=0;b<a.length;b+=4)c.push(d.Plane.createFromCoefficients(a[b],a[b+1],a[b+2],a[b+3]));return c},C=function(a){var c=new Map,b=g.XmlParser.parseUint(a,"Count");if(null===b)throw new d.XmlParseError('Expected "IDLocalTransform Count" attribute');
a=g.XmlParser.parseFloats(a,"IDTransform");if(null===a)throw new d.XmlParseError('Expected "IDTransform" attribute');if(a.length/13!==b)throw new d.XmlParseError("Expected "+b+" IDTransform values");for(b=0;b<a.length;b+=13){var f=a[b],e=a,k=b,l=new d.Matrix;l.m[1]=e[k+1];l.m[2]=e[k+2];l.m[3]=e[k+3];l.m[4]=e[k+4];l.m[6]=e[k+5];l.m[7]=e[k+6];l.m[8]=e[k+7];l.m[9]=e[k+8];l.m[11]=e[k+9];l.m[12]=e[k+10];l.m[13]=e[k+11];l.m[14]=e[k+12];c.set(f,l)}return c};for(c=c.firstElementChild;null!==c;)"Camera"===
c.localName?(console.assert(null===n),n=A(c)):"Frame"===c.localName?t=g.ViewFrame.parseXml(a,c,b.getInclusionKey()):"PMIToShow"===c.localName?u=B(c):"InstanceToShow"===c.localName?v=g.XmlParser.parseNodeIds(c,"IDs"):"InstanceToHide"===c.localName?z=g.XmlParser.parseNodeIds(c,"IDs"):"ClipPlanes"===c.localName?y=D(c):"IDLocalTransform"===c.localName?x=C(c):"IsCameraSet"===c.localName?f=l(c,f,"IsCameraSet",67108864):"IsPMIFilteringSet"===c.localName?f=l(c,f,"IsPMIFilteringSet",33554432):"IsGeomFilteringSet"===
c.localName?f=l(c,f,"IsGeomFilteringSet",16777216):"IsCrosssectionSet"===c.localName?f=l(c,f,"IsCrosssectionSet",8388608):"IsExplosionSet"===c.localName?f=l(c,f,"IsExplosionSet",4194304):"IsCombineState"===c.localName&&(f=l(c,f,"IsCombineState",2097152)),c=c.nextElementSibling;return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:u,viewFrameInfo:t,nodesToShow:null===v?[]:v,nodesToHide:null===z?[]:z,transformMap:x,cuttingPlanes:y,bits:f}};c.parseBinary=function(a,c,b){var f=b.parseViewParseBits(),
e=b.parseNodeId(),k=null;h.hasBits(f,1)&&(k=b.parseCString());var l=0,n=!1;h.hasBits(f,256)?(n=!0,k+=" # Annotation View"):null!==k&&0<=k.indexOf("# Annotation View")&&(n=!0);n&&(l|=134217728);h.hasBits(f,1024)||(l|=33554432);h.hasBits(f,2048)||(l|=16777216);h.hasBits(f,4096)||(l|=8388608);h.hasBits(f,8192)||(l|=4194304);h.hasBits(f,16384)&&(l|=2097152);var t=h.hasBits(f,32768);t&&(l|=1048576);n=null;if(h.hasBits(f,2)){t=t?d.Projection.Perspective:d.Projection.Orthographic;var u=b.parsePoint3_32(),
v=b.parsePoint3_32(),z=b.parsePoint3_32(),x=b.parseFloat_32(),y=b.parseFloat_32();!h.hasBits(f,512)&&(l|=67108864,n=d.Camera.create(u,v,z,t,x,y),0>x||0>y)&&(l|=8192)}t=[];if(h.hasBits(f,4))for(v=b.parseCount_32(),u=0;u<v;++u)z=b.parseInstanceKey(),t.push(z);v=null;h.hasBits(f,8)&&(v=g.ViewFrame.parseBinary(a,c,b));a=[];if(h.hasBits(f,16))for(c=b.parseCount_32(),u=0;u<c;++u)z=b.parseNodeId(),a.push(z);c=[];if(h.hasBits(f,32))for(z=b.parseCount_32(),u=0;u<z;++u)x=b.parseNodeId(),c.push(x);z=new Map;
if(h.hasBits(f,64))for(x=b.parseCount_32(),u=0;u<x;++u){y=b.parseNodeId();var A=g.Transform.parseBinary(b);z.set(y,A)}x=[];if(h.hasBits(f,128))for(f=b.parseCount_32(),u=0;u<f;++u)y=b.parsePlane3_32(),x.push(y);return{nodeId:e,name:k,camera:n,instanceMarkupKeysToShow:t,viewFrameInfo:v,nodesToShow:a,nodesToHide:c,transformMap:z,cuttingPlanes:x,bits:l}};c.reify=function(a,b,d,f){var e=g.towardAttachContext(b);a=new c(a,b,d,0,f);e.attachedInvisibly()&&a.setVisibility(!1);return a};c.createDynamic=function(a,
b,d,f,e,h,r,w,t){for(var k=g.towardInclusionContext(b),l=a.generateDynamicNodeId(),n=[],m=0;m<e.length;m++)for(var p=0,q=e[m].getPmiBodies();p<q.length;p++){var B=q[p],D=g.towardInclusionContext(B);console.assert(k===D);B=B.getInstanceInc()[1];n.push(B)}return new c(a,k,{nodeId:l,name:d,camera:f,instanceMarkupKeysToShow:n,viewFrameInfo:null,nodesToShow:h,nodesToHide:r,transformMap:w,cuttingPlanes:null!==t?[t]:[],bits:67108864},1,b)};c.isAuthoredViewInfo=function(a,c){return 0===c};c._toRuntimeIds=
function(a,c){for(var b=new Set,d=0;d<c.length;d++){var f=a.toRuntimeId(c[d]);b.add(f)}return b};c.prototype._loadViewFrame=function(a,c,b){return g.ViewFrame.reify(a,c,this,b)};c.prototype.getViewFrame=function(){return void 0!==this._viewFrame?this._viewFrame:null};c.prototype.getParent=function(){return this._parent};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};c.prototype.getBranchVisibility=function(){var a=this.isVisible()?2:1;void 0===this._viewFrame||this._viewFrame.isOutOfHierarchy()||
(a|=this._viewFrame.isVisible()?2:1);return a};c.prototype.setVisibility=function(a){this._setVisibility(a)};c.prototype.isPmiFilteringSet=function(){return this._hasBits(33554432)};c.prototype.deactivate=function(a){var c=Promise.resolve();null!==this._activatedCuttingSectionIndex&&(a=a.getCuttingSection(this._activatedCuttingSectionIndex),null!==a&&(c=a.clear()),this._activatedCuttingSectionIndex=null);return c};c.prototype.activate=function(a,c,b,d,f,e,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(k){switch(k.label){case 0:return console.assert(null===this._activatedCuttingSectionIndex),[4,this._activateView(a,c,b,d,g)];case 1:return k.sent(),[2,this._activateCamera(a,c,f,e)]}})})};c.prototype._activateView=function(a,c,f,m,p){return __awaiter(this,void 0,void 0,function(){var k,l,n,t,u,v,z,x,y,A,B,D=this;return __generator(this,function(q){switch(q.label){case 0:return k=a.getRootNode(),null!==p&&console.assert(p.isAConfigurationNode()),l=0,n=new Map,t=[],u=[],v=e,void 0!==this._transformMap&&
(v=function(a,c){var b=D._transformMap,d=c.getRuntimeId();b=b.get(d);void 0!==b?(c.overrideLocalTransform(b),a.push(c)):c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),a.push(c))}),z={enterProductOccurrence:function(a){(p===a||0<l)&&++l;var c=a.forEachPmi(function(a){var c=a.getPmiBodies();if(0!==c.length){var b=!0;if(D.isPmiFilteringSet()){b=!1;for(var d=0;d<c.length;d++){var f=c[d];f=f.getInstanceInc()[1];if(D._instanceMarkupKeysToShow.has(f)){b=!0;break}}}null!==p&&(b=b&&0<l);
n.set(a,b);for(a=0;a<c.length;a++)f=c[a],n.set(f,b)}}).then(function(){var c=a.getRuntimeId();D._nodesToHide.has(c)||a.isADrawingSheetNode()?n.set(a,!1):D._nodesToShow.has(c)&&(null!==p?n.set(a,0<l):n.set(a,!0));v(t,a);return a.forEachCadView(function(a){if(void 0!==a._viewFrame){var c=a===D;null!==p&&(c=c&&0<l);n.set(a,c);n.set(a._viewFrame,c)}})});u.push(c)},leaveProductOccurrence:function(){0<l&&--l},enterAnyBody:function(a){v(t,a);for(var c=null,b=a.getParent();null!==b&&null===c&&!(b instanceof
g.Pmi);){var d=b.getRuntimeId();D._nodesToHide.has(d)?(c=!1,n.set(b,!1)):D._nodesToShow.has(d)&&(c=!0,n.set(b,!0));b=g.towardContainerNode(b.getParent())}null===c&&(d=a.getRuntimeId(),D._nodesToShow.has(d)?n.set(a,!0):D._nodesToHide.has(d)&&n.set(a,!1));null!==p&&0===l&&n.set(a,!1)}},[4,g.WalkerAsync.walk(z,k,g.WalkRestriction.None)];case 1:return q.sent(),[4,Promise.all(u)];case 2:return q.sent(),x=[],y=g.updateVisibilities(a,c,f,k,n,!0,!1,null,d.TreeWalkMode.Default),x.push(y),y=g.updateScMatrices(c,
f,t,!1),x.push(y),[4,d.Util.waitForAll(x)];case 3:q.sent();A=h.TerseArray.toArray(this._cuttingPlanes);if(!(0<A.length))return[3,5];B=m.getCuttingSection(4);if(null===B)return[3,5];this._activatedCuttingSectionIndex=4;return[4,b(B,A)];case 4:return q.sent(),[2,B.activate()];case 5:return[2]}})})};c.prototype._activateCamera=function(a,c,b,f){return __awaiter(this,void 0,void 0,function(){var e,k,l,n,h,m,v,z,x,y,A,B,D,C,F,E,H,G,I,K,J,L,M,N,R,O,P,S,Q,T,U,V,W,X;return __generator(this,function(p){switch(p.label){case 0:return e=
this._camera,void 0!==e?[3,3]:a.disableAutomaticFitWorld()?[3,2]:[4,b.fitWorld(f)];case 1:p.sent(),p.label=2;case 2:return[2];case 3:k=g.towardAttachRoot(this);l=g.towardAttachContext(k);n=g.towardProductOccurrence(l);h=g.getNetMatrix(l);null!==n&&(m=k.getMeasurementUnit(),v=n.getMeasurementUnit(),m!==v&&(z=m/v,x=new d.Matrix,x.setScaleComponent(z,z,z),h=d.Matrix.multiply(x,h)));e.derived=e.initial.transform(h);if(!this._hasBits(8192))return[3,8];y=!1;return void 0===this._viewFrame?[3,5]:[4,g.getBoundingByNodeId(a,
c,[this._viewFrame.getRuntimeId()],7,!1,y)];case 4:return B=p.sent(),[3,7];case 5:return[4,c.getModelBounding(!0,!1,y)];case 6:B=p.sent(),p.label=7;case 7:return A=B,D=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition()),C=A.extents().length(),F=D.copy().normalize().scale(C),E=A.center(),H=d.Point3.subtract(E,F),e.derived.setPosition(H),e.derived.setTarget(E),e.derived.setWidth(C),e.derived.setHeight(C),[2,b._setCameraPromise(e.derived,f)];case 8:if(e.derived.getProjection()!==d.Projection.Orthographic)return[3,
10];G=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());return[4,c.getModelBounding(!0,!1,!1)];case 9:return A=p.sent(),I=d.Point3.subtract(A.center(),e.derived.getPosition()),K=1/G.length(),J=K*d.Point3.dot(G,I),0<J&&(G.scale(K),L=Math.max(e.derived.getWidth(),e.derived.getHeight()),M=d.Point3.add(e.derived.getPosition(),d.Point3.scale(G,J)),N=d.Point3.subtract(M,d.Point3.scale(G,2.5*L)),e.derived.setPosition(N),e.derived.setTarget(M)),[2,b._setCameraPromise(e.derived,f)];case 10:if(e.derived.getProjection()!==
d.Projection.Perspective)return[3,12];R=.01;return[4,c.getModelBounding(!0,!1,!1)];case 11:A=p.sent();O=d.Point3.subtract(A.max,A.min).length();G=d.Point3.subtract(e.derived.getTarget(),e.derived.getPosition());P=G.length();S=P/O;if(0===O||S>R)return[2,b._setCameraPromise(e.derived,f)];Q=O*R*1.001;T=e.derived.getWidth()/P;U=e.derived.getHeight()/P;V=T*Q;W=U*Q;X=G.copy().normalize().scale(Q);E=d.Point3.add(e.derived.getPosition(),X);e.derived.setTarget(E);e.derived.setWidth(V);e.derived.setHeight(W);
return[2,b._setCameraPromise(e.derived,f)];case 12:return[2,b._setCameraPromise(e.derived,f)]}})})};c.prototype.hasPmi=function(a){var c=g.towardInclusionContext(this).getInclusionKey(),b=g.towardInclusionContext(a).getInclusionKey();if(c!==b)return!1;c=0;for(a=a.getPmiBodies();c<a.length;c++)if(b=a[c].getInstanceInc()[1],this._instanceMarkupKeysToShow.has(b))return!0;return!1};c.prototype.isAnnotationView=function(){return this._hasBits(134217728)};c.prototype.setViewFrame=function(a){console.assert(void 0===
this._viewFrame);this._viewFrame=a};return c}(g.NodeMixin);g.CadView=c})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(b){function c(a,c,e,g){var f=b.call(this,a,e,g.nodeInfo)||this;f._inclusionContextForNodeId=c;f._modelKey=e;0<g.repItemInfos.length&&(c=f._loadRepresentationItems(a,e,g.repItemInfos),f._repItems=d.TerseArray.fromArray(c));a.registerPartDefinition(f);return f}__extends(c,b);c.parseXml=function(a,c){var b=g.Node.parseXml(a,c);if(null===b.name){var d=c.getAttribute("FilePath");null!==d&&(b=__assign({},b,{name:d}))}d=[];for(c=c.firstElementChild;null!==
c;){if("Body"===c.localName){var f=g.RepresentationItem.parseXml(a,c);d.push(f)}c=c.nextElementSibling}return{nodeInfo:b,repItemInfos:d}};c.parseBinary=function(a,c){var b=c.parseNodeParseBits(),d=g.Node.parseBinary(a,c,b),f=[];if(b.hasBits1(1024)){b=c.parseCount_32();for(var e=0;e<b;++e){var h=g.RepresentationItem.parseBinary(a,c);f.push(h)}}return{nodeInfo:d,repItemInfos:f}};c.reify=function(a,b,d,e){return new c(a,b,d,e)};c.createDynamic=function(a,b,d){var f=a.getRootNode();f=g.towardInclusionContext(f);
b={nodeInfo:{nodeId:a.massageAuthoredUserId(f,b),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},repItemInfos:[]};return new c(a,f,0,b)};c.createMissing=function(a){a=this.createDynamic(a,null,null);a._bits|=4096;return a};c.prototype.isMissing=function(){return this._hasBits(4096)};c.prototype._loadRepresentationItems=function(a,c,b){for(var d=[],f=0;f<b.length;f++){var e=g.RepresentationItem.reify(a,
c,b[f],this);this._addRepresentationItem(e);d.push(e)}return d};c.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this._inclusionContextForNodeId)};c.prototype.getInclusionContextForNodeId=function(){return this._inclusionContextForNodeId};c.prototype.addReferrer=function(a){var c=g.towardLoadContext(a),b=g.towardLoadContext(this._inclusionContextForNodeId);console.assert(c===b);this._referrers=d.TerseArray.push(this._referrers,a)};c.prototype.createRepItem=function(a,c){a=g.RepresentationItem.createDynamic(a,
c,null,this._modelKey,this);this._addRepresentationItem(a);return a};c.prototype._addRepresentationItem=function(a){this._repItems=d.TerseArray.push(this._repItems,a)};c.prototype.getRepresentationItems=function(){return d.TerseArray.toArray(this._repItems)};c.prototype.getReferrers=function(){return d.TerseArray.toArray(this._referrers)};c.prototype.removeAllReferrers=function(){for(var a=0,c=this.getReferrers();a<c.length;a++){var b=c[a].removePartDefinition();console.assert(this===b)}delete this._referrers};
c.prototype.getModelKey=function(){return this._modelKey};return c}(g.NodeMixin);g.PartDefinition=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(c){c[c.Unknown=0]="Unknown";c[c.Text=1]="Text";c[c.Dimension=2]="Dimension";c[c.Arrow=3]="Arrow";c[c.Balloon=4]="Balloon";c[c.CircleCenter=5]="CircleCenter";c[c.Coordinate=6]="Coordinate";c[c.Datum=7]="Datum";c[c.Fastener=8]="Fastener";c[c.Gdt=9]="Gdt";c[c.Locator=10]="Locator";c[c.MeasurementPoint=11]="MeasurementPoint";c[c.Roughness=12]="Roughness";c[c.Welding=13]="Welding";c[c.Table=14]="Table";c[c.Other=15]="Other";c[c.GeometricalTolerance=16]=
"GeometricalTolerance"})(g.PmiType||(g.PmiType={}));(function(c){c[c.Ident=1]="Ident";c[c.Target=2]="Target"})(g.PmiSubTypeDatum||(g.PmiSubTypeDatum={}));(function(c){c[c.Distance=1]="Distance";c[c.DistanceOffset=2]="DistanceOffset";c[c.DistanceCumulate=3]="DistanceCumulate";c[c.Chamfer=4]="Chamfer";c[c.Slope=5]="Slope";c[c.Ordinate=6]="Ordinate";c[c.Radius=7]="Radius";c[c.RadiusTangent=8]="RadiusTangent";c[c.RadiusCylinder=9]="RadiusCylinder";c[c.RadiusEdge=10]="RadiusEdge";c[c.Diameter=11]="Diameter";
c[c.DiameterTangent=12]="DiameterTangent";c[c.DiameterCylinder=13]="DiameterCylinder";c[c.DiameterEdge=14]="DiameterEdge";c[c.DiameterCone=15]="DiameterCone";c[c.Length=16]="Length";c[c.LengthCurvilinear=17]="LengthCurvilinear";c[c.LengthCircular=18]="LengthCircular";c[c.Angle=19]="Angle"})(g.PmiSubTypeDimension||(g.PmiSubTypeDimension={}));(function(c){c[c.Fcf=1]="Fcf"})(g.PmiSubTypeGdt||(g.PmiSubTypeGdt={}));(function(c){c[c.Line=1]="Line";c[c.Spot=2]="Spot"})(g.PmiSubTypeWelding||(g.PmiSubTypeWelding=
{}));(function(c){c[c.SymbolUser=1]="SymbolUser";c[c.SymbolUtility=2]="SymbolUtility";c[c.SymbolCustom=3]="SymbolCustom";c[c.GeometricReference=4]="GeometricReference";c[c.Region=5]="Region"})(g.PmiSubTypeOther||(g.PmiSubTypeOther={}));var b=function(){return function(c){this.faceIds=[];this.edgeIds=[];this.body=c}}();g.PmiTopologyReference=b;var e=function(c){function a(b,d,e,n){var f=g.towardAttachContext(d).getMasterModelKey();var k=0;e.initiallyShown&&(k|=1073741824);k=c.call(this,b,f,{nodeId:e.nodeId,
bits:k,name:e.name,localTransform:null,attributes:e.attributesDataKey?e.attributesDataKey:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._bits|=16384;k._parent=n;k._packed=a._pack(e.pmiType,e.pmiSubType);n=0;for(var l=e.pmiBodyInfos;n<l.length;n++)k._pmiBodies=h.TerseArray.push(k._pmiBodies,k._loadPmiBody(b,f,l[n]));0<e.topoRefInfos.length&&(k._topoRefs=a._loadTopoRefs(d,e.topoRefInfos));if(0<e.topoRefs.length)if(void 0===
k._topoRefs)k._topoRefs=e.topoRefs.slice();else for(d=0,e=e.topoRefs;d<e.length;d++)k._topoRefs.push(e[d]);b.registerPmi(k);return k}__extends(a,c);a.parseBinary=function(a,c,b){var d=b.parsePmiParseBits(),f=b.parseNodeId(),e=null;h.hasBits(d,1)&&(e=b.parseCString());var k=null;h.hasBits(d,4)&&(k=b.parseDataKey());var l=1;h.hasBits(d,16)&&(l=b.parseCount_32());for(var w=[],t=h.hasBits(d,8),u=0;u<l;++u){var v=g.PmiBody.parseBinary(a,c,b,t);w.push(v)}a=0<w.length?h.hasBits(w[0].nodeInfo.bits,1073741824):
!1;c=b.parsePmiType();l=b.parsePmiSubType();t=[];if(h.hasBits(d,2))for(d=b.parseCount_32(),u=0;u<d;++u)v=g.ReferenceOnTopology.parseBinary(b),t.push(v);return{nodeId:f,name:e,attributesDataKey:k,pmiBodyInfos:w,initiallyShown:a,pmiType:c,pmiSubType:l,topoRefInfos:t,topoRefs:[]}};a.reify=function(c,b,d,e){var f=g.towardAttachContext(b);c=new a(c,b,d,e);f.attachedInvisibly()&&c.setVisibility(!1);return c};a.createDynamic=function(c,b,d,e,g,h,q,r){e={nodeId:c.generateDynamicNodeId(),name:e,attributesDataKey:null,
pmiBodyInfos:q,initiallyShown:!0,pmiType:g,pmiSubType:h,topoRefInfos:[],topoRefs:r};return new a(c,b,e,d)};a._loadTopoRefs=function(a,c){for(var b=[],d=0;d<c.length;d++){var f=g.ReferenceOnTopology.reify(a,c[d]);b.push(f)}return b};a.prototype._loadPmiBody=function(a,c,b){return g.PmiBody.reify(a,c,this,b)};a.prototype.getPmiBodies=function(){return h.TerseArray.toArray(this._pmiBodies)};a._pack=function(a,c){return a+100*c};a.prototype.getPmiType=function(){return this._packed%100};a.prototype.getPmiSubType=
function(){return Math.floor(this._packed/100)%100};a.prototype.getParent=function(){return this._parent};a.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};a.prototype.getBranchVisibility=function(){for(var a=this.isVisible()?2:1,c=0,b=h.TerseArray.toArray(this._pmiBodies);c<b.length;c++){var d=b[c];d.isOutOfHierarchy()||(a|=d.isVisible()?2:1)}return a};a.prototype.setVisibility=function(a){this._setVisibility(a)};a.prototype.getPmiTopologyReferences=function(a){if(void 0===
this._topoRefs)return[];for(var c=new Map,f=0,e=this._topoRefs;f<e.length;f++){var g=e[f],h=g.getBodyInstanceInc();h=a.lookupAnyBodyByInstanceInc(h[0],h[1]);if(null!==h){var q=c.get(h);void 0===q&&(q=new b(h),c.set(h,q));switch(g.getTopoItemType()){case d.PmiTopoRef.Face:q.faceIds.push(g.getItemIndex());break;case d.PmiTopoRef.Edge:q.edgeIds.push(g.getItemIndex())}}}var r=[];c.forEach(function(a){r.push(a)});return r};return a}(g.NodeMixin);g.Pmi=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(c,a){for(var b=[],e=0;e<c.length;e++){var g=a(c[e]);g&&b.push(g)}return d.Util.waitForAll(b)}var e=function(c){function a(b,e,l,n,m,p,q){var f=this;q=a._amendInfo(n,q);var k=g.towardAttachContext(m),t=k.getMasterModelKey();k=g.towardLoadContext(k);f=c.call(this,n,t,q.nodeInfo)||this;f._parent=p;f._bits=f._bits|q.productBits|32768;var u=q.nodeInfo.header;p=[];null!==q.prototypeDataKey&&(console.assert(null!==l),f._prototypeContext=f._loadPrototypeContext(e,
l,n,m,q.prototypeDataKey,u));console.assert(null===q.quickAccessPartDefinitionDataId||null===q.partDefinition);null!==q.partDefinition?Array.isArray(q.partDefinition)?f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.partDefinition,u):f._partDefinition=f._lazyLoadPartDefinitionByInfo(n,m,q.partDefinition,t):null!==q.quickAccessPartDefinitionDataId&&(f._partDefinition=f._lazyLoadPartDefinitionById(n,m,q.quickAccessPartDefinitionDataId,u));if(0<q.childDataKeys.length){console.assert(null!==l);var v=
function(){return __awaiter(f,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._loadProductOccurrences(e,l,n,m,q.childDataKeys,u)];case 1:return a=c.sent(),this._children=h.TerseArray.fromArray(a),[2]}})})}();p.push(v)}0<q.bodyInstanceInfos.length&&(t=f._loadBodyInstances(n,t,q.bodyInstanceInfos),f._bodyInstances=h.TerseArray.fromArray(t));0<q.cadViewInfos.length&&(t=f._loadCadViews(n,m,q.cadViewInfos),f._cadViews=h.TerseArray.fromArray(t));0<
q.pmiInfos.length&&(t=f._loadPmis(n,m,q.pmiInfos),f._pmis=h.TerseArray.fromArray(t));null!==q.measurementUnit&&(f._measurementUnit=q.measurementUnit);null!==q.externalModelInfo&&(console.assert(null!==b),console.assert(null!==l),g.ExternalModel.canImplicitlyLoad(q.externalModelInfo)?(v=f._loadAndAttachExternalModel(l,m,q.externalModelInfo),p.push(v)):f._pendingExternalModels=h.TerseArray.push(f._pendingExternalModels,q.externalModelInfo));t=0;for(v=q.layerInfos;t<v.length;t++){var z=v[t],x=k.getRuntimeLayerId(z.id);
null===x?n.createLayer(z.id,z.name,k):null!==z.name&&n.updateLayerName(x,z.name)}t=0;for(v=q.filters;t<v.length;t++)n.addFilter(v[t],k);k=f.getAuthoredLayerId();null!==k&&(n.registerNodeInLayer(f,k),f.isOutOfHierarchy()||n.registerTreeNodeInLayer(f,k));n.registerProductOccurrence(f);if(null===b){if(0<p.length)throw new d.InternalLogicError;}else b.resolve(d.Util.waitForAll(p));return f}__extends(a,c);a.parseXml=function(a,c,b,d,e){var f=b.getInclusionKey(),k=g.Node.parseXml(c,d),l=g.XmlParser.parseFloat(d,
"Unit"),h=[],n=[],m=[],v=[],z=null,x=null,y=null;for(d=d.firstElementChild;null!==d;){if("PartDefinition"===d.localName){z=g.PartDefinition.parseXml(c,d);break}else if("BodyInstance"===d.localName){var A=g.BodyInstance.parseXml(c,d,f);h.push(A)}else if("Material"===d.localName)console.assert(null===x),x=g.SimpleMaterial.parseXml(d);else if("ExternalModel"===d.localName){if(console.assert(null===y),A=d.getAttribute("Name"),null!==A){y=g.XmlParser.parseFloat(d,"Unit");var B=g.XmlParser.parseBounding(d,
"BoundingBox");y={config:a,modelName:A,bounding:B,measurementUnit:y,toAttachData:e,reservedNodeIdOffset:0}}}else"CADView"===d.localName?(A=g.CadView.parseXml(c,d,b),v.push(A)):"Filter"===d.localName?n.push(g.Filter.parseXml(d)):"Layer"===d.localName&&(A=g.Layer.parseXml(d),null!==A&&m.push(A));d=d.nextElementSibling}return{nodeInfo:k,productBits:0,childDataKeys:[],prototypeDataKey:null,partDefinition:z,quickAccessPartDefinitionDataId:null,externalModelInfo:y,bodyInstanceInfos:h,cadViewInfos:v,pmiInfos:[],
measurementUnit:l,simpleMaterial:x,layerInfos:m,filters:n}};a.parseBinary=function(a,c,b,d){var f=g.towardAttachContext(b),e=f.getRemapper(),k=d.parseNodeParseBits();if(k.hasBits1(2097152)){var l=d.parseAssemblyDataVersion(2);l}k.hasBits2(8)&&f.setGenericTypeMaps(d.parseGenericTypes());l=g.Node.parseBinary(c,d,k);var h=0;k.hasBits1(4194304)&&(h=d.parseProductBits());var n=[];if(k.hasBits1(16))for(var u=d.parseCount_32(),v=0;v<u;++v){var z=d.parseDataKey();n.push(z)}z=u=null;if(k.hasBits1(32)&&(u=
d.parseDataKey(),k.hasBits1(64))){z=d.parseModelKey(e);console.assert(0!==z);var x=d.parseDataKey();z=[z,x]}x=[];if(k.hasBits1(128)){var y=d.parseCount_32();for(v=0;v<y;++v){var A=g.BodyInstance.parseBinary(c,b,d);x.push(A)}}y=null;k.hasBits1(524288)&&(v=d.parseModelKey(e),console.assert(0!==v),y=d.parseInclusionKey(e,v),y={config:a,inclusionKey:y,modelKey:v});a=null;k.hasBits1(512)&&(v=d.parseModelKey(e),0===v&&(v=f.getMasterModelKey()),a=d.parseDataKey(),a=[v,a]);f=[];if(k.hasBits1(32768))for(e=
d.parseCount_32(),v=0;v<e;++v)A=g.CadView.parseBinary(c,b,d),f.push(A);e=[];if(k.hasBits1(65536))for(A=d.parseCount_32(),v=0;v<A;++v){var B=g.Pmi.parseBinary(c,b,d);e.push(B)}b=null;k.hasBits1(16384)&&(b=d.parseFloat_64());k.hasBits1(16777216)&&(v=d.parsePoint3_64(),A=d.parsePoint3_64(),c.setViewAxes(v,A));c=[];if(k.hasBits1(134217728))for(A=d.parseCount_32(),v=0;v<A;++v)B=g.Layer.parseBinary(d),c.push(B);A=[];if(k.hasBits1(268435456))for(k=d.parseCount_32(),v=0;v<k;++v)B=g.Filter.parseBinary(d),
A.push(B);return{nodeInfo:l,productBits:h,childDataKeys:n,prototypeDataKey:u,partDefinition:a,quickAccessPartDefinitionDataId:z,externalModelInfo:y,bodyInstanceInfos:x,cadViewInfos:f,pmiInfos:e,measurementUnit:b,simpleMaterial:null,layerInfos:c,filters:A}};a.reifySync=function(c,b,d,e,h,p){console.assert(0===h.childDataKeys.length);console.assert(null===h.externalModelInfo);var f=g.towardAttachContext(e);c=new a(null,c,b,d,e,p,h);f.attachedInvisibly()&&c.setVisibility(!1);return c};a.reify=function(c,
b,d,e,g,p){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(l){switch(l.label){case 0:return f=h.OpenPromise.create(),k=new a(f,c,b,d,e,p,g),[4,f];case 1:return l.sent(),[2,k]}})})};a.createDynamic=function(c,b,e,h,m,p,q,r){void 0===q&&(q=!1);void 0===r&&(r=null);var f=g.towardInclusionContext(b);e={nodeInfo:{nodeId:c.massageAuthoredUserId(f,h),bits:p?1073741824:0,name:e,localTransform:m,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,
genericTypeId:null,genericId:null,userDatas:null},productBits:q?268435456:0,childDataKeys:[],prototypeDataKey:null,partDefinition:null,quickAccessPartDefinitionDataId:null,bodyInstanceInfos:[],externalModelInfo:null,cadViewInfos:[],pmiInfos:[],measurementUnit:r,simpleMaterial:null,layerInfos:[],filters:[]};h=new d.LoadSubtreeConfig;h.attachInvisibly=!p;return new a(null,h,null,c,f,b,e)};a.createMissing=function(a,c){a=this.createDynamic(a,c,"Missing",null,null,!1);a._bits|=4096;return a};a.prototype.isMissing=
function(){return this._hasBits(4096)};a._amendInfo=function(a,c){if(null!==c.nodeInfo.name)return c;var b=null;h.hasBits(c.productBits,2)?b=a.generateProductName():h.hasBits(c.productBits,4)?b=a.generateGroupName():h.hasBits(c.productBits,32)?b=a.generateDrawingSheetName():h.hasBits(c.productBits,8)&&(b=a.generateDrawingViewName());if(null===b)return c;a=__assign({},c.nodeInfo,{name:b});return __assign({},c,{nodeInfo:a})};a.prototype._loadExternalModel=function(a,c,b){return __awaiter(this,void 0,
void 0,function(){var d,f;return __generator(this,function(e){if(g.ExternalModel.isNameInfo(b))return[2,a.attachByExternalModelInfo(b,this,c)];d=this.getAuthoredId();f=g.towardLoadContext(c);return f.handleExternalModel(d,c,b.inclusionKey)?[2,a.attachByExternalModelInfo(b,this,c)]:[2,null]})})};a.prototype._loadAndAttachExternalModel=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._loadExternalModel(a,c,
b)];case 1:return d=f.sent(),null!==d&&this.addAttachContext(d),[2,d]}})})};a.prototype.loadPendingExternalModels=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,d,f,e,q,r,w,t,u;return __generator(this,function(k){switch(k.label){case 0:if(!this.hasPendingExternalModels())return[2,[]];c=g.towardInclusionContext(this);b=[];d=0;for(f=h.TerseArray.toArray(this._pendingExternalModels);d<f.length;d++)e=f[d],q=this._loadAndAttachExternalModel(a,c,e),b.push(q);delete this._pendingExternalModels;
r=[];w=0;return[4,Promise.all(b)];case 1:t=k.sent(),k.label=2;case 2:if(!(w<t.length))return[3,4];u=t[w];null!==u&&r.push(u);k.label=3;case 3:return w++,[3,2];case 4:return[2,r]}})})};a.prototype._lazyLoadPartDefinitionByInfo=function(a,c,b,d){a=g.PartDefinition.reify(a,c,d,b);return h.LazyPromise.create(a)};a.prototype._lazyLoadPartDefinitionById=function(a,c,b,d){var f=this,e=a.getAbstractScEngine(),k=g.towardLoadContext(c),l=a.lookupPartDefinitionByDataId(k,b[0],b[1]);if(null!==l)return h.LazyPromise.create(function(){return __awaiter(f,
void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,l];case 1:return a=c.sent(),a.addReferrer(this),[2,a]}})})});l=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,k,l,h,n,m,p;return __generator(this,function(q){switch(q.label){case 0:return f=b[0],k=b[1],[4,a.enqueue(function(){return e.safeGetMetaData(f,k)})];case 1:return l=q.sent(),null!==l?(h=new g.AssemblyData(d,l),n=new g.AssemblyDataParser(h),m=g.PartDefinition.parseBinary(a,
n),p=g.PartDefinition.reify(a,c,f,m),p.addReferrer(this),[2,p]):[2,g.PartDefinition.createMissing(a)]}})})});a.registerPartDefinitionByDataId(k,b[0],b[1],l);return l};a._loadProductOccurrence=function(c,b,d,e,h,p){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(l){f=new g.AssemblyDataParser(h);k=a.parseBinary(c,d,e,f);return[2,a.reify(c,b,d,e,k,p)]})})};a.prototype._loadPrototypeContext=function(c,b,d,e,m,p){var f=this,k=g.towardAttachContext(e),l=g.towardLoadContext(k),
n=k.getMasterModelKey();k=d.lookupPrototypeByDataId(l,n,m);null===k&&(k=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,k,l;return __generator(this,function(h){switch(h.label){case 0:return f=d.getAbstractScEngine(),[4,d.enqueue(function(){return f.safeGetMetaData(n,m)})];case 1:return k=h.sent(),null!==k?(l=new g.AssemblyData(p,k),[2,a._loadProductOccurrence(c,b,d,e,l,u)]):[2,a.createMissing(d,u)]}})})}),k=new g.SharedPrototypeContext(k),d.registerPrototypeByDataId(l,
n,m,k));var u=new g.PrototypeContext(k,e);u.addReferrer(this);return u};a.prototype._loadProductOccurrences=function(c,b,d,e,m,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,u,v,z,x,y,A,B;return __generator(this,function(q){switch(q.label){case 0:return f=g.towardAttachContext(e),l=k=f.getMasterModelKey(),n=d.getAbstractScEngine(),[4,d.enqueue(function(){return n.safeGetMetaDatas(l,m)})];case 1:u=q.sent(),v=[],z=0,q.label=2;case 2:if(!(z<m.length))return[3,9];x=void 0;if(null===u)return[3,
6];y=u[z];u[z]=h.emptyBytes;A=new g.AssemblyData(p,y);return[4,a._loadProductOccurrence(c,b,d,e,A,this)];case 3:return x=q.sent(),(B=b.onLoadChildProductOccurrence())?[4,B]:[3,5];case 4:q.sent(),q.label=5;case 5:return[3,7];case 6:x=a.createMissing(d,this),q.label=7;case 7:v.push(x),q.label=8;case 8:return++z,[3,2];case 9:return[2,v]}})})};a.prototype._loadBodyInstances=function(a,c,b){for(var d=[],f=0;f<b.length;f++){var e=g.BodyInstance.reify(a,c,this,b[f]);d.push(e)}return d};a.prototype._loadCadViews=
function(a,c,b){for(var d=[],f=0;f<b.length;f++){var e=g.CadView.reify(a,c,b[f],this);d.push(e);e.markLoaded()}return d};a.prototype._loadPmis=function(a,c,b){for(var d=[],f=0;f<b.length;f++){var e=g.Pmi.reify(a,c,b[f],this);d.push(e)}return d};a.prototype.getParent=function(){return this._parent};a.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this)};a.prototype.isAbsoluteRoot=function(){return-2===this._nodeId};a.prototype.getPrototype=function(){return void 0!==this._prototypeContext?
this._prototypeContext:null};a.prototype.isAConfigurationNode=function(){return this._hasBits(1)};a.prototype.isADefaultNode=function(){return this._hasBits(16)};a.prototype.isAProductNode=function(){return h.hasBits(this._bits,2)};a.prototype.isAGroupNode=function(){return h.hasBits(this._bits,4)};a.prototype.isADrawingSheetNode=function(){return h.hasBits(this._bits,32)};a.prototype.isADrawingViewNode=function(){return h.hasBits(this._bits,8)};a.prototype.addProductOccurrence=function(a){console.assert(a.getParent()===
this);this._children=h.TerseArray.push(this._children,a);this._itemWasAdded()};a.prototype.addBodyInstance=function(a){console.assert(a.getParent()===this);this._bodyInstances=h.TerseArray.push(this._bodyInstances,a);this._itemWasAdded()};a.prototype.addCadView=function(a){console.assert(a.getParent()===this);this._cadViews=h.TerseArray.push(this._cadViews,a);this._itemWasAdded()};a.prototype.addPmi=function(a){console.assert(a.getParent()===this);this._pmis=h.TerseArray.push(this._pmis,a);this._itemWasAdded()};
a.prototype.addLoadContext=function(a){console.assert(a.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,a);this._itemWasAdded()};a.prototype.addAttachContext=function(a){console.assert(a.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,a);this._itemWasAdded()};a.prototype._followPrototypesWhileEmpty=function(){if(void 0===this._prototypeContext||void 0!==this._children||void 0!==this._childContexts)return this;var a=this._prototypeContext.getProductOccurrence();
return a.isResolved()?a.getResolved()._followPrototypesWhileEmpty():this};a.prototype.getRawPartDefinition=function(){if(void 0!==this._partDefinition)return this._partDefinition;if(void 0!==this._prototypeContext){var a=this._prototypeContext.getProductOccurrence();if(a.isResolved())return a.getResolved().getRawPartDefinition()}return null};a.prototype.getPartDefinition=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){a=this.getRawPartDefinition();
if(a instanceof h.LazyPromise)return[2,h.Boxed.create(a)];if(a instanceof Promise)return[2,a];d.Util.TypeAssert(a);return[2,null]})})};a.prototype.getPartDefinitionSync=function(){console.assert(this.isLoaded());if(void 0!==this._partDefinition&&this._partDefinition.isResolved())return this._partDefinition.getResolved();if(void 0!==this._prototypeContext){var a=this._prototypeContext.getProductOccurrence();if(a.isResolved())return a.getResolved().getPartDefinitionSync()}return null};a.prototype._getChildren=
function(){for(var a=h.TerseArray.toArray(this._children),c=0,b=h.TerseArray.toArray(this._childContexts);c<b.length;c++){var d=b[c].getChildren();h.append(a,d)}return a};a.prototype.getChildren=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._followPrototypesWhileEmpty()];case 1:return a=c.sent(),[2,a._getChildren()]}})})};a.prototype.getChildrenSync=function(){console.assert(this.isLoaded());var a=this.tryGetChildrenSync();
if(null===a)throw new d.InternalLogicError;return a};a.prototype.tryGetChildrenSync=function(){var a=this._followPrototypesWhileEmpty();return a instanceof Promise?null:a._getChildren()};a.prototype.forEachChild=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this.getChildren()];case 1:return c=d.sent(),[2,b(c,a)]}})})};a.prototype.forEachBodyInstance=function(a){var c=this.getBodyInstances();return b(c,a)};a.prototype.forEachPmi=
function(a){var c=this.getPmis();return b(c,a)};a.prototype.forEachCadView=function(a){var c=this.getCadViews();return b(c,a)};a.prototype.hasBodyInstances=function(){return void 0!==this._bodyInstances};a.prototype.getBodyInstances=function(){return h.TerseArray.toArray(this._bodyInstances)};a.prototype.getCadViews=function(){return h.TerseArray.toArray(this._cadViews)};a.prototype.getPmis=function(){return h.TerseArray.toArray(this._pmis)};a.prototype.setMeasurementUnit=function(a){this._measurementUnit=
a};a.prototype.unsetMeasurementUnit=function(){this._measurementUnit=void 0};a.prototype.hasMeasurementUnit=function(){return void 0!==this._measurementUnit};a.prototype.getMeasurementUnit=function(){for(var a=this;null!==a;){if(void 0!==a._measurementUnit)return a._measurementUnit;a=g.towardProductOccurrence(a._parent)}return 1};a.prototype.getPhysicalProperties=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,
this.getPartDefinition()];case 1:return a=f.sent(),null===a?[2,null]:[4,a.value];case 2:c=f.sent();b=c.getRepresentationItems();if(1!==b.length)return[2,null];d=b[0];e=d.getPhysicalProperties();return[2,e]}})})};a.prototype.setPartDefinition=function(a){console.assert(void 0===this._partDefinition);this._partDefinition=h.LazyPromise.create(a)};a.prototype.setPrototype=function(a){console.assert(void 0===this._prototypeContext);this._prototypeContext=a;this._markBranchVisibilityDirty(!1)};a.prototype.removePrototype=
function(){if(void 0===this._prototypeContext)throw new d.InternalLogicError;var a=this._prototypeContext;delete this._prototypeContext;this._markBranchVisibilityDirty(!1);return a};a.prototype.getBranchVisibility=function(){this._updateBranchVisibility();return this._getBranchVisibility()};a.prototype._getBranchVisibility=function(){var a=this.isVisible()?2:1;this._hasBits(65536)&&(a|=2);this._hasBits(131072)&&(a|=1);return a};a.prototype._setBranchVisibility=function(a){this.isVisible()?console.assert(h.hasBits(a,
2)):console.assert(h.hasBits(a,1));this._bits&=-196609;h.hasBits(a,1)&&(this._bits|=131072);h.hasBits(a,2)&&(this._bits|=65536)};a.prototype._updateBranchVisibility=function(){if(this._hasBits(32768)){var a=this.isVisible()?2:1,c=this._getSubBranchVisibilities();null!==c&&(a|=c);this._setBranchVisibility(a);this._bits&=-32769}};a.prototype._getSubBranchVisibilities=function(){for(var a=0,c=0,b=this.getChildrenSync();c<b.length;c++){var d=b[c].getBranchVisibility();a|=d;if(3===a)return 3}d=0;for(c=
this.getBodyInstances();d<c.length;d++)if(b=c[d],!b.isOutOfHierarchy()&&(a|=b.isVisible()?2:1,3===a))return 3;c=0;for(b=this.getPmis();c<b.length;c++)if(d=b[c].getBranchVisibility(),a|=d,3===a)return 3;c=0;for(b=this.getCadViews();c<b.length;c++)if(d=b[c].getBranchVisibility(),a|=d,3===a)return 3;return 0===a?null:a};a.prototype._itemWasAdded=function(){3!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!0)};a.prototype._onItemRemoved=function(){1!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!1)};
a.prototype.markBranchVisibilityDirty=function(){this._markBranchVisibilityDirty(!1)};a.prototype._markBranchVisibilityDirty=function(a){if(!(this._hasBits(32768)||a&&3===this._getBranchVisibility()))if(this._bits|=32768,this._parent instanceof g.PrototypeContext)for(var c=0,b=this._parent.getReferrers();c<b.length;c++)b[c]._markBranchVisibilityDirty(a);else if(c=g.towardProductOccurrence(this._parent),null!==c)return c._markBranchVisibilityDirty(a)};a.prototype.setVisibility=function(a){this.isVisible()!==
a&&(this._setVisibility(a),this._markBranchVisibilityDirty(!1))};a.prototype._removeDirectChild=function(a){var c=h.TerseArray.toArray(this._children),b=c.length;c=c.filter(function(c){return c!==a});if(c.length===b)return!1;0===c.length?delete this._children:this._children=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};a.prototype._removeIndirectChild=function(a){for(var c=!1,b=h.TerseArray.toArray(this._childContexts),d=0,f=b;d<f.length;d++)if(f[d].removeProductOccurrence(a)){c=!0;break}if(!c)return!1;
b=b.filter(function(a){return a.hasChildren()});0===b.length?delete this._childContexts:this._childContexts=h.TerseArray.fromArray(b);this._onItemRemoved();return!0};a.prototype.removeProductOccurrence=function(a){return this._removeDirectChild(a)?!0:this._removeIndirectChild(a)};a.prototype.removeBodyInstance=function(a){var c=h.TerseArray.toArray(this._bodyInstances),b=c.length;c=c.filter(function(c){return c!==a});if(c.length===b)return!1;0===c.length?delete this._bodyInstances:this._bodyInstances=
h.TerseArray.fromArray(c);this._onItemRemoved();return!0};a.prototype.purgeContents=function(){var a=this;this._markBranchVisibilityDirty(!1);var c=[];if(void 0!==this._partDefinition&&!this._partDefinition.isUnforced()){var e=this._partDefinition.then(function(c){c.removeAllReferrers();delete a._partDefinition});c.push(e)}void 0!==this._prototypeContext&&(e=this._prototypeContext.purgeContents(),c.push(e),delete this._prototypeContext);e=h.TerseArray.toArray(this._children);e=b(e,function(a){return a.purgeContents()});
c.push(e);delete this._children;e=h.TerseArray.toArray(this._childContexts);e=b(e,function(a){return a.purgeContents()});c.push(e);delete this._childContexts;delete this._bodyInstances;delete this._cadViews;delete this._pmis;delete this._measurementUnit;return d.Util.waitForAll(c)};a.prototype.removePartDefinition=function(){if(void 0===this._partDefinition||!this._partDefinition.isResolved())throw new d.InternalLogicError;var a=this._partDefinition;delete this._partDefinition;return a.getResolved()};
a.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};a.prototype.markIsExternalModelRoot=function(a){console.assert(!this._hasBits(2048));this._bits|=2048;a.markSeenExternalModel()};a.prototype.isExternalModelRoot=function(){return this._hasBits(2048)};a.prototype.addPendingExternalModel=function(a){this._pendingExternalModels=h.TerseArray.push(this._pendingExternalModels,a)};a.prototype.hasPendingExternalModels=function(){return!h.TerseArray.isEmpty(this._pendingExternalModels)};
return a}(g.NodeMixin);g.ProductOccurrence=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a,c){return void 0!==a&&c<a.length?a[c]:null}function e(a,c,b){void 0===a&&(a=[]);a.length=Math.max(a.length,c+1);a[c]=b;return a}var c;(function(a){a[a.Unknown=0]="Unknown";a[a.BRep=1]="BRep";a[a.Tessellation=2]="Tessellation";a[a.Wireframe=3]="Wireframe";a[a.PointCloud=4]="PointCloud"})(c=g.BodyType||(g.BodyType={}));var a=function(a){function f(c,b,d,f){b=a.call(this,c,b,d.nodeInfo)||this;b._parent=f;b._bodyType=d.bodyType;0<d.faceMeasurementProps.length&&
(b._faceMeasurementProps=d.faceMeasurementProps.slice());0<d.edgeMeasurementProps.length&&(b._edgeMeasurementProps=d.edgeMeasurementProps.slice());null!==d.physicalProps&&(b._physicalProps=d.physicalProps);if(0<d.faceAttributes.length){b._faceAttributes=[];for(var e=0,k=d.faceAttributes;e<k.length;e++)f=k[e],b._faceAttributes.push(null===f?null:f.copy())}if(0<d.edgeAttributes.length)for(b._edgeAttributes=[],e=0,d=d.edgeAttributes;e<d.length;e++)f=d[e],b._edgeAttributes.push(null===f?null:f.copy());
c.registerRepresentationItem(b);return b}__extends(f,a);f.parseXml=function(a,b){a=g.Node.parseXml(a,b);b=g.XmlParser.parseMeshKey(b,"TCKey_Mesh");return{nodeInfo:a,meshKey:b,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]}};f.parseBinary=function(a,c){var b=c.parseNodeParseBits();a=g.Node.parseBinary(a,c,b);var f=c.parseBodyType(),e=null;b.hasBits1(8192)&&(e=c.parseMeshKey());var k=[];if(b.hasBits1(2048))for(var l=c.parseCount_32(),
h=0;h<l;++h){var n=g.MeasurementProperty.Face.parseBinary(c);k.push(n)}n=[];if(b.hasBits1(4096))for(l=c.parseCount_32(),h=0;h<l;++h){var v=g.MeasurementProperty.Edge.parseBinary(c);n.push(v)}l=null;b.hasBits1(1048576)&&(l=g.PhysicalProperties.parseBinary(c));v=[];if(b.hasBits2(1)){var z=c.parseCount_32();for(h=0;h<z;h++){for(var x=[],y=c.parseCount_32(),A=0;A<y;A++){var B=g.Attribute.parseBinary(c);B.getType()!==d.AttributeType.Ignored&&x.push(B)}v.push(0<x.length?new d.SubentityAttributes(x):null)}}z=
[];if(b.hasBits2(2))for(b=c.parseCount_32(),h=0;h<b;h++){x=[];y=c.parseCount_32();for(A=0;A<y;A++)B=g.Attribute.parseBinary(c),B.getType()!==d.AttributeType.Ignored&&x.push(B);z.push(0<x.length?new d.SubentityAttributes(x):null)}return{nodeInfo:a,meshKey:e,bodyType:f,faceMeasurementProps:k,edgeMeasurementProps:n,physicalProps:l,faceAttributes:v,edgeAttributes:z}};f.reify=function(a,c,b,d){return new f(a,c,b,d)};f.createDynamic=function(a,b,d,e,k){var l=k.getInclusionContextForNodeId();b={nodeInfo:{nodeId:a.massageAuthoredUserId(l,
b),bits:1073741824,name:d,localTransform:null,attributes:[],header:g.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},meshKey:null,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]};return new f(a,e,b,k)};f.prototype.setPhysicalProperties=function(a){this._physicalProps=a};f.prototype.getPhysicalProperties=function(){return void 0!==this._physicalProps?this._physicalProps:
null};f.prototype.getParent=function(){return this._parent};f.prototype.getFaceCount=function(){return void 0!==this._faceMeasurementProps?this._faceMeasurementProps.length:0};f.prototype.getEdgeCount=function(){return void 0!==this._edgeMeasurementProps?this._edgeMeasurementProps.length:0};f.prototype.getFaceAttributes=function(a){return b(this._faceAttributes,a)};f.prototype.getEdgeAttributes=function(a){return b(this._edgeAttributes,a)};f.prototype.getFaceMeasurementProperty=function(a){return b(this._faceMeasurementProps,
a)};f.prototype.getEdgeMeasurementProperty=function(a){return b(this._edgeMeasurementProps,a)};f.prototype.setFaceMeasurementProperty=function(a,c){this._faceMeasurementProps=e(this._faceMeasurementProps,a,c.copy())};f.prototype.setEdgeMeasurementProperty=function(a,c){this._edgeMeasurementProps=e(this._edgeMeasurementProps,a,c.copy())};f.prototype.getBodyType=function(){return this._bodyType};f.prototype.getRuntimeId=function(){return g.getRuntimeId(this._nodeId,this._parent.getInclusionContextForNodeId())};
return f}(g.NodeMixin);g.RepresentationItem=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a,b){this._type=c;this._title=a;this._value=b}b.parseBinary=function(c){var a=c.parseCString(),d=c.parseAttributeType();c=c.parseCString();return new b(d,a,c)};b.parseXml=function(c){console.assert("Attr"===c.localName);var a=d.AttributeType.Undefined,f="",e="",g=c.getAttribute("Name");if(null!==g&&(f=g,"__PRC_RESERVED_ATTRIBUTE_A3DF_ProductInformation"===f))return new b(a,f,e);g=c.getAttribute("Type");if(null!==g)switch(g){case "i":a=
d.AttributeType.Int;break;case "f":a=d.AttributeType.Float;break;case "t":a=d.AttributeType.Time;break;case "s":a=d.AttributeType.String}c=c.getAttribute("Value");null!==c&&(e=c);return new b(a,f,e)};b.prototype.getType=function(){return this._type};b.prototype.getTitle=function(){return this._title};b.prototype.getValue=function(){return this._value};b.prototype.copy=function(){return new b(this._type,this._title.slice(),this._value.slice())};return b}();g.Attribute=b})(h.Tree||(h.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c){this._colorTable=[];this._colorTable=c.slice()}b.parseXml=function(c){console.assert("ColorTable"===c.localName);var a=[];c=c.getAttribute("data");if(null!==c){c=c.split(" ");console.assert(0===c.length%3);for(var f=0;f<c.length;f+=3){var e=parseFloat(c[f]),g=parseFloat(c[f+1]),h=parseFloat(c[f+2]);e=new d.Color(e,g,h);a.push(e)}}return new b(a)};b.prototype.getColor=function(c){if(0<=c&&0===c%3&&(c/=3,c<this._colorTable.length))return this._colorTable[c];
console.assert(!1);return null};return b}();g.ColorTable=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(){function a(){this.isInclusive=!1;this.ids=[]}a.parseBinary=function(c){var b=new a;b.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)b.ids.push(c.parseNodeId());return b};a.parseXml=function(c){var b=new a;b.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseNodeIds(c,"Ids");null!==d?(b.ids=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===b.ids.length))):console.error("'Entities' tag has missing or malformed 'Ids' attribute");
return b};return a}();g.FilterEntities=b;var e=function(){function a(){this.isInclusive=!1;this.authoredIds=[]}a.parseBinary=function(c){var b=new a;b.isInclusive=c.parseBoolean();for(var d=c.parseCount_32(),f=0;f<d;f++)b.authoredIds.push(c.parseLayerId());return b};a.parseXml=function(c){var b=new a;b.isInclusive="1"===c.getAttribute("Inclusive");var d=g.XmlParser.parseUints(c,"Ids");null!==d?(b.authoredIds=d,c=c.getAttribute("Count"),null!==c&&(c=parseInt(c,10),console.assert(c===b.authoredIds.length))):
console.error("'Layers' tag has missing or malformed 'Ids' attribute");return b};return a}();g.FilterLayers=e;var c=function(){function a(){this.isDisplayfilter=!1;this.name=null;this.isActive=!1;this.entities=this.layers=null}a.parseBinary=function(c){var f=new a,g=null,h=null,m=c.parseLayerParseBits();f.isDisplayfilter=c.parseBoolean();d.hasBits(m,1)&&(f.name=c.parseCString());f.isActive=c.parseBoolean();d.hasBits(m,2)&&(g=e.parseBinary(c));d.hasBits(m,4)&&(h=b.parseBinary(c));f.layers=g;f.entities=
h;return f};a.parseXml=function(c){var d=new a,f=c.getAttribute("Name");null!==f&&(d.name=f);d.isDisplayfilter="1"===c.getAttribute("Display");d.isActive="1"===c.getAttribute("Active");for(f=c.firstElementChild;null!==f;f=f.nextElementSibling)"Layers"===f.localName?(console.assert(null===d.layers),d.layers=e.parseXml(f)):"Entities"===f.localName?(console.assert(null===d.entities),d.entities=b.parseXml(f)):console.error("Unknown tag: "+c.localName);return d};return a}();g.Filter=c})(d.Tree||(d.Tree=
{}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(){function b(c,a,b,d){this.id=c;this.name=a;this.nodes=b;this.treeNodes=d}b.parseBinary=function(c){var a=c.parseLayerParseBits(),b=c.parseLayerId(),e=null;d.hasBits(a,1)&&(e=c.parseCString());return{id:b,name:e}};b.parseXml=function(c){var a=c.getAttribute("Name");c=g.XmlParser.parseUint(c,"Id");return null===c?(console.error("'Layer' tag missing 'Id' attribute"),null):{id:c,name:a}};return b}();g.Layer=b})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a,b,d,e,g,h,p,q){this._ambientAlpha=c;this._diffuseAlpha=a;this._emissiveAlpha=b;this._specularAlpha=d;this._shininess=e;null!==g&&(this._ambientIndex=g);null!==h&&(this._diffuseIndex=h);null!==p&&(this._emissiveIndex=p);null!==q&&(this._specularIndex=q)}b.parseXml=function(c){console.assert("MaterialTable"===c.localName);var a=g.XmlParser.parseFloat(c,"AmbientAlpha")||0,d=g.XmlParser.parseFloat(c,"DiffuseAlpha")||0,e=g.XmlParser.parseFloat(c,
"EmissiveAlpha")||0,l=g.XmlParser.parseFloat(c,"SpecularAlpha")||0,h=g.XmlParser.parseFloat(c,"Shininess")||0,m=g.XmlParser.parseUint(c,"AmbientIndice"),p=g.XmlParser.parseUint(c,"DiffuseIndice"),q=g.XmlParser.parseUint(c,"EmissiveIndice");c=g.XmlParser.parseUint(c,"SpecularIndice");return new b(a,d,e,l,h,m,p,q,c)};b.prototype.getAmbientColorIndex=function(){return void 0!==this._ambientIndex?this._ambientIndex:null};b.prototype.getDiffuseColorIndex=function(){return void 0!==this._diffuseIndex?this._diffuseIndex:
null};b.prototype.getEmissiveColorIndex=function(){return void 0!==this._emissiveIndex?this._emissiveIndex:null};b.prototype.getSpecularColorIndex=function(){return void 0!==this._specularIndex?this._specularIndex:null};b.prototype.getAmbientAlpha=function(){return this._ambientAlpha};b.prototype.getDiffuseAlpha=function(){return this._diffuseAlpha};b.prototype.getEmissiveAlpha=function(){return this._emissiveAlpha};b.prototype.getSpecularAlpha=function(){return this._specularAlpha};b.prototype.getShininess=
function(){return this._shininess};return b}();g.Material=b;b=function(){function b(c,a){null!==c&&(this._color=c);null!==a&&(this._alpha=a)}b.parseXml=function(c){console.assert("Material"===c.localName);var a=null,f=null;c=c.getAttribute("Color");if(null!==c){var e=c.split(" ");if(4!==e.length)throw new d.XmlParseError('Expected "Color" attribute to have four channel components.');a=parseFloat(e[0]);f=parseFloat(e[1]);c=parseFloat(e[2]);e=parseFloat(e[3]);a=new d.Color(a,f,c);f=e}return new b(a,
f)};b.prototype.getColor=function(){return void 0!==this._color?this._color:null};b.prototype.getAlpha=function(){return void 0!==this._alpha?this._alpha:null};return b}();g.SimpleMaterial=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(c,a,b){this.surfaceArea=c;this.volume=a;this.centerOfGravity=b}b.parseBinary=function(c){var a=c.parseFloat_64(),d=c.parseFloat_64();c=c.parsePoint3_64();return new b(a,d,c)};return b}();d.PhysicalProperties=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(c,a,b,d){this._inclusionKey=c;this._bodyInstanceKey=a;this._topoItemType=b;this._itemIndex=d}b.parseBinary=function(c){var a=c.parseInstanceKey(),b=c.parsePmiTopoRef();c=c.parseIndex_32();return{bodyInstanceKey:a,topoItemType:b,itemIndex:c}};b.reify=function(c,a){c=c.getInclusionKey();return new b(c,a.bodyInstanceKey,a.topoItemType,a.itemIndex)};b.fromBodyInstance=function(c,a,d){c=c.getInstanceInc();return new b(c[0],c[1],a,d)};b.prototype.getBodyInstanceInc=
function(){return[this._inclusionKey,this._bodyInstanceKey]};b.prototype.getTopoItemType=function(){return this._topoItemType};b.prototype.getItemIndex=function(){return this._itemIndex};return b}();d.ReferenceOnTopology=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(c,a){console.assert(null!==c||null!==a);this._materialIndex=c;this._colorIndex=a}b.parseXml=function(c){console.assert("Style"===c.localName);var a=d.XmlParser.parseUint(c,"MaterialIndex");c=d.XmlParser.parseUint(c,"ColorIndex");return new b(a,c)};b.prototype.getMaterialIndex=function(){return this._materialIndex};b.prototype.getColorIndex=function(){return this._colorIndex};return b}();d.Style=b})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(){}b.parseBinary=function(c){return c.parseMatrix()};b.parseXml=function(c){console.assert("Transformation"===c.localName);var a=new d.Matrix;c=c.getAttribute("RelativeTransfo");if(null!==c){c=c.split(" ");console.assert(16===c.length);for(var b=0;16>b;++b){var e=parseFloat(c[b]);console.assert(!isNaN(e));a.m[b]=e}}return a};return b}();g.Transform=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){(function(g){function b(a){a.markLoaded();var c=0;for(a=a.getRepresentationItems();c<a.length;c++)a[c].markLoaded()}function e(a){a=a.getRawPartDefinition();if(null!==a){if(a instanceof h.LazyPromise)return a.isResolved()?void 0:a.then(b);d.Util.TypeAssert(a);return a.then(function(a){if(null!==a&&(a=a.value,!a.isResolved()))return a.then(b)})}}function c(a){var c=g.forcePrototype(a);return void 0!==c?c.then(function(){return e(a)}):e(a)}g.forcePartDefinition=c;g.forcePartDefinitions=function(a){return __awaiter(this,
void 0,void 0,function(){var b,e;return __generator(this,function(f){switch(f.label){case 0:return b=[],e={enterProductOccurrence:function(a){a=c(a);void 0!==a&&b.push(a)}},[4,g.WalkerAsync.walk(e,a,g.WalkRestriction.None)];case 1:return f.sent(),[2,d.Util.waitForAll(b)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(c){c=c.getPrototype();if(null!==c){var a=c.getProductOccurrence();return(a.isResolved()?e(a.getResolved()):a.then(e)).then(function(){console.assert(a.isResolved());a.getResolved().markLoaded()})}}function e(c){return __awaiter(this,void 0,void 0,function(){var a,f;return __generator(this,function(e){switch(e.label){case 0:return a=[],f={enterProductOccurrence:function(c){c=b(c);void 0!==c&&a.push(c)}},[4,g.WalkerAsync.walk(f,c,g.WalkRestriction.None)];
case 1:return e.sent(),[2,d.Util.waitForAll(a)]}})})}g.forcePrototype=b;g.forcePrototypes=e})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(c,a,b,e,l,n){var f=[];return(c=c.walk({enterAnyBody:function(a){if(!l.has(a)){l.add(a);if(a instanceof g.BodyInstance){if(!h.hasBits(b,1)||a.isOutOfHierarchy()&&!e)return}else if(a instanceof g.PmiBody){if(!h.hasBits(b,2))return}else if(d.Util.TypeAssert(a),!h.hasBits(b,4))return;a=a.getInstanceInc();f.push(a[0],a[1])}}},a,n))?c.then(function(){return f}):f}function e(c,a,d,e,l){return b(g.WalkerSync,c,a,d,e,l)}g.gatherInstanceIncs=function(c,a,d,
e){return b(g.WalkerAsync,c,a,d,e,g.WalkRestriction.None)};g.gatherInstanceIncsSync=e;g.gatherInstanceIncsByNodeIdsSync=function(c,a,b,k){for(var f=null,h=new Set,m=0;m<a.length;m++){var p=a[m],q=c.lookupAnyTreeNode(p);if(null===q)throw new d.InvalidNodeIdError(p);p=g.isOutOfHierarchy(q);p=e(q,b,p,h,k);if(null===f)f=p;else for(q=0;q<p.length;q++)f.push(p[q])}return null!==f?f:[]}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.gatherParentsOfPendingExternalModels=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a;return __generator(this,function(f){switch(f.label){case 0:return e=[],c=function(a){a.hasPendingExternalModels()&&e.push(a)},a={enterProductOccurrence:c},[4,d.WalkerAsync.walk(a,b,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getBoundingByNodeId=function(b,e,c,a,f,k){return __awaiter(this,void 0,void 0,function(){var l;return __generator(this,function(h){l=g.gatherInstanceIncsByNodeIdsSync(b,c,a,g.WalkRestriction.None);if(0===l.length)throw new d.CommunicatorError("Cannot get the bounding of node without geometry.");return[2,e.getPartsBounding(l,f,k)]})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.getNodeColorMap=function(b,e,c){return __awaiter(this,void 0,void 0,function(){var a,f,k,g,h,m,p,q;return __generator(this,function(l){switch(l.label){case 0:return a=[],f=[],k={enterAnyBody:function(c){c instanceof d.BodyInstance&&!c.isOutOfHierarchy()&&(a.push(c),c=c.getInstanceInc(),f.push(c[0],c[1]))}},[4,d.WalkerAsync.walk(k,b,d.WalkRestriction.None)];case 1:return l.sent(),g=new Map,[4,e.getPartColor(f,c)];case 2:h=l.sent();m=h.length;console.assert(m===
a.length);for(p=0;p<m;++p)q=h[p],null!==q&&g.set(a[p].getRuntimeId(),q);return[2,g]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.getVisibilityState=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f;return __generator(this,function(k){switch(k.label){case 0:return e=new Set,c=new Set,a={enterAnyBody:function(a){if(a instanceof g.BodyInstance){var b=a.getRuntimeId();a.isVisible()?e.add(b):c.add(b)}}},[4,g.WalkerAsync.walk(a,b,g.WalkRestriction.None)];case 1:return k.sent(),f=e.size>=c.size,[2,new d.VisibilityState(f,f?c:e)]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(b,c){var a=function(a){c.push(a)};return g.WalkerAsync.walk({enterProductOccurrence:a,enterAnyBody:a,enterCadView:a,enterPmi:a,enterPartDefinition:a,enterRepresentationItem:a},b,g.WalkRestriction.None)}g.markContextsLoaded=function(e){return __awaiter(this,void 0,void 0,function(){var c,a,f,k,g,h,m,p,q;return __generator(this,function(l){switch(l.label){case 0:c=[];a=[];f=0;for(k=e;f<k.length;f++)g=k[f],h=b(g,a),c.push(h);return[4,d.Util.waitForAll(c)];
case 1:l.sent();m=0;for(p=a;m<p.length;m++)q=p[m],q.markLoaded();return[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.resetTransforms=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a;return __generator(this,function(f){switch(f.label){case 0:return e=!1,c=function(a){a.hasLocalTransformOverride()&&(a.removeLocalTransformOverride(),e=!0)},a={enterProductOccurrence:c,enterPmi:c,enterCadView:c,enterAnyBody:function(a){a.preventFromResetting()||c(a)}},[4,d.WalkerAsync.walk(a,b,d.WalkRestriction.None)];case 1:return f.sent(),[2,e]}})})}})(d.Tree||(d.Tree={}))})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.setMeshLevels=function(b,e,c){var a=[],f=new Set,k=function(a){if(f.has(a))return!1;f.add(a);return!0};k={followProductOccurrence:k,followPmi:k,followCadView:k,followAnyBody:k,enterAnyBody:function(c){c.isOutOfHierarchy()||(c=c.getInstanceInc(),a.push(c[0],c[1]))}};for(var g=0;g<e.length;g++)d.WalkerSync.walk(k,e[g],d.WalkRestriction.None);b.setMeshLevel(a,c)}})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){g.updateScMatrices=function(b,e,c,a){return __awaiter(this,void 0,void 0,function(){var f,k,l,n,m,p,q,r,w,t,u,v,z=this;return __generator(this,function(x){switch(x.label){case 0:f=[];k=[];l=[];n=new Set;m=function(a){if(n.has(a))return!1;n.add(a);a=a.getLocalTransform();if(null!==a){var c=h.last(f);c=d.Matrix.multiply(a,c);f.push(c)}return!0};p=function(a){null!==a.getLocalTransform()&&(console.assert(1<f.length),f.pop())};q={followProductOccurrence:m,leaveProductOccurrence:p,
followPmi:m,leavePmi:p,followCadView:m,leaveCadView:p,followAnyBody:m,enterAnyBody:function(c){if(!c.isOutOfHierarchy()||a)c=c.getInstanceInc(),l.push(c[0],c[1]),k.push(h.last(f))},leaveAnyBody:p};r=new h.PromiseQueue(1,!0);w=function(a){var c=h.Lazy.create(function(){return __awaiter(z,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return console.assert(0===f.length),c=g.getNetMatrix(a.getParent()),f.push(c),[4,g.WalkerAsync.walk(q,a,g.WalkRestriction.None)];
case 1:return b.sent(),console.assert(1===f.length),f.pop(),[2]}})})});r.push(c)};t=0;for(u=c;t<u.length;t++)v=u[t],w(v);return[4,r.waitForIdle()];case 1:return x.sent(),console.assert(2*k.length===l.length),[4,b.setMatrices(l,k)];case 2:return x.sent(),e.trigger("_updateTransform",a),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a){for(var c=[],b=0;b<a.length;b++){var d=a[b].getInstanceInc();c.push(d[0],d[1])}return c}function e(a){for(var c=[],b=0;b<a.length;b++){var d=a[b].getRuntimeId();c.push(d)}return c}function c(a,c,k,l,n,m,p,q,r,w){return __awaiter(this,void 0,void 0,function(){var f,u,v,z,x,y,A,B,D,C,F,E,H,G,I=this;return __generator(this,function(t){switch(t.label){case 0:if(l instanceof g.AttachContext)switch(console.assert(0===n.size),console.assert(null===k),
console.assert(null===r),console.assert(null!==m),f=function(a){l.getChildren().forEach(function(c){n.set(c,a)})},m){case 0:console.assert(!0===q);f(!1);break;case 1:f(!0);break;case 2:console.assert(p),console.assert(!0===q)}else console.assert(null===m);null!==r&&console.assert(r.isAConfigurationNode());u=0;null===q&&(q=a.getInitiallyHiddenStayHidden());v=[];z=[];x=[];y=function(a){var c=A(a,!1);null!==c&&a.setVisibility(c)};A=function(a,c){var b=n.get(a);void 0!==b?x.push(b):0<x.length&&x.push(h.last(x));
if(g.isOutOfHierarchy(a))return null;if(null!==r&&0===u)return!1;if(void 0!==b)return b;b=a.isVisible();var d=a.isInitiallyShown();if(0<x.length){if(c=h.last(x),c!==b)return c&&!d&&q?a instanceof g.PmiBody&&(a=a.getParent(),!0===n.get(a))?!0:null:c}else if(p&&b!==d&&!c)return d;return null};B=function(a){0<x.length&&x.pop()};D={enterProductOccurrence:function(a){(r===a||0<u)&&++u;y(a)},leaveProductOccurrence:function(a){B(a);0<u&&--u},enterPmi:y,leavePmi:B,enterCadView:y,leaveCadView:B,enterAnyBody:function(a){var c=
a.preventFromResetting();c=A(a,c);null!==c&&(a.setVisibility(c),c?v.push(a):z.push(a))},leaveAnyBody:B};if(w!==d.TreeWalkMode.PerNode)return[3,1];n.forEach(function(a,c){return __awaiter(I,void 0,void 0,function(){return __generator(this,function(a){g.WalkerSync.walk(D,c,g.WalkRestriction.None);return[2]})})});return[3,3];case 1:return[4,g.WalkerAsync.walk(D,l,g.WalkRestriction.None)];case 2:t.sent(),t.label=3;case 3:return console.assert(0===x.length),null===m?(C=b(v),F=b(z),c.pauseRendering(),c.setPartVisibility(C,
!0,!0),c.setPartVisibility(F,!1,!0),c.resumeRendering(),null!==k&&(E=e(v),H=e(z),k.trigger("visibilityChanged",E,H))):(G=l.getAttachScope(),console.assert(0!==G),c.setVisibilityByAttachment(G,m)),[2]}})})}g.updateVisibilitiesByAttachment=function(a,b,e,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){return[2,c(a,b,null,e,new Map,g,2===g,1!==g,null,d.TreeWalkMode.Default)]})})};g.updateVisibilities=function(a,b,d,e,g,h,p,q,r){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(f){return[2,c(a,b,d,e,g,null,h,p,q,r)]})})};g.synchronizePmiVisibilities=function(a,c){return __awaiter(this,void 0,void 0,function(){var d,f,e,h,p;return __generator(this,function(k){switch(k.label){case 0:return d=[],f=[],e={enterAnyBody:function(a){if(a instanceof g.PmiBody||a instanceof g.ViewFrame){var c=a.isVisible();a.setVisibility(c);c?d.push(a):f.push(a)}}},[4,g.WalkerAsync.walk(e,c,g.WalkRestriction.None)];case 1:return k.sent(),h=b(d),p=b(f),
a.pauseRendering(),a.synchronizeVisibilities(h,!0),a.synchronizeVisibilities(p,!1),a.resumeRendering(),[2]}})})}})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(c,a){this._visitor=new g.TotalVisitor(c,a)}b.walk=function(c,a,f){if(f===g.WalkRestriction.LoadedNodesOnly&&!a.isLoaded())return Promise.resolve();var e=new b(c,f);if(a instanceof g.NodeMixin)return e._walkAnyTreeNode(a);var l=new d.Util.ActionQueue(1,!1);c=function(a){l.push(function(){return e._walkAnyTreeNode(a)})};f=0;for(a=a.getChildren();f<a.length;f++)c(a[f]);return l.waitForIdle()};b.forceLazyPromises=function(c){return this.walk({},
c,g.WalkRestriction.None)};b.prototype._walkAnyTreeNode=function(c){c instanceof g.ProductOccurrence?c=this._walkProductOccurrence(c):c instanceof g.Pmi?c=this._walkPmi(c):c instanceof g.CadView?c=this._walkCadView(c):(d.Util.TypeAssert(c),c=this._walkAnyBody(c));return void 0===c?Promise.resolve():c};b.prototype._walkRepresentationItem=function(c){this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),this._visitor.leaveRepresentationItem(c))};b.prototype._walkPartDefinition=
function(c){if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var a=0,b=c.getRepresentationItems();a<b.length;a++)this._walkRepresentationItem(b[a]);this._visitor.leavePartDefinition(c)}};b.prototype._walkAnyBody=function(c){this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};b.prototype._walkPmi=function(c){if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var a=0,b=c.getPmiBodies();a<b.length;a++)this._walkAnyBody(b[a]);
this._visitor.leavePmi(c)}};b.prototype._walkCadView=function(c){if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var a=c.getViewFrame();null!==a&&this._walkAnyBody(a);this._visitor.leaveCadView(c)}};b.prototype._walkProductOccurrence=function(c){var a=this,b=new d.Util.ActionQueue(1,!1);if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);var e=c.getRawPartDefinition();null!==e&&(e instanceof h.LazyPromise?b.push(function(){if(e.isResolved())return a._walkPartDefinition(e.getResolved())}):
(d.Util.TypeAssert(e),b.push(function(){return e.then(function(c){return null!==c&&(c=c.value,c.isResolved())?a._walkPartDefinition(c.getResolved()):Promise.resolve()})})));var g=c.tryGetChildrenSync();if(null!==g)for(var n=function(c){b.push(function(){return a._walkProductOccurrence(c)})},m=0;m<g.length;m++)n(g[m]);else b.push(function(){return c.getChildren().then(function(c){if(0!==c.length){for(var b=new d.Util.ActionQueue(1,!1),f=function(c){b.push(function(){return a._walkProductOccurrence(c)})},
e=0;e<c.length;e++)f(c[e]);if(!b.isIdle())return b.waitForIdle()}})});g=function(c){b.push(function(){return a._walkAnyBody(c)})};n=0;for(m=c.getBodyInstances();n<m.length;n++)g(m[n]);g=function(c){b.push(function(){return a._walkPmi(c)})};n=0;for(m=c.getPmis();n<m.length;n++)g(m[n]);g=function(c){b.push(function(){return a._walkCadView(c)})};n=0;for(m=c.getCadViews();n<m.length;n++)g(m[n]);b.push(function(){return a._visitor.leaveProductOccurrence(c)})}if(!b.isIdle())return b.waitForIdle()};return b}();
g.WalkerAsync=b})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a){return a.isLoaded()}function e(){return!0}var c;(function(a){a[a.None=0]="None";a[a.LoadedNodesOnly=1]="LoadedNodesOnly"})(c=g.WalkRestriction||(g.WalkRestriction={}));var a=function(){return function(a,k){this.followProductOccurrence=e;this.leaveProductOccurrence=this.enterProductOccurrence=h.nop;this.followPartDefinition=e;this.leavePartDefinition=this.enterPartDefinition=h.nop;this.followRepresentationItem=e;this.leaveRepresentationItem=this.enterRepresentationItem=
h.nop;this.followAnyBody=e;this.leaveAnyBody=this.enterAnyBody=h.nop;this.followCadView=e;this.leaveCadView=this.enterCadView=h.nop;this.followPmi=e;this.leavePmi=this.enterPmi=h.nop;k===c.LoadedNodesOnly?(console.assert(void 0===a.followProductOccurrence),console.assert(void 0===a.followAnyBody),console.assert(void 0===a.followCadView),console.assert(void 0===a.followPmi),this.followPmi=this.followCadView=this.followAnyBody=this.followProductOccurrence=b):d.Util.TypeAssert(k);void 0!==a.followProductOccurrence&&
(this.followProductOccurrence=a.followProductOccurrence);void 0!==a.enterProductOccurrence&&(this.enterProductOccurrence=a.enterProductOccurrence);void 0!==a.leaveProductOccurrence&&(this.leaveProductOccurrence=a.leaveProductOccurrence);void 0!==a.followPartDefinition&&(this.followPartDefinition=a.followPartDefinition);void 0!==a.enterPartDefinition&&(this.enterPartDefinition=a.enterPartDefinition);void 0!==a.leavePartDefinition&&(this.leavePartDefinition=a.leavePartDefinition);void 0!==a.followRepresentationItem&&
(this.followRepresentationItem=a.followRepresentationItem);void 0!==a.enterRepresentationItem&&(this.enterRepresentationItem=a.enterRepresentationItem);void 0!==a.leaveRepresentationItem&&(this.leaveRepresentationItem=a.leaveRepresentationItem);void 0!==a.followAnyBody&&(this.followAnyBody=a.followAnyBody);void 0!==a.enterAnyBody&&(this.enterAnyBody=a.enterAnyBody);void 0!==a.leaveAnyBody&&(this.leaveAnyBody=a.leaveAnyBody);void 0!==a.followCadView&&(this.followCadView=a.followCadView);void 0!==a.enterCadView&&
(this.enterCadView=a.enterCadView);void 0!==a.leaveCadView&&(this.leaveCadView=a.leaveCadView);void 0!==a.followPmi&&(this.followPmi=a.followPmi);void 0!==a.enterPmi&&(this.enterPmi=a.enterPmi);void 0!==a.leavePmi&&(this.leavePmi=a.leavePmi)}}();g.TotalVisitor=a})(h.Tree||(h.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(){function b(c,a){this._visitor=new d.TotalVisitor(c,a)}b.walk=function(c,a,f){if(f!==d.WalkRestriction.LoadedNodesOnly||a.isLoaded())return c=new b(c,f),a instanceof d.ProductOccurrence?c._walkProductOccurrence(a):a instanceof d.Pmi?c._walkPmi(a):a instanceof d.CadView?c._walkCadView(a):c._walkAnyBody(a)};b.prototype._walkRepresentationItem=function(c){console.assert(c.isLoaded());this._visitor.followRepresentationItem(c)&&(this._visitor.enterRepresentationItem(c),
this._visitor.leaveRepresentationItem(c))};b.prototype._walkPartDefinition=function(c){console.assert(c.isLoaded());if(this._visitor.followPartDefinition(c)){this._visitor.enterPartDefinition(c);for(var a=0,b=c.getRepresentationItems();a<b.length;a++)this._walkRepresentationItem(b[a]);this._visitor.leavePartDefinition(c)}};b.prototype._walkAnyBody=function(c){console.assert(c.isLoaded());this._visitor.followAnyBody(c)&&(this._visitor.enterAnyBody(c),this._visitor.leaveAnyBody(c))};b.prototype._walkPmi=
function(c){console.assert(c.isLoaded());if(this._visitor.followPmi(c)){this._visitor.enterPmi(c);for(var a=0,b=c.getPmiBodies();a<b.length;a++)this._walkAnyBody(b[a]);this._visitor.leavePmi(c)}};b.prototype._walkCadView=function(c){console.assert(c.isLoaded());if(this._visitor.followCadView(c)){this._visitor.enterCadView(c);var a=c.getViewFrame();null!==a&&this._walkAnyBody(a);this._visitor.leaveCadView(c)}};b.prototype._walkProductOccurrence=function(c){console.assert(c.isLoaded());if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);
var a=c.getPartDefinitionSync();null!==a&&this._walkPartDefinition(a);a=0;for(var b=c.getChildrenSync();a<b.length;a++)this._walkProductOccurrence(b[a]);a=0;for(b=c.getBodyInstances();a<b.length;a++)this._walkAnyBody(b[a]);a=0;for(b=c.getPmis();a<b.length;a++)this._walkPmi(b[a]);a=0;for(b=c.getCadViews();a<b.length;a++)this._walkCadView(b[a]);this._visitor.leaveProductOccurrence(c)}};return b}();d.WalkerSync=b})(d.Tree||(d.Tree={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){this.plane=new d.Plane;this.instanceNodeId=this.meshId=this.referenceGeometry=null;this.color=d.Color.createFromFloat(.65,.65,.65);this.lineColor=d.Color.black();this.opacity=.35;this.matrix=new d.Matrix}b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){return{plane:{normal:this.plane.normal,d:this.plane.d},referenceGeometry:this.referenceGeometry}};b.prototype.forJson=function(){return this.toJson()};b.prototype.fromJson=
function(b){b=h.deepClone(b);var c=b.plane;this.plane=new d.Plane;var a=c.normal;this.plane.normal=new d.Point3(a.x,a.y,a.z);this.plane.d=c.d;b=b.referenceGeometry;if(Array.isArray(b))for(c=0;c<b.length;++c)b[c]=d.Point3.fromJson(b[c]);this.referenceGeometry=b};b.prototype.getMatrix=function(){return this.matrix.copy()};b.prototype.setMatrix=function(b){this.matrix=b.copy()};b.prototype.setReferenceGeometry=function(b){if(b){this.referenceGeometry=[];for(var c=0;c<b.length;c++)this.referenceGeometry.push(b[c].copy())}else this.referenceGeometry=
null};b.prototype.getReferenceGeometry=function(){if(this.referenceGeometry){for(var b=[],c=0,a=this.referenceGeometry;c<a.length;c++)b.push(a[c].copy());return b}return null};b.prototype.createMeshData=function(){var b=this.referenceGeometry;if(null===b)return null;var c=new d.MeshData,a=[],f=[];a.push(b[0].x,b[0].y,b[0].z);a.push(b[1].x,b[1].y,b[1].z);a.push(b[3].x,b[3].y,b[3].z);a.push(b[1].x,b[1].y,b[1].z);a.push(b[2].x,b[2].y,b[2].z);a.push(b[3].x,b[3].y,b[3].z);for(var k=d.Plane.createFromPoints(b[0],
b[1],b[2]).normal,g=0;6>g;g++)f.push(k.x,k.y,k.z);c.addFaces(a,f);c.addPolyline([b[0].x,b[0].y,b[0].z,b[1].x,b[1].y,b[1].z]);c.addPolyline([b[1].x,b[1].y,b[1].z,b[2].x,b[2].y,b[2].z]);c.addPolyline([b[2].x,b[2].y,b[2].z,b[3].x,b[3].y,b[3].z]);c.addPolyline([b[3].x,b[3].y,b[3].z,b[0].x,b[0].y,b[0].z]);return c};return b}();h.CuttingPlane=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,d,c,a,f){this._cuttingPlanes=[];this._isActive=!1;this._viewer=b;this._model=d;this._callbackManager=c;this._cuttingManager=a;this._engine=f}g.deprecated=function(b,d,c){var a=c.value;c.value=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this._callbackManager.trigger("deprecated","CuttingSection",d);return a.apply(this,c)};return c};g.prototype.addPlane=function(b,e){void 0===e&&(e=null);return __awaiter(this,void 0,void 0,function(){var c,
a;return __generator(this,function(f){switch(f.label){case 0:c=this._engine.getCuttingSectionLimits();if(this._cuttingPlanes.length>=c.maxCuttingPlanesPerSection)return[2,!1];a=new d.Internal.CuttingPlane;a.plane=b.copy();a.setReferenceGeometry(e);this._cuttingPlanes.push(a);return this._isActive?[4,this._resetCuttingPlane(a)]:[2,!0];case 1:return f.sent(),[4,this._engine.updateCuttingSection(this)];case 2:return f.sent(),[2,!0]}})})};g.prototype.setPlane=function(b,d,c){void 0===c&&(c=null);return __awaiter(this,
void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:a=this._cuttingPlanes[b];if(void 0===a)return[3,2];a.plane=d.copy();a.setReferenceGeometry(c);return this._isActive?[4,this._resetCuttingPlane(a)]:[3,2];case 1:return f.sent(),[2,this._engine.updateCuttingSection(this)];case 2:return[2]}})})};g.prototype.updatePlane=function(b,e,c,a,f){void 0===c&&(c=new d.Matrix);void 0===a&&(a=!1);void 0===f&&(f=!1);return __awaiter(this,void 0,void 0,function(){var k,g,h;
return __generator(this,function(l){switch(l.label){case 0:k=this._cuttingPlanes[b];if(void 0===k)return[3,3];k.plane=e.copy();if(!this._isActive)return[3,3];if(null===k.instanceNodeId)return[3,2];this._engine.pauseRendering();g=k.getMatrix();f&&(g=new d.Matrix);h=d.Matrix.multiply(g,c);a&&k.setMatrix(h);return[4,Promise.all([this._model.setNodeMatrix(k.instanceNodeId,h),this._engine.updateCuttingSection(this)])];case 1:return l.sent(),this._engine.resumeRendering(),[3,3];case 2:return[2,this._engine.updateCuttingSection(this)];
case 3:return[2]}})})};g.prototype.removePlane=function(b){var e=[],c=this._cuttingPlanes[b];void 0!==c&&(null!==c.meshId&&null!==c.instanceNodeId&&e.push(this._destroyMeshes([c.meshId],[c.instanceNodeId])),this._cuttingPlanes.splice(b,1));this._isActive&&e.push(this._engine.updateCuttingSection(this));return d.Util.waitForAll(e)};g.prototype.getPlane=function(b){b=this._cuttingPlanes[b];return void 0!==b?b.plane.copy():null};g.prototype.getNodeId=function(b){b=this._cuttingPlanes[b];return void 0!==
b?b.instanceNodeId:null};g.prototype.getReferenceGeometry=function(b){b=this._cuttingPlanes[b];return void 0!==b?b.getReferenceGeometry():null};g.prototype.getPlaneIndexByNodeId=function(b){for(var d=0;d<this._cuttingPlanes.length;d++)if(this._cuttingPlanes[d].instanceNodeId===b)return d;return null};g.prototype.setPlaneOpacity=function(b,d){b=this._cuttingPlanes[b];void 0!==b&&(b.opacity=d,null!==b.instanceNodeId&&this._model.setNodesOpacity([b.instanceNodeId],d))};g.prototype.setPlaneTransparency=
function(b,d){this.setPlaneOpacity(b,d);return Promise.resolve()};g.prototype.setItemTransparency=function(b,d){this.setPlaneOpacity(b,d);return Promise.resolve()};g.prototype.setColor=function(b){for(var d=[],c=0,a=this._cuttingPlanes;c<a.length;c++){var f=a[c];f.color.assign(b);null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesFaceColor(d,b);return Promise.resolve()};g.prototype.setOpacity=function(b){for(var d=[],c=0,a=this._cuttingPlanes;c<a.length;c++){var f=a[c];f.opacity=
b;null!==f.instanceNodeId&&d.push(f.instanceNodeId)}this._model.setNodesOpacity(d,b)};g.prototype.setTransparency=function(b){this.setOpacity(b);return Promise.resolve()};g.prototype.getCount=function(){return this._cuttingPlanes.length};g.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.deactivate()];case 1:return b.sent(),this._cuttingPlanes.length=0,[2]}})})};g.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){var b,e,c,a,f;return __generator(this,function(k){switch(k.label){case 0:if(this._isActive)return[2];this._isActive=!0;if(!(0<this._cuttingPlanes.length))return[3,2];this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,.9999995231628418);b=[];e=[];c=0;for(a=this._cuttingPlanes;c<a.length;c++)f=a[c],b.push(this._createCuttingPlaneGeometry(f).then(function(a){null!==a&&e.push(a)}));return[4,d.Util.waitForAll(b)];case 1:k.sent(),this._initCuttingPlanesByNodeId(e),
k.label=2;case 2:return[2,this._engine.addCuttingSection(this)]}})})};g.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(e){return this._isActive?(this._isActive=!1,b=[],b.push(this._destroyGeometry()),b.push(this._engine.removeCuttingSection(this)),this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,1),[2,d.Util.waitForAll(b)]):[2]})})};g.prototype.isActive=function(){return this._isActive};g.prototype.toJson=
function(){return this._toJson()};g.prototype._toJson=function(){for(var b=[],d=0;d<this._cuttingPlanes.length;d++)b[d]=this._cuttingPlanes[d].toJson();return{planes:b}};g.prototype.forJson=function(){return this.toJson()};g.prototype.fromJson=function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this.clear()];case 1:l.sent();e=d.Internal.deepClone(b);c=e.planes;a=0;for(f=c;a<f.length;a++)k=f[a],g=new d.Internal.CuttingPlane,
g.fromJson(k),this._cuttingPlanes.push(g);return[2,this.activate()]}})})};g.prototype._initCuttingPlanesByNodeId=function(b){this._model.setInstanceModifier(d.InstanceModifier.DoNotCut,b,!0);this._model.setInstanceModifier(d.InstanceModifier.DoNotExplode,b,!0);this._cuttingManager.getStandinGeometryPickable()||this._model.setInstanceModifier(d.InstanceModifier.DoNotSelect,b,!0)};g.prototype._destroyGeometry=function(){for(var b=[],d=[],c=0,a=this._cuttingPlanes;c<a.length;c++){var f=a[c];null!==f.meshId&&
b.push(f.meshId);null!==f.instanceNodeId&&d.push(f.instanceNodeId);f.meshId=null;f.instanceNodeId=null}return this._destroyMeshes(b,d)};g.prototype._getInstanceNodeIds=function(){for(var b=[],d=0,c=this._cuttingPlanes;d<c.length;d++){var a=c[d].instanceNodeId;null!==a&&b.push(a)}return b};g.prototype._resetCuttingPlane=function(b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null===b.meshId||null===b.instanceNodeId)return[3,2];
d=this._destroyMeshes([b.meshId],[b.instanceNodeId]);b.meshId=null;b.instanceNodeId=null;return[4,d];case 1:return c.sent(),[2,this._createInstanceGeometry(b)];case 2:if(null!==b.referenceGeometry)return[2,this._createInstanceGeometry(b)];c.label=3;case 3:return[2]}})})};g.prototype._createInstanceGeometry=function(b){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(a){switch(a.label){case 0:return d=[],[4,this._createCuttingPlaneGeometry(b)];case 1:return c=
a.sent(),null!==c&&d.push(c),this._initCuttingPlanesByNodeId(d),[2]}})})};g.prototype._destroyMeshes=function(b,e){return __awaiter(this,void 0,void 0,function(){var c,a,f,k;return __generator(this,function(g){switch(g.label){case 0:return c=[],c.push(this._model.deleteMeshInstances(e)),c.push(this._model.deleteMeshes(b)),[4,d.Util.waitForAll(c)];case 1:g.sent();a=0;for(f=e;a<f.length;a++)k=f[a],this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.delete(k);return[2]}})})};g.prototype._createCuttingPlaneGeometry=
function(b){return __awaiter(this,void 0,void 0,function(){var e,c,a,f,k,g,h,m;return __generator(this,function(l){switch(l.label){case 0:e=b.createMeshData();if(null===e)return[2,null];e.setBackfacesEnabled(!0);return[4,this._model.createMesh(e)];case 1:return c=l.sent(),b.meshId=c,a=d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay,f=b.plane.copy(),k=f.normal.copy().scale(-f.d),g=(new d.Matrix).setTranslationComponent(k.x,
k.y,k.z),b.setMatrix(g.copy()),h=new d.MeshInstanceData(c,g,null,b.color,null,null,a),h.setOpacity(b.opacity),h.setLineColor(b.lineColor),this._engine.pauseRendering(),[4,this._model.createMeshInstance(h,void 0,!0,!0)];case 2:return m=l.sent(),b.instanceNodeId=m,this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.add(m),this._model.setDepthRange([m],4.76837158203125E-7,1),this._engine.resumeRendering(),[2,m]}})})};__decorate([g.deprecated],g.prototype,"setPlaneTransparency",null);__decorate([g.deprecated],
g.prototype,"setItemTransparency",null);__decorate([g.deprecated],g.prototype,"setTransparency",null);__decorate([g.deprecated],g.prototype,"forJson",null);return g}();d.CuttingSection=h})(Communicator||(Communicator={}));
(function(d){(function(d){function g(b,d){for(var c=0;c<d.length;c++)b.push(d[c])}d.emptyBytes=new Uint8Array(0);d.copyArray=function(b){return b.slice()};d.append=function(b,d){for(var c=0;c<d.length;c++)b.push(d[c])};d.last=function(b){console.assert(0<b.length);return b[b.length-1]};d.all=function(b){for(var d=0;d<b.length;d++)if(!b[d])return!1;return!0};d.chunkify=function(b,d){for(var c=[],a=0;a<b.length;a+=d)c.push(b.slice(a,a+d));return c};d.mapInPlace=function(b,d){for(var c=0;c<b.length;++c)b[c]=
d(b[c]);return b};d.concatInPlace=g;d.concatAll=function(b){for(var d=[],c=0;c<b.length;c++)g(d,b[c]);return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.filterInPlace=function(d,b){for(var e=0,c=0;c<d.length;++c){var a=d[c];b(a)&&(d[e++]=a)}d.length=e}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this._leftToRight=new Map;this._rightToLeft=new Map}b.prototype.set=function(b,c){this._leftToRight.set(b,c);this._rightToLeft.set(c,b)};b.prototype.getLeft=function(b){return this._rightToLeft.get(b)};b.prototype.getRight=function(b){return this._leftToRight.get(b)};return b}();d.Bimap=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(b){this.value=b}b.create=function(d){return new b(d)};return b}();d.Boxed=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this._stopTime=this._currentTime=0}b.prototype.stop=function(){this._stopTime=this._currentTime};b.prototype.isTicking=function(){this._refreshCurrentTime();return 0<this._remainingDuration()};b.prototype.tickFor=function(b){this._refreshCurrentTime();this._remainingDuration()>=b||(this._stopTime=this._currentTime+b)};b.prototype._remainingDuration=function(){return this._stopTime-this._currentTime};b.prototype._refreshCurrentTime=function(){this._currentTime=
Date.now()};return b}();d.Clock=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(b){this._planes=[];this._absPlanes=[];this._signs=[];this._distanceScale=[];for(var c=b.length,a=0;a<b.length;a++)this._planes.push(b[a].slice());for(b=0;b<c;++b)for(this._planes[b][3]=-this._planes[b][3],this._absPlanes[b]=d.cwiseAbs3(this._planes[b]),this._signs[b]=[0,0,0],a=0;3>a;++a)this._signs[b][a]=0<=this._planes[b][a]?1:-1;for(b=0;b<c;++b)a=d.squaredNorm3(this._planes[b]),this._distanceScale[b]=0===a?0:1/a}b.fromPlaneCoefficients=function(d){for(var c=
[],a=0;a<d.length;a++){var f=d[a];c.push([f.x,f.y,f.z,f.w])}return new b(c)};b.createFrustumFromMatrix=function(e){for(var c=[],a=0;3>a;++a)c[a]=d.sub4(d.col4(e,3),d.col4(e,a));for(a=0;3>a;++a)c[a+3]=d.add4(d.col4(e,3),d.col4(e,a));return new b(c)};b.prototype.testAxisAlignedBox=function(b,c){for(var a=this._planes.length,f=2,e=0;e<a;++e){var g=d.dot3(this._planes[e],b),h=d.dot3(this._absPlanes[e],c);if(g+h<=this._planes[e][3])return 0;g-h<this._planes[e][3]&&(f=1)}return f};b.prototype.axisAlignedBoxNotOutside=
function(b,c){for(var a=this._planes.length,f=0;f<a;++f)if(d.dot3(this._planes[f],d.add3(b,d.cwiseProduct3(c,this._signs[f])))<=this._planes[f][3])return!1;return!0};b.prototype.sphereNotOutside=function(b,c){for(var a=this._planes.length,f=0;f<a;++f){var e=d.dot3(this._planes[f],b)-this._planes[f][3];if(0>e&&e*e*this._distanceScale[f]>=c)return!1}return!0};b.prototype.sphereFullyInside=function(b,c){for(var a=this._planes.length,f=0;f<a;++f){var e=d.dot3(this._planes[f],b)-this._planes[f][3];if(0>
e||e*e*this._distanceScale[f]<c)return!1}return!0};b.prototype.pointInside=function(b){for(var c=this._planes.length,a=0;a<c;++a)if(0>d.dot3(this._planes[a],b)-this._planes[a][3])return!1;return!0};return b}();d.ConvexVolume=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){}b.isSupported=function(){return b._enabled&&"function"===typeof fetch&&"function"===typeof ReadableStream};b.request=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return[4,fetch(b)];case 1:c=a.sent();if(200===c.status)return[2,c];throw new d.LoadError('Failed to fetch "'+b+'" with status '+c.status+".");}})})};b._enabled=!0;return b}();h.FetchApi=g})(d.Internal||(d.Internal=
{}))})(Communicator||(Communicator={}));(function(d){(function(d){d.nop=function(){};d.identity=function(d){return d}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b,e){return new Promise(function(c,a){var f=new XMLHttpRequest;f.open("GET",b,!0);e&&(f.responseType=e);f.onload=function(e){4===f.readyState&&(200===f.status?c(f):(e=new d.LoadError('XMLHttpRequest failed to GET "'+b+'" with status '+f.status+"."),a(e)))};f.onerror=function(c){a(c)};f.send()})}h.httpRequest=g;h.httpRequestBuffer=function(b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,
g(b,"arraybuffer")];case 1:return d=c.sent(),[2,new Uint8Array(d.response)]}})})}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.copyMap=function(d){var b=new Map;d.forEach(function(d,c){b.set(c,d)});return b};d.copySet=function(d){var b=new Set;d.forEach(function(d){b.add(d)});return b};d.toSet=function(d){for(var b=new Set,e=0;e<d.length;e++)b.add(d[e]);return b}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(b){this._deferredValue=b}b.create=function(d){return new b(d)};b.prototype.get=function(){null!==this._deferredValue&&(this._resolvedValue=this._deferredValue(),this._deferredValue=null);return this._resolvedValue};return b}();d.Lazy=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.Lazy=d.Util.Lazy;var g=function(){function b(c){this._value=c}b.create=function(c){return new b(c)};b.prototype.get=function(){"function"===typeof this._value&&(this._value=this._value());return this._value};return b}();h.LazyObject=g;var b=function(){function b(c){"function"===typeof c&&(c=g.create(c));c instanceof Promise&&(c=this._rectifyResult(c));this._value=c}b.create=function(c){return new b(c)};b.prototype.isUnforced=function(){return this._value instanceof g};
b.prototype.isResolved=function(){return!(this._value instanceof g)&&!(this._value instanceof Promise)};b.prototype.getResolved=function(){console.assert(this.isResolved());return this._value};b.prototype.then=function(c,a){this._value instanceof g&&(this._value=this._rectifyResult(this._value.get()));if(this._value instanceof Promise)return this._value.then(c,a);d.Util.TypeAssert(this._value);return Promise.resolve(this._value).then(c,a)};b.prototype._rectifyResult=function(c){var a=this;return c instanceof
Promise?c.then(function(c){return a._value=c}):c};return b}();h.LazyPromise=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.fromIntegerMap=function(d){if(d instanceof Map)return d;for(var b=new Map,e=0,c=Object.keys(d);e<c.length;e++){var a=c[e],f=d[a];b.set(parseInt(a,10),f)}return b};d.toIntegerMap=function(d){if(!(d instanceof Map))return d;var b={};d.forEach(function(d,c){b[c]=d});return b};d.fromRealNumberMap=function(d){if(d instanceof Map)return d;for(var b=new Map,e=0,c=Object.keys(d);e<c.length;e++){var a=c[e];b.set(Number(a),d[a])}return b};d.fromStringMap=function(d){if(d instanceof
Map)return d;for(var b=new Map,e=0,c=Object.keys(d);e<c.length;e++){var a=c[e];b.set(a,d[a])}return b}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(h){h.Todo=function(){for(var g=0;g<arguments.length;g++);throw new d.InternalLogicError;}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){h.TypeAssert=function(d){};h.TypeAssertNever=function(g){throw new d.InternalLogicError;}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.CompileTime||(d.CompileTime={});d.enable=!0;d.disable=!1})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(b){this._heap=[];this._comparator=b}b.prototype.clear=function(){this._heap.length=0};Object.defineProperty(b.prototype,"length",{get:function(){return this._heap.length},enumerable:!0,configurable:!0});b.prototype.peek=function(){return this._heap[0]};b.prototype.push=function(b){this._heap.push(b);this._siftUp()};b.prototype.pop=function(){var b=this.peek(),c=this.length-1;0<c&&this._swap(0,c);this._heap.pop();this._siftDown();return b};b.prototype.replace=
function(b){var c=this.peek();this._heap[0]=b;this._siftDown();return c};b.prototype._greater=function(b,c){return this._comparator(this._heap[b],this._heap[c])};b.prototype._swap=function(b,c){var a=[this._heap[c],this._heap[b]];this._heap[b]=a[0];this._heap[c]=a[1]};b.prototype._siftUp=function(){for(var b=this.length-1;0<b&&this._greater(b,(b+1>>>1)-1);)this._swap(b,(b+1>>>1)-1),b=(b+1>>>1)-1};b.prototype._siftDown=function(){for(var b=0;(b<<1)+1<this.length&&this._greater((b<<1)+1,b)||b+1<<1<
this.length&&this._greater(b+1<<1,b);){var c=b+1<<1<this.length&&this._greater(b+1<<1,(b<<1)+1)?b+1<<1:(b<<1)+1;this._swap(b,c);b=c}};return b}();d.PriorityQueue=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){d.waitForAll=function(d){return Promise.all(d)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){return function(){this.items=[];this.next=null}}(),b=function(){function b(){this.clear()}b.prototype.clear=function(){this._tail=this._head=new g;this._size=0};Object.defineProperty(b.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0});b.prototype.push=function(c){++this._size;if(1024===this._tail.items.length){var a=new g;this._tail=this._tail.next=a}this._tail.items.push(c)};b.prototype.pop=function(){console.assert(0<
this._size);console.assert(0<this._head.items.length);--this._size;var c=this._head.items.shift();if(0===this._head.items.length){var a=this._head.next;null===a?console.assert(this._head===this._tail):this._head=a}return c};return b}();d.Queue=b})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){var g=function(){return function(b,d){this.value=b;this.kids=d.slice()}}();d.RoseTree=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){function g(b){var d=[];b.forEach(function(c){d.push(c)});return d}d.setToArray=g;d.setSubtraction=function(b,e){b=g(b).filter(function(c){return!e.has(c)});return d.toSet(b)}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){d.utf8ArrayToStr=function(c){if("undefined"!==typeof window&&8192>c.length&&"escape"in window){var a=void 0;try{var b=String.fromCharCode.apply(null,c),d=window.escape(b);a=decodeURIComponent(d)}catch(p){a=""}return a}a="";d=c.length;for(b=0;b<d;){var e=c[b++];switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(e);break;case 12:case 13:var g=c[b++];a+=String.fromCharCode((e&31)<<6|g&63);break;case 14:g=c[b++];var h=c[b++];a+=String.fromCharCode((e&
15)<<12|(g&63)<<6|(h&63)<<0)}}return a};var g=/^\d+$/;d.isBase10Number=function(c){return g.test(c)};var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`~!@#$%^&*()_+-=[]{};:'\",.<>\\|/?".split("");d.compressUint=function(c){console.assert(0<=c);if(0===c)return b[0];for(var a=[];0!==c;){var d=Math.floor(c/b.length);a.push(b[c%b.length]);c=d}return a.join("")};var e="0000000 000000 00000 0000 000 00 0 ".split(" ");d.zeroPadHex32=function(c){c=c.toString(16);return e[c.length-1]+c}})(d.Internal||
(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.isEmpty=function(b){return null===b||void 0===b};d.toArray=function(b){return Array.isArray(b)?b.slice():null===b||void 0===b?[]:[b]};d.fromArray=function(b){return 0===b.length?null:1===b.length?b[0]:b};d.push=function(b,d){return b?Array.isArray(b)?(b.push(d),b):[b,d]:d}})(d.TerseArray||(d.TerseArray={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){this._afterActionIdlePromise=this._beforeActionIdlePromise=this._action=this._timerId=null}b.prototype.isIdle=function(b){if(0===b)return null===this._timerId;h.TypeAssert(b);return null===this._action};b.prototype.waitForIdle=function(b){if(0===b){if(null===this._timerId)return Promise.resolve();null===this._beforeActionIdlePromise&&(this._beforeActionIdlePromise=d.Internal.OpenPromise.create());return this._beforeActionIdlePromise}h.TypeAssert(b);
if(null===this._action)return Promise.resolve();null===this._afterActionIdlePromise&&(this._afterActionIdlePromise=d.Internal.OpenPromise.create());return this._afterActionIdlePromise};b.prototype._triggerIdlePromise=function(b){0===b?null!==this._beforeActionIdlePromise&&(this._beforeActionIdlePromise.resolve(),this._beforeActionIdlePromise=null):(h.TypeAssert(b),null!==this._afterActionIdlePromise&&(this._afterActionIdlePromise.resolve(),this._afterActionIdlePromise=null))};b.prototype._clearTimeout=
function(){null!==this._timerId&&(clearTimeout(this._timerId),this._timerId=null)};b.prototype.clear=function(){this._clearTimeout();this._triggerIdlePromise(0);this._action=null;this._triggerIdlePromise(1)};b.prototype.set=function(b,c){var a=this;this._clearTimeout();this._action=c;this._timerId=setTimeout(function(){a._timerId=null;a._triggerIdlePromise(0);var c=a._afterActionIdlePromise;a._afterActionIdlePromise=null;a._action();null===a._timerId&&(a._action=null);null!==c&&c.resolve()},b)};return b}();
h.Timer=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){d=d.Internal||(d.Internal={});d=d.Unicode||(d.Unicode={});d.Subscript2="\u00b2";d.Subscript3="\u00b3"})(Communicator||(Communicator={}));
(function(d){(function(d){function g(b,c){return b[0]*c[0]+b[1]*c[1]+b[2]*c[2]}function b(b){var c=b[0],a=b[1];b=b[2];return c*c+a*a+b*b}d.toVec3=function(b){return[b.x,b.y,b.z]};d.cwiseAbs3=function(b){return[Math.abs(b[0]),Math.abs(b[1]),Math.abs(b[2])]};d.cwiseProduct3=function(b,c){return[b[0]*c[0],b[1]*c[1],b[2]*c[2]]};d.add3=function(b,c){return[b[0]+c[0],b[1]+c[1],b[2]+c[2]]};d.sub3=function(b,c){return[b[0]-c[0],b[1]-c[1],b[2]-c[2]]};d.add4=function(b,c){return[b[0]+c[0],b[1]+c[1],b[2]+c[2],
b[3]+c[3]]};d.sub4=function(b,c){return[b[0]-c[0],b[1]-c[1],b[2]-c[2],b[3]-c[3]]};d.dot3=g;d.squaredNorm3=b;d.norm3=function(d){return Math.sqrt(b(d))};d.scale3=function(b,c){return[b*c[0],b*c[1],b*c[2]]};d.toVec4=function(b){return[b.x,b.y,b.z,b.w]};d.row4=function(b,c){b=b.m;c*=4;return[b[c],b[c+1],b[c+2],b[c+3]]};d.col4=function(b,c){b=b.m;return[b[c],b[c+4],b[c+8],b[c+12]]};d.squaredNorm4=function(b){var c=b[0],a=b[1],d=b[2];b=b[3];return c*c+a*a+d*d+b*b};d.scale4=function(b,c){return[b*c[0],
b*c[1],b*c[2],b*c[3]]};d.projectSquaredSize=function(b,c,a){b=g(b,a)+a[3];b*=b;1E-5>b&&(b=1E-5);return c/b}})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;console.assert(0<b,"Don't create a non-progressible queue.");this._maxActivePromises=b;this._suppressFailures=c;this._deferredActions=new d.Internal.Queue}b.prototype.isIdle=function(){return 0===this._activePromiseCount};b.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isIdle()){if(this._failed)throw this._failureError;
return[2]}null===this._idlePromise&&(this._idlePromise=h.OpenPromise.create());return[2,this._idlePromise]})})};b.prototype.push=function(b){"function"===typeof b&&(b=h.Lazy.create(b));this._activePromiseCount<this._maxActivePromises?(console.assert(0===this._deferredActions.length),this._immediateAction(b)):this._deferredActions.push(b)};b.prototype._immediateAction=function(b){var c=this;if(this._failed)return console.assert(0===this._deferredActions.length),!0;try{var a=b.get()}catch(f){this._suppressFailures||
(this._failed=!0,this._failureError=f,this._deferredActions.clear())}if(void 0===a)return!0;++this._activePromiseCount;a.then(function(a){c._finalizePromise();return a}).catch(function(a){c._finalizePromise();throw a;});return!1};b.prototype._finalizePromise=function(){--this._activePromiseCount;this._failed&&console.assert(0===this._deferredActions.length);if(0<this._deferredActions.length){do{var b=this._deferredActions.pop();if(!this._immediateAction(b))break}while(0<this._deferredActions.length)
}this._tryActivateIdlePromise()};b.prototype._tryActivateIdlePromise=function(){0===this._activePromiseCount&&(console.assert(0===this._deferredActions.length),null!==this._idlePromise&&(this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null))};return b}();h.ActionQueue=g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(b){this._idlePromise=this._pending=this._active=null;this._suppressFailures=b}b.prototype.isIdle=function(){return null===this._active};b.prototype.waitForIdle=function(){if(this.isIdle())return Promise.resolve();null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return this._idlePromise};b.prototype.set=function(b){var c=this;"function"===typeof b&&(b=d.Lazy.create(b));if(null===this._active){var a=void 0;try{a=b.get()}catch(f){return this._advance(!this._suppressFailures,
f)}if(void 0===a)return this._advance(!1,null);this._active=a.then(function(){c._advance(!1,null)}).catch(function(a){c._advance(!c._suppressFailures,a)})}else this._pending=b};b.prototype._advance=function(b,c){this._active=null;b&&(this._pending=null);null===this._pending?null!==this._idlePromise&&(b?this._idlePromise.reject(c):this._idlePromise.resolve(),this._idlePromise=null):(b=this._pending,this._pending=null,this.set(b))};b.prototype.clear=function(){this._pending=null};return b}();d.CurrentAction=
g})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this._action=new d.CurrentAction(!0);this._latestPromise=null;this._timestamp=0}b.prototype.isIdle=function(){return null===this._latestPromise&&this._action.isIdle()};b.prototype.set=function(b){var c=this,a=++this._timestamp;null!==this._latestPromise&&this._latestPromise.reject(void 0);var f=d.OpenPromise.create();this._latestPromise=f;this._action.clear();this._action.waitForIdle().then(function(){a===c._timestamp&&c._action.set(function(){if(a===
c._timestamp){f===c._latestPromise&&(c._latestPromise=null);"function"===typeof b&&(b=d.Lazy.create(b));try{var e=b.get()}catch(l){return c._advance(f,!0,l)}return void 0===e?c._advance(f,!1,null):e.then(function(){return c._advance(f,!1,null)},function(a){return c._advance(f,!0,a)})}})});return f};b.prototype._advance=function(b,c,a){b===this._latestPromise&&(this._latestPromise=null);c?b.reject(a):b.resolve()};return b}();d.CurrentActionSync=g})(d.Util||(d.Util={}))})(Communicator||(Communicator=
{}));(function(d){(function(d){(function(d){d.create=function(){var b,d,c=new Promise(function(a,c){b=a;d=c});c.resolve=b;c.reject=d;return c}})(d.OpenPromise||(d.OpenPromise={}))})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));(function(d){(d.Internal||(d.Internal={})).OpenPromise=d.Util.OpenPromise})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){this._cache=new Map}b.prototype.clear=function(){this._cache.clear()};b.prototype.load=function(b,c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){a=this._cache.get(b);if(void 0!==a)return[2,a];this._cache.set(b,c);return[2,c]})})};return b}();d.PromiseCache=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function c(a,c,b){this._lazyPromise=a;this._wrapperPromise=c;null!==b&&(this.compareValue=b)}c.prototype.kill=function(){this._lazyPromise=null};c.prototype.cancel=function(a){this._lazyPromise=null;this._wrapperPromise.resolve(a)};c.prototype.fetch=function(a,c){var b=this;null===this._lazyPromise?(this._wrapperPromise.reject(null),setTimeout(c,0)):a(this._lazyPromise).then(function(a){b._wrapperPromise.resolve(a)}).catch(function(a){b._wrapperPromise.reject(a)})};
return c}();d._DeferredPromise=g;var b=function(){function c(a,c,b){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;this._latestPromise=Promise.resolve();this._needsResorting=!1;console.assert(0<a,"Don't create a non-progressible queue.");this._maxActivePromises=a;this._deferredPromises=c;this._failureFailsAll=b}c.prototype.maxActivePromises=function(){return this._maxActivePromises};c.prototype.activePromiseCount=function(){return this._activePromiseCount};
c.prototype.isIdle=function(){return 0===this._activePromiseCount};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(this.isIdle()){if(this._failureFailsAll&&this._failed)throw this._failureError;return[2]}null===this._idlePromise&&(this._idlePromise=d.OpenPromise.create());return[2,this._idlePromise]})})};c.prototype.killDeferred=function(){for(var a=[];0<this._deferredPromises.length;){var c=this._dequeue();c.kill();a.push(c)}for(var b=
0;b<a.length;b++)c=a[b],this._queue(c)};c.prototype._push=function(a,c){"function"===typeof a&&(a=d.Lazy.create(a));return this._latestPromise=a=this._activePromiseCount<this._maxActivePromises?this._immediatePromise(a):this._deferPromise(a,c)};c.prototype._resort=function(){console.assert(this._needsResorting);this._needsResorting=!1;for(var a=0,c=this._drainQueue();a<c.length;a++)this._queue(c[a])};c.prototype._drainQueue=function(){for(var a=[];0<this._deferredPromises.length;){var c=this._dequeue();
a.push(c)}return a};c.prototype._deferPromise=function(a,c){var b=d.OpenPromise.create();a=new g(a,b,c);this._queue(a);return b};c.prototype._immediatePromise=function(a){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(d){switch(d.label){case 0:if(this._failureFailsAll&&this._failed)throw this._failureError;++this._activePromiseCount;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,a.get()];case 2:return c=d.sent(),this._finalizePromise(),[2,c];case 3:throw b=
d.sent(),this._failureFailsAll&&!this._failed&&(this._failed=!0,this._failureError=b,null!==this._idlePromise&&this._idlePromise.reject(b)),this._finalizePromise(),b;case 4:return[2]}})})};c.prototype._fetchNext=function(){var a=this;this._dequeue().fetch(function(c){return a._immediatePromise(c)},function(){a._finalizePromise()})};c.prototype._finalizePromise=function(){--this._activePromiseCount;0<this._deferredPromises.length?(this._needsResorting&&this._resort(),this._fetchNext()):0===this._activePromiseCount&&
(null!==this._idlePromise&&(this._failureFailsAll&&this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null),this._latestPromise=Promise.resolve())};return c}();d.PromiseQueueImpl=b;var e=function(c){function a(a,b){return c.call(this,a,new d.Queue,b)||this}__extends(a,c);a.prototype._queue=function(a){this._deferredPromises.push(a)};a.prototype._dequeue=function(){return this._deferredPromises.pop()};a.prototype.push=function(a){return this._push(a,
null)};a.prototype.waitOnLatest=function(){return this._latestPromise.then(d.nop,d.nop)};return a}(b);d.PromiseQueue=e;b=function(c){function a(a,b,e){var f=this;f=new d.PriorityQueue(function(a,c){return b(a.compareValue,c.compareValue)});return f=c.call(this,a,f,e)||this}__extends(a,c);a.prototype._queue=function(a){this._deferredPromises.push(a)};a.prototype._dequeue=function(){return this._deferredPromises.pop()};a.prototype.push=function(a,c){return this._push(a,c)};a.prototype.markDirty=function(){this._needsResorting=
!0};return a}(b);d.PriorityPromiseQueue=b;e=function(c){function a(a){return c.call(this,1,a)||this}__extends(a,c);a.prototype._queue=function(a){this._deferredPromises.clear();this._deferredPromises.push(a)};return a}(e);d.SingleMostRecentPromiseQueue=e;e=function(c){function a(a,b,d,e,g){d=c.call(this,d,e,g)||this;d._cutoffAttachments=[];d._attachPriorityManager=b;d._cutoffScale=a;return d}__extends(a,c);a.prototype.setCutoffScale=function(a){this._cutoffScale=Math.max(Math.min(a,2),0)};a.prototype.cutoffEnabled=
function(){return 0!==this._cutoffScale};a.prototype.isEmpty=function(){return 0===this._cutoffAttachments.length&&0===this._deferredPromises.length};a.prototype.killDeferred=function(){var a=this._drainQueue(),c=this._cutoffAttachments;this._cutoffAttachments=[];for(var b=0;b<a.length;b++)a[b].cancel(null);for(a=0;a<c.length;a++)c[a].cancel(null)};a.prototype._getCutoffValue=function(){return this._cutoffScale*-this._attachPriorityManager.getCalculatedCutoff()-1};a.prototype.push=function(a,c){if(!this.cutoffEnabled())return this._push(a,
c);var b=this._attachPriorityManager.getPriorityCompareValue(c),f=this._getCutoffValue();return b>f?("function"===typeof a&&(a=d.Lazy.create(a)),b=d.OpenPromise.create(),a=new g(a,b,c),this._cutoffAttachments.push(a),b):this._push(a,c)};a.prototype._resort=function(){if(this.cutoffEnabled()){this._needsResorting=!1;var a=this._drainQueue(),b=this._cutoffAttachments;this._cutoffAttachments=[];this._updateDeferredPromiseArray(a);this._updateDeferredPromiseArray(b)}else c.prototype._resort.call(this)};
a.prototype.update=function(){this.cutoffEnabled()?0<this._cutoffAttachments.length&&(this._resort(),this._refillQueue()):this.markDirty()};a.prototype._refillQueue=function(){for(var a=Math.min(this.maxActivePromises()-this.activePromiseCount(),this._deferredPromises.length),c=0;c<a;c++)this._fetchNext()};a.prototype._updateDeferredPromiseArray=function(a){for(var c=0;c<a.length;c++){var b=a[c],d=this._attachPriorityManager.getPriorityCompareValue(b.compareValue),f=this._getCutoffValue();d>f?this._cutoffAttachments.push(b):
this._queue(b)}};return a}(b);d.StreamCutoffAttachQueue=e})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));(function(d){(function(d){(function(d){d.create=function(){var b,d,c=new Promise(function(a,f){b=function(b){c.state=1;a(b)};d=function(a){c.state=2;f(a)}});c.state=0;c.resolve=b;c.reject=d;return c}})(d.TrackedOpenPromise||(d.TrackedOpenPromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){d.create=function(b,d){var c=new Promise(function(a,f){d.then(function(){c.isReady=!0;a(b)},f)});c.unsafeValue=b;c.readyPromise=d;c.isReady=!1;return c}})(d.UnsafePromise||(d.UnsafePromise={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function c(a,c,e,g){var f=b.call(this)||this;f._position=new d.Point2(a,c);f._modifiers=e;f._inputType=g;return f}__extends(c,b);c.prototype.getPosition=function(){return this._position.copy()};c.prototype.shiftDown=function(){return(this._modifiers&d.KeyModifiers.Shift)===d.KeyModifiers.Shift};c.prototype.altDown=function(){return(this._modifiers&d.KeyModifiers.Alt)===d.KeyModifiers.Alt};c.prototype.controlDown=function(){return(this._modifiers&d.KeyModifiers.Control)===
d.KeyModifiers.Control};c.prototype.commandDown=function(){return(this._modifiers&d.KeyModifiers.Command)===d.KeyModifiers.Command};c.prototype.getEventType=function(){return this._inputType};c.prototype.getModifiers=function(){return this._modifiers};return c}(h.InputEvent);h.MouseInputEventBase=g;var b=function(b){function c(a,c,d,e,g,h){a=b.call(this,a,c,g,h)||this;a._button=d;a._buttons=e;return a}__extends(c,b);c.prototype.getButton=function(){return this._button};c.prototype.getButtons=function(){return this._buttons};
return c}(g);h.MouseInputEvent=b;g=function(b){function c(a,c,d,e,g,h){a=b.call(this,a,c,g,h)||this;a._wheelDelta=d;a._buttons=e;return a}__extends(c,b);c.prototype.getWheelDelta=function(){return this._wheelDelta};c.prototype.getButtons=function(){return this._buttons};return c}(g);h.MouseWheelInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b){this._selection=b}b.prototype.getType=function(){return this._selection?this._selection.getSelectionType():d.SelectionType.None};b.prototype.getSelection=function(){return this._selection};b._createNull=function(){return new b(d.Selection.SelectionItem.create())};return b}();h.NodeSelectionEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a,f,e,g){var k=b.call(this)||this;k._id=c;k._position=new d.Point2(a,f);k._buttons=e;k._inputType=g;return k}__extends(e,b);e.prototype.getId=function(){return this._id};e.prototype.getPosition=function(){return this._position};e.prototype.getEventType=function(){return this._inputType};e.prototype.getButtons=function(){return this._buttons};return e}(h.InputEvent);h.TouchInputEvent=g})(d.Event||(d.Event={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var g=function(){function b(){}b.calculate=function(b,c,a,d){var f=2/(c+2*a+d);b=b<=c?this._PA(b,f,c):b>=c&&b<=c+a?this._PA(b,f,c):this._PC(b,f,c,a,d);return b=Math.min(b,1)};b._PA=function(b,c,a){return b*b*.5*c/a};b._PB=function(b,c,a){return this._PA(a,c,a)+(b-a)*c};b._PC=function(b,c,a,d,g){return this._PB(a+d,c,a)+(b-(a+d))*c*(1-.5*(b-(a+d))/g)};return b}();d.EaseInEaseOut=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a,f,g){this._startTime=this._completeCallback=null;this._progress=0;this._targetMoveDelta=this._positionMoveDelta=null;this._interpolationUsesRotation=!1;this._endQuaternion=this._beginQuaternion=null;this._fieldHeightDelta=this._fieldWidthDelta=this._viewVectorLengthDelta=this._viewVectorLength=0;this._beginCam=b.copy();this._endCam=c.copy();b=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()).normalize();c=this._endCam.getUp().normalize();
c=d.Point3.cross(c,b);b=d.Point3.cross(b,c);this._endCam.setUp(b.normalize());this._completeCallback=f;this._duration=a;this._view=g}b.prototype.isComplete=function(){return 1<=this._progress};b.prototype.getCallback=function(){return this._completeCallback};b.prototype.stop=function(){};b.prototype.start=function(){this._startTime=Date.now();this._progress=0;this._init();this._view.getProjectionMode()!==this._endCam.getProjection()&&this._view.setProjectionMode(this._endCam.getProjection())};b.prototype.update=
function(){if(null!==this._startTime){var b=(Date.now()-this._startTime)/this._duration;b=Math.min(b,1);b=Math.max(b,0);b=h.EaseInEaseOut.calculate(b,.49,.02,.49);b=Math.min(b,1);b=Math.max(b,0);var c=d.Point3.scale(this._positionMoveDelta,b),a=d.Point3.scale(this._targetMoveDelta,b),f=this._beginCam.getUp(),g=d.Point3.add(this._beginCam.getPosition(),c);a=d.Point3.add(this._beginCam.getTarget(),a);c=this._beginCam.getWidth()+b*this._fieldWidthDelta;var l=this._beginCam.getHeight()+b*this._fieldHeightDelta;
if(this._interpolationUsesRotation){g=this._viewVectorLength+this._viewVectorLengthDelta*b;var n=d.Quaternion.interpolate(this._beginQuaternion,this._endQuaternion,b);n=d.Quaternion.toMatrix(n);g=new d.Point3(a.x-n.m[8]*g,a.y-n.m[9]*g,a.z-n.m[10]*g);f.set(n.m[4],n.m[5],n.m[6])}f=d.Camera.create(g,a,f,this._endCam.getProjection(),c,l,this._endCam.getNearLimit());this._view.setCamera(f);this._progress=b;1<=this._progress&&this._view.setCamera(this._endCam)}};b.prototype.getMatrixFromCamera=function(b){var c=
d.Point3.subtract(b.getTarget(),b.getPosition()).normalize();b=b.getUp().normalize();b=d.Point3.cross(b,c);var a=d.Point3.cross(c,b);return d.Matrix.createFromBasis(b,a,c)};b.prototype._init=function(){var b=d.Point3.subtract(this._beginCam.getTarget(),this._beginCam.getPosition()),c=d.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()),a=b.length(),f=c.length()-a;b.normalize();c.normalize();c=d.Point3.subtract(b,c);var g=d.Point3.subtract(this._endCam.getUp(),this._beginCam.getUp());
b=!0;1E-4>c.length()&&1E-4>g.length()&&(b=!1);g=c=null;if(b){c=this.getMatrixFromCamera(this._beginCam);g=this.getMatrixFromCamera(this._endCam);c=d.Quaternion.createFromMatrix(c);g=d.Quaternion.createFromMatrix(g);var l=d.Quaternion.subtract(c,g).magnitudeSquared();d.Quaternion.add(c,g).magnitudeSquared()<l&&g.negate()}this._interpolationUsesRotation=b;this._beginQuaternion=c;this._endQuaternion=g;this._viewVectorLength=a;this._viewVectorLengthDelta=f;this._positionMoveDelta=d.Point3.subtract(this._endCam.getPosition(),
this._beginCam.getPosition());this._targetMoveDelta=d.Point3.subtract(this._endCam.getTarget(),this._beginCam.getTarget());this._fieldWidthDelta=this._endCam.getWidth()-this._beginCam.getWidth();this._fieldHeightDelta=this._endCam.getHeight()-this._beginCam.getHeight()};return b}();h.CameraInterpolation=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(){this._activeInterpolation=null;this._updateTimer=new d.Util.Timer;this._updateInterval=16}b.prototype.stop=function(){this._activeInterpolation&&this._activeInterpolation.stop();this._activeInterpolation=null;this._updateTimer.clear()};b.prototype.start=function(b,c){void 0===c&&(c=!0);if(this._activeInterpolation&&!c)return!1;this.stop();this._activeInterpolation=b;this._activeInterpolation.start();this.update();return!0};b.prototype.update=
function(){var b=this;if(this._activeInterpolation)if(this._activeInterpolation.update(),this._activeInterpolation.isComplete()){var c=this._activeInterpolation.getCallback();null!==c&&c()}else this._updateTimer.isIdle(0)&&this._updateTimer.set(this._updateInterval,function(){b.update()})};return b}();h.InterpolationManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a){this._markupItems=new Map;this._selectedMarkup=this._activeView=null;this._pendingUpdateHandleTimer=new d.Util.Timer;this._pickTolerance=0;this._callbackManager=b;this._domElements=c;this._markupRenderer=a}b.prototype.shutdown=function(){this.setActiveView(null);this._markupItems.forEach(function(b){b.remove()});this._markupItems.clear()};b.prototype._updateLater=function(b){var c=this;this._pendingUpdateHandleTimer.isIdle(0)&&this._pendingUpdateHandleTimer.set(0,
function(){c.update()});null!==b&&this._pendingUpdateHandleTimer.waitForIdle(1).then(function(){b.resolve()})};b.prototype.updateLater=function(){this._updateLater(null)};b.prototype.update=function(){this._pendingUpdateHandleTimer.clear();this.renderMarkup();this.renderActiveViewMarkup()};b.prototype.registerMarkupItem=function(b){var c=d.UUID.create();this._markupItems.set(c,b);return c};b.prototype.unregisterMarkupItem=function(b){var c=this._markupItems.get(b);c&&(c.remove&&c.remove(),this._markupItems.delete(b))};
b.prototype.getActiveView=function(){return this._activeView};b.prototype.setActiveView=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,d,e,g,n;return __generator(this,function(f){switch(f.label){case 0:this._selectedMarkup&&(this._selectedMarkup.onDeselect(),this._selectedMarkup=null);c=this._activeView;this._activeView=b;if(null===c||c===b)return[3,2];a=c.getMarkup();d=0;for(e=a;d<e.length;d++)g=e[d],g.remove();n=h.OpenPromise.create();this._updateLater(n);return[4,n];case 1:return f.sent(),
this._callbackManager.trigger("viewDeactivated",c),[3,4];case 2:return[4,this._pendingUpdateHandleTimer.waitForIdle(1)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};b.prototype.renderMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getMarkupSvgElement());this._markupRenderer._clear();this._markupItems.forEach(function(b){b.draw()});this._markupRenderer._finalize()};b.prototype.renderActiveViewMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getRedlineSvgElement());
this._markupRenderer._clear();if(this._activeView){for(var b=0,c=this._activeView.getMarkup();b<c.length;b++)c[b].draw();this._markupRenderer._finalize()}};b.prototype.getPickTolerance=function(){return this._pickTolerance};b.prototype.setPickTolerance=function(b){this._pickTolerance=b};b.prototype.pick=function(b){var c=this;if(this._activeView)for(var a=0,d=this._activeView.getMarkup();a<d.length;a++){var e=d[a];if(e.hitWithTolerance(b,this._pickTolerance)||e.hit(b))return e}var g=null;this._markupItems.forEach(function(a){null===
g&&(a.hitWithTolerance(b,c._pickTolerance)||a.hit(b))&&(g=a)});return g};b.prototype.select=function(b){if(this._selectedMarkup&&b!==this._selectedMarkup)this._selectedMarkup.onDeselect();if(this._selectedMarkup=b)this._selectedMarkup.onSelect();this.update()};b.prototype.getSelected=function(){return this._selectedMarkup};return b}();h.MarkupItemManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._center=d.Point2.zero();a._radius=1;return a}__extends(a,c);a.prototype.set=function(a,c){this._center.assign(a);this.setRadius(c)};a.prototype.getCenter=function(){return this._center.copy()};a.prototype.setCenter=function(a){this._center.assign(a)};a.prototype.getRadius=function(){return this._radius};a.prototype.setRadius=function(a){this._radius=a};return a}(g.FilledShape);g.Circle=
b;var e=function(){return function(c,a){this.center=c.copy();this.radius=a}}();g._MarkupCircleData=e;b=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._circles=[];return a}__extends(a,c);a.prototype.clear=function(){this._circles=[]};a.prototype.addCircle=function(a,c){this._circles.push(new e(a,c))};a.prototype.setCircle=function(a,c,b){a=this._circles[a];a.center.assign(c);a.radius=b};a.prototype.getCircles=function(){return this._circles};return a}(g.FilledShape);g.CircleCollection=
b})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(c){function a(a,b){var f=c.call(this)||this;f._p1=a?a.copy():d.Point2.zero();f._p2=b?b.copy():d.Point2.zero();return f}__extends(a,c);a.prototype.set=function(a,c){this._p1.assign(a);this._p2.assign(c)};a.prototype.getP1=function(){return this._p1.copy()};a.prototype.setP1=function(a){this._p1.assign(a)};a.prototype.getP2=function(){return this._p2};a.prototype.setP2=function(a){this._p2.assign(a)};return a}(g.EndcapShape);g.Line=b;var e=function(){return function(c,
a){this.p1=c.copy();this.p2=a.copy()}}();g._MarkupLineData=e;b=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._lines=[];return a}__extends(a,c);a.prototype.addLine=function(a,c){this._lines.push(new e(a,c))};a.prototype.getLines=function(){return this._lines};a.prototype.clear=function(){this._lines=[]};return a}(g.EndcapShape);g.LineCollection=b})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function c(){this._padding=5;this._text=new g.TextMarkupBase;this._box=new g.RectangleBase;this._box.setFillOpacity(0);this._box.setFillColor(d.Color.white())}c.prototype._assign=function(a){this._text._assign(a._text);this._box._assign(a._box);this._padding=a._padding};c.prototype.getTextPortion=function(){return this._text};c.prototype.getBoxPortion=function(){return this._box};c.prototype.getPadding=function(){return this._padding};c.prototype.setPadding=
function(a){this._padding=a};return c}();g.TextBoxBase=b;var e=function(c){function a(a,b){var f=c.call(this)||this;f._position=d.Point2.zero();f._textStr="";a&&f._position.assign(a);b&&(f._textStr=b);return f}__extends(a,c);a.prototype._assign=function(a){c.prototype._assign.call(this,a);this._position.assign(a._position)};a.prototype.getPosition=function(){return this._position.copy()};a.prototype.setPosition=function(a){this._position.assign(a)};a.prototype.getTextString=function(){return this._textStr};
a.prototype.setTextString=function(a){this._textStr=a};return a}(b);g.TextBox=e;b=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._textStrings=[];return a}__extends(a,c);a.prototype.clear=function(){this._textStrings=[]};a.prototype.addString=function(a,c){this._textStrings.push(new g._MarkupTextData(a,c))};a.prototype.getStrings=function(){return this._textStrings};return a}(b);g.TextBoxCollection=b})(h.Shape||(h.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){var g=function(){return function(b,c){this.markupView=b;this.itemResults=c}}();h._MarkupViewConstruction=g;var b=function(){function b(c,a,b,d,e,g){void 0===g&&(g=null);this._faceVisibility=this._lineVisibility=!0;this._markupItems=new Set;this._sheetId=null;this._colorMap=new Map;this._snapshotImage=null;this._defaultVisibility=!0;this._visibilityExceptions=new Set;this._uniqueId=c;this._camera=b;this._name=a;this._explodeMagnitude=d;this._cuttingPlaneData=e;this._sheetId=g}
b.prototype.getCamera=function(){return this._camera};b.prototype.getSheetId=function(){return this._sheetId};b.prototype.getUniqueId=function(){return this._uniqueId};b.prototype.getName=function(){return this._name};b.prototype.setName=function(c){this._name=c};b.prototype.getLineVisibility=function(){return this._lineVisibility};b.prototype.setLineVisibility=function(c){this._lineVisibility=c};b.prototype.getFaceVisibility=function(){return this._faceVisibility};b.prototype.setFaceVisibility=function(c){this._faceVisibility=
c};b.prototype.addMarkupItem=function(c){this._markupItems.add(c)};b.prototype.getMarkup=function(){return d.Util.setToArray(this._markupItems)};b.prototype.removeMarkup=function(c){c.remove();return this._markupItems.delete(c)};b.prototype.getCuttingPlaneData=function(){return this._cuttingPlaneData};b.prototype.setCuttingPlaneData=function(c){this._cuttingPlaneData=c};b.prototype.getExplodeMagnitude=function(){return this._explodeMagnitude};b.prototype.setExplodeMagnitude=function(c){this._explodeMagnitude=
c};b.prototype.getColorMap=function(){return this._colorMap};b.prototype.setColorMap=function(c){this._colorMap=c};b.prototype.getDefaultVisibility=function(){return this._defaultVisibility};b.prototype.setDefaultVisibility=function(c){this._defaultVisibility=c};b.prototype.getVisibilityExceptions=function(){return this._visibilityExceptions};b.prototype.setVisibilityExceptions=function(c){this._visibilityExceptions=c};b.prototype.getSnapshotImage=function(){return this._snapshotImage};b.prototype.setSnapshotImage=
function(c){this._snapshotImage=c};b.prototype._handleLoadMarkupItem=function(c){return c instanceof h.MarkupItem?(this.addMarkupItem(c),!0):!1};b._fromJson=function(c,a){return __awaiter(this,void 0,void 0,function(){var f,e,l,h,m,p,q,r,w,t,u,v,z,x,y,A,B,D,C,F,E,H;return __generator(this,function(k){switch(k.label){case 0:f=c;e=d.Camera.fromJson(f.camera);f.hasOwnProperty("sheetId")&&f.sheetId&&(h=parseInt(c.sheetId,10),isNaN(h)||(l=h));m=new b(f.uniqueId,f.name,e,f.explodeMagnitude,f.cuttingData,
l);m.setLineVisibility(f.lineVisibility);m.setFaceVisibility(f.faceVisibility);void 0!==f.defaultVisibility&&void 0!==f.visibilityExceptions&&(m.setDefaultVisibility(f.defaultVisibility),p=new Set,f.visibilityExceptions.forEach(function(a){p.add(a)}),m.setVisibilityExceptions(p));q=new Map;r=f.colors;if(Array.isArray(r))for(w=0,t=r;w<t.length;w++)u=t[w],v=u[0],z=d.Color.fromJson(u[1]),q.set(v,z);m.setColorMap(q);x=[];console.assert(Array.isArray(f.markup));y=0;for(A=f.markup;y<A.length;y++)if(B=A[y],
D=d.Internal.classFromString(B.className))C=D.fromJson(B,a),C instanceof Promise?x.push(C.then(function(a){return m._handleLoadMarkupItem(a)})):x.push(Promise.resolve(m._handleLoadMarkupItem(C)));F=f.imageSrc;void 0!==F&&0<F.length&&(E=new Image,E.src=F,m.setSnapshotImage(E));return[4,Promise.all(x)];case 1:return H=k.sent(),[2,new g(m,H)]}})})};b.prototype.toJson=function(){return this._toJson()};b.prototype._toJson=function(){var c={uniqueId:this._uniqueId,name:this._name,camera:this._camera.toJson(),
cuttingData:this._cuttingPlaneData,explodeMagnitude:this._explodeMagnitude,lineVisibility:this._lineVisibility,faceVisibility:this._faceVisibility,markup:[],sheetId:this._sheetId,defaultVisibility:this._defaultVisibility,visibilityExceptions:[],colors:[],imageSrc:""};this._markupItems.forEach(function(a){var b=a.toJson();b.className=a.getClassName();c.markup.push(b)});this._visibilityExceptions.forEach(function(a){c.visibilityExceptions.push(a)});this._colorMap.forEach(function(a,b){c.colors.push([b,
a.toJson()])});null!==this._snapshotImage&&(c.imageSrc=this._snapshotImage.src);return c};b.prototype.forJson=function(){return this.toJson()};return b}();h.MarkupView=b})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a,d,e,g,h){var f=b.call(this)||this;f._markupViews=new Map;f._defaultViewCounter=1;f._markupItemManager=a;f._callbackManager=d;f._explodeManager=e;f._cuttingManager=g;f._viewer=c;f._sheetManager=h;f._initEvents();return f}__extends(e,b);e.prototype._initEvents=function(){var c=this;this._callbackManager.bind({modelSwitchStart:function(){c._markupItemManager.shutdown()}})};e.prototype.getView=function(c){c=this._markupViews.get(c);return void 0!==
c?c:null};e.prototype.getViewKeys=function(){var c=[];this._markupViews.forEach(function(a,b){c.push(b)});return c};e.prototype.loadData=function(c){return __awaiter(this,void 0,void 0,function(){var a,b,e,g,n,m=this;return __generator(this,function(f){a=[];b=0;for(e=c;b<e.length;b++)g=e[b],n=d.Markup.MarkupView._fromJson(g,this._viewer).then(function(a){if(!h.all(a.itemResults))return!1;a=a.markupView;var c=a.getUniqueId();return m._markupViews.has(c)?!1:(m._markupViews.set(c,a),m._callbackManager.trigger("viewLoaded",
a),!0)}),a.push(n);return[2,Promise.all(a)]})})};e.prototype.exportMarkup=function(){var c=[];this._markupViews.forEach(function(a){c.push(a.toJson())});return c};e.prototype.createView=function(c,a,b,e,g,h){void 0===c&&(c=this._createDefaultViewName());void 0===a&&(a=!0);void 0===b&&(b=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var f=this._viewer.view,k=d.UUID.create();c=new d.Markup.MarkupView(k,c,f.getCamera(),this._explodeManager.getMagnitude(),this._cuttingManager.toJson(),
b);this._markupViews.set(k,c);c.setLineVisibility(f.getLineVisibility());c.setFaceVisibility(f.getFaceVisibility());null!==e&&(c.setDefaultVisibility(e.defaultVisibility),c.setVisibilityExceptions(e.visibilityExceptions));null!==g&&c.setColorMap(g);null!==h&&c.setSnapshotImage(h);this._markupItemManager.setActiveView(c);a&&this._callbackManager.trigger("viewCreated",c);return c};e.prototype._activateSheet=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return null!==
c?[2,this._sheetManager.setActiveSheetId(c,!0,!1)]:[2]})})};e.prototype._activateViewImpl=function(c,a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,this._activateSheet(c.getSheetId())];case 1:return d.sent(),b=this._viewer.view,b.setFaceVisibility(c.getFaceVisibility()),b.setLineVisibility(c.getLineVisibility()),0<a?[4,this._markupItemManager.setActiveView(null)]:[3,4];case 2:return d.sent(),[4,b._setCameraPromise(c.getCamera(),
a)];case 3:return d.sent(),[3,5];case 4:b.setCamera(c.getCamera()),d.label=5;case 5:return[4,this._setActiveView(c)];case 6:return d.sent(),[2]}})})};e.prototype._activateView=function(c,a){c=this._markupViews.get(c);return void 0!==c?(a=this._activateViewImpl(c,a),h.UnsafePromise.create(!0,a)):h.UnsafePromise.create(!1,Promise.resolve())};e.prototype.activateView=function(c,a){void 0===a&&(a=d.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,
this._activateView(c,a)]})})};e.prototype.deprecatedActivateView=function(c,a){void 0===a&&(a=d.DefaultTransitionDuration);return this._activateView(c,a).unsafeValue};e.prototype._setActiveView=function(c){return __awaiter(this,void 0,void 0,function(){var a,b,d,e;return __generator(this,function(f){switch(f.label){case 0:return this._viewer.model.isDrawing()?null!==c.getSheetId()?[3,2]:[4,this._viewer.sheetManager.deactivateSheets()]:[3,5];case 1:return f.sent(),[3,4];case 2:a=c.getVisibilityExceptions();
b=c.getDefaultVisibility();if(!(0<a.size&&b))return[3,4];d=[];a.forEach(function(a){d.push(a)});return[4,this._viewer.model.setNodesVisibility(d,!1)];case 3:f.sent(),f.label=4;case 4:return[3,8];case 5:return b=c.getDefaultVisibility(),[4,this._viewer.model.setNodesVisibility([this._viewer.model.getAbsoluteRootNode()],b)];case 6:f.sent();a=c.getVisibilityExceptions();if(!(0<a.size))return[3,8];e=[];a.forEach(function(a){e.push(a)});return[4,this._viewer.model.setNodesVisibility(e,!b)];case 7:f.sent(),
f.label=8;case 8:return[4,this._markupItemManager.setActiveView(c)];case 9:return f.sent(),[4,this._cuttingManager.fromJson(c.getCuttingPlaneData())];case 10:return f.sent(),[4,this._viewer.model.setNodesColors(c.getColorMap())];case 11:return f.sent(),[4,this._explodeManager.setMagnitude(c.getExplodeMagnitude())];case 12:return f.sent(),[2]}})})};e.prototype.deleteView=function(c){var a=this._markupViews.get(c);return void 0!==a?(this._callbackManager.trigger("viewDeleted",a),a===this._markupItemManager.getActiveView()&&
this._markupItemManager.setActiveView(null),this._markupViews.delete(c),!0):!1};e.prototype._createDefaultViewName=function(){return"View "+this._defaultViewCounter++};e.prototype.toJson=function(){return this.exportMarkup()};e.prototype.forJson=function(){return this.toJson()};return e}(d.MarkupTypeManager);h.MarkupViewManager=g})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a,c,e,g,h){void 0===c&&(c=null);void 0===e&&(e=null);void 0===g&&(g=null);void 0===h&&(h=null);var f=b.call(this)||this;f._uniqueId=d.UUID.create();f._lineMeshId=null;f._lineMeshInstanceId=null;f._lineColor=d.Color.red();f._lineOpacity=1;f._linePattern=null;f._linePatternLength=null;f._linePatternLengthUnit=null;f._viewer=a;f._firstPoint=c;f._secondPoint=e;f._firstNodeId=g;f._secondNodeId=h;return f}__extends(c,b);c.prototype.setLineColor=
function(a){this._lineColor=a};c.prototype.getLineColor=function(){return this._lineColor};c.prototype.setLineOpacity=function(a){this._lineOpacity=a};c.prototype.getLineOpacity=function(){return this._lineOpacity};c.prototype.setLinePattern=function(a,c,b){this._linePattern=a;this._linePatternLength=c;this._linePatternLengthUnit=b};c.prototype.getLinePattern=function(){return void 0!==this._linePattern?this._linePattern:null};c.prototype.getLinePatternLength=function(){return void 0!==this._linePatternLength?
this._linePatternLength:null};c.prototype.getLinePatternLengthUnit=function(){return void 0!==this._linePatternLengthUnit?this._linePatternLengthUnit:null};c.prototype.setFirstPoint=function(a){this._firstPoint=a};c.prototype.getFirstPoint=function(){return this._firstPoint};c.prototype.setSecondPoint=function(a){this._secondPoint=a};c.prototype.getSecondPoint=function(){return this._secondPoint};c.prototype.setFirstNodeId=function(a){this._firstNodeId=a};c.prototype.getFirstNodeId=function(){return this._firstNodeId};
c.prototype.setSecondNodeId=function(a){this._secondNodeId=a};c.prototype.getSecondNodeId=function(){return this._secondNodeId};c.prototype.getNodeId=function(){return this._lineMeshInstanceId};c.prototype.removeLine=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=this._viewer.model,null===this._lineMeshInstanceId?[3,3]:[4,a.deleteMeshInstances([this._lineMeshInstanceId])];case 1:return c.sent(),this._lineMeshInstanceId=
null,null===this._lineMeshId?[3,3]:[4,a.deleteMeshes([this._lineMeshId])];case 2:c.sent(),this._lineMeshId=null,c.label=3;case 3:return[2]}})})};c.prototype.updateLine=function(){return __awaiter(this,void 0,void 0,function(){var a,c,b,e,g;return __generator(this,function(f){switch(f.label){case 0:return[4,this.removeLine()];case 1:f.sent();if(null===this._firstPoint||null===this._secondPoint)return[3,4];a=new d.MeshData;a.addPolyline([this._firstPoint.x,this._firstPoint.y,this._firstPoint.z,this._secondPoint.x,
this._secondPoint.y,this._secondPoint.z]);c=this._viewer.model;return[4,c.createMesh(a)];case 2:return this._lineMeshId=b=f.sent(),e=new d.MeshInstanceData(b),e.setLineColor(this._lineColor),e.setLineOpacity(this._lineOpacity),e.setCreationFlags(d.MeshInstanceCreationFlags.ExcludeBounding),[4,c.createMeshInstance(e)];case 3:g=f.sent(),null!==this._linePattern&&c.setNodesLinePattern([g],this._linePattern,this._linePatternLength,this._linePatternLengthUnit),this._lineMeshInstanceId=g,f.label=4;case 4:return[2]}})})};
c.prototype.getId=function(){return this._uniqueId};c.prototype.setId=function(a){this._uniqueId=a};c.prototype.getClassName=function(){return c.className};c.prototype._toJson=function(){return{className:this.getClassName(),uniqueId:this._uniqueId,firstPoint:this.getFirstPoint(),secondPoint:this.getSecondPoint(),firstNodeId:this.getFirstNodeId(),secondNodeId:this.getSecondNodeId(),lineColor:this.getLineColor(),lineOpacity:this.getLineOpacity(),linePattern:this.getLinePattern(),linePatternLength:this.getLinePatternLength(),
linePatternLengthUnit:this.getLinePatternLengthUnit()}};c.prototype.toJson=function(){return this._toJson()};c.fromJson=function(a,b){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(g){f=a;e=new c(b,d.Point3.fromJson(f.firstPoint),d.Point3.fromJson(f.secondPoint),f.firstNodeId,f.secondNodeId);e.setId(f.uniqueId);e.setLineColor(d.Color.fromJson(f.lineColor));e.setLineOpacity(f.lineOpacity);null!=f.linePattern&&null!=f.linePatternLength&&null!=f.linePatternLengthUnit&&
e.setLinePattern(f.linePattern,f.linePatternLength,f.linePatternLengthUnit);return[2,e]})})};c.className="Communicator.Markup.Line.LineMarkup";return c}(h.MarkupItem);g.LineMarkup=b})(h.Line||(h.Line={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(b){function c(a){var c=b.call(this)||this;c._viewer=a;return c}__extends(c,b);c.prototype.onDragStart=function(a){a;return!1};c.prototype.onDragMove=function(a){a;return!1};c.prototype.onDragEnd=function(a){a;return!1};c.prototype.remove=function(){this._viewer.trigger("redlineDeleted",this);this._viewer.markupManager.refreshMarkup()};return c}(d.MarkupItem);g.RedlineItem=b})(d.Redline||(d.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(){this._svgDefsElement=this._svgCanvas=null;this._svgElements=[];this._svgTextElements=[]}b.prototype._setCanvas=function(c){this._svgCanvas=c;this._svgDefsElement=document.createElementNS(g.Util.svgNamespace,"defs");this._svgCanvas.appendChild(this._svgDefsElement)};b.prototype._clear=function(){if(null===this._svgCanvas||null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");for(;this._svgCanvas.firstChild;)this._svgCanvas.removeChild(this._svgCanvas.firstChild);this._svgElements=
[];for(this._svgTextElements=[];this._svgDefsElement.firstChild;)this._svgDefsElement.removeChild(this._svgDefsElement.firstChild);this._svgCanvas.appendChild(this._svgDefsElement)};b.prototype._finalize=function(){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");for(var c=0,a=this._svgElements;c<a.length;c++){var b=a[c];this._svgCanvas.appendChild(b)}c=0;for(a=this._svgTextElements;c<a.length;c++)b=a[c],this._svgCanvas.appendChild(b)};b.prototype.drawCircle=function(c){return this._addCircleNode(c.getCenter(),
c.getRadius(),c)};b.prototype.drawCircles=function(c){for(var a=[],b=0,d=c.getCircles();b<d.length;b++){var e=d[b];e=this._addCircleNode(e.center,e.radius,c);a.push(e)}return a};b.prototype.drawLine=function(c){return this._addLineElement(c.getP1(),c.getP2(),c)};b.prototype.drawLines=function(c){for(var a=[],b=0,d=c.getLines();b<d.length;b++){var e=d[b];e=this._addLineElement(e.p1,e.p2,c);a.push(e)}return a};b.prototype.drawText=function(c){return this._addTextElement(c.getText(),c.getPosition(),
c)};b.prototype.drawTexts=function(c){for(var a=[],b=0,d=c.getStrings();b<d.length;b++){var e=d[b];e=this._addTextElement(e.text,e.position,c);a.push(e)}return a};b.prototype.measureText=function(c,a){if(null===this._svgCanvas)throw new d.CommunicatorError("canvas not set");c=this._createTextElement(c,d.Point2.zero(),a);this._svgCanvas.appendChild(c);a=c.getBoundingClientRect();a=new d.Point2(a.width,a.height);this._svgCanvas.removeChild(c);return a};b.prototype.measureTextBox=function(c){var a=this.measureText(c.getTextString(),
c.getTextPortion());a.x+=2*c.getBoxPortion().getStrokeWidth();a.y+=2*c.getBoxPortion().getStrokeWidth();a.x+=2*c.getPadding();a.y+=2*c.getPadding();return a};b.prototype.drawPolyline=function(c){return this._addPolylineElement(c.getPoints(),c)};b.prototype.drawPolylines=function(c){for(var a=[],b=0,d=c.getPolylines();b<d.length;b++){var e=this._addPolylineElement(d[b],c);a.push(e)}return a};b.prototype.drawPolygon=function(c){return this._addPolygonElement(c.getPoints(),c)};b.prototype.drawPolygons=
function(c){for(var a=[],b=0,d=c.getPolygons();b<d.length;b++){var e=this._addPolygonElement(d[b],c);a.push(e)}return a};b.prototype.drawRectangle=function(c){return this._addRectangleElement(c.getPosition(),c.getSize(),c)};b.prototype.drawRectangles=function(c){for(var a=[],b=0,d=c.getRectangles();b<d.length;b++){var e=d[b];e=this._addRectangleElement(e.position,e.size,c);a.push(e)}return a};b.prototype.drawTextBox=function(c){return this._addTextBoxElement(c.getTextString(),c.getPosition(),c)};
b.prototype.drawTextBoxes=function(c){for(var a=[],b=0,d=c.getStrings();b<d.length;b++){var e=d[b];e=this._addTextBoxElement(e.text,e.position,c);a.push(e)}return a};b.prototype._addTextBoxElement=function(c,a,b){var d=this.measureText(c,b.getTextPortion());d.x+=2*b.getPadding();d.y+=2*b.getPadding();var f=[];d=this._addRectangleElement(a,d,b.getBoxPortion(),!0);f.push(d);a=a.copy();a.x+=b.getPadding();a.y+=b.getPadding()/2+b.getBoxPortion().getStrokeWidth();c=this._addTextElement(c,a,b.getTextPortion());
f.push(c);return f};b.prototype._renderEndcaps=function(c,a,b,e){if(null===this._svgDefsElement)throw new d.CommunicatorError("canvas not set");b.getStartEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(b.getEndcapsInverted()?(c=g.Util.createEndArrowMarker(b.getStartEndcapSize(),b.getStartEndcapColor()),c.refX.baseVal.value=b.getStartEndcapSize()):c=g.Util.createStartArrowMarker(b.getStartEndcapSize(),b.getStartEndcapColor()),e.style.markerStart="url(#"+c.id+")",this._svgDefsElement.appendChild(c)):
b.getStartEndcapType()===d.Markup.Shape.EndcapType.Circle&&(c=g.Util.createCircleMarker(c,b.getStrokeWidth(),b.getStartEndcapSize(),b.getStartEndcapColor()),this._addSVGElement(c));b.getEndEndcapType()===d.Markup.Shape.EndcapType.Arrowhead?(c=b.getEndcapsInverted()?g.Util.createStartArrowMarker(b.getEndEndcapSize(),b.getEndEndcapColor()):g.Util.createEndArrowMarker(b.getEndEndcapSize(),b.getEndEndcapColor()),e.style.markerEnd="url(#"+c.id+")",this._svgDefsElement.appendChild(c)):b.getEndEndcapType()===
d.Markup.Shape.EndcapType.Circle&&(c=g.Util.createCircleMarker(a,b.getStrokeWidth(),b.getEndEndcapSize(),b.getEndEndcapColor()),this._addSVGElement(c))};b.prototype._createTextElement=function(c,a,b){var d=document.createElementNS(g.Util.svgNamespace,"text"),f=0;for(c=c.split("\n");f<c.length;f++){var e=c[f],h=document.createElementNS(g.Util.svgNamespace,"tspan");h.textContent=e;h.setAttributeNS(null,"x",""+a.x);h.setAttributeNS(null,"dy","1.2em");d.appendChild(h)}(f=b.getFontFamily())&&d.setAttributeNS(null,
"font-family",f);d.setAttributeNS(null,"font-size",b.getFontSize().toString());d.setAttributeNS(null,"x",""+a.x);d.setAttributeNS(null,"y",""+a.y);this._setGenericFillAttributes(d,b);this._setGenericStrokeAttributes(d,b);return d};b.prototype._addTextElement=function(c,a,b){c=this._createTextElement(c,a,b);this._addSVGTextItemElement(c);return c};b.prototype._addRectangleElement=function(b,a,d,e){void 0===e&&(e=!1);var c=document.createElementNS(g.Util.svgNamespace,"rect");c.setAttributeNS(null,"x",
b.x.toString());c.setAttributeNS(null,"y",b.y.toString());c.setAttributeNS(null,"width",a.x.toString());c.setAttributeNS(null,"height",a.y.toString());b=d.getBorderRadius();0<b&&(c.setAttributeNS(null,"rx",b.toString()),c.setAttributeNS(null,"ry",b.toString()));this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);e?this._addSVGTextItemElement(c):this._addSVGElement(c);return c};b.prototype._addLineElement=function(b,a,d){var c=document.createElementNS(g.Util.svgNamespace,"line");
c.setAttributeNS(null,"x1",b.x.toString());c.setAttributeNS(null,"y1",b.y.toString());c.setAttributeNS(null,"x2",a.x.toString());c.setAttributeNS(null,"y2",a.y.toString());this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);this._renderEndcaps(b,a,d,c);return c};b.prototype._addPolygonElement=function(b,a){b=g.Util.svgPointString(b);var c=document.createElementNS(g.Util.svgNamespace,"polygon");c.setAttributeNS(null,"points",b);this._setGenericStrokeAttributes(c,a);this._setGenericFillAttributes(c,
a);this._addSVGElement(c);return c};b.prototype._addPolylineElement=function(b,a){var c=g.Util.svgPointString(b),d=document.createElementNS(g.Util.svgNamespace,"polyline");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill","none");this._renderEndcaps(b[0],b[b.length-1],a,d);this._setGenericStrokeAttributes(d,a);this._addSVGElement(d);return d};b.prototype._addCircleNode=function(b,a,d){var c=document.createElementNS(g.Util.svgNamespace,"circle");c.setAttributeNS(null,"cx",b.x.toString());
c.setAttributeNS(null,"cy",b.y.toString());c.setAttributeNS(null,"r",a.toString());this._setGenericFillAttributes(c,d);this._setGenericStrokeAttributes(c,d);this._addSVGElement(c);return c};b.prototype._setGenericFillAttributes=function(b,a){b.setAttributeNS(null,"fill",g.Util.svgColorRgbString(a.getFillColor()));b.setAttributeNS(null,"fill-opacity",a.getFillOpacity().toString())};b.prototype._setGenericStrokeAttributes=function(b,a){b.setAttributeNS(null,"stroke",g.Util.svgColorRgbString(a.getStrokeColor()));
b.setAttributeNS(null,"stroke-width",a.getStrokeWidth().toString())};b.prototype._addSVGTextItemElement=function(b){this._svgTextElements.push(b)};b.prototype._addSVGElement=function(b){this._svgElements.push(b)};return b}();g.SVGMarkupRenderer=b})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){(function(b){function e(b){return"rgb("+b.r+", "+b.g+", "+b.b+")"}b.svgNamespace="http://www.w3.org/2000/svg";b.svgColorRgbString=e;b.svgPointString=function(b){for(var a="",c=0;c<b.length;c++)c&&(a+=" "),a+=b[c].x+","+b[c].y;return a};b.createStartArrowMarker=function(c,a){var f=1.1*c,g=new d.Point2(f,0),l=new d.Point2(f,c),h=new d.Point2(0,c/2),m=document.createElementNS(b.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=
c;m.setOrientToAuto();m.refY.baseVal.value=c/2;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(b.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(a));m.appendChild(f);return m};b.createEndArrowMarker=function(c,a){var f=1.1*c,g=d.Point2.zero(),l=new d.Point2(0,c),h=new d.Point2(f,c/2),m=document.createElementNS(b.svgNamespace,"marker");m.id=d.UUID.create();m.markerWidth.baseVal.value=f;m.markerHeight.baseVal.value=c;m.setOrientToAuto();
m.refY.baseVal.value=c/2;m.refX.baseVal.value=c;c="M"+g.x+","+g.y+" L"+l.x+","+l.y+" L"+h.x+","+h.y+" Z";f=document.createElementNS(b.svgNamespace,"path");f.setAttribute("d",c);f.setAttributeNS(null,"fill",e(a));m.appendChild(f);return m};b.createCircleMarker=function(c,a,d,g){d/=2;g=e(g);var f=document.createElementNS(b.svgNamespace,"circle");f.setAttributeNS(null,"cx",c.x.toString());f.setAttributeNS(null,"cy",c.y.toString());f.setAttributeNS(null,"r",d.toString());f.setAttributeNS(null,"fill",
g);0<a&&(f.setAttributeNS(null,"stroke-width",a.toString()),f.setAttributeNS(null,"stroke",g));return f}})(g.Util||(g.Util={}))})(h.SVG||(h.SVG={}))})(d.Internal||(d.Internal={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._points=[];return a}__extends(c,b);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(a){this._points.push(a.copy())};return c}(d.FilledShape);d.Polygon=b;b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._polygons=[];return a}__extends(c,b);c.prototype.clear=function(){this._polygons=
[]};c.prototype.createPolygon=function(){var a=[];this._polygons.push(a);return a};c.prototype.getPolygons=function(){return this._polygons};return c}(d.FilledShape);d.PolygonCollection=b})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(d){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._points=[];return a}__extends(c,b);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(a){this._points.push(a.copy())};return c}(d.EndcapShape);d.Polyline=b;b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._polylines=[];return a}__extends(c,b);c.prototype.clear=function(){this._polylines=
[]};c.prototype.createPolyline=function(){var a=[];this._polylines.push(a);return a};c.prototype.getPolylines=function(){return this._polylines};return c}(d.EndcapShape);d.PolylineCollection=b})(d.Shape||(d.Shape={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(a,b){var c=Math.abs(a.x);var f=Math.abs(a.y),e=Math.abs(a.z);c=c<=f&&c<=e?new d.Point3(1,0,0):f<=c&&f<=e?new d.Point3(0,1,0):new d.Point3(0,0,1);a=d.Point3.cross(c,a);return b?(b.assign(a),b):a}function b(a,b,c,d){var f=c.normal.x*(b.x-a.x)+c.normal.y*(b.y-a.y)+c.normal.z*(b.z-a.z);if(1E-5>Math.abs(f))return!1;c=-(c.d+c.normal.x*a.x+c.normal.y*a.y+c.normal.z*a.z)/f;d.x=a.x+c*(b.x-a.x);d.y=a.y+c*(b.y-a.y);d.z=a.z+c*(b.z-a.z);return 0>c||1<c?!1:!0}function e(a){if(.01>
Math.abs(a-25.4/72))return"points";if(.01>Math.abs(a-25.4))return"inch";if(.01>Math.abs(a-1))return"mm";if(.01>Math.abs(a-10))return"cm";if(.01>Math.abs(a-25.4/6))return"picas";if(.01>Math.abs(a-12*25.4))return"ft";if(.01>Math.abs(a-914.4))return"yd";if(.01>Math.abs(a-1E3))return"m";if(.01>Math.abs(a-1E6))return"km";if(.01>Math.abs(a-1609344))return"mi";console.log("warning: unit multiplier doesn't map to known type: unit="+a);return""}function c(a){return Math.PI/180*a}function a(a){return 180/Math.PI*
a}function f(a,b,f){a=a.copy().normalize();var e=c(b);b=Math.cos(e);e=Math.sin(e);var g=1-b,k=g*a.x*a.y,l=g*a.x*a.z,h=g*a.y*a.z;void 0===f&&(f=new d.Matrix);f.m[0]=g*a.x*a.x+b;f.m[1]=e*a.z+k;f.m[2]=l-e*a.y;f.m[3]=0;f.m[4]=k-e*a.z;f.m[5]=g*a.y*a.y+b;f.m[6]=e*a.x+h;f.m[7]=0;f.m[8]=e*a.y+l;f.m[9]=h-e*a.x;f.m[10]=g*a.z*a.z+b;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f}function k(a,b,c){b=d.Point3.subtract(b,a);a=d.Point3.subtract(c,a);a=d.Point3.dot(a,b)/b.squaredLength();return Math.max(0,
Math.min(1,a))}h.oneVectorCross=g;h.intersectionPlaneLine2=b;h.computePointToLineDistance=function(a,b,c,f){var e=d.Point3.subtract(c,b),g=e.squaredLength(),k=0;0<g&&(k=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y)+(a.z-b.z)*(c.z-b.z))/g);e.set(e.x*k,e.y*k,e.z*k);f.set(b.x+e.x,b.y+e.y,b.z+e.z);new d.Point3(0,0,0);return d.Point3.subtract(a,f).length()};h.formatWithUnit=function(a,b){b=e(b);for(var c,d=2;9>d&&(c=a.toFixed(d),0===parseFloat(c));d++);0===parseFloat(c)&&(c="0");return c+b};h.degreesToRadians=
c;h.radiansToDegrees=a;h.computeOffaxisRotation=f;h.intersect3d2Planes=function(a,b,c,f,e,g){var k=d.Point3.cross(a.normal,c.normal),l=Math.abs(k.x),h=Math.abs(k.y),n=Math.abs(k.z);if(1E-7>l+h+n)return c=d.Point3.subtract(f,b),0===d.Point3.dot(a.normal,c)?1:0;l=l>h?l>n?1:3:h>n?2:3;h=d.Point3.zero();b=-d.Point3.dot(a.normal,b);f=-d.Point3.dot(c.normal,f);switch(l){case 1:h.x=0;h.y=(f*a.normal.z-b*c.normal.z)/k.x;h.z=(b*c.normal.y-f*a.normal.y)/k.x;break;case 2:h.x=(b*c.normal.z-f*a.normal.z)/k.y;h.y=
0;h.z=(f*a.normal.x-b*c.normal.x)/k.y;break;case 3:h.x=(f*a.normal.y-b*c.normal.y)/k.z,h.y=(b*c.normal.x-f*a.normal.x)/k.z,h.z=0}e.assign(h);g.set(h.x+k.x,h.y+k.y,h.z+k.z);return 2};h.intersectionPlaneLine=function(a,c,f,e,g,k){var l=new d.Plane;l.normal.x=(e.y-f.y)*(g.z-f.z)-(e.z-f.z)*(g.y-f.y);l.normal.y=(e.z-f.z)*(g.x-f.x)-(e.x-f.x)*(g.z-f.z);l.normal.z=(e.x-f.x)*(g.y-f.y)-(e.y-f.y)*(g.x-f.x);l.normal.normalize();l.d=-l.normal.x*f.x-l.normal.y*f.y-l.normal.z*f.z;return b(a,c,l,k)};h.computeAngleBetweenVector=
function(b,c){b=b.copy().normalize();var f=c.copy().normalize();c=d.Point3.cross(b,f).length();b=d.Point3.dot(b,f);return a(Math.atan2(c,b))};h.generatePointsOnCircle=function(a,b,c,f,e){for(var k=2*Math.PI/f,l=0;l<f;l++)a[l]=new d.Point3(0,c*Math.cos(k*l),c*Math.sin(k*l));a[f]=a[0].copy();c=g(e);c.normalize();k=d.Point3.cross(c,e);k.normalize();l=new d.Matrix;var h=l.m;h[0]=e.x;h[1]=e.y;h[2]=e.z;h[3]=0;h[4]=c.x;h[5]=c.y;h[6]=c.z;h[7]=0;h[8]=k.x;h[9]=k.y;h[10]=k.z;h[11]=0;h[12]=0;h[13]=0;h[14]=0;
h[15]=1;l.transformArray(a,a);for(l=0;l<=f;l++)a[l].set(a[l].x+b.x,a[l].y+b.y,a[l].z+b.z)};h.distanceLineLine=function(a,b,c,f,e,g){var k=0,l=0,h=d.Point3.subtract(b,a),n=d.Point3.subtract(f,c),m=d.Point3.dot(h,a),p=d.Point3.dot(h,n),q=d.Point3.dot(h,h),r=d.Point3.dot(h,c),B=d.Point3.dot(n,n),D=d.Point3.dot(n,c),C=d.Point3.dot(n,a);f=d.Point3.dot(h,f);var F=d.Point3.dot(n,b),E=q*B-p*p;0===E?(0!==q?(r=(r-m)/q,0>r?r=0:1<r&&(r=1),m=(f-m)/q,0>m?m=0:1<m&&(m=1)):m=r=0,0!==B?(C=(C-D)/B,0>C?C=0:1<C&&(C=1),
B=(F-D)/B,0>B?B=0:1<B&&(B=1)):B=C=0,k=(r+m)/2,l=(C+B)/2):(b=(p*C-p*D-B*m+B*r)/E,p=(q*C-q*D+p*r-p*m)/E,r=(r-m)/q,C=(C-D)/B,m=(f-m)/q,B=(F-D)/B,0<=b&&1>=b&&0<=p&&1>=p?(k=b,l=p):0>b&&0<=p&&1>=p?(k=b,l=C):1<b&&0<=p&&1>=p?(k=b,l=B):0<=b&&1>=b&&0>p?(k=r,l=p):0<=b&&1>=b&&1<p?(k=m,l=p):0>b&&0>p?(k=r,l=C):0>b&&1<p?(k=m,l=C):1<b&&0>p?(k=r,l=B):1<b&&1<p&&(k=m,l=B),0>k?k=0:1<k&&(k=1),0>l?l=0:1<l&&(l=1));e.x=k*h.x+a.x;e.y=k*h.y+a.y;e.z=k*h.z+a.z;g.x=l*n.x+c.x;g.y=l*n.y+c.y;g.z=l*n.z+c.z;return d.Point3.subtract(g,
e).length()};h.lineLineIntersect=function(a,b,c,f){var e=d.Point3.zero(),g=d.Point3.zero(),k=d.Point3.zero(),l=d.Point3.zero(),h=d.Point3.zero();k.x=a.x-c.x;k.y=a.y-c.y;k.z=a.z-c.z;l.x=f.x-c.x;l.y=f.y-c.y;l.z=f.z-c.z;if(1E-12>Math.abs(l.x)&&1E-12>Math.abs(l.y)&&1E-12>Math.abs(l.z))return null;h.x=b.x-a.x;h.y=b.y-a.y;h.z=b.z-a.z;if(1E-12>Math.abs(h.x)&&1E-12>Math.abs(h.y)&&1E-12>Math.abs(h.z))return null;b=k.x*l.x+k.y*l.y+k.z*l.z;f=l.x*h.x+l.y*h.y+l.z*h.z;var n=k.x*h.x+k.y*h.y+k.z*h.z;k=l.x*l.x+l.y*
l.y+l.z*l.z;var m=(h.x*h.x+h.y*h.y+h.z*h.z)*k-f*f;if(1E-12>Math.abs(m))return null;n=(b*f-n*k)/m;b=(b+f*n)/k;e.x=a.x+n*h.x;e.y=a.y+n*h.y;e.z=a.z+n*h.z;g.x=c.x+b*l.x;g.y=c.y+b*l.y;g.z=c.z+b*l.z;return e};h.closestPointScalarFromPointToSegment=k;h.closestPointFromPointToSegment=function(a,b,c){c=k(a,b,c);b=d.Point3.subtract(b,a).scale(c);return d.Point3.add(a,b)};h.isPointOnLineSegment=function(a,b,c,f){var e=k(a,b,c);if(0>e||1<e)return!1;b=d.Point3.subtract(b,a).scale(e);a=d.Point3.add(a,b);return d.Point3.subtract(a,
c).squaredLength()<=f*f};h.isPointOnLineSegment2d=function(a,b,c,f){var e=d.Point2.subtract(c,b);var g=e.length();e.scale(((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/(g*g));e=d.Point2.add(b,e);return d.Point2.distance(a,e)<=f?e.x<Math.min(b.x,c.x)||e.x>Math.max(b.x,c.x)||e.y<Math.min(b.y,c.y)||e.y>Math.max(b.y,c.y)?!1:!0:!1};h.isPointInRect2d=function(a,b,c,d){void 0===d&&(d=0);return a.x+d<b.x||a.x>b.x+c.x+d||a.y+d<b.y||a.y>b.y+c.y+d?!1:!0};h.generateArcPoints=function(a,b,c,e,g){var k=[],l=d.Point3.zero(),
h=new d.Matrix;b/=g;for(var n=0,m=0;n<=g;++n,m+=b)f(a,m,h),h.transform(e,l),k.push(d.Point3.add(c,l));return k}})(d.Util||(d.Util={}))})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,e){this.origin=d.Point3.zero();this.direction=new d.Point3(0,0,1);b&&this.origin.assign(b);e&&this.direction.assign(e)}g.prototype.copy=function(){return new g(this.origin,this.direction)};g.prototype.assign=function(b){this.origin.assign(b.origin);this.direction.assign(b.direction);return this};g.prototype.negate=function(){this.direction.negate();return this};return g}();d.Ray=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(){this.normal=d.Point3.zero();this.d=0}g.prototype.setFromPointAndNormal=function(b,e){this.normal.assign(e);this.d=-d.Point3.dot(e,b);return this};g.prototype.setFromPoints=function(b,e,c){this.normal=d.Point3.cross(d.Point3.subtract(e,b),d.Point3.subtract(c,b)).normalize();this.d=-d.Point3.dot(b,this.normal)};g.prototype.setFromCoefficients=function(b,d,c,a){this.normal.set(b,d,c);this.d=a};g.prototype.getCoefficients=function(){var b=this.normal;return[b.x,
b.y,b.z,this.d]};g.prototype.distanceToPoint=function(b){return d.Point3.dot(this.normal,b)+this.d};g.prototype.rayIntersection=function(b){var e=d.Point3.zero();return this.intersectsRay(b,e)?e:null};g.prototype.intersectsRay=function(b,e){var c=d.Point3.dot(this.normal,b.direction),a=this.distanceToPoint(b.origin),f=-a/c;return 0<=f&&0<Math.abs(c)?(e&&(c=b.direction.copy().scale(f),e.set(b.origin.x+c.x,b.origin.y+c.y,b.origin.z+c.z)),!0):0<=f&&0>=Math.abs(a)?(e&&e.assign(b.origin),!0):!1};g.prototype.determineSide=
function(b){return 0<this.normal.x*b.x+this.normal.y*b.y+this.normal.z*b.z+this.d?!0:!1};g.prototype.copy=function(){var b=new g;b.normal.assign(this.normal);b.d=this.d;return b};g.prototype.assign=function(b){this.normal.assign(b.normal);this.d=b.d};g.prototype.equals=function(b){return this.normal.equals(b.normal)&&this.d===b.d};g.createFromPointAndNormal=function(b,d){return(new g).setFromPointAndNormal(b,d)};g.createFromPoints=function(b,d,c){var a=new g;a.setFromPoints(b,d,c);return a};g.createFromCoefficients=
function(b,d,c,a){var f=new g;f.setFromCoefficients(b,d,c,a);return f};return g}();d.Plane=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function d(b,d,c,a){this.x=b;this.y=d;this.z=c;this.w=a}d.prototype.scale=function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this};d.prototype.set=function(b,d,c,a){this.x=b;this.y=d;this.z=c;this.w=a};d.prototype.assign=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w};d.zero=function(){return new d(0,0,0,0)};return d}();d.Point4=h})(Communicator||(Communicator={}));
(function(d){var h=function(){function g(b,d,c,a){this.x=b;this.y=d;this.z=c;this.w=a}g.prototype.set=function(b,d,c,a){this.x=b;this.y=d;this.z=c;this.w=a};g.prototype.assign=function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w};g.prototype.copy=function(){return new g(this.x,this.y,this.z,this.w)};g.prototype.equals=function(b){return this.x===b.x&&this.y===b.y&&this.z===b.z&&this.w===b.w};g.prototype.equalsWithTolerance=function(b,d){return this.x-b.x<d&&this.x-b.x>-d&&this.y-b.y<d&&this.y-
b.y>-d&&this.z-b.z<d&&this.z-b.z>-d&&this.w-b.w<d&&this.w-b.w>-d};g.prototype.fromArray=function(b){this.x=b[0];this.y=b[1];this.z=b[2];this.w=b[3];return this};g.prototype.toArray=function(b){b[0]=this.x;b[1]=this.y;b[2]=this.z;b[3]=this.w;return this};g.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};g.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};g.prototype.magnitude=function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)};g.prototype.normalize=function(){var b=this.magnitude();this.x/=b;this.y/=b;this.z/=b;this.w/=b};g.add=function(b,d){return new g(b.x+d.x,b.y+d.y,b.z+d.z,b.w+d.w)};g.subtract=function(b,d){return new g(b.x-d.x,b.y-d.y,b.z-d.z,b.w-d.w)};g.Identity=function(){return g.identity()};g.identity=function(){return new g(0,0,0,1)};g.toMatrix=function(b){var e=b.x*b.x+b.y*b.y+b.z*b.z+b.w*b.w;e=2/e;var c=b.x*e,a=b.y*e,f=b.z*e;e=b.w*c;var g=b.w*a,l=b.w*f;c*=
b.x;var h=b.x*a,m=b.x*f;a*=b.y;var p=b.y*f;b=b.z*f;f=new d.Matrix;f.m[0]=1-(a+b);f.m[1]=h+l;f.m[2]=m-g;f.m[3]=0;f.m[4]=h-l;f.m[5]=1-(c+b);f.m[6]=p+e;f.m[7]=0;f.m[8]=m+g;f.m[9]=p-e;f.m[10]=1-(c+a);f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};g.createFromMatrix=function(b){var d=[],c=b.m[0]+b.m[5]+b.m[10];if(0<c){var a=Math.sqrt(c+1);d[3]=.5*a;a=.5/a;d[0]=a*(b.m[6]-b.m[9]);d[1]=a*(b.m[8]-b.m[2]);d[2]=a*(b.m[1]-b.m[4])}else{c=0;b.m[5]>b.m[0]&&(c=1);b.m[10]>b.m[4*c+c]&&(c=2);a=[1,2,0];
var f=a[c],k=a[f];a=Math.sqrt(b.m[4*c+c]-(b.m[4*f+f]+b.m[4*k+k])+1);d[c]=.5*a;a=.5/a;d[3]=a*(b.m[4*f+k]-b.m[4*k+f]);d[f]=a*(b.m[4*c+f]+b.m[4*f+c]);d[k]=a*(b.m[4*c+k]+b.m[4*k+c])}return g.identity().fromArray(d)};g.interpolate=function(b,d,c){var a=[],f=[],e=[];b.toArray(a);d.toArray(f);b=a[0]*f[0]+a[1]*f[1]+a[2]*f[2]+a[3]*f[3];if(1+b>g._epsilon){if(1-b>g._epsilon){d=g._arccos(b);var l=1/Math.sin(d);b=l*Math.sin((1-c)*d);c=l*Math.sin(c*d)}else b=1-c;for(d=0;4>d;++d)e[d]=b*a[d]+c*f[d]}else for(e[0]=
-a[1],e[1]=a[0],e[2]=-a[3],e[3]=a[2],b=Math.sin(.5*Math.PI*(1-c)),c=Math.sin(.5*Math.PI*c),d=0;3>d;++d)e[d]=b*a[d]+c*e[d];return g.identity().fromArray(e)};g._arccos=function(b){return-1>b?Math.PI:1<b?0:Math.acos(b)};g._epsilon=1E-5;return g}();d.Quaternion=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,a){this._button=b;this._modifier=a}b.prototype.getButton=function(){return this._button};b.prototype.getModifier=function(){return this._modifier};return b}();h.ButtonModifier=g;var b=function(){function b(b){this._ptFirst=d.Point2.zero();this._ptPrevious=d.Point2.zero();this._ptCurrent=d.Point2.zero();this._dragging=!1;this._dragCount=0;this._primaryTouchId=null;this._mapping=[];this._buttonModifierActive=!1;this._doubleClickInterval=200;this._firstMouseDownTime=
null;this._isDoubleClick=!1;this._viewer=b}b.prototype.onDoubleClick=function(b){};b.prototype.onMouseDown=function(b){this._firstMouseDownTime?Date.now()-this._firstMouseDownTime<this._doubleClickInterval?(this._isDoubleClick=!0,this._firstMouseDownTime=null):this._firstMouseDownTime=Date.now():(this._firstMouseDownTime=Date.now(),this._isDoubleClick=!1);if(this._isDoubleClick)this.onDoubleClick(b);else{if(this._buttonModifierActive=this.checkMapping(b))b=b.getPosition(),this._ptFirst.assign(b),
this._ptPrevious.assign(b),this._ptCurrent.assign(b);this._dragging=!0}};b.prototype.onMouseMove=function(b){this.isActive()&&(this._ptPrevious.assign(this._ptCurrent),this._ptCurrent.assign(b.getPosition()),this._dragging&&!this._ptCurrent.equals(this._ptPrevious)&&(++this._dragCount,1===this._dragCount&&this._viewer.trigger("beginInteraction")))};b.prototype.onMouseUp=function(b){this._buttonModifierActive&&this.stopInteraction();this._dragging=!1};b.prototype.stopInteraction=function(){this._viewer.trigger("endInteraction");
this._dragging=!1;this._dragCount=0;this._buttonModifierActive=!1};b.prototype.isDragging=function(){return this._dragging};b.prototype.isActive=function(){return(this._buttonModifierActive||null!==this._primaryTouchId)&&!this._isDoubleClick&&!this._viewer.getContextMenuStatus()};b.prototype.onTouchStart=function(b){if(null===this._primaryTouchId){this._primaryTouchId=b.getId();var a=b.getPosition();a=new d.Event.MouseInputEvent(a.x,a.y,d.Button.None,b.getButtons(),d.KeyModifiers.None,d.MouseInputType.Down);
this.onMouseDown(a)}b.setHandled(this.setHandled())};b.prototype.onTouchMove=function(b){if(this._primaryTouchId===b.getId()){var a=b.getPosition();a=new d.Event.MouseInputEvent(a.x,a.y,d.Button.None,b.getButtons(),d.KeyModifiers.None,d.MouseInputType.Move);this.onMouseMove(a)}b.setHandled(this.setHandled())};b.prototype.onTouchEnd=function(b){if(this._primaryTouchId===b.getId()){var a=b.getPosition();a=new d.Event.MouseInputEvent(a.x,a.y,d.Button.None,b.getButtons(),d.KeyModifiers.None,d.MouseInputType.Up);
this.onMouseUp(a);this._primaryTouchId=null}b.setHandled(this.setHandled())};b.prototype.addMapping=function(b,a){void 0===a&&(a=d.KeyModifiers.None);this._mapping.push(new g(b,a))};b.prototype.clearMapping=function(){this._mapping=[]};b.prototype.setMapping=function(b,a){void 0===a&&(a=d.KeyModifiers.None);this._mapping=[];this._mapping.push(new g(b,a))};b.prototype.checkMapping=function(b){if(0===this._mapping.length)return!0;for(var a=0,c=this._mapping;a<c.length;a++){var d=c[a];if(d.getButton()===
b.getButton()&&d.getModifier()===b.getModifiers())return!0}return!1};b.prototype.setHandled=function(){return!1};b.prototype.onDeactivate=function(){var b=this.stopInteraction();this._primaryTouchId=null;return b};return b}();h.OperatorBase=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this)||this;c._stage=0;c._finalized=!1;c._uniqueId="";c._positions=[];c._name="";c._measurementValue=0;c._unitMultiplier=1;c._textShape=new h.Shape.TextBox;c._visibility=!0;c._positions=[];c._lineShapes=[];c._viewer=a;return c}__extends(c,b);c.prototype.getName=function(){return this._name};c.prototype.setName=function(a){this._name=a};c.prototype._getStage=function(){return this._stage};c.prototype._nextStage=function(){this._stage++};
c.prototype._setId=function(a){this._uniqueId=a};c.prototype._getId=function(){return this._uniqueId};c.prototype.adjust=function(a){a};c.prototype._isFinalized=function(){return this._finalized};c.prototype.update=function(){};c.prototype.draw=function(){this.update()};c.prototype.setVisibility=function(a){this._visibility=a;this.draw();a?this._viewer.trigger("measurementShown",this):this._viewer.trigger("measurementHidden",this)};c.prototype.getVisibility=function(){return this._visibility};c.prototype.toJson=
function(){return{}};c.prototype.forJson=function(){return this.toJson()};c.prototype.getMeasurementValue=function(){return this._measurementValue};c.prototype.getUnitMultiplier=function(){return this._unitMultiplier};c.prototype.setMeasurementText=function(a){this._textShape.setTextString(a)};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._setMeasurementValue=function(a){this._measurementValue=a/this._unitMultiplier;this.setMeasurementText(d.Util.formatWithUnit(this._measurementValue,
this._unitMultiplier));this._viewer.trigger("measurementValueSet",this)};c._serializePointArray=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toJson());return b};c._constructPointArray=function(a){for(var b=[],c=0;c<a.length;c++){var e=d.Point3.fromJson(a[c]);b.push(e)}return b};return c}(h.MarkupItem);g.MeasureMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function c(a){a=b.call(this,a)||this;a._rectangle=new d.Markup.Shape.Rectangle;a._markupHandle=null;a._dim=new d.Point2(0,0);a.initialPosition=new d.Point2(0,0);a.currentPosition=new d.Point2(0,0);a.min=new d.Point2(0,0);a.max=new d.Point2(0,0);a._name="_RectangleMarkup";a._rectangle.setFillOpacity(0);return a}__extends(c,b);c.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawRectangle(this._rectangle)};c.prototype.updateCurrentPosition=
function(a){this.currentPosition.assign(a);this._rectangle.setStrokeColor(this.initialPosition.x<this.currentPosition.x?d.Color.red():d.Color.blue());this.min.assign(this.initialPosition);this.max.assign(this.currentPosition);this.max.x<this.min.x&&(a=this.max.x,this.max.x=this.min.x,this.min.x=a);this.max.y<this.min.y&&(a=this.max.y,this.max.y=this.min.y,this.min.y=a);this._dim.assign(this.max);this._dim.subtract(this.min);this._updateRectangleVertices()};c.prototype._updateRectangleVertices=function(){this._rectangle.setPosition(this.min);
this._rectangle.setSize(this._dim)};c.prototype.activate=function(a){this.initialPosition.assign(a);this.currentPosition.assign(a);this.min.assign(a);this.max.assign(a);this._dim.set(0,0);this._rectangle.setStrokeWidth(1);this._updateRectangleVertices();this._markupHandle=this._viewer.markupManager.registerMarkup(this)};c.prototype.deactivate=function(){this.initialPosition.set(0,0);this.currentPosition.set(0,0);this.min.set(0,0);this.max.set(0,0);this._dim.set(0,0);this._rectangle.setStrokeWidth(0);
this._updateRectangleVertices();var a=this._viewer.markupManager;null!==this._markupHandle&&(a.unregisterMarkup(this._markupHandle),this._markupHandle=null);a.refreshMarkup()};c.prototype.isActive=function(){return null!==this._markupHandle};return c}(d.Markup.Measure.MeasureMarkup),b=function(b){function c(a){var c=b.call(this,a)||this;c._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;c._rectangleMarkup=new g(a);c._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",
a);a.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},selectionArray:function(a){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return 0!==a.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}});return c}
__extends(c,b);c.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};c.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};c.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};c.prototype.clearSelection=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.clearSelection()]})})};c.prototype._allowSelection=function(a,b){return a.x===b.x||a.y===b.y?!1:!0};c.prototype._createBeginConfig=function(a,b,c){var f=new d.IncrementalPickConfig;f.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;f.ignoreCuttingSections=!1;f.ignoreUnrequestedInstances=!0;c&&(f.mustBeFullyContained=!0);return{pickConfig:f,areaCssMin:a,
areaCssMax:b}};c.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return b=this._rectangleMarkup.min.copy(),c=this._rectangleMarkup.max.copy(),e=this._rectangleMarkup.initialPosition.x<this._rectangleMarkup.currentPosition.x,a?[4,this.clearSelection()]:[3,2];case 1:f.sent(),f.label=2;case 2:if(!this._allowSelection(b,c))return[2];g=this._createBeginConfig(b,c,e);f.label=3;case 3:return f.trys.push([3,
5,,6]),[4,this._incrementalSelection.performSelection(g)];case 4:return[2,f.sent()];case 5:h=f.sent();if(!(h instanceof d.SelectionInvalidatedError))throw h;return[3,6];case 6:return[2]}})})};c.prototype.setHandled=function(){return!0};c.prototype.onKeyUp=function(a){a.getKeyCode()===d.KeyCode.Escape&&this.clearSelection()};c.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a);this.isActive()&&(a.setHandled(!0),this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate(),
this._rectangleMarkup.activate(a.getPosition()))};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a);this.isActive()&&this._rectangleMarkup.isActive()&&(a.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(a.getPosition()),this._viewer.markupManager.refreshMarkup())};c.prototype.onMouseUp=function(a){if(this.isActive()&&this._rectangleMarkup.isActive()){a.setHandled(!0);this._rectangleMarkup.updateCurrentPosition(a.getPosition());var c=!a.controlDown();this._performSelection(c)}this._rectangleMarkup.isActive()&&
this._rectangleMarkup.deactivate();b.prototype.onMouseUp.call(this,a)};return c}(h.OperatorBase);h.AreaSelectionOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c)||this;a._axisTriad=c.view.getAxisTriad();a._pickConfig=new d.PickConfig(d.SelectionMask.Face);a._pickConfig.restrictToOverlays=!0;return a}__extends(e,b);e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:if(!(this._axisTriad.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()&&this._axisTriad.insideOverlay(c.getPosition())))return[3,
3];c.setHandled(!0);return[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)];case 1:return a=f.sent(),[4,this._axisTriad.onClickSelection(a)];case 2:f.sent(),f.label=3;case 3:return b.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.AxisTriadOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(b,c,a,d,g){this.section=b;this.node=c;this.planeIndex=a;this.plane=d;this.selectionPosition=g;this.origPlaneD=d.d}}(),b=function(b){function c(a,c){a=b.call(this,a)||this;a._context=null;a._cuttingManager=c;return a}__extends(c,b);c.prototype.onMouseDown=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b.prototype.onMouseDown.call(this,a),this.isActive()&&this._cuttingManager.hasActiveCuttingSection()?
[4,this._startSelection(a)]:[3,2];case 1:c.sent(),a.setHandled(null!==this._context),c.label=2;case 2:return[2]}})})};c.prototype.onMouseMove=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:b.prototype.onMouseMove.call(this,a);c=this._context;if(!this.isActive()||null===c)return[3,2];a.setHandled(!0);return[4,this._updatePlane(a.getPosition(),c,!1)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDrag",c.section,c.planeIndex),
d.label=2;case 2:return[2]}})})};c.prototype._updatePlane=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h,r,w,t,u;return __generator(this,function(l){switch(l.label){case 0:f=b.selectionPosition;e=b.plane.normal.copy().add(b.selectionPosition);g=this._viewer.view.unprojectPoint(a,0);k=this._viewer.view.unprojectPoint(a,.5);if(null===g||null===k)return[3,3];h=d.Util.lineLineIntersect(f,e,g,k);if(null===h)return[3,2];r=d.Point3.subtract(h,b.selectionPosition);w=0>d.Point3.dot(r,
b.plane.normal)?r.length():-r.length();b.plane.d=b.origPlaneD+w;t=b.plane.normal.copy().scale(-w);u=(new d.Matrix).setTranslationComponent(t.x,t.y,t.z);return[4,b.section.updatePlane(b.planeIndex,b.plane,u,c,!1)];case 1:l.sent(),l.label=2;case 2:this._cuttingManager.delayCapping(),l.label=3;case 3:return[2]}})})};c.prototype.onMouseUp=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:c=this._context;if(!this.isActive()||null===
c)return[3,2];a.setHandled(!0);return[4,this._updatePlane(a.getPosition(),c,!0)];case 1:d.sent(),this._viewer.trigger("cuttingPlaneDragEnd",c.section,c.planeIndex),d.label=2;case 2:return this._context=null,b.prototype.onMouseUp.call(this,a),[2]}})})};c.prototype.setHandled=function(){return this.isActive()&&null!==this._context};c.prototype._startSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return this._context=
null,b=a.getPosition(),c=d.SelectionMask.Face|d.SelectionMask.Line,e=new d.PickConfig(c),e.ignoreCappingGeometry=!0,e.forceEffectiveSceneVisibilityMask=d.SelectionMask.Face,[4,this._viewer.view.compositePickFromPoint(b,e)];case 1:h=f.sent();m=h.fetchMostRelevant(c);if(null===m)return[2];p=m.getNodeId();q=this._cuttingManager.getCuttingSectionFromNodeId(p);null!==q&&(r=q.getPlaneIndexByNodeId(p),this._context=new g(q,p,r,q.getPlane(r),m.getPosition()),this._cuttingManager.delayCapping(),this._viewer.trigger("cuttingPlaneDragStart",
q,r));return[2]}})})};return c}(h.OperatorBase);h.CuttingPlaneOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c)||this;a._draggingAvatar=!1;a._restrictToAvatar=!0;a._floorLocked=!1;a._manager=c.floorplanManager;return a}__extends(e,b);e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var a,f,e,g;return __generator(this,function(k){switch(k.label){case 0:b.prototype.onMouseDown.call(this,c);if(!this._manager.isActive())return[2];a=c.getPosition();if(this._restrictToAvatar)return[3,1];f=this._manager.insideOverlay(a);
return[3,3];case 1:return e=new d.PickConfig,e.restrictToOverlays=!0,[4,this._viewer.view.pickFromPoint(a,e)];case 2:g=k.sent(),f=g.getNodeId()===this._manager.getAvatarNodeId(),k.label=3;case 3:if(!f)return[3,5];this._draggingAvatar=!0;this._floorLocked=this._manager.getFloorLock();return[4,this._manager.setFloorLock(!0)];case 4:k.sent(),this._manager.snapAvatarToPoint(a),c.setHandled(!0),k.label=5;case 5:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return b.prototype.onMouseUp.call(this,c),this._draggingAvatar?[4,this._manager.setFloorLock(this._floorLocked)]:[3,2];case 1:a.sent(),a.label=2;case 2:return this._draggingAvatar=!1,[2]}})})};e.prototype.onMouseMove=function(c){b.prototype.onMouseMove.call(this,c);this._manager.isActive()&&this._draggingAvatar&&(c.setHandled(!0),c=c.getPosition(),this._manager.insideOverlay(c)&&this._manager.snapAvatarToPoint(c))};e.prototype.restrictToAvatar=function(b){this._restrictToAvatar=
b};return e}(h.OperatorBase);h.FloorplanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c)||this;a._draggingHandle=!1;a._newRotationMatrix=new d.Matrix;a._translation=d.Point3.zero();a._newTranslation=d.Point3.zero();a._nodeIdGroupMap=new Map;a._groupIdCount=0;a._activeChildrenGroupIds=new Map;a._initialLocalNodeMatrices=[];a._newLocalNodeMatrices=[];a._trackedPoints=[];a._trackedPointsPositions=[];a._trackedPointCount=0;a._previousContextClick=!1;a._overlayIndex=null;a._activeHandleNodeId=null;a._handleEventType=
d.HandleEventType.Translate;a._highlightedHandleId=null;a._handleSize=1;a._explodeActive=!1;a._measureActive=!1;a._settingMatrixInProgress=!1;a._handleMarkup=new d.Markup.HandleMarkup(c);a._pickConfig=new d.PickConfig(d.SelectionMask.Face);a._pickConfig.restrictToOverlays=!0;c.setCallbacks({explode:function(b){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return(this._explodeActive=0<b)?[4,this.removeHandles()]:[3,2];case 1:a.sent(),a.label=
2;case 2:return[2]}})})},measurementBegin:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._measureActive=!0,[4,this.removeHandles()];case 1:return a.sent(),[2]}})})},measurementCreated:function(){a._measureActive=!1}});return a}__extends(e,b);e.prototype.setAxisMeshData=function(b){return this._handleMarkup.setAxisMeshData(b)};e.prototype.setPlaneMeshData=function(b){return this._handleMarkup.setPlaneMeshData(b)};e.prototype.setViewPlaneMeshData=
function(b){return this._handleMarkup.setViewPlaneMeshData(b)};e.prototype.setRotateMeshData=function(b){return this._handleMarkup.setRotateMeshData(b)};e.prototype.addTrackedPoint=function(b){var a=this._trackedPointCount;this._trackedPoints[a]=b.copy();this._trackedPointsPositions[a]=b.copy();++this._trackedPointCount;return a};e.prototype.getTrackedPoints=function(){return this._trackedPointsPositions};e.prototype.clearTrackedPoints=function(){this._trackedPoints.length=0;this._trackedPointCount=
this._trackedPointsPositions.length=0};e.prototype.isEnabled=function(){return!this._explodeActive&&!this._measureActive&&!this._viewer.sheetManager.isDrawingSheetActive()};e.prototype._guardEnabled=function(){if(!this.isEnabled()){var b=this._explodeActive?"Handles are not enabled when the model is exploded":this._measureActive?"Handles are not enabled while a measurement is in progress.":this._viewer.sheetManager.isDrawingSheetActive()?"Handles are not enabled for 2d drawings.":"Handles are not enabled.";
throw new d.CommunicatorError(b);}};e.prototype.setHandleSize=function(b){this._handleSize=b};e.prototype.addHandles=function(b,a,d){void 0===a&&(a=null);void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return this._previousContextClick=!1,this._guardEnabled(),a?[3,2]:[4,this._viewer.model.getNodesBounding(b)];case 1:return c=f.sent(),[2,this.addHandles(b,c.center())];case 2:return null===d&&(d=this.generateGroupId()),
this._nodeIdGroupMap.set(d,b),[2,this._handleMarkup.addHandles(a,this._handleSize,d)]}})})};e.prototype.generateGroupId=function(){return this._groupIdCount++};e.prototype._massageGroupId=function(b){return null===b?d.Markup.HandleMarkup.defaultGroupId:b};e.prototype.addAxisTranslationHandle=function(b,a,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addAxisTranslationHandle(b,
a,d,e,this._massageGroupId(g))]})})};e.prototype.addAxisRotationHandle=function(b,a,d,e,g){void 0===e&&(e=null);void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addRotateHandle(b,a,d,e,this._massageGroupId(g))]})})};e.prototype.addPlaneTranslationHandle=function(b,a,d,e,g,h){void 0===g&&(g=null);void 0===h&&(h=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addPlaneTranslationHandle(b,a,d,e,g,this._massageGroupId(h))]})})};e.prototype.addViewPlaneTranslationHandle=function(b,a,d){void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addViewPlaneHandle(b,a,this._massageGroupId(d))]})})};e.prototype.setNodeIds=function(b,a){void 0===a&&
(a=null);this._nodeIdGroupMap.set(this._massageGroupId(a),b)};e.prototype.getNodeIds=function(b){void 0===b&&(b=null);b=this._nodeIdGroupMap.get(this._massageGroupId(b));return void 0===b?[]:b.slice()};e.prototype.showHandles=function(){this._handleMarkup.showOverlay()};e.prototype.updatePosition=function(b,a,d,e){void 0===e&&(e=null);return this._handleMarkup.updatePosition(b,a,d,this._massageGroupId(e),this._activeChildrenGroupIds)};e.prototype.getPosition=function(){var b=this._handleMarkup.getHandleNodeIds();
return 0<b.length&&(b=this._handleMarkup.getPosition(b[0]),null!==b)?b.copy():null};e.prototype.removeHandles=function(){this._newRotationMatrix=new d.Matrix;this._translation=d.Point3.zero();this._highlightedHandleId=null;this._nodeIdGroupMap.clear();this._groupIdCount=0;return this._handleMarkup.removeHandles()};e.prototype.getTranslation=function(){return this._translation};e.prototype._initLocalNodeMatrices=function(b){var a=this._viewer.model;this._initialLocalNodeMatrices=[];for(var c=0;c<b.length;c++)this._initialLocalNodeMatrices.push(a.getNodeMatrix(b[c]))};
e.prototype._getHandleEventType=function(b){return this._handleMarkup.getHandleType(b)===d.HandleType.Rotate?d.HandleEventType.Rotate:d.HandleEventType.Translate};e.prototype._rotate=function(b,a,f,e){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(e);return[4,this._genericTransform(b,a,d.Point3.zero(),f,c,e)];case 1:return g.sent(),this._viewer.trigger("handleEvent",
d.HandleEventType.Rotate,c,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};e.prototype._translate=function(b,a,f){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:if(!this._draggingHandle||this._settingMatrixInProgress)return[2];c=this.getNodeIds(f);return[4,this._genericTransform(d.Point3.zero(),0,b,a,c,f)];case 1:return e.sent(),this._viewer.trigger("handleEvent",d.HandleEventType.Translate,c,this._initialLocalNodeMatrices,
this._newLocalNodeMatrices),[2]}})})};e.prototype._genericTransform=function(b,a,f,e,g,h){return __awaiter(this,void 0,void 0,function(){var c,k,l,n,w,t,u,v,z,x,y,A,B,D,C,F;return __generator(this,function(m){switch(m.label){case 0:this._settingMatrixInProgress=!0;c=this._viewer.model;k=new d.Matrix;this._newTranslation=f;0<b.squaredLength()&&(k=this._getRotationMatrix(b,d.Point3.zero(),a),this._newRotationMatrix=k.copy());l=[];l.push(this.updatePosition(this._newTranslation,this._newRotationMatrix,
!1,h));this._newLocalNodeMatrices=[];for(n=0;n<g.length;n++)w=this._newTranslation.copy(),t=g[n],u=this._initialLocalNodeMatrices[n].copy(),v=b.copy(),z=e.copy(),x=void 0,y=c.getNodeParent(t),null!==y?(x=c.getNodeNetMatrix(y),A=d.Matrix.inverse(x),null!==A&&(A.transform(z,z),A.setTranslationComponent(0,0,0),A.transform(v,v),A.transform(w,w))):x=null,0<b.squaredLength()&&(k=this._getRotationMatrix(v,z,x&&0>x.upperLeft3x3Determinant()?-a:a),u=d.Matrix.multiply(u,k)),u.setTranslationComponent(u.m[12]+
w.x,u.m[13]+w.y,u.m[14]+w.z),l.push(c.setNodeMatrix(t,u)),this._newLocalNodeMatrices.push(u);B=this._newRotationMatrix.copy();B.setTranslationComponent(f.x,f.y,f.z);for(n=0;n<this._trackedPoints.length;++n)D=this._trackedPoints[n].copy(),C=d.Point3.subtract(D,e),B.transform(C,C),F=d.Point3.add(C,e),this._trackedPointsPositions[n]=F;return[4,d.Util.waitForAll(l)];case 1:return m.sent(),this._settingMatrixInProgress=!1,[2]}})})};e.prototype._testRotate=function(b,a,f){void 0===f&&(f=null);return __awaiter(this,
void 0,void 0,function(){var c,e;return __generator(this,function(g){switch(g.label){case 0:f=this._massageGroupId(f);c=this._getActiveNodeIdByGroupId(f);if(null===c)return[3,3];e=this._handleMarkup.getPosition(c);if(null===e)return[2];this._startDragging(c,d.HandleEventType.Rotate);return[4,this._rotate(b,a,e,f)];case 1:return g.sent(),[4,this._stopDragging()];case 2:g.sent(),g.label=3;case 3:return[2]}})})};e.prototype._testTranslate=function(b,a){void 0===a&&(a=null);return __awaiter(this,void 0,
void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:a=this._massageGroupId(a);c=this._getActiveNodeIdByGroupId(a);if(null===c)return[3,3];this._startDragging(c,d.HandleEventType.Translate);return[4,this._translate(b,d.Point3.zero(),a)];case 1:return f.sent(),[4,this._stopDragging()];case 2:f.sent(),f.label=3;case 3:return[2]}})})};e.prototype._getActiveNodeIdByGroupId=function(b){for(var a=this._handleMarkup.getHandleNodeIds(),c=0;c<a.length;++c){var d=a[c];if(this._handleMarkup.getHandleGroupId(d)===
b)return d}return null};e.prototype._startDragging=function(b,a){var c=this;this._activeHandleNodeId=b;this._handleEventType=a;var d=this._handleMarkup.getHandleGroupId(b),e=this.getNodeIds(d),g=new Map;this._nodeIdGroupMap.forEach(function(a,b){b!==d&&a.forEach(function(a){for(var d=c._viewer.model.getNodeParent(a);null!==d;){if(-1!==e.indexOf(d)){g.set(b,a);break}d=c._viewer.model.getNodeParent(d)}})});this._activeChildrenGroupIds=g;0<e.length&&(this._initLocalNodeMatrices(e),this._viewer.trigger("handleEventStart",
this._handleEventType,e,this._initialLocalNodeMatrices),this._draggingHandle=!0)};e.prototype._stopDragging=function(){return __awaiter(this,void 0,void 0,function(){var b,a;return __generator(this,function(c){switch(c.label){case 0:this._draggingHandle=!1;if(null===this._activeHandleNodeId)return[3,2];b=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);return[4,this.updatePosition(this._newTranslation,this._newRotationMatrix,!0,b)];case 1:c.sent(),a=this.getNodeIds(b),this._activeHandleNodeId=
null,this._activeChildrenGroupIds.clear(),this._viewer.trigger("handleEventEnd",this._handleEventType,a,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),this._newRotationMatrix=new d.Matrix,this._handleMarkup.resetTranslation(),this._translation.add(this._newTranslation),this._newTranslation=d.Point3.zero(),this._trackedPoints=this._trackedPointsPositions.slice(),c.label=2;case 2:return[2]}})})};e.prototype.onMouseDown=function(c){return __awaiter(this,void 0,void 0,function(){var a,d,e,
g;return __generator(this,function(f){switch(f.label){case 0:return b.prototype.onMouseDown.call(this,c),this._overlayIndex=null,[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 1:return a=f.sent(),a.isNodeEntitySelection()&&(d=a.getNodeId(),e=this._viewer.model.getNodeName(d),null!==e&&"handle-"===e.slice(0,7)&&(c.setHandled(!0),g=this._getHandleEventType(d),this._startDragging(d,g))),[2]}})})};e.prototype._onHandleDrag=function(){if(null!==this._activeHandleNodeId){var b=
this._viewer.view.getCamera();d.Point3.zero();d.Point3.zero();var a=this._handleMarkup.getHandleType(this._activeHandleNodeId),f=this._handleMarkup.getVector(this._activeHandleNodeId),e=this._handleMarkup.getPosition(this._activeHandleNodeId);if(null!==a&&null!==e){var g=this._handleMarkup.getHandleGroupId(this._activeHandleNodeId);switch(a){case d.HandleType.Axis:null!==f&&(b=this._getTranslationComponent(e,f,0,g),this._translate(b,e,g));break;case d.HandleType.Plane:null!==f&&(b=this._getTranslationComponent(e,
f,1,g),this._translate(b,e,g));break;case d.HandleType.ViewPlane:f=b.getTarget();b=b.getPosition();b=d.Point3.subtract(b,f).normalize();b=this._getTranslationComponent(e,b,2,g);this._translate(b,e,g);break;case d.HandleType.Rotate:null!==f&&(this._handleMarkup.getGroupIdRotationMatrix(g).copy().setTranslationComponent(0,0,0).transform(f,f),b=this._getRotationAngle(e,f),this._rotate(f,b,e,g));break;default:d.Util.TypeAssertNever(a)}}}};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,
void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:b.prototype.onMouseMove.call(this,c);if(!this._draggingHandle||null===this._activeHandleNodeId)return[3,1];this._onHandleDrag();return[3,4];case 1:return[4,this._viewer.view.pickFromPoint(c.getPosition(),this._pickConfig)];case 2:return a=d.sent(),[4,this._highlightHandle(a)];case 3:d.sent(),d.label=4;case 4:return[2]}})})};e.prototype.onMouseUp=function(c){this._draggingHandle||!(3>this._dragCount)||c.getButton()===
d.Button.Right||this._previousContextClick||this._viewer.getContextMenuStatus()||0!==this._overlayIndex&&null!==this._overlayIndex||this.removeHandles();this._previousContextClick=c.getButton()===d.Button.Right||this._viewer.getContextMenuStatus();this._draggingHandle&&this._stopDragging();b.prototype.onMouseUp.call(this,c)};e.prototype.setHandled=function(){return this._draggingHandle};e.prototype._getClosestPoint=function(b,a,f){var c=b.copy();b=b.copy().add(a);a=this._viewer.view.unprojectPoint(f,
0);f=this._viewer.view.unprojectPoint(f,.5);return null!==a&&null!==f?d.Util.lineLineIntersect(c,b,a,f):null};e.prototype._getTranslationComponent=function(b,a,f,e){2!==f&&this._handleMarkup.getGroupIdRotationMatrix(e).copy().setTranslationComponent(0,0,0).transform(a,a);var c=e=null;1===f||2===f?(e=this._getPlaneIntersectionPoint(b,a,this._ptFirst),null!==e&&(c=this._getPlaneIntersectionPoint(e,a,this._ptCurrent))):0===f&&(e=this._getClosestPoint(b,a,this._ptFirst),null!==e&&(c=this._getClosestPoint(e,
a,this._ptCurrent)));return null!==c&&null!==e?d.Point3.subtract(c,e):d.Point3.zero()};e.prototype._clearHighlightedHandle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return null===this._highlightedHandleId?[3,2]:[4,this._viewer.model.unsetNodesFaceColor([this._highlightedHandleId])];case 1:b.sent(),this._highlightedHandleId=null,b.label=2;case 2:return[2]}})})};e.prototype._highlightHandle=function(b){return __awaiter(this,
void 0,void 0,function(){var a,c,e;return __generator(this,function(f){switch(f.label){case 0:if(!b.isNodeEntitySelection()||b.overlayIndex()!==d.BuiltinOverlayIndex.Handles)return[3,2];a=this._viewer.model;c=a.getNodeName(b.getNodeId());if(null===c||"handle-"!==c.slice(0,7))return[3,2];e=b.getNodeId();return this._highlightedHandleId===e?[2]:[4,this._clearHighlightedHandle()];case 1:return f.sent(),this._highlightedHandleId=e,a.setNodesFaceColor([this._highlightedHandleId],d.Color.green()),[2];case 2:return[2,
this._clearHighlightedHandle()]}})})};e.prototype._getPlaneIntersectionPoint=function(b,a,f){var c=this._viewer.view.unprojectPoint(f,0);f=this._viewer.view.unprojectPoint(f,.5);if(null===c||null===f)return null;c=new d.Ray(c,f.copy().subtract(c));b=d.Plane.createFromPointAndNormal(b,a);a=d.Point3.zero();return b.intersectsRay(c,a)?a:null};e.prototype._getRotationAngle=function(b,a){console.assert(null!==b);var c=this._getPlaneIntersectionPoint(b,a,this._ptFirst),e=this._getPlaneIntersectionPoint(b,
a,this._ptCurrent);if(null===c||null===e)return 0;c=d.Point3.subtract(c,b).normalize();b=d.Point3.subtract(e,b).normalize();e=d.Point3.dot(c,b);e=180*Math.acos(e)/Math.PI;0>d.Point3.dot(d.Point3.cross(c,b),a)&&(e=-e);return e};e.prototype._getRotationMatrix=function(b,a,f){var c=(new d.Matrix).setTranslationComponent(-a.x,-a.y,-a.z);b=d.Matrix.createFromOffAxisRotation(b,f);a=(new d.Matrix).setTranslationComponent(a.x,a.y,a.z);return d.Matrix.multiply(d.Matrix.multiply(c,b),a)};return e}(h.OperatorBase);
h.HandleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c)||this;a._navCube=c.view.getNavCube();a._pickConfig=new d.PickConfig(d.SelectionMask.Face);a._pickConfig.restrictToOverlays=!0;return a}__extends(e,b);e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(f){switch(f.label){case 0:return b.prototype.onMouseMove.call(this,c),a=c.getPosition(),d=this._dragging&&1<this._dragCount,this._navCube.getEnabled()&&
!d&&this._navCube.insideOverlay(a)?[4,this._viewer.view.pickFromPoint(a,this._pickConfig)]:[3,2];case 1:e=f.sent(),this._navCube.onMoveSelection(e),f.label=2;case 2:return[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(f){switch(f.label){case 0:return this._navCube.getEnabled()&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?[4,this._viewer.view.pickFromPoint(this._ptFirst,this._pickConfig)]:[3,
3];case 1:return a=f.sent(),[4,this._navCube.onClickSelection(a)];case 2:f.sent(),f.label=3;case 3:return b.prototype.onMouseUp.call(this,c),[2]}})})};return e}(h.OperatorBase);h.NavCubeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){c=b.call(this,c)||this;c._insertNoteButton=d.Button.Left;c._callbackFlag=!1;c._noteTextManager=a;return c}__extends(e,b);e.prototype.onMouseDown=function(c){var a=this;b.prototype.onMouseDown.call(this,c);this.isActive()&&(this._callbackFlag||(this._viewer.setCallbacks({explode:function(b){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._noteTextManager.explode(b)];case 1:return a.sent(),
[2]}})})}}),this._callbackFlag=!0),this._dragging=!1)};e.prototype.onMouseUp=function(c){var a=this;if(this.isActive()){var f=new d.PickConfig(d.SelectionMask.Face);if(this._ptFirst.equals(this._ptCurrent)&&c.getButton()===this._insertNoteButton||null!==this._primaryTouchId)f=this._viewer.view.pickFromPoint(c.getPosition(),f).then(function(b){a._noteTextManager.selectPin(b)||a._noteTextManager.getExplodeActive()||a._noteTextManager.getIsolateActive()||0!==b.overlayIndex()||(b.isFaceSelection()&&new d.Markup.Note.NoteText(a._viewer,
a._noteTextManager,b.getPosition(),b.getFaceEntity().getNormal(),b.getNodeId()),c.setHandled(!0))}),f}b.prototype.onMouseUp.call(this,c)};e.prototype.getNoteTextElement=function(){return this._noteTextManager.getNoteTextElement()};e.prototype.setNoteTextElement=function(b){this._noteTextManager.setNoteTextElement(b)};e.prototype.checkPinInstance=function(b){return null!==this._noteTextManager.checkPinInstance(b)};return e}(h.OperatorBase);h.NoteOperator=g})(d.Operator||(d.Operator={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c)||this;a._selectionButton=d.Button.Left;a._ignoreTransparency=!1;a._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;a._incrementalSelection=d.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},
selectionArray:function(b){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return 0!==b.length?[3,2]:[4,this._incrementalSelection.stopSelection()];case 1:a.sent(),a.label=2;case 2:return[2]}})})}});return a}__extends(e,b);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(b){this._forceEffectiveSceneVisibilityMask=b};e.prototype.setIgnoreTransparency=
function(b){this._ignoreTransparency=b};e.prototype.getIgnoreTransparency=function(){return this._ignoreTransparency};e.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._incrementalSelection.waitForIdle()]})})};e.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,
this._incrementalSelection.clearSelection()]})})};e.prototype._createBeginConfig=function(b){var a=new d.IncrementalPickConfig;a.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;a.ignoreUnrequestedInstances=!0;return{pickConfig:a,rayCssOrigin:b,rayCssBoxRadius:10}};e.prototype._selectionPredicate=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,d;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.model,c=b.getNodeId(),null===
c?[2,!1]:[4,a.getNodesHaveTransparency([c])];case 1:return d=f.sent()[0],[2,!d]}})})};e.prototype._performSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,d=this;return __generator(this,function(f){a=this._createBeginConfig(b);c=this._ignoreTransparency?function(a){return d._selectionPredicate(a)}:null;return[2,this._incrementalSelection.performSelection(a,c)]})})};e.prototype.setHandled=function(){return!0};e.prototype.onKeyUp=function(b){b.getKeyCode()===d.KeyCode.Escape&&
this.clearSelection()};e.prototype.onMouseUp=function(c){var a=this;this.isActive()&&function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return(c.getButton()===this._selectionButton||null!==this._primaryTouchId)&&25>d.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()?c.controlDown()?[3,2]:[4,this.clearSelection()]:[3,4];case 1:a.sent(),a.label=2;case 2:return[4,this._performSelection(c.getPosition())];case 3:a.sent(),a.label=
4;case 4:return[2]}})})}();b.prototype.onMouseUp.call(this,c)};return e}(h.OperatorBase);h.RayDrillSelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){c=b.call(this,c)||this;c._selectionButton=d.Button.Left;c._forceEffectiveSceneVisibilityMask=d.SelectionMask.None;c._doubleClickFitWorld=!0;c._noteTextManager=a;return c}__extends(e,b);e.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};e.prototype.setForceEffectiveSceneVisibilityMask=function(b){this._forceEffectiveSceneVisibilityMask=b};e.prototype.getSelectionButton=function(){return this._selectionButton};
e.prototype.setSelectionButton=function(b){this._selectionButton=b};e.prototype.onKeyUp=function(b){b.getKeyCode()===d.KeyCode.Escape&&this._viewer.selectionManager.clear()};e.prototype.onMouseUp=function(c){var a=this;if(this.isActive()&&5>d.Point2.subtract(this._ptFirst,this._ptCurrent).length()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)){var f=this._viewer.view,e=new d.PickConfig(d.SelectionMask.Face|d.SelectionMask.Line);e.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;
f=f.pickFromPoint(this._ptCurrent,e).then(function(b){var f=null!==a._viewer.cuttingManager.getCuttingSectionFromNodeId(b.getNodeId()),e=a._noteTextManager.selectPin(b),g=a._viewer.markupManager.pickMarkupItem(a._ptCurrent);if(g instanceof d.Markup.Redline.RedlineText)g.onSelect();e||f||null!==g||(b.isNodeSelection()?a._processSelectionClick(c,b):a._isDoubleClick||a._viewer.selectionManager.clear())});f}b.prototype.onMouseUp.call(this,c)};e.prototype.onDoubleClick=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){return this._doubleClickFitWorld?[2,this._viewer.view.fitWorld()]:[2]})})};e.prototype.setDoubleClickFitWorldEnabled=function(b){this._doubleClickFitWorld=b};e.prototype._getSelectionOrParentIfSelected=function(b){var a=this._viewer.model,c=b.getNodeId();if(!a.isNodeLoaded(c)||a.getNodeType(c)===d.NodeType.PmiBody)return b;var e=this._viewer.selectionManager,g=null;e.getSelectParentIfSelected()&&(g=e.containsParent(b));return null!==g?(a=
d.Selection.SelectionItem.create(a.getNodeParent(g.getNodeId())),a.isNodeSelection()?a:b):e.contains(b)?(a=d.Selection.SelectionItem.create(a.getNodeParent(c)),a.isNodeSelection()?a:b):b};e.prototype._processSelectionClick=function(b,a){var c=a.overlayIndex();if(0===c||null===c)c=this._viewer.selectionManager,b.controlDown()||b.commandDown()?c.toggle(a):(b=this._getSelectionOrParentIfSelected(a),c.set(b))};return e}(h.OperatorBase);h.SelectionOperator=g})(d.Operator||(d.Operator={}))})(Communicator||
(Communicator={}));
(function(d){(function(h){function g(a,b){var c=new d.PickConfig(d.SelectionMask.Face);c.bimMask=a;c.ignoreOverlays=!0;null!==b&&(c.maxWorldDistance=b);return c}function b(a,b,c,e){return __awaiter(this,void 0,void 0,function(){var f,k,l;return __generator(this,function(h){switch(h.label){case 0:return f=new d.Ray(b,c),k=g(d.BimMask.Floor,e),[4,a.pickFromRay(f,k)];case 1:return l=h.sent(),l.isFaceSelection()?[2,l.getPosition()]:[2,null]}})})}function e(a,b,c,e){return __awaiter(this,void 0,void 0,
function(){var f,k,l;return __generator(this,function(h){switch(h.label){case 0:return f=new d.Ray(b,c),k=g(d.BimMask.Wall,e),[4,a.pickFromRay(f,k)];case 1:return l=h.sent(),l.isFaceSelection()?[2,l]:[2,null]}})})}var c=function(){function a(a){this._nearbyDoors=new Set;this._viewer=a}a.prototype._performSphereSelection=function(a,b,c){var f=d.Util.IncrementalSelection.create("View",this._viewer),e=new d.IncrementalPickConfig(d.SelectionMask.Face);e.bimMask=c;e.onlyStreamedInstances=!0;e.ignoreUnrequestedInstances=
!0;return f.performSelection({pickConfig:e,sphereCenter:a,sphereRadius:b})};a.prototype.updateNearbyDoors=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,l,h,n,v,z,x,y;return __generator(this,function(m){switch(m.label){case 0:return[4,this._performSphereSelection(a,b,d.BimMask.Door)];case 1:f=m.sent();e=new Set;g=0;for(k=f;g<k.length;g++)l=k[g],h=l.getNodeId(),e.add(h);n=d.Util.setSubtraction(e,this._nearbyDoors);v=d.Util.setSubtraction(this._nearbyDoors,e);z=d.Util.setToArray(n);
x=d.Util.setToArray(v);y=this._viewer.model;y.setNodesOpacity(z,c);y.resetNodesOpacity(x);this._nearbyDoors=e;return[2]}})})};a.prototype.forgetNearbyDoors=function(){var a=d.Util.setToArray(this._nearbyDoors);this._nearbyDoors.clear();this._viewer.model.resetNodesOpacity(a)};return a}(),a=function(a){function f(b){var f=a.call(this,b)||this;f._elevationSpeed=0;f._rotationSpeed=0;f._viewAngle=90;f._zoomDistance=0;f._walkDistance=0;f._tilt=0;f._majorAxis=d.Axis.X;f._maxExtents=0;f._walkActive=!1;f._activeWalk=
new d.Util.CurrentAction(!0);f._bimModeEnabled=!1;f._synchronizedToggleBimMode=new d.Util.CurrentActionSync;f._initialInteractiveDrawLimitIncreaseStatus=!0;f._logical={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._effective={floor:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.FloorConfig),wall:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.WallConfig),
door:__assign({},h.CameraKeyboardWalkOperator.Bim.Default.DoorConfig)};f._doorCache=new c(b);f._downAxis=new d.Point3(0,-1,0);b.setCallbacks({subtreeLoaded:function(a,b){b===d.NodeSource.LoadModel&&f._updateSceneFloor()}});return f}__extends(f,a);f.prototype._updateSceneFloor=function(){var a=this._viewer.model.getViewAxes().upVector;console.assert(a.isAxis());this._downAxis=d.Point3.scale(a,-1)};f.prototype.isBimModeEnabled=function(){return this._bimModeEnabled};f.prototype._enableBimMode=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._bimModeEnabled=!0,this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor),this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall),this._effective.door=this._scaleAgainstModelUnit(this._logical.door),this._updateSceneFloor(),[4,this._applyGravity()];case 1:return a.sent(),[4,this._updateNearbyDoors()];case 2:return a.sent(),[2]}})})};f.prototype._disableBimMode=function(){this._bimModeEnabled=
!1;this._doorCache.forgetNearbyDoors()};f.prototype.enableBimMode=function(){var a=this;return this._synchronizedToggleBimMode.set(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._enableBimMode()];case 1:return a.sent(),[2]}})})})};f.prototype.disableBimMode=function(){var a=this;return this._synchronizedToggleBimMode.set(function(){a._disableBimMode()})};f.prototype.toggleBimMode=function(){var a=this;return this._synchronizedToggleBimMode.set(function(){return a._bimModeEnabled?
a._disableBimMode():a._enableBimMode()})};f.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){var a,b,c,f,e;return __generator(this,function(g){switch(g.label){case 0:return this._viewer.view.setProjectionMode(d.Projection.Perspective),a=this._viewer.view,b=this,[4,a.getInteractiveDrawLimitIncreaseEnabled()];case 1:return b._initialInteractiveDrawLimitIncreaseStatus=g.sent(),a.setInteractiveDrawLimitIncreaseEnabled(!1),this._calculateInitialPosition(),0!==this._maxExtents?
[3,3]:[4,this.resetDefaultWalkSpeeds()];case 2:g.sent(),g.label=3;case 3:return this._bimModeEnabled?[4,this._updateNearbyDoors()]:[3,5];case 4:g.sent(),g.label=5;case 5:return c=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,c?(e=(f=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&0<f.size)?[4,this._viewer.floorplanManager.activate()]:[3,7]:[3,7];case 6:g.sent(),g.label=7;case 7:return[2]}})})};f.prototype.onDeactivate=function(){return __awaiter(this,
void 0,void 0,function(){var b,c,f;return __generator(this,function(e){switch(e.label){case 0:return this._viewer.view.setInteractiveDrawLimitIncreaseEnabled(this._initialInteractiveDrawLimitIncreaseStatus),this._doorCache.forgetNearbyDoors(),b=this._viewer.floorplanManager.getConfiguration().autoActivate===d.FloorplanAutoActivation.BimWalk,b?(f=(c=this._viewer.model.getNodesByGenericType("IFCBUILDINGSTOREY"))&&0<c.size)?[4,this._viewer.floorplanManager.deactivate()]:[3,2]:[3,2];case 1:e.sent(),e.label=
2;case 2:return a.prototype.onDeactivate.call(this),[2]}})})};f.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:return this._rotationSpeed=40,this._viewAngle=90,[4,this._viewer.model.getLooseBounding()];case 1:return a=c.sent(),b=a.extents(),this._maxExtents=Math.max(b.x,b.y,b.z),this._walkDistance=this._maxExtents/15,this._elevationSpeed=this._maxExtents/10,this._zoomDistance=this._maxExtents/
30,[2]}})})};f.prototype.getBimFloorConfig=function(){return __assign({},this._logical.floor)};f.prototype.setBimFloorConfig=function(a){this._logical.floor=__assign({},a);this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor)};f.prototype.getBimWallConfig=function(){return __assign({},this._logical.wall)};f.prototype.setBimWallConfig=function(a){this._logical.wall=__assign({},a);this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall)};f.prototype.getBimDoorConfig=function(){return __assign({},
this._logical.door)};f.prototype.setBimDoorConfig=function(a){this._logical.door=__assign({},a);this._effective.door=this._scaleAgainstModelUnit(this._logical.door)};f.prototype._scaleAgainstModelUnit=function(a){var b=this._viewer.model;b=1/b.getNodeUnitMultiplier(b.getAbsoluteRootNode());a=__assign({},a);for(var c=0,d=Object.keys(a);c<d.length;c++){var f=d[c];"number"===typeof a[f]&&(a[f]*=b)}return a};f.prototype.onMouseDown=function(b){a.prototype.onMouseDown.call(this,b)};f.prototype.onMouseMove=
function(b){a.prototype.onMouseMove.call(this,b)};f.prototype.onMouseUp=function(b){a.prototype.onMouseUp.call(this,b)};f.prototype._applyGravity=function(){return __awaiter(this,void 0,void 0,function(){var a,c,f,e,g,k,h,t,u,v;return __generator(this,function(l){switch(l.label){case 0:return a=this._viewer.view,c=a.getCamera(),f=c.getPosition(),[4,b(a,f,this._downAxis,this._effective.floor.maxFallDistance)];case 1:e=l.sent();if(null!==e)return[3,3];f=d.Point3.subtract(f,d.Point3.scale(this._downAxis,
this._effective.floor.avatarOffset));return[4,b(a,f,this._downAxis,this._effective.floor.maxFallDistance)];case 2:e=l.sent();if(null===e)return[2];l.label=3;case 3:g=new d.Point3(0,0,this._effective.floor.avatarOffset);k=d.Point3.add(e,g);h=d.Point3.subtract(k,f);t=h.length();if(t>this._effective.floor.negligibleClimbHeight&&(u=d.Util.computeAngleBetweenVector(h,this._downAxis),(v=90<u)&&t>this._effective.floor.maxClimbHeight))return[2];this._applyWalkDelta(c,h);return[2]}})})};f.prototype._updateNearbyDoors=
function(){var a=this._viewer.view.getCamera().getPosition();return this._doorCache.updateNearbyDoors(a,this._effective.door.transparencyRange,.5)};f.prototype._updateCamera=function(a){this._resetPosition(a);this._updateCameraTilt(a);this._updateCameraViewAngle(a);this._viewer.view.setCamera(a)};f.prototype._applyWalkDelta=function(a,b){a.dolly(d.Point3.scale(b,-1));this._updateCamera(a)};f.prototype._applyWalkDeltaWithCollisionCheck=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var f,
e,g,k,l,h,n,m,x,y,A,B,D,C,F,E,H,G;return __generator(this,function(p){switch(p.label){case 0:return f=a.getPosition(),e=d.Matrix.createFromOffAxisRotation(c,90),g=e.transform(b),k=d.Matrix.createFromOffAxisRotation(c,-90),l=k.transform(b),h=this._testWallCollision(f,g,this._effective.wall.avatarOffset),n=this._testWallCollision(f,l,this._effective.wall.avatarOffset),m=this._testWallCollision(f,b,b.length()+this._effective.wall.avatarOffset),[4,Promise.all([h,n])];case 1:x=p.sent();y=x[0];A=x[1];if(null!==
y||null!==A)if(B=function(a){return null!==a?(a=a.getFaceEntity().getNormal(),90<d.Util.computeAngleBetweenVector(a,b)):!1},B(y)||B(A))return[2];return[4,m];case 2:return D=p.sent(),null!==D&&(C=b.length(),F=d.Point3.scale(b,1/C),E=d.Point3.subtract(D.getPosition(),f).length(),H=E-this._effective.wall.avatarOffset,G=Math.min(C,H),b=d.Point3.scale(F,G)),this._applyWalkDelta(a,b),[2]}})})};f.prototype._testWallCollision=function(a,b,c){return e(this._viewer.view,a,b,c)};f.prototype._walkBackward=function(a,
b){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();a=d.Point3.subtract(e,f).normalize().copy().scale(a);return b?this._applyWalkDeltaWithCollisionCheck(c,a,g):this._applyWalkDelta(c,a)};f.prototype._walkForward=function(a,b){return this._walkBackward(-a,b)};f.prototype._walkLeft=function(a,b){var c=this._viewer.view.getCamera();this._resetPosition(c);var f=c.getTarget(),e=c.getPosition(),g=c.getUp();f=d.Point3.subtract(f,e).normalize();
a=d.Point3.cross(g,f).normalize().copy().scale(a);return b?this._applyWalkDeltaWithCollisionCheck(c,a,g):this._applyWalkDelta(c,a)};f.prototype._walkRight=function(a,b){return this._walkLeft(-a,b)};f.prototype.walkBackward=function(a){return this._walkBackward(a,!1)};f.prototype.walkForward=function(a){return this._walkForward(a,!1)};f.prototype.walkLeft=function(a){return this._walkLeft(a,!1)};f.prototype.walkRight=function(a){return this._walkRight(a,!1)};f.prototype.walkBackwardWithCollision=function(a){return this._walkBackward(a,
!0)};f.prototype.walkForwardWithCollision=function(a){return this._walkForward(a,!0)};f.prototype.walkLeftWithCollision=function(a){return this._walkLeft(a,!0)};f.prototype.walkRightWithCollision=function(a){return this._walkRight(a,!0)};f.prototype.walkDown=function(a){var b=this._viewer.view.getCamera();this._resetPosition(b);a=b.getUp().normalize().scale(a);this._applyWalkDelta(b,a)};f.prototype.walkUp=function(a){this.walkDown(-a)};f.prototype.rotateRight=function(a){var b=this._viewer.view.getCamera();
this._resetPosition(b);var c=b.getTarget(),f=b.getPosition(),e=d.Point3.subtract(f,c).length(),g=d.Point3.subtract(c,f).normalize();a=d.Util.degreesToRadians(a);a=Math.tan(a);a*=d.Point3.subtract(b.getTarget(),b.getPosition()).length();g=d.Point3.cross(g,b.getUp()).scale(a);c=c.copy().add(g);e=d.Point3.subtract(c,f).normalize().scale(e);c=d.Point3.add(f,e);b.setTarget(c);this._updateCamera(b)};f.prototype.rotateLeft=function(a){this.rotateRight(-a)};f.prototype.tiltDown=function(a){this.setTilt(this._tilt+
a);a=this._viewer.view.getCamera();this._resetPosition(a);this._updateCamera(a)};f.prototype.tiltUp=function(a){this.tiltDown(-a)};f.prototype._calculateInitialPosition=function(){var a=this._viewer.view.getCamera();this._calculateMajorAxis(a);this.setTilt(this._calculateInitialTilt(a));this._resetPosition(a);this._updateCamera(a)};f.prototype._updateCameraViewAngle=function(a){var b=d.Util.degreesToRadians(this._viewAngle);b=Math.tan(b/2);b*=d.Point3.subtract(a.getTarget(),a.getPosition()).length();
a.setWidth(b);a.setHeight(b)};f.prototype._updateCameraTilt=function(a){var b=a.getPosition(),c=a.getTarget(),f=a.getUp().normalize(),e=d.Point3.subtract(c,b).normalize();f=d.Point3.cross(f,e).normalize();c=d.Point3.distance(c,b);d.Matrix.createFromOffAxisRotation(f,this._tilt).transform(e,e);a.setTarget(d.Point3.add(b,e.scale(c)))};f.prototype._calculateInitialTilt=function(a){var b=a.getTarget();a=a.getPosition();a=d.Point3.subtract(b,a);b=a.length();this._majorAxis===d.Axis.X?a.x=0:this._majorAxis===
d.Axis.Y?a.y=0:this._majorAxis===d.Axis.Z&&(a.z=0);a=a.length();return 180/Math.PI*Math.acos(a/b)};f.prototype._resetPosition=function(a){this._calculateMajorAxis(a);var b=a.getPosition(),c=a.getTarget();c=d.Point3.subtract(c,b);var f=c.length();0<this.getWalkSpeed()&&(f=this.getWalkSpeed());switch(this._majorAxis){case d.Axis.X:c.set(0,c.y,c.z);a.setUp(new d.Point3(1,0,0));break;case d.Axis.Y:c.set(c.x,0,c.z);a.setUp(new d.Point3(0,1,0));break;case d.Axis.Z:c.set(c.x,c.y,0),a.setUp(new d.Point3(0,
0,1))}c.normalize().scale(f);a.setTarget(d.Point3.add(b,c))};f.prototype._calculateMajorAxis=function(a){var b=a.getUp();a=Math.abs(b.x);var c=Math.abs(b.y);b=Math.abs(b.z);this._majorAxis=b>=a&&b>=c?d.Axis.Z:c>=a&&c>=b?d.Axis.Y:d.Axis.X};f.prototype.setZoomSpeed=function(a){this._zoomDistance=a};f.prototype.getZoomSpeed=function(){return this._zoomDistance};f.prototype.setTilt=function(a){this._tilt=Math.max(Math.min(a,45),-45);a=this._viewer.view.getCamera();this._updateCamera(a)};f.prototype.getTilt=
function(){return this._tilt};f.prototype.setViewAngle=function(a){a=Math.max(Math.min(a,150),30);this._viewAngle!==a&&(this._viewAngle=a,this._updateCamera(this._viewer.view.getCamera()))};f.prototype.getViewAngle=function(){return this._viewAngle};f.prototype.setWalkSpeed=function(a){this._walkDistance=a};f.prototype.getWalkSpeed=function(){return this._walkDistance};f.prototype.setElevationSpeed=function(a){this._elevationSpeed=a};f.prototype.getElevationSpeed=function(){return this._elevationSpeed};
f.prototype.setRotationSpeed=function(a){this._rotationSpeed=a};f.prototype.getRotationSpeed=function(){return this._rotationSpeed};f.prototype.setWalkActive=function(a){this._walkActive=a};f.prototype.getWalkActive=function(){return this._walkActive};f.prototype.getBimModeEnabled=function(){return this._bimModeEnabled};f.prototype.getMajorAxis=function(){return this._majorAxis};f.prototype.getActiveWalk=function(){return this._activeWalk};return f}(h.OperatorBase);h.CameraWalkBaseOperator=a;(function(a){(function(a){(function(a){(function(a){a[a.avatarOffset=
1500]="avatarOffset";a[a.maxClimbHeight=600]="maxClimbHeight";a[a.negligibleClimbHeight=20]="negligibleClimbHeight";a[a.maxFallDistance=5E3]="maxFallDistance"})(a.FloorConfig||(a.FloorConfig={}));(function(a){a[a.avatarOffset=150]="avatarOffset"})(a.WallConfig||(a.WallConfig={}));(function(a){a[a.transparencyRange=4E3]="transparencyRange"})(a.DoorConfig||(a.DoorConfig={}))})(a.Default||(a.Default={}))})(a.Bim||(a.Bim={}))})(a=h.CameraWalkBaseOperator||(h.CameraWalkBaseOperator={}))})(d.Operator||
(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(c){b(c,d.WalkDirection.Forward,d.WalkDirection.Backward);b(c,d.WalkDirection.Left,d.WalkDirection.Right);b(c,d.WalkDirection.Up,d.WalkDirection.Down);b(c,d.WalkDirection.RotateLeft,d.WalkDirection.RotateRight);b(c,d.WalkDirection.TiltUp,d.WalkDirection.TiltDown)}function b(b,a,d){b.has(a)&&b.has(d)&&(b.delete(a),b.delete(d))}var e=function(b){function a(a){var c=b.call(this,a)||this;c._keyWalkMapping=new Map;c._keyUpMap=new Map;c._keyDownMap=new Map;c._mouseLookSpeed=
0;c._mouseLookEnabled=!0;c._previousWalkTime=0;c._tickTimerId=null;a.setCallbacks({camera:function(a){a.getProjection()!==d.Projection.Perspective&&c._keyDownMap.clear()}});c.addKeyMapping(d.KeyCode.a,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.d,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.w,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.s,d.WalkDirection.Backward);c.addKeyMapping(d.KeyCode.q,d.WalkDirection.RotateLeft);c.addKeyMapping(d.KeyCode.e,d.WalkDirection.RotateRight);c.addKeyMapping(d.KeyCode.r,
d.WalkDirection.TiltUp);c.addKeyMapping(d.KeyCode.f,d.WalkDirection.TiltDown);c.addKeyMapping(d.KeyCode.x,d.WalkDirection.Up);c.addKeyMapping(d.KeyCode.c,d.WalkDirection.Down);c.addKeyMapping(d.KeyCode.LeftArrow,d.WalkDirection.Left);c.addKeyMapping(d.KeyCode.RightArrow,d.WalkDirection.Right);c.addKeyMapping(d.KeyCode.UpArrow,d.WalkDirection.Forward);c.addKeyMapping(d.KeyCode.DownArrow,d.WalkDirection.Backward);return c}__extends(a,b);a.prototype.addKeyMapping=function(a,b){this._keyWalkMapping.set(a,
b)};a.prototype.getKeyMapping=function(){return d.Util.copyMap(this._keyWalkMapping)};a.prototype.clearKeyMappings=function(){this._keyWalkMapping.clear()};a.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a);this._viewer.focusInput(!0)};a.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a);if(this._dragging&&this._mouseLookEnabled){this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=window.screen.width,f=window.screen.height;a.setHandled(!0);
a=d.Point2.subtract(this._ptPrevious,this._ptCurrent);this.rotateLeft(a.x/c*this._mouseLookSpeed);this.tiltUp(a.y/f*this._mouseLookSpeed)}};a.prototype.onMouseUp=function(a){5<this._dragCount&&a.setHandled(!0);b.prototype.onMouseUp.call(this,a)};a.prototype.onMousewheel=function(a){var b=this;this._viewer.view.setProjectionMode(d.Projection.Perspective);var c=this._viewer.view,f=c.getCamera(),e=a.getPosition(),g=a.getWheelDelta();a=c.pickFromPoint(e,new d.PickConfig(d.SelectionMask.Face)).then(function(a){var c=
a.getPosition();null!==a&&null!==c?(a=d.Point3.subtract(f.getPosition(),c).normalize().scale(b.getZoomSpeed()*g),b._applyWalkDelta(f,a)):b.walkBackward(g*b.getWalkSpeed())});a};a.prototype.onKeyDown=function(a){this._viewer.view.setProjectionMode(d.Projection.Perspective);var b=a.getKeyCode();b===d.KeyCode.v&&this.toggleBimMode();this._keyCodeActive(b)||(this._keyDownMap.set(b,a.getDate().getTime()),this._onKeyChange(b))};a.prototype.onKeyUp=function(a){var b=a.getKeyCode();this._keyUpMap.set(b,a.getDate().getTime());
this._onKeyChange(b)};a.prototype._keyCodeActive=function(a){var b=this._keyDownMap.get(a);return void 0!==b&&(a=this._keyUpMap.get(a),void 0===a||b>a)?!0:!1};a.prototype._onKeyChange=function(a){this._keyCodeActive(a)&&this._keyWalkMapping.has(a)&&(this.getWalkActive()||(this._previousWalkTime=Date.now()),this._onTick())};a.prototype.setMouseLookSpeed=function(a){this._mouseLookSpeed=a};a.prototype.getMouseLookSpeed=function(){return this._mouseLookSpeed};a.prototype.setMouseLookEnabled=function(a){this._mouseLookEnabled=
a};a.prototype.getMouseLookEnabled=function(){return this._mouseLookEnabled};a.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){return[2,b.prototype.resetDefaultWalkSpeeds.call(this).then(function(){a._mouseLookSpeed=300})]})})};a.prototype._execWalkDirection=function(a,b,c){var f=this.getWalkSpeed()*b;switch(a){case d.WalkDirection.Forward:return c?this.walkForwardWithCollision(f):this.walkForward(f);case d.WalkDirection.Backward:return c?
this.walkBackwardWithCollision(f):this.walkBackward(f);case d.WalkDirection.Left:return c?this.walkLeftWithCollision(f):this.walkLeft(f);case d.WalkDirection.Right:return c?this.walkRightWithCollision(f):this.walkRight(f);case d.WalkDirection.Up:return this.walkUp(this.getElevationSpeed()*b);case d.WalkDirection.Down:return this.walkDown(this.getElevationSpeed()*b);case d.WalkDirection.RotateLeft:return this.rotateLeft(this.getRotationSpeed()*b);case d.WalkDirection.RotateRight:return this.rotateRight(this.getRotationSpeed()*
b);case d.WalkDirection.TiltUp:return this.tiltUp(this.getRotationSpeed()*b);case d.WalkDirection.TiltDown:return this.tiltDown(this.getRotationSpeed()*b);default:d.Util.TypeAssertNever(a)}};a.prototype._queueWalkDirections=function(a){var b=this,c=new Set;this._keyWalkMapping.forEach(function(a,d){b._keyCodeActive(d)&&c.add(a)});g(c);var f=d.Util.setToArray(c);f.sort();if(0<f.length){this.setWalkActive(!0);var e=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(b,void 0,
void 0,function(){var b,g,k,h,l,n=this;return __generator(this,function(m){b=new d.Util.ActionQueue(1,!0);if(0<a)for(g=function(c){b.push(function(){return n._execWalkDirection(c,a,e)})},k=0,h=f;k<h.length;k++)l=h[k],g(l);e&&(c.has(d.WalkDirection.Up)||c.has(d.WalkDirection.Down)||b.push(function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._applyGravity()];case 1:return a.sent(),[2]}})})}),b.push(function(){return __awaiter(n,
void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._updateNearbyDoors()];case 1:return a.sent(),[2]}})})}));return b.isIdle()?[2]:[2,b.waitForIdle()]})})})}};a.prototype._onTick=function(){var a=this,b=Date.now(),c=(b-this._previousWalkTime)/1E3;this._previousWalkTime=b;b=!this.getActiveWalk().isIdle();this.setWalkActive(b);this._queueWalkDirections(c);null!==this._tickTimerId&&(cancelAnimationFrame(this._tickTimerId),this._tickTimerId=null);this.getWalkActive()&&
(this._tickTimerId=requestAnimationFrame(function(){a._onTick()}))};return a}(h.CameraWalkBaseOperator);h.CameraKeyboardWalkOperator=e})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(e){function c(a,c){a=e.call(this,a)||this;a._cameraRotationMomentumEnabled=!1;a._isDown=!1;a._mouseDragged=!1;a._averagedMousePoints=new b;a._averageTimeIntervalMilliseconds=150;a._previousMouseMovePoint=d.Point2.zero();a._mouseMovePoint=d.Point2.zero();a._mouseMoveOffset=d.Point2.zero();a._previousMouseMoveTime=null;a._mouseMoveTime=null;a._mouseMoveElapsedTimeSeconds=0;a._rotationDegreesPerSecond=[0,0];a._animationLastTickTime=0;a._animationElapsedTimeSeconds=
0;a._animationIntervalResult=null;a._preferredAnimationIntervalMilliseconds=16;a._momentum=0;a._momentumLossPerSecond=0;a._degreesPerPixel=.5;a._maxRotationMagnitudeScale=8;a._initialSelectionPosition=null;a._cameraRotateFunction=c;return a}__extends(c,e);c.prototype.getCameraRotationMomentumEnabled=function(){return this._cameraRotationMomentumEnabled};c.prototype.setCameraRotationMomentumEnabled=function(a){a!==this._cameraRotationMomentumEnabled&&((this._cameraRotationMomentumEnabled=a)||this.stopAnimation())};
c.prototype.isCurrentlyAnimating=function(){return this._cameraRotationMomentumEnabled&&0<this.getMomentum()};c.prototype.onDeactivate=function(){return e.prototype.onDeactivate.call(this)};c.prototype.onViewOrientationChange=function(){this.stopAnimation()};c.prototype.supportsAnimation=function(){return!0};c.prototype.onMouseDown=function(a){e.prototype.onMouseDown.call(this,a);this.isActive()&&(this._initialSelectionPosition=a.getPosition(),this._isDown=!0,this.stopAnimation(),this._mouseDragged=
!1,this._mouseMoveTime=this._previousMouseMoveTime=Date.now(),this._mouseMovePoint.assign(this._initialSelectionPosition),this._previousMouseMovePoint.assign(this._mouseMovePoint),this._averagedMousePoints.clear(),this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime))};c.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);this.isActive()&&this._isDown&&(this._mouseDragged=!0,this._previousMouseMovePoint.assign(this._mouseMovePoint),this._mouseMovePoint.assign(a.getPosition()),
this._mouseMoveOffset=d.Point2.subtract(this._mouseMovePoint,this._previousMouseMovePoint),this._previousMouseMoveTime=this._mouseMoveTime,this._mouseMoveTime=Date.now(),this._mouseMoveElapsedTimeSeconds=null===this._previousMouseMoveTime?0:(this._mouseMoveTime-this._previousMouseMoveTime)/1E3,this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime),a=this._getMouseMoveOffsetForRotation(),this._rotateCamera(a))};c.prototype.onMouseUp=function(a){if(this.isActive()&&(this._isDown=!1,
this._mouseDragged&&this.getCameraRotationMomentumEnabled())){this._mouseMoveOffset=this._averagedMousePoints.getAverageOffsetWithinMilliseconds(this._averageTimeIntervalMilliseconds);var b=this._getMouseMoveOffsetForRotation();if(0!==b[0]||0!==b[1]){for(var c=0;2>c;c++){var d=Math.abs(b[c])*this._maxRotationMagnitudeScale;this._rotationDegreesPerSecond[c]=b[c]/this._mouseMoveElapsedTimeSeconds;this._rotationDegreesPerSecond[c]<-d?this._rotationDegreesPerSecond[c]=-d:this._rotationDegreesPerSecond[c]>
d&&(this._rotationDegreesPerSecond[c]=d)}this._momentum=1;this._startAnimation()}else this._momentum=0}e.prototype.onMouseUp.call(this,a)};c.prototype._rotateCamera=function(a){this._cameraRotateFunction(a)};c.prototype.stopAnimation=function(){null!==this._animationIntervalResult&&(clearInterval(this._animationIntervalResult),this._animationIntervalResult=null)};c.prototype.getMomentum=function(){return this._momentum};c.prototype.setMomentumLossPerSecond=function(a){0<=a&&(this._momentumLossPerSecond=
a)};c.prototype.getMomentumLossPerSecond=function(){return this._momentumLossPerSecond};c.prototype.isAnimating=function(){return null!==this._animationIntervalResult};c.prototype._startAnimation=function(){var a=this;null===this._animationIntervalResult&&(this._animationLastTickTime=Date.now(),this._animationIntervalResult=window.setInterval(function(){a._onTick()},this._preferredAnimationIntervalMilliseconds))};c.prototype._getMouseMoveOffsetForRotation=function(){return[-this._mouseMoveOffset.x*
this._degreesPerPixel,this._mouseMoveOffset.y*this._degreesPerPixel]};c.prototype._onTick=function(){var a=Date.now();this._animationElapsedTimeSeconds=(a-this._animationLastTickTime)/1E3;this._animationLastTickTime=a;this._rotateCamera([this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[0],this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[1]]);if(0<this._momentumLossPerSecond)if(this._momentum=Math.max(0,this._momentum-this._animationElapsedTimeSeconds*this._momentumLossPerSecond),
0<this._momentum)for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]*=this._momentum;else{for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]=0;this._rotateCamera(this._rotationDegreesPerSecond);this.stopAnimation()}};return c}(h.OperatorBase);h.CameraOrbitBaseOperator=g;var b=function(){function b(b){void 0===b&&(b=10);this._count=0;this._points=Array(b);this._times=Array(b)}b.prototype.clear=function(){this._count=0};b.prototype.add=
function(b,a){void 0===a&&(a=Date.now());var c=this._count%this._points.length;void 0===this._points[c]?this._points[c]=b.copy():this._points[c].assign(b);this._times[c]=a;this._count++};b.prototype.getAverageOffsetWithinMilliseconds=function(b,a){void 0===a&&(a=Date.now());var c=-1,e=d.Point2.zero(),g=Math.min(this._points.length,this._count);if(0<g){for(var h=0,m=0;m<g;m++){var p=(this._count-1-m)%this._points.length;if(a-this._times[p]>b)break;c=p;e.add(this._points[p]);h++}1<h?(e.subtract(this._points[c]),
h--,e.scale(1/h)):(c=-1,e.set(0,0))}return 0<=c?d.Point2.subtract(e,this._points[c]):e};return b}()})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function c(a,c,e){var f=b.call(this)||this;f._circle=new d.Markup.Shape.Circle;f._viewer=a;f._position=c;f._circle.setRadius(e);return f}__extends(c,b);c.prototype.draw=function(){if(this._circle){var a=this._viewer.view.projectPoint(this._position);this._circle.setCenter(d.Point2.fromPoint3(a));this._viewer.markupManager.getRenderer().drawCircle(this._circle)}};return c}(d.Markup.MarkupItem);h.OrbitMarkup=g;var b=function(b){function c(a){var c=b.call(this,
a,function(a){if(!c._viewer.sheetManager.isDrawingSheetActive())if(null!==c._pickPosition){if(null===c._circleMarkupHandler){var b=new g(c._viewer,c._pickPosition,c._circleRadius);c._circleMarkupHandler=c._viewer.markupManager.registerMarkup(b)}c._orbitByTurnTiltWithTarget(a,c._pickPosition)}else switch(b=c._viewer.view.getCamera(),c._orbitFallbackMode){default:case d.OrbitFallbackMode.CameraTarget:c._orbitByTurnTiltWithTarget(a,b.getTarget());break;case d.OrbitFallbackMode.ModelCenter:c._modelCenter&&
c._orbitByTurnTiltWithTarget(a,c._modelCenter);break;case d.OrbitFallbackMode.OrbitTarget:c._orbitByTurnTiltWithTarget(a,c._orbitTarget)}})||this;c._orbitTarget=d.Point3.zero();c._orbitFallbackMode=d.OrbitFallbackMode.ModelCenter;c._modelCenter=null;c._circleMarkupHandler=null;c._circleRadius=3;c._updateCameraCenterAction=new d.Util.CurrentAction(!1);c._updateCameraCenterTimer=new d.Util.Timer;c._primaryButton=d.Button.Middle;c._pickPosition=null;c._bimOrbitEnabled=!1;c._viewer.setCallbacks({sceneReady:function(){c._updateModelCenter()},
modelSwitched:function(){c._updateModelCenter()},visibilityChanged:function(){c._updateModelCenter()},_updateTransform:function(a){a||c._updateModelCenter()},_geometryCreated:function(){c._updateModelCenter()},hwfParseComplete:function(){c._updateModelCenter()}});return c}__extends(c,b);c.prototype._updateModelCenter=function(a){var b=this;void 0===a&&(a=50);this._updateCameraCenterTimer.clear();this._updateCameraCenterAction.set(function(){return __awaiter(b,void 0,void 0,function(){var b,c=this;
return __generator(this,function(d){switch(d.label){case 0:return[4,this._viewer.model.getModelBounding(!0,!1)];case 1:b=d.sent();if(b.isDegenerate()&&0<a)return this._updateCameraCenterTimer.set(500,function(){c._updateModelCenter(a-1)}),[2];this._modelCenter=b.center();return[2]}})})})};c.prototype.onMouseDown=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(f){switch(f.label){case 0:return b.prototype.onMouseDown.call(this,a),this.isActive()&&a.getButton()===
this._primaryButton?[4,this._viewer.view.pickFromPoint(a.getPosition(),new d.PickConfig(d.SelectionMask.Face))]:[3,2];case 1:c=f.sent(),null!==c&&0===c.overlayIndex()?(this._pickPosition=c.getPosition(),a.setHandled(!0)):this._pickPosition=null,f.label=2;case 2:return[2]}})})};c.prototype.onMouseUp=function(a){b.prototype.onMouseUp.call(this,a);a.getButton()===this._primaryButton&&(this._pickPosition=null);this._removeMarkup()};c.prototype.setBimOrbitEnabled=function(a){this._bimOrbitEnabled=a};c.prototype.getBimOrbitEnabled=
function(){return this._bimOrbitEnabled};c.prototype._removeMarkup=function(){null!==this._circleMarkupHandler&&(this._viewer.markupManager.unregisterMarkup(this._circleMarkupHandler),this._circleMarkupHandler=null)};c.prototype._getClampedRotationMatrix=function(a,b,c,e){a=d.Matrix.createFromOffAxisRotation(a,b);b=d.Point3.zero();a.transform(c,b);return 0>=d.Util.radiansToDegrees(Math.asin(d.Point3.dot(e,b)))?new d.Matrix:a};c.prototype._orbitByTurnTiltWithTarget=function(a,b){var c=this._viewer.view,
f=c.getCamera(),e=f.getPosition().subtract(b),g=f.getTarget().subtract(b),h=f.getUp().normalize(),q=d.Point3.subtract(g,e).normalize(),r=d.Point3.cross(h,q).normalize();q=a[0];var w=a[1];new d.Matrix;new d.Matrix;this._bimOrbitEnabled?(a=this._viewer.model.getViewAxes().upVector.copy(),r=this._getClampedRotationMatrix(r,w,h,a),a=d.Matrix.createFromOffAxisRotation(a,q/4),q=a.transform(r.transform(e)),g=a.transform(r.transform(g)),h=a.transform(r.transform(d.Point3.add(e,h)))):(r=d.Matrix.createFromOffAxisRotation(r,
w),a=d.Matrix.createFromOffAxisRotation(h,q),r=d.Matrix.multiply(a,r),q=r.transform(e),g=r.transform(g),h=r.transform(d.Point3.add(e,h)));h.subtract(q);e=q;e.add(b);g.add(b);f.setPosition(e);f.setTarget(g);f.setUp(h);c.setCamera(f)};c.prototype.setOrbitFallbackMode=function(a){this._orbitFallbackMode=a};c.prototype.getOrbitFallbackMode=function(){return this._orbitFallbackMode};c.prototype.setOrbitTarget=function(a){this._orbitTarget=a};c.prototype.getOrbitTarget=function(){return this._orbitTarget};
c.prototype.setPrimaryButton=function(a){this._primaryButton=a};c.prototype.getPrimaryButton=function(){return this._primaryButton};return c}(h.CameraOrbitBaseOperator);h.CameraOrbitOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._cameraPtPrevious=d.Point3.zero();return c}__extends(e,b);e.prototype.onMouseDown=function(c){b.prototype.onMouseDown.call(this,c);if(this.isActive()||this._viewer.sheetManager.isDrawingSheetActive()){var a=this._viewer.view;(c=a.getCamera().getCameraPlaneIntersectionPoint(c.getPosition(),a))&&this._cameraPtPrevious.assign(c)}};e.prototype.onMouseMove=function(c){b.prototype.onMouseMove.call(this,c);if(this.isActive()||
this._viewer.sheetManager.isDrawingSheetActive()){var a=this._viewer.view,f=a.getCamera();if(c=f.getCameraPlaneIntersectionPoint(c.getPosition(),a))c=d.Point3.subtract(c,this._cameraPtPrevious),f.dolly(c),a.setCamera(f)}};return e}(h.OperatorBase);h.CameraPanOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._mouseMoveZoomDelta=3;c._mouseWheelZoomDelta=.25;c._pinchZoomModifier=2.5;c._zoomToMousePosition=!0;c._dollyZoomEnabled=!1;c._adjustCameraTarget=!1;c._preserveViewAngle=!0;c._mouseMoveZoomFactor=1;c._mouseWheelZoomFactor=-1;c._secondaryTouchId=null;c._lastTouch1=d.Point2.zero();c._lastTouch2=d.Point2.zero();c._prevLen=0;return c}__extends(e,b);e.prototype.setMouseWheelZoomInverted=function(b){this._mouseWheelZoomFactor=
b?-1:1};e.prototype.getMouseWheelZoomInverted=function(){return-1===this._mouseWheelZoomFactor};e.prototype.setMouseMoveZoomInverted=function(b){this._mouseMoveZoomFactor=b?-1:1};e.prototype.getMouseMoveZoomInverted=function(){return-1===this._mouseMoveZoomFactor};e.prototype.setMouseMoveZoomDelta=function(b){this._mouseMoveZoomDelta=b};e.prototype.getMouseMoveZoomDelta=function(){return this._mouseMoveZoomDelta};e.prototype.setMouseWheelZoomDelta=function(b){this._mouseWheelZoomDelta=b};e.prototype.getMouseWheelZoomDelta=
function(){return this._mouseWheelZoomDelta};e.prototype.setZoomToMousePosition=function(b){this._zoomToMousePosition=b};e.prototype.getZoomToMousePosition=function(){return this._zoomToMousePosition};e.prototype.setDollyZoomEnabled=function(b){this._dollyZoomEnabled=b};e.prototype.getDollyZoomEnabled=function(){return this._dollyZoomEnabled};e.prototype.setMouseWheelAdjustCameraTarget=function(b){this._adjustCameraTarget=b};e.prototype.getMouseWheelAdjustCameraTarget=function(){return this._adjustCameraTarget};
e.prototype.setPreserveViewAngle=function(b){this._preserveViewAngle=b};e.prototype.getPreserveViewAngle=function(){return this._preserveViewAngle};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var a,d,e,g,h,m;return __generator(this,function(f){switch(f.label){case 0:b.prototype.onMouseMove.call(this,c);if(!this.isDragging()||!this.isActive())return[3,4];a=this._viewer.view;d=a.pointToWindowPosition(this._ptCurrent);e=a.pointToWindowPosition(this._ptPrevious);
g=d.y-e.y;h=d.x-e.x;m=this._mouseMoveZoomDelta*this._mouseMoveZoomFactor*(g-h);return this._dollyZoomEnabled?[4,this._dollyZoom(m,void 0,void 0,!0)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._doZoom(m)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};e.prototype.onMousewheel=function(b){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=this._mouseWheelZoomDelta*this._mouseWheelZoomFactor*b.getWheelDelta(),this._dollyZoomEnabled?
[4,this._dollyZoom(-a,void 0,b.getPosition())]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,this._doZoom(a,void 0,b.getPosition())];case 3:c.sent(),c.label=4;case 4:return[2]}})})};e.prototype.onTouchStart=function(b){var a=this._viewer.view;null===this._primaryTouchId?(this._primaryTouchId=b.getId(),this._lastTouch1.assign(a.pointToWindowPosition(b.getPosition()))):null===this._secondaryTouchId&&(this._secondaryTouchId=b.getId(),this._lastTouch2.assign(a.pointToWindowPosition(b.getPosition())));
null!==this._primaryTouchId&&null!==this._secondaryTouchId&&(this._prevLen=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._dragging=!0)};e.prototype.onTouchMove=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:a=this._viewer.view;c=b.getId();e=b.getPosition();c===this._primaryTouchId?this._lastTouch1.assign(a.pointToWindowPosition(e)):c===this._secondaryTouchId&&this._lastTouch2.assign(a.pointToWindowPosition(e));
if(!this._dragging||c!==this._secondaryTouchId)return[3,2];g=d.Point2.subtract(this._lastTouch2,this._lastTouch1).length();h=(this._prevLen-g)*this._pinchZoomModifier;return[4,this._doZoom(h)];case 1:f.sent(),this._prevLen=g,f.label=2;case 2:return[2]}})})};e.prototype.onTouchEnd=function(b){b=b.getId();this._primaryTouchId===b?this._primaryTouchId=null:this._secondaryTouchId===b&&(this._secondaryTouchId=null);this._dragging=!1};e.prototype.onDeactivate=function(){this._secondaryTouchId=this._primaryTouchId=
null};e.prototype._updateCameraViewAngle=function(b){var a=d.Util.degreesToRadians(90);a=Math.tan(a/2);a*=d.Point3.subtract(b.getTarget(),b.getPosition()).length();b.setWidth(a);b.setHeight(a);return b};e.prototype._dollyZoom=function(b,a,f,e){void 0===a&&(a=this._viewer.view.getCamera());void 0===e&&(e=!1);return __awaiter(this,void 0,void 0,function(){var c,g,k,h,q,r,w,t,u,v,z,x,y=this;return __generator(this,function(l){switch(l.label){case 0:return c=this._viewer.view,a.setProjection(d.Projection.Perspective),
g=a.getPosition(),k=a.getTarget(),f?[4,this._viewer.model.getModelBounding(!1,!1,!1)]:[3,3];case 1:return h=l.sent(),q=h.extents().length(),r=q/100,[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)];case 2:return w=l.sent(),t=w.getPosition(),null!==t&&(u=d.Point3.subtract(k,g),v=d.Point3.subtract(t,g),z=d.Point3.add(g,u.scale(d.Point3.dot(u,v)/d.Point3.dot(u,u))),a.setTarget(z)),x=d.Point3.subtract(a.getTarget(),g),0<b&&x.length()<r&&a.setTarget(d.Point3.add(k,x.copy().normalize().scale(2*r))),
x=d.Point3.subtract(a.getTarget(),g),a.setPosition(d.Point3.add(g,x.copy().scale(.05*(0<b?1:-1)))),[3,4];case 3:x=d.Point3.subtract(k,g).scale(b/10),a.setPosition(d.Point3.add(g,x)),e&&a.setTarget(d.Point3.add(k,x)),l.label=4;case 4:return a=this._updateCameraViewAngle(a),this._viewer.pauseRendering(function(){if(f){var b=a.getCameraPlaneIntersectionPoint(f,y._viewer.view);c.setCamera(a);var e=a.getCameraPlaneIntersectionPoint(f,y._viewer.view);null!==b&&null!==e&&a.dolly(d.Point3.subtract(e,b))}c.setCamera(a)}),
[2]}})})};e.prototype._doZoom=function(b,a,f){void 0===a&&(a=this._viewer.view.getCamera());return __awaiter(this,void 0,void 0,function(){var c,e,g,h,p,q,r,w=this;return __generator(this,function(k){switch(k.label){case 0:return c=this._viewer.view,e=1/(1-b),f&&this._zoomToMousePosition?this._adjustCameraTarget?[4,this._viewer.view.pickFromPoint(f,new d.PickConfig)]:[3,2]:[3,3];case 1:g=k.sent(),void 0!==g&&g.isEntitySelection()&&(h=a.getPosition().subtract(a.getTarget()),p=d.Point3.subtract(a.getTarget(),
a.getPosition()),q=d.Point3.subtract(g.getPosition(),a.getPosition()),r=a.getPosition().add(p.scale(d.Point3.dot(p,q)/d.Point3.dot(p,p))),a.setTarget(r),a.setPosition(d.Point3.add(r,h))),k.label=2;case 2:return this._viewer.pauseRendering(function(){var b=a.getCameraPlaneIntersectionPoint(f,w._viewer.view);w._zoomHelper(e,a);var g=a.getCameraPlaneIntersectionPoint(f,w._viewer.view);null!==b&&null!==g&&a.dolly(d.Point3.subtract(g,b));c.setCamera(a)}),[3,4];case 3:this._zoomHelper(e,a),k.label=4;case 4:return[2]}})})};
e.prototype._zoomHelper=function(b,a){var c=this._viewer.view;a.setWidth(a.getWidth()*b);a.setHeight(a.getHeight()*b);if(this._preserveViewAngle&&!this._viewer.sheetManager.isDrawingSheetActive()){var e=a.getPosition(),g=a.getTarget();b=d.Point3.subtract(g,e).scale(b);a.setPosition(d.Point3.subtract(g,b))}c.setCamera(a)};return e}(h.OperatorBase);h.CameraZoomOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a,d,e){c=b.call(this,c)||this;c._activeOperator=null;c._activeTouchCount=0;c._touchMoveCount=0;c._returnToOrbit=!1;c._bimNavigationEnabled=!1;c._orbitOperator=a;c._panOperator=d;c._zoomOperator=e;return c}__extends(e,b);e.prototype.setBimNavigationEnabled=function(b){this._bimNavigationEnabled=b;var a=this._orbitOperator,c=this._zoomOperator,e=this._panOperator;a.clearMapping();c.clearMapping();e.clearMapping();a.setMapping(d.Button.Left);a.setBimOrbitEnabled(b);
c.setDollyZoomEnabled(b);b?(a.setPrimaryButton(d.Button.Left),c.setMapping(d.Button.Right),e.setMapping(d.Button.Middle),this._setBimCamera()):(a.addMapping(d.Button.Middle),a.setPrimaryButton(d.Button.Middle),c.addMapping(d.Button.Left,d.KeyModifiers.Shift),e.addMapping(d.Button.Right),e.addMapping(d.Button.Left,d.KeyModifiers.Control))};e.prototype._setBimCamera=function(){var b=this._viewer.view.getCamera(),a=d.Point3.subtract(b.getPosition(),b.getTarget()).normalize(),f=this._viewer.model.getViewAxes().upVector.copy();
f=d.Point3.cross(a,f);a=d.Point3.cross(f,a);b.setUp(a);b.setProjection(d.Projection.Perspective);this._viewer.view.setCamera(b)};e.prototype.getBimNavigationEnabled=function(){return this._bimNavigationEnabled};e.prototype.onViewOrientationChange=function(){this._activeTouchCount=0;this._returnToOrbit=!1};e.prototype.onMouseDown=function(c){b.prototype.onMouseDown.call(this,c);this._setActiveOperatorForMouseInput(c);this._activeOperator&&(this._bimNavigationEnabled&&this._setBimCamera(),this._activeOperator.onMouseDown(c))};
e.prototype.onMouseMove=function(c){b.prototype.onMouseMove.call(this,c);if(this._activeOperator&&this._dragging&&3<this._dragCount)this._activeOperator.onMouseMove(c)};e.prototype.onMouseUp=function(c){if(this._activeOperator)this._activeOperator.onMouseUp(c);this._activeOperator instanceof h.CameraOrbitOperator||this._orbitOperator._removeMarkup();b.prototype.onMouseUp.call(this,c)};e.prototype.onMousewheel=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,
this._zoomOperator.onMousewheel(b)];case 1:return a.sent(),[2]}})})};e.prototype.onTouchStart=function(b){++this._activeTouchCount;this._orbitOperator.onTouchStart(b);this._zoomOperator.onTouchStart(b);this._viewer.sheetManager.isDrawingSheetActive()&&(this._panOperator.onTouchStart(b),this._orbitOperator.onDeactivate());1===this._activeTouchCount&&(this._primaryTouchId=b.getId());2===this._activeTouchCount&&(this._orbitOperator.onDeactivate(),this._panOperator.onTouchStart(b),this._zoomOperator.onTouchStart(b))};
e.prototype.onTouchMove=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:++this._touchMoveCount;if(!(5<this._touchMoveCount))return[3,5];if(!this._returnToOrbit)return[3,1];this._orbitOperator.onTouchStart(b);this._returnToOrbit=!1;return[3,5];case 1:if(1!==this._activeTouchCount)return[3,3];this._orbitOperator.onTouchMove(b);return[4,this._zoomOperator.onTouchMove(b)];case 2:return a.sent(),this._panOperator.onTouchMove(b),[3,5];
case 3:return 2!==this._activeTouchCount?[3,5]:[4,this._zoomOperator.onTouchMove(b)];case 4:a.sent(),this._panOperator.onTouchMove(b),a.label=5;case 5:return[2]}})})};e.prototype.onTouchEnd=function(b){2===this._activeTouchCount&&(this._returnToOrbit=!0);this._zoomOperator.onTouchEnd(b);this._panOperator.onTouchEnd(b);this._orbitOperator.onTouchEnd(b);0<this._activeTouchCount&&--this._activeTouchCount;0===this._activeTouchCount&&(this._touchMoveCount=0)};e.prototype.stopInteraction=function(){var c=
[];var a=b.prototype.stopInteraction.call(this);void 0!==a&&c.push(a);this._touchMoveCount=this._activeTouchCount=0;a=this._zoomOperator.onDeactivate();void 0!==a&&c.push(a);a=this._panOperator.onDeactivate();void 0!==a&&c.push(a);a=this._orbitOperator.onDeactivate();void 0!==a&&c.push(a);return d.Util.waitForAll(c)};e.prototype._setActiveOperatorForMouseInput=function(b){var a=this._orbitOperator,c=this._panOperator,d=this._zoomOperator;this._activeOperator=null;this._viewer.sheetManager.isDrawingSheetActive()?
this._activeOperator=c:a.checkMapping(b)?this._activeOperator=a:d.checkMapping(b)?this._activeOperator=d:c.checkMapping(b)&&(this._activeOperator=c)};e.prototype.onDeactivate=function(){b.prototype.onDeactivate.call(this);this._orbitOperator.onDeactivate();this._panOperator.onDeactivate();this._zoomOperator.onDeactivate()};return e}(h.OperatorBase);h.CameraNavigationOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){var a=b.call(this,c,function(b){a._rotateAroundAxis(a._rotationAxis,b[0])})||this;a._rotationAxis=new d.Point3(0,0,1);a._tiltAmount=12;return a}__extends(e,b);e.prototype._rotateAroundAxis=function(b,a){var c=this._viewer.view,e=c.getCamera(),g=e.getPosition(),h=e.getUp().normalize(),m=e.getTarget();b=d.Matrix.createFromOffAxisRotation(b,a);a=(new d.Matrix).setTranslationComponent(-m.x,-m.y,-m.z);a=d.Matrix.multiply(a,b);m=(new d.Matrix).setTranslationComponent(m.x,
m.y,m.z);d.Matrix.multiply(a,m).transform(g,g);b.transform(h,h);h.normalize();e.setPosition(g);e.setUp(h);c.setCamera(e)};e.prototype.onMousewheel=function(b){b=b.getWheelDelta();var a=this._viewer.view.getCamera(),c=a.getUp().normalize();a=d.Point3.subtract(a.getTarget(),a.getPosition()).normalize();c=d.Point3.cross(c,a).normalize();0<b?this._rotateAroundAxis(c,this._tiltAmount):this._rotateAroundAxis(c,-this._tiltAmount)};e.prototype.setRotationAxis=function(b){var a=!0;switch(b){case d.Axis.X:this._rotationAxis.set(1,
0,0);break;case d.Axis.Y:this._rotationAxis.set(0,1,0);break;case d.Axis.Z:this._rotationAxis.set(0,0,1);break;default:a=!1}return a};return e}(h.CameraOrbitBaseOperator);h.CameraTurntableOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){function b(b,c,a){this._keyboardWalkOperator=a;this._activeOperator=this._walkOperator=c;this._walkMode=d.WalkMode.Mouse;this._active=!1}b.prototype.setWalkMode=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:if(this._walkMode===b)return[3,7];this._walkMode=b;if(b!==d.WalkMode.Keyboard)return[3,4];this._activeOperator=this._keyboardWalkOperator;return this._active?[4,this._walkOperator.onDeactivate()]:
[3,3];case 1:return c.sent(),[4,this._keyboardWalkOperator.onActivate()];case 2:c.sent(),c.label=3;case 3:return[3,7];case 4:return this._activeOperator=this._walkOperator,this._active?[4,this._keyboardWalkOperator.onDeactivate()]:[3,7];case 5:return c.sent(),[4,this._walkOperator.onActivate()];case 6:c.sent(),c.label=7;case 7:return[2]}})})};b.prototype.getWalkMode=function(){return this._activeOperator instanceof h.CameraKeyboardWalkOperator?d.WalkMode.Keyboard:d.WalkMode.Mouse};b.prototype.onMouseDown=
function(b){this._activeOperator.onMouseDown(b)};b.prototype.onMouseMove=function(b){this._activeOperator.onMouseMove(b)};b.prototype.onMouseUp=function(b){this._activeOperator.onMouseUp(b)};b.prototype.onMousewheel=function(b){this._activeOperator.onMousewheel(b)};b.prototype.onTouchStart=function(b){this._activeOperator.onTouchStart(b)};b.prototype.onTouchMove=function(b){this._activeOperator.onTouchMove(b)};b.prototype.onTouchEnd=function(b){this._activeOperator.onTouchEnd(b)};b.prototype.onKeyDown=
function(b){this._activeOperator.onKeyDown(b)};b.prototype.onKeyUp=function(b){if(this._activeOperator instanceof h.CameraKeyboardWalkOperator)this._activeOperator.onKeyUp(b)};b.prototype.onDeactivate=function(){return this._activeOperator.onDeactivate()};b.prototype.onActivate=function(){this._active=!0;return this._activeOperator.onActivate()};b.prototype.onViewOrientationChange=function(){this._active=!1};b.prototype.stopInteraction=function(){return this._activeOperator.stopInteraction()};b.prototype.setBimModeEnabled=
function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){c=[];b?(c.push(this._keyboardWalkOperator.enableBimMode()),c.push(this._walkOperator.enableBimMode())):(c.push(this._keyboardWalkOperator.disableBimMode()),c.push(this._walkOperator.disableBimMode()));return[2,Promise.all(c).then(function(){})]})})};b.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,Promise.all([this._walkOperator.resetDefaultWalkSpeeds(),
this._keyboardWalkOperator.resetDefaultWalkSpeeds()]).then(function(){})]})})};b.prototype.setBimFloorConfig=function(b){this._walkOperator.setBimFloorConfig(b);this._keyboardWalkOperator.setBimFloorConfig(b)};b.prototype.setBimWallConfig=function(b){this._walkOperator.setBimWallConfig(b);this._keyboardWalkOperator.setBimWallConfig(b)};b.prototype.setBimDoorConfig=function(b){this._walkOperator.setBimDoorConfig(b);this._keyboardWalkOperator.setBimDoorConfig(b)};b.prototype.setZoomSpeed=function(b){this._walkOperator.setZoomSpeed(b);
this._keyboardWalkOperator.setZoomSpeed(b)};b.prototype.setWalkSpeed=function(b){this._walkOperator.setWalkSpeed(b);this._keyboardWalkOperator.setWalkSpeed(b)};b.prototype.setElevationSpeed=function(b){this._walkOperator.setElevationSpeed(b);this._keyboardWalkOperator.setElevationSpeed(b)};b.prototype.setRotationSpeed=function(b){this._walkOperator.setRotationSpeed(b);this._keyboardWalkOperator.setRotationSpeed(b)};b.prototype.setViewAngle=function(b){this._walkOperator.setViewAngle(b);this._keyboardWalkOperator.setViewAngle(b)};
return b}();h.CameraWalkModeOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._timerId=null;c._walkButton=d.Button.None;c._previousTimestamp=0;c._activeTouchCount=0;c._maxDistance=200;return c}__extends(e,b);e.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,b.prototype.onActivate.call(this)];case 1:return c.sent(),this._viewer.trigger("walkOperatorActivated"),[2]}})})};e.prototype.onKeyDown=function(b){b=
b.getKeyCode();var a=this.getWalkSpeed();b===d.KeyCode.PgUp&&this.setWalkSpeed(1.2*a);b===d.KeyCode.PgDown&&this.setWalkSpeed(.8*a);b===d.KeyCode.v&&this.toggleBimMode()};e.prototype.onDeactivate=function(){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(a){switch(a.label){case 0:return c=this._resetCameraTarget(),this.stopWalking(),[4,b.prototype.onDeactivate.call(this)];case 1:return a.sent(),this._viewer.trigger("walkOperatorDeactivated"),[2,c]}})})};e.prototype.onMouseDown=
function(c){b.prototype.onMouseDown.call(this,c);var a=this._viewer.view;a.getProjectionMode()!==d.Projection.Perspective&&(a.setProjectionMode(d.Projection.Perspective),this._calculateInitialPosition());this.isActive()&&(this.stopWalking(),this.setWalkActive(!0),this._walkButton=c.getButton())};e.prototype.onMouseMove=function(c){b.prototype.onMouseMove.call(this,c);this.getWalkActive()&&null===this._timerId&&this.isActive()&&(this._previousTimestamp=Date.now(),this._onTick())};e.prototype.onMouseUp=
function(c){this.isActive()&&this.stopWalking();b.prototype.onMouseUp.call(this,c)};e.prototype.onTouchStart=function(c){b.prototype.onTouchStart.call(this,c);++this._activeTouchCount;1===this._activeTouchCount?this._walkButton=d.Button.Left:2===this._activeTouchCount?this._walkButton=d.Button.Right:3===this._activeTouchCount&&(this._walkButton=d.Button.None)};e.prototype.onTouchMove=function(c){3===this._activeTouchCount&&this._primaryTouchId===c.getId()?(this._ptCurrent.assign(c.getPosition()),
c=d.Point2.subtract(this._ptCurrent,this._ptPrevious),this._adjustTilt(c.y/100*1.5)):3>this._activeTouchCount&&b.prototype.onTouchMove.call(this,c)};e.prototype.onTouchEnd=function(c){b.prototype.onTouchEnd.call(this,c);0<this._activeTouchCount&&--this._activeTouchCount};e.prototype.onMousewheel=function(b){0<b.getWheelDelta()?this._adjustTilt(3):this._adjustTilt(-3)};e.prototype.stopWalking=function(){null!==this._timerId&&(cancelAnimationFrame(this._timerId),this._timerId=null);this.setWalkActive(!1)};
e.prototype._testWalk=function(b,a,f){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(k){switch(k.label){case 0:return c=new d.Event.MouseInputEvent(0,0,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Down),e=new d.Event.MouseInputEvent(0,b,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Move),g=new d.Event.MouseInputEvent(0,b,f,d.Buttons.None,d.KeyModifiers.None,d.MouseInputType.Up),this.onMouseDown(c),this.onMouseMove(e),[4,d.Util.sleep(a)];
case 1:return k.sent(),this.onMouseUp(g),[2]}})})};e.prototype._onTick=function(){var b=this,a=Date.now(),f=(a-this._previousTimestamp)/1E3;this._previousTimestamp=a;var e=this._viewer.view;a=d.Point2.subtract(this._ptCurrent,this._ptFirst);var g=new d.Point2(Math.abs(a.x)/this._maxDistance,Math.abs(a.y)/this._maxDistance),h=this.getRotationSpeed()*f*g.x,m=this.getWalkSpeed()*f*g.y,p=this.getElevationSpeed()*f*g.x;f=this.getElevationSpeed()*f*g.y;if(this._walkButton===d.Button.Left){if(0!==a.x&&(0<
a.x?this.rotateRight(h):0>a.x&&this.rotateLeft(h)),0!==a.y){var q=e.getCamera();this._resetPosition(q);f=q.getTarget();e=q.getPosition();f=d.Point3.subtract(f,e).normalize();var r=q.getUp(),w=d.Point3.scale(f,m);0<a.y&&(w=w.negate());this.setWalkActive(!0);var t=this.getBimModeEnabled();this.getActiveWalk().set(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return t?[4,this._applyWalkDeltaWithCollisionCheck(q,w,r)]:[3,4];case 1:return a.sent(),
[4,this._applyGravity()];case 2:return a.sent(),[4,this._updateNearbyDoors()];case 3:return a.sent(),[3,5];case 4:return[2,this._applyWalkDelta(q,w)];case 5:return[2]}})})})}}else if(this._walkButton===d.Button.Right||this._walkButton===d.Button.Middle)0<Math.abs(a.y)&&(0<a.y?this.walkUp(f):this.walkDown(f)),0<Math.abs(a.x)&&(0<a.x?this.walkRight(p):this.walkLeft(p));this._timerId=requestAnimationFrame(function(){b._onTick()})};e.prototype._adjustTilt=function(b){var a=this._viewer.view;this.setTilt(this.getTilt()+
b);b=a.getCamera();this._resetPosition(b);var c=b.getTarget(),e=b.getPosition(),g=d.Point3.distance(c,e),h=b.getUp().normalize();c=d.Point3.subtract(c,e).normalize();h=d.Point3.cross(h,c).normalize();d.Matrix.createFromOffAxisRotation(h,this.getTilt()).transform(c,c);c.normalize().scale(g);b.setTarget(d.Point3.add(e,c));a.setCamera(b)};e.prototype._resetCameraTarget=function(){return __awaiter(this,void 0,void 0,function(){var b,a,f,e,g,h;return __generator(this,function(c){switch(c.label){case 0:return b=
this._viewer.view,a=b.getCanvasSize(),f=new d.Point2(Math.round(a.x/2),Math.round(a.y/2)),e=new d.PickConfig,[4,b.pickFromPoint(f,e)];case 1:return g=c.sent(),g.isEntitySelection()&&(h=b.getCamera(),h.setTarget(g.getPosition()),b.updateCamera(h)),[2]}})})};return e}(h.CameraWalkBaseOperator);h.CameraWalkOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(){this._positionOffset=d.Point2.zero();this._position=d.Point2.zero();this._activeNoteText=null;this._createTextBox()}b.prototype._createTextBox=function(){var b=this;this._container=document.createElement("div");this._container.className="noteTextElement";this._textArea=document.createElement("textarea");this._textArea.oninput=function(){null!==b._activeNoteText&&b._activeNoteText.saveTextValue()};this._container.appendChild(this._textArea);
var a=7;["blue","red","green","white","black"].forEach(function(c){var f=document.createElement("button");f.className="noteButton color "+c;f.style.top=a+"px";a+=25;f.id=c+"_button";switch(c){case "blue":var e=d.Color.blue();break;case "red":e=d.Color.red();break;case "green":e=d.Color.green();break;case "white":e=d.Color.white();break;case "black":e=d.Color.black();break;default:e=d.Color.white()}f.onmousedown=function(){null!==b._activeNoteText&&b._activeNoteText.setColor(e)};b._container.appendChild(f)});
var f=document.createElement("button");f.className="noteButton trash";f.style.top=a+"px";f.onmousedown=function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeNoteText?[3,2]:[4,this._activeNoteText.remove()];case 1:a.sent(),a.label=2;case 2:return[2]}})})};this._container.appendChild(f)};b.prototype.setPositionOffset=function(b){this._positionOffset=b};b.prototype.getPositionOffset=function(){return this._positionOffset.copy()};
b.prototype.setPosition=function(b){this._position=d.Point2.add(b,this._positionOffset);this._container.style.left=this._position.x+"px";this._container.style.top=this._position.y+"px"};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.setText=function(b){var a=this._container.querySelector("textarea");null!==a&&(a.value=b)};b.prototype.getText=function(){var b=this._container.querySelector("textarea");return null!==b?b.value:""};b.prototype.setSize=function(b){this._container.style.width=
b.x+"px";this._container.style.height=b.y+"px"};b.prototype.getSize=function(){var b=this._container.getBoundingClientRect();return new d.Point2(b.width,b.height)};b.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto"};b.prototype.blur=function(){this._container.blur()};b.prototype.hide=function(){this._container.style.visibility="hidden";this._activeNoteText=null};b.prototype.show=function(b){this._container.style.visibility="visible";this._activeNoteText=
b};b.prototype.getHtmlContainer=function(){return this._container};b.prototype.setHtmlContainer=function(b){this._container=b};return b}();g.NoteTextElement=b})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(){return function(){this.rotate=this.viewPlane=this.plane=this.axis=null}}(),b=function(){return function(b,a,f,e,g,h){this.vector=a;this.matrix=f;this.nodeId=e;this.position=b;this.handleType=g;this.translation=d.Point3.zero();this.groupId=h}}(),e=function(c){function a(a){var b=c.call(this)||this;b._meshIds=new g;b._scaleModifier=1;b._id=0;b._handleData=new Map;b._translationFromInitialHandlePosition=d.Point3.zero();b._groupIdRotationMatrix=new Map;b._viewer=
a;b._callbacks={camera:function(){b._updateCamera()},_assemblyTreeReady:function(){return __awaiter(b,void 0,void 0,function(){var a,b,c,d,f=this;return __generator(this,function(e){this._updateViewport();this._hideOverlay();a=this._createMeshId(this._getAxisMeshData()).then(function(a){f._meshIds.axis=a});b=this._createMeshId(this._getPlaneMeshData()).then(function(a){f._meshIds.plane=a});c=this._createMeshId(this._getViewPlaneMeshData()).then(function(a){f._meshIds.viewPlane=a});d=this._createMeshId(this._getRotateMeshData()).then(function(a){f._meshIds.rotate=
a});a;b;c;d;return[2]})})},modelSwitchStart:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.removeHandles()];case 1:return a.sent(),[2]}})})}};b._viewer.setCallbacks(b._callbacks);return b}__extends(a,c);a.prototype.remove=function(){null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);c.prototype.remove.call(this)};a.prototype._getAxisMeshData=function(){return d.Util.generateConeCylinderMeshData(a._cylinderRadius,
a._segmentCount,a._cylinderHeight,a._coneBaseRadius,a._capHeight,a._taperHeight)};a.prototype._getPlaneMeshData=function(){var b=new d.Point3(a._planeOffset,0,a._planeOffset),c=new d.Point3(a._planeOffset+a._planeLength,0,a._planeOffset),e=new d.Point3(a._planeOffset+a._planeLength,0,a._planeOffset+a._planeLength),g=new d.Point3(a._planeOffset,0,a._planeOffset+a._planeLength),h=[b.x,b.y,b.z,c.x,c.y,c.z,e.x,e.y,e.z,b.x,b.y,b.z,e.x,e.y,e.z,g.x,g.y,g.z],p=new d.Point3(0,-1,0);p=[p.x,p.y,p.z,p.x,p.y,
p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z];var q=new d.MeshData;q.addFaces(h,p);q.setBackfacesEnabled(!0);q.addPolyline([b.x,b.y,b.z,c.x,c.y,c.z]);q.addPolyline([c.x,c.y,c.z,e.x,e.y,e.z]);q.addPolyline([e.x,e.y,e.z,g.x,g.y,g.z]);q.addPolyline([g.x,g.y,g.z,b.x,b.y,b.z]);return q};a.prototype._getViewPlaneMeshData=function(){return d.Util.generateSphereMeshData()};a.prototype._getRotateMeshData=function(a,b,c){void 0===a&&(a=35);void 0===b&&(b=12);void 0===c&&(c=.5);var f=a*Math.PI/180*.5;
a=[];for(var e=-f;e<=f;e+=.1){var g=Math.sin(e)*b;a.push(Math.cos(e)*b);a.push(0);a.push(g)}b=new d.Point3(0,0,1);c=d.Util.createCylinderMeshDataFromArc(a,b,10,c);c.setBackfacesEnabled(!0);return c};a.prototype.setAxisMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.axis?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.axis=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.axis,
a)];case 3:return[2]}})})};a.prototype.setPlaneMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.plane?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.plane=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.plane,a)];case 3:return[2]}})})};a.prototype.setViewPlaneMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,
function(c){switch(c.label){case 0:return null!==this._meshIds.viewPlane?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.viewPlane=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.viewPlane,a)];case 3:return[2]}})})};a.prototype.setRotateMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.rotate?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),
this._meshIds.rotate=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.rotate,a)];case 3:return[2]}})})};a.prototype.getOverlayId=function(){return d.BuiltinOverlayIndex.Handles};a.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!1)};a.prototype.hideOverlay=function(){this._hideOverlay();return Promise.resolve()};a.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(d.BuiltinOverlayIndex.Handles,!0);
this._updateCamera()};a.prototype.showOverlay=function(){this._showOverlay();return Promise.resolve()};a.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(d.BuiltinOverlayIndex.Handles,d.OverlayAnchor.UpperLeftCorner,0,d.OverlayUnit.ProportionOfCanvas,0,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas,1,d.OverlayUnit.ProportionOfCanvas)};a.prototype.updateViewport=function(){this._updateViewport();return Promise.resolve()};a.prototype.addHandles=function(a,
b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return this._scaleModifier=b,this._translationFromInitialHandlePosition.assign(d.Point3.zero()),[4,this.createDefaultHandles(a,c)];case 1:return f.sent(),this._showOverlay(),[2]}})})};a.prototype._updateCamera=function(){this._viewer.overlayManager.setCamera(d.BuiltinOverlayIndex.Handles,this._viewer.view.getCamera())};a.prototype.getVector=function(a){a=this._handleData.get(a);return void 0!==
a&&(a=a.vector,null!==a)?a.copy():null};a.prototype.getHandleType=function(a){a=this._handleData.get(a);return void 0===a?null:a.handleType};a.prototype.getHandleGroupId=function(b){b=this._handleData.get(b);return void 0===b?a.defaultGroupId:b.groupId};a.prototype.getPosition=function(a){if(a=this._handleData.get(a)){var b=a.translation.copy();return a.position.copy().add(this._translationFromInitialHandlePosition).add(b)}return null};a.prototype.getHandleNodeIds=function(){var a=[];this._handleData.forEach(function(b,
c){a.push(c)});return a};a.prototype.removeHandles=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return a=this.getHandleNodeIds(),this._handleData.clear(),this._groupIdRotationMatrix.clear(),this._id=0,this._hideOverlay(),[4,this._viewer.model.deleteMeshInstances(a)];case 1:return b.sent(),[2]}})})};a.prototype.isEmpty=function(){return 0===this._handleData.size};a.prototype.createDefaultHandles=function(b,c){return __awaiter(this,
void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:return f=[],f.push(this.addViewPlaneHandle(b,a._viewPlaneColor,c)),f.push(this.addAxisTranslationHandle(b,new d.Point3(1,0,0),a._xColor,null,c)),f.push(this.addAxisTranslationHandle(b,new d.Point3(0,1,0),a._yColor,null,c)),f.push(this.addAxisTranslationHandle(b,new d.Point3(0,0,1),a._zColor,null,c)),f.push(this.addPlaneTranslationHandle(b,new d.Point3(1,0,0),a._zColor,d.Color.black(),new d.Point3(0,-1,0),c)),
f.push(this.addPlaneTranslationHandle(b,new d.Point3(0,1,0),a._xColor,d.Color.black(),new d.Point3(0,0,-1),c)),f.push(this.addPlaneTranslationHandle(b,new d.Point3(0,0,1),a._yColor,d.Color.black(),new d.Point3(-1,0,0),c)),f.push(this.addRotateHandle(b,new d.Point3(1,0,0),a._zColor,new d.Point3(0,-1,0),c)),f.push(this.addRotateHandle(b,new d.Point3(0,1,0),a._xColor,new d.Point3(0,0,-1),c)),f.push(this.addRotateHandle(b,new d.Point3(0,0,1),a._yColor,new d.Point3(-1,0,0),c)),[4,Promise.all(f)];case 1:return e.sent(),
[2]}})})};a.prototype._createMeshId=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return b=this._viewer.model,[4,b.createMesh(a,{doNotDelete:!0})];case 1:return c=d.sent(),[2,c]}})})};a.prototype.addAxisTranslationHandle=function(a,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.axis)return[3,2];f=this._meshIds;return[4,
this._createMeshId(this._getAxisMeshData())];case 1:f.axis=m.sent(),m.label=2;case 2:return k="handle-axis-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.axis,k,e,null,a.copy(),l.copy())];case 3:return n=m.sent(),this._handleData.set(n,new b(a.copy(),c.copy(),l.copy(),n,d.HandleType.Axis,h)),[2,n]}})})};a.prototype.addViewPlaneHandle=function(a,c,e){return __awaiter(this,void 0,void 0,function(){var f,g;return __generator(this,function(k){switch(k.label){case 0:if(null!==
this._meshIds.viewPlane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getViewPlaneMeshData())];case 1:f.viewPlane=k.sent(),k.label=2;case 2:return[4,this._createMeshInstance(this._meshIds.viewPlane,"handle-sphere-instance",c,null,a,new d.Matrix)];case 3:return g=k.sent(),this._handleData.set(g,new b(a.copy(),null,new d.Matrix,g,d.HandleType.ViewPlane,e)),[2,g]}})})};a.prototype.addPlaneTranslationHandle=function(a,c,e,g,h,p){return __awaiter(this,void 0,void 0,function(){var f,k,l,
n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.plane)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getPlaneMeshData())];case 1:f.plane=m.sent(),m.label=2;case 2:return k="handle-plane-translation-"+this._id++,l=this._getRotationMatrixFromVector(c,h),[4,this._createMeshInstance(this._meshIds.plane,k,e,g,a,l)];case 3:return n=m.sent(),this._handleData.set(n,new b(a.copy(),c.copy(),l.copy(),n,d.HandleType.Plane,p)),[2,n]}})})};a.prototype.addRotateHandle=
function(a,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l,n;return __generator(this,function(m){switch(m.label){case 0:if(null!==this._meshIds.rotate)return[3,2];f=this._meshIds;return[4,this._createMeshId(this._getRotateMeshData())];case 1:f.rotate=m.sent(),m.label=2;case 2:return k="handle-rotate-"+this._id++,l=this._getRotationMatrixFromVector(c,g),[4,this._createMeshInstance(this._meshIds.rotate,k,e,null,a,l)];case 3:return n=m.sent(),this._handleData.set(n,new b(a.copy(),c.copy(),
l.copy(),n,d.HandleType.Rotate,h)),[2,n]}})})};a.prototype._getRotationMatrixFromVector=function(a,b){b||(b=new d.Point3(1,0,0),.001>d.Point3.cross(b,a).squaredLength()&&(b=new d.Point3(0,1,0)));b=d.Point3.cross(b,a).normalize();var c=d.Point3.cross(b,a).normalize();a.normalize();var f=new d.Matrix;f.m[0]=b.x;f.m[1]=b.y;f.m[2]=b.z;f.m[3]=0;f.m[4]=a.x;f.m[5]=a.y;f.m[6]=a.z;f.m[7]=0;f.m[8]=c.x;f.m[9]=c.y;f.m[10]=c.z;f.m[11]=0;f.m[12]=0;f.m[13]=0;f.m[14]=0;f.m[15]=1;return f};a.prototype._createMeshInstance=
function(a,b,c,e,g,h){return __awaiter(this,void 0,void 0,function(){var f,k,l;return __generator(this,function(n){f=this._createTransformationMatrix(g,new d.Matrix);f=d.Matrix.multiply(h,f);k=new d.MeshInstanceData(a,f,b,c||void 0,e||void 0);k.setOpacity(1);k.setCreationFlags(d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.OverrideSceneVisibility|
d.MeshInstanceCreationFlags.AlwaysDraw);k.setOverlayIndex(d.BuiltinOverlayIndex.Handles);l=this._viewer.model;return[2,l.createMeshInstance(k,void 0,!0,!0)]})})};a.prototype._createTransformationMatrix=function(b,c){var f=a._defaultScale*this._scaleModifier;f=(new d.Matrix).setScaleComponent(f,f,f);f=d.Matrix.multiply(f,c);f.setTranslationComponent(b.x,b.y,b.z);return f};a.prototype._getHandlePosition=function(a){var b=null;this._handleData.forEach(function(c){c.groupId===a&&(b=c.position.copy())});
return b};a.prototype.getGroupIdRotationMatrix=function(a){a=this._groupIdRotationMatrix.get(a);return void 0===a?new d.Matrix:a.copy()};a.prototype.updatePosition=function(a,b,c,e,g){return __awaiter(this,void 0,void 0,function(){var f,k,h,l,n=this;return __generator(this,function(m){switch(m.label){case 0:f=this._viewer.model;k=[];h=new Map;l=this._getHandlePosition(e);if(null===l)return[2];this._handleData.forEach(function(m,p){var q=m.groupId,r=void 0!==g.get(q);if(q===e||r){var t=m.position.copy();
t.add(a.copy());var w=m.translation.copy();t.add(w);w=d.Matrix.multiply(n.getGroupIdRotationMatrix(q),b);w=d.Matrix.multiply(m.matrix,w);r&&(r=d.Point3.subtract(t,l),b.transform(r,t),t.add(l));r=n._createTransformationMatrix(t,w);c&&(m.position.assign(t),h.set(q,d.Matrix.multiply(n.getGroupIdRotationMatrix(q),b)));k.push(f.setNodeMatrix(p,r))}});h.forEach(function(a,b){n._groupIdRotationMatrix.set(b,a.copy())});return[4,Promise.all(k)];case 1:return m.sent(),[2]}})})};a.prototype.resetTranslation=
function(){var a=this;this._translationFromInitialHandlePosition&&(this._handleData.forEach(function(b){b.translation.add(a._translationFromInitialHandlePosition)}),this._translationFromInitialHandlePosition.assign(d.Point3.zero()))};a.prototype.getTranslation=function(){return this._translationFromInitialHandlePosition};a.className="Communicator.Markup.HandleMarkup";a.defaultGroupId=-1;a._defaultScale=.02;a._cylinderRadius=.5;a._coneBaseRadius=.9;a._cylinderHeight=7;a._capHeight=1.2;a._taperHeight=
.2;a._segmentCount=20;a._planeOffset=1;a._planeLength=2.5;a._xColor=new d.Color(168,56,59);a._yColor=new d.Color(96,166,50);a._zColor=new d.Color(41,81,185);a._viewPlaneColor=d.Color.white();return a}(h.MarkupItem);h.HandleMarkup=e})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._firstNode=null;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._measurePoint1=null;c._measurePoint2=null;c._leaderPoint1=null;c._leaderPoint2=null;c._textPoint=null;c._name="MeasureBodyBodyDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),
c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._viewer=a;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,b);c.prototype.initCircle=function(a){a.setRadius(2.5);a.setFillColor(this._viewer.measureManager.getMeasurementColor())};
c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=a};c.prototype.setFirstNode=function(a){this._stage=1;this._firstNode=a};c.prototype.getFirstNode=function(){return this._firstNode};c.prototype.setSecondNode=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:if(null===this._firstNode)return[2];this._stage=2;return[4,this._viewer.model.computeMinimumBodyBodyDistance(this._firstNode,a)];case 1:return b=c.sent(),this._measurePoint1=
b.pos1.copy(),this._measurePoint2=b.pos2.copy(),this._textPoint=b.pos2.copy(),this._setMeasurementValue(b.distance),[2]}})})};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);if(!(2>this._stage)){var c=this._viewer.view.raycastFromPoint(a);if(null!==c&&null!==this._measurePoint1&&null!==this._measurePoint2&&null!=this._textPoint){var e=new d.Point3(1,0,0);this._measurePoint2.equals(this._measurePoint1)||
(e=d.Point3.subtract(this._measurePoint2,this._measurePoint1));var g=this._viewer.view.getCamera().getUp();a=d.Point3.cross(c.direction,g).normalize();var h=new d.Point3((this._measurePoint1.x+this._measurePoint2.x)/2,(this._measurePoint1.y+this._measurePoint2.y)/2,(this._measurePoint1.z+this._measurePoint2.z)/2);g=new d.Point3(h.x+g.x,h.y+g.y,h.z+g.z);var m=new d.Point3(h.x+a.x,h.y+a.y,h.z+a.z),p=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);
a=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,p,h,g,m,a);this._textPoint.assign(a);new d.Point3(0,0,0);c=Math.abs(e.x)<=Math.abs(e.y)&&Math.abs(e.x)<=Math.abs(e.z)?new d.Point3(1,0,0):Math.abs(e.y)<=Math.abs(e.x)&&Math.abs(e.y)<=Math.abs(e.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,e);h=d.Point3.cross(c,e);c.set(this._measurePoint1.x+c.x,this._measurePoint1.y+c.y,this._measurePoint1.z+c.z);h.set(this._measurePoint1.x+h.x,this._measurePoint1.y+h.y,this._measurePoint1.z+
h.z);g=new d.Point3(a.x+1E4*e.x,a.y+1E4*e.y,a.z+1E4*e.z);e=new d.Point3(a.x-1E4*e.x,a.y-1E4*e.y,a.z-1E4*e.z);e=d.Util.intersectionPlaneLine(g,e,this._measurePoint1,c,h,a);c=!isNaN(a.x)&&!isNaN(a.y)&&!isNaN(a.z);e&&c||(a=this._measurePoint2.copy());a=d.Point3.subtract(a,this._measurePoint1);this._leaderPoint1=new d.Point3(this._measurePoint1.x+a.x,this._measurePoint1.y+a.y,this._measurePoint1.z+a.z);this._leaderPoint2=new d.Point3(this._measurePoint2.x+a.x,this._measurePoint2.y+a.y,this._measurePoint2.z+
a.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){if(null!==this._leaderPoint1&&null!==this._leaderPoint2&&null!==this._textPoint){var a=new d.Point3((this._leaderPoint1.x+this._leaderPoint2.x)/2,(this._leaderPoint1.y+this._leaderPoint2.y)/2,(this._leaderPoint1.z+this._leaderPoint2.z)/2),b=d.Point3.subtract(this._leaderPoint2,this._leaderPoint1);2*d.Point3.subtract(this._textPoint,a).length()>b.length()?this._arrowsInvert=
!0:this._arrowsInvert=!1}};c.prototype.update=function(){var a=this;b.prototype.update.call(this);if(!(1>=this._stage)){var c=this._viewer.view;this._behindView=!1;var e=function(b){if(null===b)return d.Point2.zero();b=c.projectPoint(b);0>=b.z&&(a._behindView=!0);return d.Point2.fromPoint3(b)},g=e(this._measurePoint1),n=e(this._measurePoint2),m=e(this._textPoint),p=e(this._leaderPoint1);e=e(this._leaderPoint2);this._firstPointShape.setCenter(g);this._textShape&&this._textShape.setPosition(m);this._secondPointShape.setCenter(n);
this._lineShapes[0].set(g,n);this._lineShapes[1].set(p,e);this._lineShapes[2].set(g,p);this._lineShapes[3].set(n,e);this._lineShapes[4].set(p,m);this._lineShapes[5].set(p,e);this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[5].setEndcapsInverted(this._arrowsInvert)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=
this._viewer.markupManager.getRenderer();if(2===this._stage||3===this._stage){a.drawCircle(this._firstPointShape);a.drawCircle(this._secondPointShape);for(var b=0,c=this._lineShapes;b<c.length;b++)a.drawLine(c[b]);a.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._measurePoint1,measurePoint2:this._measurePoint2,leaderPoint1:this._leaderPoint1,leaderPoint2:this._leaderPoint2,textPoint:this._textPoint,
text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.fromJson=function(a,b){b=new c(b);b._name=a.name;b._measurePoint1=d.Point3.fromJson(a.measurePoint1);b._measurePoint2=d.Point3.fromJson(a.measurePoint2);b._textPoint=d.Point3.fromJson(a.textPoint);b._textShape.setTextString(a.text);b._leaderPoint1=d.Point3.fromJson(a.leaderPoint1);b._leaderPoint2=d.Point3.fromJson(a.leaderPoint2);b._measurementValue=a.measurementValue;
b._unitMultiplier=a.unitMultiplier||1;b._updateArrowsInverted();b._stage=2;return b};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureBodyBodyDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasureBodyBodyDistanceMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(d){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._lineEdgeShape=new d.Shape.Polyline;c._linePositions=[];c._name="MeasureLength";c._positions=[];c._lineShapes=[];c._lineEdgeShape.setStrokeWidth(4);c._lineEdgeShape.setStrokeColor(a.measureManager.getMeasurementEdgeColor());return c}__extends(c,b);c.prototype.setLineGeometry=function(a){this._lineEdgeShape.setStrokeColor(this._viewer.measureManager.getMeasurementEdgeColor());this._linePositions=a;this._stage=
1};c.prototype.reset=function(){this._stage=0};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a)};c.prototype.update=function(){b.prototype.update.call(this);var a=this._viewer.measureManager,c=a.getMeasurementColor();a=a.getMeasurementEdgeColor();this._lineShapes.forEach(function(a){a.setStrokeColor(c)});this._lineEdgeShape.setStrokeColor(a)};c.prototype.draw=function(){};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLengthMarkup"};return c}(g.MeasureMarkup);
g.MeasureLengthMarkup=b})(d.Measure||(d.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a,c,e,g){var f=b.call(this,a)||this;f._circlePoints=[];f._radius=0;f._surfaceCenter=d.Point3.zero();f._circlePlane=new d.Plane;f._arrowsInvert=!1;f._name="MeasureCircleEdgeLength";f._lineProperties=c;f._matrix=e.copy();f._unitMultiplier=g;f._textShape.getBoxPortion().setFillOpacity(1);f._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(c=0;5>c;c++)f._lineShapes.push(new h.Shape.Line),f._lineShapes[c].setStrokeColor(a.measureManager.getMeasurementColor());
return f}__extends(c,b);c.prototype.createCircleData=function(){d.Util.generatePointsOnCircle(this._circlePoints,this._lineProperties.origin,this._lineProperties.radius,32,this._lineProperties.normal);this._matrix.transformArray(this._circlePoints,this._circlePoints);this._positions[0]=this._circlePoints[0].copy();this._positions[1]=this._circlePoints[16].copy();var a=new d.Point3(this._lineProperties.radius,0,0),b=new d.Point3(0,0,0);this._matrix.transform(a,a);this._matrix.transform(b,b);this._radius=
d.Point3.subtract(b,a).length();d.Point3.subtract(this._positions[1],this._positions[0]);this._positions[4]=this._positions[1].copy();this._surfaceCenter=this._matrix.transform(this._lineProperties.origin);a=new d.Point3(this._circlePoints[0].x,this._circlePoints[0].y,this._circlePoints[0].z);b=new d.Point3(this._circlePoints[1].x,this._circlePoints[1].y,this._circlePoints[1].z);this._circlePlane=d.Plane.createFromPoints(a,b,this._surfaceCenter)};c.prototype.setLineGeometry=function(a){b.prototype.setLineGeometry.call(this,
a);this._positions[0]=this._linePositions[0];this._positions[0].equals(this._positions[this._positions.length-1])?this._positions[1]=this._positions[Math.floor(this._positions.length/2)]:this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[2]=this._linePositions[1].copy();this.createCircleData();this._setMeasurementValue(this._radius)};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);
var c=this._viewer.view.raycastFromPoint(a);if(null!==c){a=this._surfaceCenter;var e=this._circlePlane,g=e.rayIntersection(c);null===g&&(g=d.Point3.add(a,c.direction.copy().scale(-2*this._radius)),g=d.Plane.createFromPointAndNormal(g,c.direction).rayIntersection(c),console.assert(null!==g),c=new d.Ray(g,e.normal),g=e.rayIntersection(c),null===g&&(g=e.rayIntersection(c.negate())));null===g&&(console.assert(!1),g=a.copy());c=d.Point3.subtract(g,a).normalize().scale(this._radius);e=d.Point3.add(a,c);
a=d.Point3.subtract(a,c);this._positions[0]=e;this._positions[1]=a;this._positions[2]=e.copy();this._positions[3]=a.copy();this._positions[4]=g.copy();this._positions[5]=this._surfaceCenter.copy();this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var a=new d.Point3((this._positions[4].x+this._positions[5].x)/2,(this._positions[4].y+this._positions[5].y)/2,(this._positions[4].z+this._positions[5].z)/2),b=d.Point3.subtract(this._positions[5],
this._positions[4]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],a).length()>b.length()};c.prototype.update=function(){b.prototype.update.call(this);var a=this._viewer.view;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=0,e=this._linePositions;c<e.length;c++){var g=d.Point2.fromPoint3(a.projectPoint(e[c]));this._lineEdgeShape.pushPoint(g)}}if(1<this._stage){c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=d.Point2.fromPoint3(a.projectPoint(this._positions[e]));this._textShape&&
this._textShape.setPosition(c[4]);this._lineShapes[0].set(c[5],c[2]);this._lineShapes[1].set(c[5],c[4]);a=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.None);this._lineShapes[0].setEndcapsInverted(this._arrowsInvert);this._lineShapes[0].setEndEndcapColor(a);this._lineShapes[0].setStartEndcapColor(a)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()){this.update();
var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var b=0;2>b;b++)a.drawLine(this._lineShapes[b]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){var a=g.MeasureMarkup._serializePointArray(this._linePositions),b=g.MeasureMarkup._serializePointArray(this._positions);return{matrix:this._matrix.toJson(),lineOrigin:this._lineProperties.origin,
lineRadius:this._lineProperties.radius,lineNormal:this._lineProperties.normal,linePositions:a,positions:b,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){var f=d.Matrix.fromJson(a.matrix),e=a.lineRadius,h=d.Point3.fromJson(a.lineOrigin),m=d.Point3.fromJson(a.lineNormal);e=new d.SubentityProperties.CircleElement(e,h,m);b=new c(b,
e,f,a.unitMultiplier||1);f=g.MeasureMarkup._constructPointArray(a.linePositions);e=g.MeasureMarkup._constructPointArray(a.positions);b.setLineGeometry(f);b._positions=e;b._textShape.setTextString(a.text);b._stage=3;b._measurementValue=a.measurementValue;return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureCircleEdgeLengthMarkup"};return c}(g.MeasureLengthMarkup);g.MeasureCircleEdgeLengthMarkup=b})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){a=b.call(this,a)||this;a._faceSelection=[];a._arcArray=[];a._lineGeometryShape=new h.Shape.Polyline;a.planeIntersectionLine=[];a._pointOnLine=d.Point3.zero();a._clickpointOriginal2=d.Point3.zero();a._clickpointOriginal1=d.Point3.zero();a._plane1=new d.Plane;a._plane2=new d.Plane;a._secondPoint=d.Point3.zero();a._firstPoint=d.Point3.zero();a._textPos=d.Point3.zero();a._intermediatePoint=d.Point3.zero();a._textAnchorPoint=d.Point3.zero();
a._angle=0;a._useAuthoredNormals=!0;a._name="MeasureFaceFaceAngle";a._lineGeometryShape.setStrokeWidth(2);a._lineGeometryShape.setStrokeColor(a._viewer.measureManager.getMeasurementColor());a._textShape=new h.Shape.TextBox;a._textShape.getBoxPortion().setFillOpacity(1);a._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)a._lineShapes.push(new h.Shape.Line),a._lineShapes[c].setStrokeColor(a._viewer.measureManager.getMeasurementColor());return a}__extends(c,b);c.prototype._getNormalAndPositionFromSelection=
function(a,b,c){return __awaiter(this,void 0,void 0,function(){var f,e,g,k,h;return __generator(this,function(l){switch(l.label){case 0:return f=a.getNodeId(),e=a.getFaceEntity().getCadFaceIndex(),c.assign(a.getPosition().copy()),b.assign(a.getFaceEntity().getNormal()),[4,this._viewer.model.getFaceProperty(f,e)];case 1:return g=l.sent(),this._useAuthoredNormals&&null!==g&&g instanceof d.SubentityProperties.PlaneElement&&(k=this._viewer.model.getNodeNetMatrix(f),h=k.normalMatrix(),null!==h&&h.transform(g.normal,
b)),[2]}})})};c.prototype.getFirstSelection=function(){return this._faceSelection[0]};c.prototype.setFirstFace=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return b=a.getNodeId(),c=a.getFaceEntity().getCadFaceIndex(),this._viewer.model.setNodeFaceColor(b,c,new d.Color(255,0,0)),this._faceSelection.push(a),e=d.Point3.zero(),g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(a,e,g)];case 1:return f.sent(),
this._firstPoint=g.copy(),this._plane1.setFromPointAndNormal(this._firstPoint,e),this._clickpointOriginal1=a.getPosition().copy(),this._stage++,[2]}})})};c.prototype.setSecondFace=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g,h,p,q,r,w,t,u,v,z,x,y,A,B;return __generator(this,function(f){switch(f.label){case 0:return b=a.getNodeId(),c=a.getFaceEntity().getCadFaceIndex(),this._faceSelection[1]=a,this._viewer.model.setNodeFaceColor(b,c,new d.Color(255,0,0)),e=d.Point3.zero(),
g=d.Point3.zero(),[4,this._getNormalAndPositionFromSelection(a,g,e)];case 1:f.sent();this._secondPoint=e.copy();this._plane2.setFromPointAndNormal(this._secondPoint,g);this.planeIntersectionLine[0]=new d.Point3(0,0,0);this.planeIntersectionLine[1]=new d.Point3(0,0,0);h=d.Util.intersect3d2Planes(this._plane1,this._firstPoint,this._plane2,this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1]);if(2!==h)return[2,!1];p=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);
p.normalize();this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-100*p.x,this.planeIntersectionLine[0].y-100*p.y,this.planeIntersectionLine[0].z-100*p.z);this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*p.x,this.planeIntersectionLine[1].y+100*p.y,this.planeIntersectionLine[1].z+100*p.z);d.Util.computePointToLineDistance(this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1],this._pointOnLine);q=new d.Point3(0,0,0);r=new d.Point3(0,0,0);q.set(this._firstPoint.x+
p.x,this._firstPoint.y+p.y,this._firstPoint.z+p.z);d.Util.computePointToLineDistance(this._pointOnLine,this._firstPoint,q,r);this._firstPoint=r.copy();this._clickpointOriginal2=a.getPosition().copy();w=new d.Matrix;t=d.Point3.subtract(this._secondPoint,this._pointOnLine);u=t.length();v=d.Point3.subtract(this._firstPoint,this._pointOnLine);v.normalize();this._intermediatePoint.set(this._pointOnLine.x+v.x*u,this._pointOnLine.y+v.y*u,this._pointOnLine.z+v.z*u);this._angle=d.Util.computeAngleBetweenVector(t,
v);if(0===this._angle)return[2,!1];this._measurementValue=this._angle;this._textShape.setTextString(this._measurementValue.toFixed(2)+"\u00b0");this._viewer.trigger("measurementValueSet",this);this._textPos=this._pointOnLine.copy();z=!1;x=new d.Point3(0,0,0);y=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(p,1,w);w.transform(t,y);x.set(y.x+this._pointOnLine.x,y.y+this._pointOnLine.y,y.z+this._pointOnLine.z);x=d.Point3.subtract(x,this._firstPoint);A=x.length();d.Util.computeOffaxisRotation(p,-1,
w);w.transform(t,y);x.set(y.x+this._pointOnLine.x,y.y+this._pointOnLine.y,y.z+this._pointOnLine.z);d.Point3.subtract(x,this._firstPoint);B=x.length();B<A&&(z=!0);this._arcArray=d.Util.generateArcPoints(p,z?-this._angle:this._angle,this._pointOnLine,t,30);this._stage++;return[2,!0]}})})};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);if(!(1>=this._stage)&&(a=this._viewer.view.raycastFromPoint(a),null!==a)){var c=new d.Point3(a.origin.x+1E6*a.direction.x,a.origin.y+1E6*a.direction.y,
a.origin.z+1E6*a.direction.z),e=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(a.origin,c,this._pointOnLine,this._firstPoint,this._secondPoint,e);this._textPos=e.copy();new d.Point3(0,0,0);a=d.Point3.subtract(e,this._pointOnLine);c=a.length();a=d.Point3.subtract(this._secondPoint,this._pointOnLine);a.normalize();this._secondPoint.set(this._pointOnLine.x+a.x*c,this._pointOnLine.y+a.y*c,this._pointOnLine.z+a.z*c);a=d.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);a.normalize();
c=new d.Matrix;e=d.Point3.subtract(this._secondPoint,this._pointOnLine);var g=e.length(),h=d.Point3.subtract(this._firstPoint,this._pointOnLine);h.normalize();this._intermediatePoint.set(this._pointOnLine.x+h.x*g,this._pointOnLine.y+h.y*g,this._pointOnLine.z+h.z*g);g=!1;h=new d.Point3(0,0,0);var m=new d.Point3(0,0,0);d.Util.computeOffaxisRotation(a,1,c);c.transform(e,m);h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);var p=h.length();
d.Util.computeOffaxisRotation(a,-1,c);c.transform(e,m);h.set(m.x+this._pointOnLine.x,m.y+this._pointOnLine.y,m.z+this._pointOnLine.z);h=d.Point3.subtract(h,this._firstPoint);h.length()<p&&(g=!0);this._arcArray=d.Util.generateArcPoints(a,g?-this._angle:this._angle,this._pointOnLine,e,30);a=this._viewer.view.projectPoint(this._textPos);c=0;for(e=this._arcArray;c<e.length;c++)if(g=this._viewer.view.projectPoint(e[c]),g=(new d.Point3(a.x-g.x,a.y-g.y,a.z-g.z)).length(),void 0===q||q>g)var q=g;void 0===
q||20>=q?this._textAnchorPoint=this._textPos:(c=this._viewer.view.projectPoint(this._intermediatePoint),q=this._viewer.view.projectPoint(this._secondPoint),c=new d.Point3(c.x-a.x,c.y-a.y,c.z-a.z),q=new d.Point3(q.x-a.x,q.y-a.y,q.z-a.z),a=c.length(),q=q.length(),this._textAnchorPoint=a<q?this._intermediatePoint:this._secondPoint)}};c.prototype._nextStage=function(){this._stage++;2<this._stage&&(this._finalized=!0,this.cleanup())};c.prototype.cleanup=function(){var a=this,b=function(b){b=a._faceSelection[b];
a._viewer.model.unsetNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex())};2<=this._stage&&b(1);1<=this._stage&&b(0)};c.prototype.update=function(){b.prototype.update.call(this);var a=this._viewer.view;if(1<this._stage){this._lineGeometryShape.clearPoints();for(var c=0,e=this._arcArray;c<e.length;c++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(a.projectPoint(e[c])));this._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);
this._lineGeometryShape.setEndEndcapSize(5);this._lineGeometryShape.setStartEndcapSize(5);this._lineGeometryShape.setEndEndcapColor(this._viewer.measureManager.getMeasurementColor());this._lineGeometryShape.setStartEndcapColor(this._viewer.measureManager.getMeasurementColor());c=Array(10);c[0]=a.projectPoint(this._textPos);c[1]=a.projectPoint(this._firstPoint);c[2]=a.projectPoint(this._clickpointOriginal1);c[3]=a.projectPoint(this._secondPoint);c[4]=a.projectPoint(this._clickpointOriginal2);c[5]=
a.projectPoint(this._intermediatePoint);c[6]=a.projectPoint(this._textAnchorPoint);this._behindView=!1;a=Array(10);for(e=0;6>=e;e++)0>=c[e].z&&(this._behindView=!0),a[e]=d.Point2.fromPoint3(c[e]);this._textShape&&this._textShape.setPosition(a[0]);this._lineShapes[0].set(a[1],a[2]);this._lineShapes[1].set(a[1],a[5]);this._lineShapes[2].set(a[3],a[4]);this._lineShapes[3].set(a[6],a[0])}};c.prototype.draw=function(){var a=0!==this._viewer.explodeManager.getMagnitude();if(this._visibility&&!a&&(this.update(),
!this._behindView&&2<=this._stage&&4>=this._stage)){a=this._viewer.markupManager.getRenderer();for(var b=0;4>b;b++)a.drawLine(this._lineShapes[b]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineGeometryShape)}};c.prototype.setUseAuthoredNormals=function(a){this._useAuthoredNormals=a};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var a=[],b=0,c=this._arcArray;b<c.length;b++){var d=
c[b].toJson();a.push(d)}return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),arcArray:a,firstPoint:this._firstPoint.toJson(),clickpointOriginal1:this._clickpointOriginal1.toJson(),secondPoint:this._secondPoint.toJson(),clickpointOriginal2:this._clickpointOriginal2.toJson(),intermediatePoint:this._intermediatePoint.toJson(),textAnchorPoint:this._textAnchorPoint.toJson(),measurementValue:this._measurementValue,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};
c.fromJson=function(a,b){b=new c(b);for(var f=0,e=a.arcArray;f<e.length;f++){var g=d.Point3.fromJson(e[f]);b._arcArray.push(g)}b._textShape.setTextString(a.text);b._textPos.assign(d.Point3.fromJson(a.textPos));b._firstPoint.assign(d.Point3.fromJson(a.firstPoint));b._clickpointOriginal1=d.Point3.fromJson(a.clickpointOriginal1);b._secondPoint.assign(d.Point3.fromJson(a.secondPoint));b._clickpointOriginal2=d.Point3.fromJson(a.clickpointOriginal2);b._intermediatePoint.assign(d.Point3.fromJson(a.intermediatePoint));
b._textAnchorPoint.assign(d.Point3.fromJson(a.textAnchorPoint));b._measurementValue=a.measurementValue;b._stage=3;return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureFaceFaceAngleMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){a=b.call(this,a)||this;a._faceSelection=[];a._line1PreviewShape1=new h.Shape.Line;a._line1PreviewShape2=new h.Shape.Line;a._line2PreviewShape1=new h.Shape.Line;a._line2PreviewShape2=new h.Shape.Line;a._matrix1=new d.Matrix;a._matrix2=new d.Matrix;a._lineGeometryShape=new h.Shape.Polyline;a._parallelFaces=!1;a._triangulatedDistance=!0;a._pointsOnSameRay=!1;a._arrowsInvert=!1;a._faceData=[];a._distance=0;a._surfaceCenter=[d.Point3.zero(),
d.Point3.zero()];a._surfaceAxis1=[d.Point3.zero(),d.Point3.zero()];a._surfaceAxis2=[d.Point3.zero(),d.Point3.zero()];a._cylinderAxisInfinite1=[d.Point3.zero(),d.Point3.zero()];a._cylinderAxisInfinite2=[d.Point3.zero(),d.Point3.zero()];a._firstPointHelper=d.Point3.zero();a._secondPointHelper=d.Point3.zero();a._secondPoint=d.Point3.zero();a._firstPoint=d.Point3.zero();a._textPos=d.Point3.zero();a._name="MeasureFaceFaceDistance";a._lineGeometryShape.setStrokeWidth(2);a._lineGeometryShape.setStrokeColor(a._viewer.measureManager.getMeasurementColor());
a._textShape=new h.Shape.TextBox;a._textShape.getBoxPortion().setFillOpacity(1);a._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));for(var c=0;5>c;c++)a._lineShapes.push(new h.Shape.Line),a._lineShapes[c].setStrokeColor(a._viewer.measureManager.getMeasurementColor());return a}__extends(c,b);c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=a};c.prototype.setFirstFace=function(a,b,c,e){var f=a.getNodeId(),g=a.getFaceEntity(),k=a.getPosition();this._matrix1=c.copy();this._viewer.model.setNodeFaceColor(f,
g.getCadFaceIndex(),new d.Color(255,0,0));this._faceSelection[0]=a;this._firstPoint=k.copy();this._faceData[0]=b;this._faceData[0]instanceof d.SubentityProperties.PlaneElement?(a=this._faceData[0],b=new d.Point3(a.origin.x+a.normal.x,a.origin.y+a.normal.y,a.origin.z+a.normal.z),this._matrix1.transform(b,this._surfaceAxis1[0]),this._matrix1.transform(a.origin,this._surfaceCenter[0])):this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this.createCylinderData(this._faceData[0],c,e);this._stage++};
c.prototype.getFirstSelection=function(){return this._faceSelection[0]||null};c.prototype.getFirstFaceData=function(){return this._faceData[0]||null};c.prototype.cleanup=function(){var a=this._viewer.model;2<=this._stage&&a.unsetNodeFaceColor(this._faceSelection[1].getNodeId(),this._faceSelection[1].getFaceEntity().getCadFaceIndex());1<=this._stage&&a.unsetNodeFaceColor(this._faceSelection[0].getNodeId(),this._faceSelection[0].getFaceEntity().getCadFaceIndex())};c.prototype.createCylinderData=function(a,
b,c){c=d.Point3.subtract(c.max,c.min).length()/4;var f=new d.Point3(a.origin.x+1E4*a.normal.x,a.origin.y+1E4*a.normal.y,a.origin.z+1E4*a.normal.z),e=new d.Point3(a.origin.x-1E4*a.normal.x,a.origin.y-1E4*a.normal.y,a.origin.z-1E4*a.normal.z),g=new d.Point3(0,0,0);d.Util.computePointToLineDistance(a.origin,f,e,g);this._surfaceCenter[this._stage]=new d.Point3(0,0,0);b.transform(g,this._surfaceCenter[this._stage]);f=new d.Point3(g.x+a.normal.x,g.y+a.normal.y,g.z+a.normal.z);this._surfaceAxis1[this._stage]=
new d.Point3(0,0,0);b.transform(f,this._surfaceAxis1[this._stage]);f.set(g.x-a.normal.x,g.y-a.normal.y,g.z-a.normal.z);this._surfaceAxis2[this._stage]=new d.Point3(0,0,0);b.transform(f,this._surfaceAxis2[this._stage]);new d.Point3(0,0,0);a=this._surfaceAxis1[this._stage].copy();a=d.Point3.subtract(a,this._surfaceCenter[this._stage]);a.normalize();this._surfaceAxis1[this._stage].set(this._surfaceCenter[this._stage].x+a.x*c,this._surfaceCenter[this._stage].y+a.y*c,this._surfaceCenter[this._stage].z+
a.z*c);this._surfaceAxis2[this._stage].set(this._surfaceCenter[this._stage].x-a.x*c,this._surfaceCenter[this._stage].y-a.y*c,this._surfaceCenter[this._stage].z-a.z*c);this._cylinderAxisInfinite1[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x+a.x*c*1E3,this._surfaceCenter[this._stage].y+a.y*c*1E3,this._surfaceCenter[this._stage].z+a.z*c*1E3);this._cylinderAxisInfinite2[this._stage]=new d.Point3(this._surfaceCenter[this._stage].x-a.x*c*1E3,this._surfaceCenter[this._stage].y-a.y*c*1E3,
this._surfaceCenter[this._stage].z-a.z*c*1E3)};c.prototype.setSecondFace=function(a,b,c,e,g){return __awaiter(this,void 0,void 0,function(){var f,k,h,l,n,t,u,v,z,x,y,A,B,D,C,F,E,H,G,I,K,J;return __generator(this,function(m){switch(m.label){case 0:f=this._faceSelection[0];k=this._faceData[0];if(void 0===f||void 0===k)throw new d.CommunicatorError("setSecondFace() called before setFirstFace()");if(c instanceof d.SubentityProperties.PlaneElement)h=k,l=new d.Point3(h.origin.x+h.normal.x,h.origin.y+h.normal.y,
h.origin.z+h.normal.z),this._matrix1.transform(l,this._surfaceAxis1[0]),this._matrix1.transform(h.origin,this._surfaceCenter[0]);else if(c instanceof d.SubentityProperties.CylinderElement)this.createCylinderData(c,e,g);else return[2];return[4,this._viewer.model.computeMinimumFaceFaceDistance(f.getNodeId(),f.getFaceEntity().getCadFaceIndex(),b.getNodeId(),b.getFaceEntity().getCadFaceIndex())];case 1:n=m.sent();if(0===n.distance)return[2];this._matrix2=e.copy();this._secondPoint=b.getPosition().copy();
if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.PlaneElement))return[3,2];t=c;l=new d.Point3(t.origin.x+t.normal.x,t.origin.y+t.normal.y,t.origin.z+t.normal.z);this._matrix2.transform(l,this._surfaceAxis1[1]);this._matrix2.transform(t.origin,this._surfaceCenter[1]);u=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);v=new d.Point3(this._surfaceAxis1[1].x-
this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);u.normalize();v.normalize();z=new d.Point3(-u.x,-u.y,-u.z);u.equalsWithTolerance(v,1E-5)||z.equalsWithTolerance(v,1E-5)?(this._secondPointHelper=new d.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z),this._firstPointHelper=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z),x=new d.Plane,x.setFromPointAndNormal(this._surfaceCenter[0],u),
y=new d.Plane,y.setFromPointAndNormal(this._surfaceCenter[1],v),A=new d.Point3(this._firstPoint.x+u.x,this._firstPoint.y+u.y,this._firstPoint.z+u.z),d.Util.intersectionPlaneLine2(f.getPosition(),A,y,this._secondPoint),z.equalsWithTolerance(v,1E-5)&&(B=new d.Point3(-u.x,-u.y,-u.z),x.setFromPointAndNormal(this._surfaceCenter[0],B)),this._distance=D=Math.abs(y.d-x.d)/x.normal.length(),this._setMeasurementValue(this._distance),this._parallelFaces=!0,this._triangulatedDistance=!1,C=new d.Point3(0,1,0),
F=d.Point3.subtract(this._secondPoint,this._firstPoint),E=new d.Point3(0,0,0),E=d.Point3.subtract(this._secondPointHelper,this._firstPoint),H=d.Util.computeAngleBetweenVector(C,F),G=d.Util.computeAngleBetweenVector(C,E),this._textPos.assign(this._secondPoint),.1>H-G&&-.1<H-G&&(this._pointsOnSameRay=!0)):(this._firstPoint.assign(n.pos1),this._secondPoint.assign(n.pos2),this._textPos.assign(n.pos2),this._distance=n.distance,this._setMeasurementValue(this._distance));return[3,8];case 2:if(!(k instanceof
d.SubentityProperties.CylinderElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,3];u=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);v=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);u.normalize();v.normalize();z=new d.Point3(-u.x,-u.y,-u.z);if(u.equalsWithTolerance(v,
1E-5)||z.equalsWithTolerance(v,1E-5)){I=new d.Point3(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],I);this._firstPoint=I.copy();K=new d.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);K=d.Point3.subtract(K,this._surfaceCenter[0]);K.set(0,0,0);d.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],I);this._secondPoint=I.copy();D=d.Point3.subtract(this._secondPoint,
this._firstPoint).length();if(1E-7>D)return[2];this._triangulatedDistance=!1;this._textPos.assign(this._secondPoint);this._setMeasurementValue(D)}else{this._distance=d.Util.distanceLineLine(this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],this._firstPoint,this._secondPoint);if(1E-7>this._distance)return[2];this._textPos.assign(this._firstPoint);this._setMeasurementValue(this._distance)}return[3,8];case 3:if(!(k instanceof d.SubentityProperties.CylinderElement&&
c instanceof d.SubentityProperties.PlaneElement))return[3,5];u=new d.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[0],u))];case 4:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);
this._textPos.assign(J.pos2);this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=b;this._stage++;this.adjust(a);this._setMeasurementValue(this._distance);return[3,8];case 5:if(!(k instanceof d.SubentityProperties.PlaneElement&&c instanceof d.SubentityProperties.CylinderElement))return[3,7];u=new d.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,
this._surfaceAxis1[1].z-this._surfaceCenter[1].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(f.getNodeId(),f.getFaceEntity().getCadFaceIndex(),new d.Ray(this._surfaceCenter[1],u))];case 6:J=m.sent();this._distance=J.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(J.pos1);this._secondPoint.assign(J.pos2);this._textPos.assign(J.pos2);this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0));this._faceData[1]=c;this._faceSelection[1]=
b;this._stage++;this.adjust(a);this._setMeasurementValue(this._distance);return[3,8];case 7:this._firstPoint.assign(n.pos1);this._secondPoint.assign(n.pos2);this._textPos.assign(n.pos2);this._distance=n.distance;if(1E-7>this._distance)return[2];this._setMeasurementValue(this._distance);m.label=8;case 8:return this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),new d.Color(255,0,0)),this._faceData[1]=c,this._faceSelection[1]=b,this._stage++,this.adjust(a),[2]}})})};
c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);if(!(1>=this._stage)){var c=this._viewer.view.raycastFromPoint(a);if(null!==c){var e=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),g=d.Util.oneVectorCross(c.direction);new d.Point3(0,0,0);var h=d.Point3.cross(c.direction,g);h.normalize();new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2);var m=
this._textPos.copy();g.set(m.x+g.x,m.y+g.y,m.z+g.z);h.set(m.x+h.x,m.y+h.y,m.z+h.z);a=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,e,m,g,h,a);2===this._stage?d.Util.computePointToLineDistance(a,this._firstPoint,this._secondPoint,this._textPos):this._parallelFaces||this._triangulatedDistance?(c=new d.Point3(0,0,0),this._pointsOnSameRay||(d.Util.computePointToLineDistance(a,this._secondPoint,this._secondPointHelper,c),new d.Point3(0,0,0),a=d.Point3.subtract(c,this._secondPoint),this._secondPoint=
c.copy(),this._firstPoint.set(this._firstPoint.x+a.x,this._firstPoint.y+a.y,this._firstPoint.z+a.z),this._textPos.set(this._textPos.x+a.x,this._textPos.y+a.y,this._textPos.z+a.z))):(c=new d.Point3(0,0,0),d.Util.computePointToLineDistance(a,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],c),a=d.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+a.x,this._firstPoint.y+a.y,this._firstPoint.z+a.z),this._textPos.set(this._textPos.x+a.x,
this._textPos.y+a.y,this._textPos.z+a.z));this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){var a=new d.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2),b=d.Point3.subtract(this._secondPoint,this._firstPoint);2*d.Point3.subtract(this._textPos,a).length()>b.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype._nextStage=function(){this._stage++;
if(3<this._stage||2<this._stage&&this._triangulatedDistance)this._finalized=!0,this.cleanup()};c.prototype.update=function(){b.prototype.update.call(this);var a=this._viewer.view;this._behindView=!1;if(0!==this._stage){for(var c=Array(10),e=[],g=0;10>g;g++)e.push(new d.Point3(0,0,0));this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&(e[0]=a.projectPoint(this._surfaceCenter[0]),e[1]=a.projectPoint(this._surfaceAxis1[0]),e[2]=a.projectPoint(this._surfaceAxis2[0]),c[0]=d.Point2.fromPoint3(e[0]),
c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line1PreviewShape1.set(c[0],c[1]),this._line1PreviewShape2.set(c[0],c[2]));1<this._stage&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&(e[0]=a.projectPoint(this._surfaceCenter[1]),e[1]=a.projectPoint(this._surfaceAxis1[1]),e[2]=a.projectPoint(this._surfaceAxis2[1]),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._line2PreviewShape1.set(c[0],c[1]),this._line2PreviewShape2.set(c[0],
c[2]));1<this._stage&&(e[0]=a.projectPoint(this._textPos),e[1]=a.projectPoint(this._firstPoint),e[2]=a.projectPoint(this._secondPoint),c[0]=d.Point2.fromPoint3(e[0]),c[1]=d.Point2.fromPoint3(e[1]),c[2]=d.Point2.fromPoint3(e[2]),this._textShape&&this._textShape.setPosition(c[0]),this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setEndcapsInverted(this._arrowsInvert),this._lineShapes[0].setEndEndcapColor(this._viewer.measureManager.getMeasurementColor()),
this._lineShapes[0].setStartEndcapColor(this._viewer.measureManager.getMeasurementColor()),this._lineShapes[0].set(c[1],c[2]),this._faceData[1]instanceof d.SubentityProperties.CylinderElement&&this._faceData[0]instanceof d.SubentityProperties.CylinderElement?(e[3]=a.projectPoint(this._surfaceCenter[0]),e[4]=a.projectPoint(this._surfaceCenter[1]),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[1],c[3]),this._lineShapes[2].set(c[2],c[4]),this._lineShapes[3].set(c[0],
c[1])):(e[3]=a.projectPoint(this._firstPointHelper),e[4]=a.projectPoint(this._secondPointHelper),c[3]=d.Point2.fromPoint3(e[3]),c[4]=d.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[2],c[4]),this._lineShapes[2].set(c[1],c[3]),this._lineShapes[3].set(c[1],c[0])));for(g=0;6>g;g++)0>e[g].z&&(this._behindView=!0)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:this._faceData[0]instanceof
d.SubentityProperties.CylinderElement&&(a.drawLine(this._line1PreviewShape1),a.drawLine(this._line1PreviewShape2));break;case 2:case 3:case 4:this._faceData[0]instanceof d.SubentityProperties.CylinderElement&&this._faceData[1]instanceof d.SubentityProperties.CylinderElement?(3>this._stage&&(a.drawLine(this._line1PreviewShape1),a.drawLine(this._line1PreviewShape2),a.drawLine(this._line2PreviewShape1),a.drawLine(this._line2PreviewShape2)),a.drawLine(this._lineShapes[0]),a.drawLine(this._lineShapes[1]),
a.drawLine(this._lineShapes[2])):(this._viewer.markupManager.getRenderer().drawLine(this._lineShapes[0]),this._parallelFaces&&(a.drawLine(this._lineShapes[1]),a.drawLine(this._lineShapes[2]))),a.drawLine(this._lineShapes[3]),a.drawTextBox(this._textShape)}}};c._serializeFaceProp=function(a){return a instanceof d.SubentityProperties.CylinderElement?{type:"CylinderElement",origin:a.origin.toJson(),normal:a.normal.toJson(),radius:a.radius}:a instanceof d.SubentityProperties.PlaneElement?{type:"PlaneElement",
origin:a.origin.toJson(),normal:a.normal.toJson()}:null};c._constructFaceProp=function(a){if("CylinderElement"===a.type){var b=d.Point3.fromJson(a.origin),c=d.Point3.fromJson(a.normal);return new d.SubentityProperties.CylinderElement(a.radius,b,c)}return"PlaneElement"===a.type?(b=d.Point3.fromJson(a.origin),c=d.Point3.fromJson(a.normal),new d.SubentityProperties.PlaneElement(b,c)):null};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var a=[],b=0,d=this._faceData;b<
d.length;b++)a.push(c._serializeFaceProp(d[b]));b=[];d=0;for(var e=this._surfaceCenter;d<e.length;d++)b.push(e[d].toJson());d=[];for(var g=0,h=this._surfaceAxis1;g<h.length;g++)e=h[g],d.push(e.toJson());g=[];h=0;for(var p=this._surfaceAxis2;h<p.length;h++)e=p[h],g.push(e.toJson());return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),firstPoint:this._firstPoint.toJson(),secondPoint:this._secondPoint.toJson(),firstPointHelper:this._firstPointHelper.toJson(),secondPointHelper:this._secondPointHelper.toJson(),
measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,parallelFaces:this._parallelFaces,faceData:a,surfaceCenter:b,surfaceAxis1:d,surfaceAxis2:g,name:this.getName(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b);b.setName(a.name);b._textShape.setTextString(a.text);b._textPos.assign(d.Point3.fromJson(a.textPos));b._firstPoint.assign(d.Point3.fromJson(a.firstPoint));b._firstPointHelper.assign(d.Point3.fromJson(a.firstPointHelper));
b._secondPoint.assign(d.Point3.fromJson(a.secondPoint));b._secondPointHelper.assign(d.Point3.fromJson(a.secondPointHelper));console.assert(Array.isArray(a.faceData));for(var f=0,e=a.faceData;f<e.length;f++){var g=c._constructFaceProp(e[f]);console.assert(null!==g);b._faceData.push(g)}b._surfaceCenter[0].assign(a.surfaceCenter[0]);b._surfaceCenter[1].assign(a.surfaceCenter[1]);b._surfaceAxis1[0].assign(a.surfaceAxis1[0]);b._surfaceAxis1[1].assign(a.surfaceAxis1[1]);b._surfaceAxis2[0].assign(a.surfaceAxis2[0]);
b._surfaceAxis2[1].assign(a.surfaceAxis2[1]);b._stage=4;b._parallelFaces=a.parallelFaces;b._measurementValue=a.measurementValue;b._unitMultiplier=a.unitMultiplier||1;return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasureFaceFaceDistanceMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._anchorLinePoint=null;c._firstLinePoint=null;c._secondLinePoint=null;c._selectionPosition=null;c._lineGeometryShape=new h.Shape.Polyline;c._viewer=a;c._name="MeasureLineLineAngle";c._lineGeometryShape.setStrokeWidth(2);c._lineGeometryShape.setStrokeColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);c._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);
c._lineGeometryShape.setEndEndcapSize(5);c._lineGeometryShape.setStartEndcapSize(5);c._lineGeometryShape.setEndEndcapColor(c._viewer.measureManager.getMeasurementColor());c._lineGeometryShape.setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,b);c.prototype.addPoint=function(a){if(!this._finalized){if(null===this._anchorLinePoint)this._anchorLinePoint=a.copy(),
this._stage=1;else if(null===this._firstLinePoint)this._firstLinePoint=a.copy(),this._stage=2;else{var b=d.Point3.subtract(this._firstLinePoint,this._anchorLinePoint),c=d.Point3.subtract(a,this._anchorLinePoint);b=d.Util.computeAngleBetweenVector(b,c);if(0===b||180===b)return;this._secondLinePoint=a.copy();this.setMeasurementText(b.toFixed(2)+"\u00b0");this._measurementValue=b;this._finalized=!0;this._stage=3}this.draw()}};c.prototype.setSelectionPosition=function(a){this._selectionPosition=a};c.prototype._drawPreviewLine=
function(a,b){var c=this._viewer.markupManager.getRenderer(),f=this._viewer.view;a=d.Point2.fromPoint3(f.projectPoint(a));b=d.Point2.fromPoint3(f.projectPoint(b));b=new h.Shape.Line(a,b);c.drawLine(b)};c.prototype._drawAngleMarkup=function(a,b,c){var f=this._viewer.markupManager.getRenderer(),e=this._viewer.view,g=d.Point3.subtract(b,a),k=d.Point3.subtract(c,a),q=d.Point3.cross(g,k).normalize();b=d.Util.computeAngleBetweenVector(g,k);if(0!==b&&180!==b){q=d.Util.generateArcPoints(q,-b,a,k,30);this._lineGeometryShape.clearPoints();
for(var r=0;r<q.length;r++)this._lineGeometryShape.pushPoint(d.Point2.fromPoint3(e.projectPoint(q[r])));f.drawPolyline(this._lineGeometryShape)}k=k.length();g=d.Point3.add(a,g.copy().normalize().scale(k));a=d.Point2.fromPoint3(e.projectPoint(a));g=d.Point2.fromPoint3(e.projectPoint(g));c=d.Point2.fromPoint3(e.projectPoint(c));e=new h.Shape.Line(a,g);f.drawLine(e);c=new h.Shape.Line(a,c);f.drawLine(c);this._textShape.setPosition(g);this._finalized?this._textShape.setTextString(this.getMeasurementText()):
this._textShape.setTextString(b.toFixed(2)+"\u00b0");f.drawTextBox(this._textShape)};c.prototype.draw=function(){this._visibility&&null!==this._anchorLinePoint&&(0>=this._viewer.view.projectPoint(this._anchorLinePoint).z||(1===this._stage?null!==this._selectionPosition&&this._drawPreviewLine(this._anchorLinePoint,this._selectionPosition):2===this._stage?null!==this._firstLinePoint&&null!==this._selectionPosition&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._selectionPosition):
3===this._stage&&null!=this._firstLinePoint&&null!=this._secondLinePoint&&this._drawAngleMarkup(this._anchorLinePoint,this._firstLinePoint,this._secondLinePoint)))};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,anchorPoint:this._anchorLinePoint.copy(),firstPoint:this._firstLinePoint.copy(),secondPoint:this._secondLinePoint.copy(),measurementValue:this._measurementValue,measurementText:this.getMeasurementText(),className:this.getClassName()}};
c.fromJson=function(a,b){b=new c(b);b._name=a.name;b._anchorLinePoint=d.Point3.fromJson(a.anchorPoint);b._firstLinePoint=d.Point3.fromJson(a.firstPoint);b._secondLinePoint=d.Point3.fromJson(a.secondPoint);b._measurementValue=a.measurementValue;b.setMeasurementText(a.measurementText);b._finalized=!0;b._stage=3;return b};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLineLineAngleMarkup"};return c}(g.MeasureMarkup);g.MeasureLineLineAngleMarkup=b})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._arrowsInvert=!1;c._name="MeasurePointPointDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());
c._viewer=a;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new d.Color(255,255,255));return c}__extends(c,b);c.prototype.initCircle=function(a){a.setRadius(2.5);a.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=a};c.prototype.setFirstPointPosition=function(a){this._stage=1;this._positions[0]=
a.copy()};c.prototype.setSecondPointPosition=function(a){this._stage=2;this._positions[1]=a.copy();this._positions[2]=a.copy();this._setMeasurementValue(d.Point3.subtract(this._positions[1],this._positions[0]).length())};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.getFirstPointPosition=function(){return this._positions[0]};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);var c=this._viewer.view.raycastFromPoint(a);if(null!==
c){a=this._positions[0];var e=this._positions[1],g=new d.Point3(1,0,0);e.equals(a)||(g=d.Point3.subtract(e,a));var h=this._viewer.view.getCamera().getUp(),m=d.Point3.cross(c.direction,h).normalize(),p=new d.Point3((a.x+e.x)/2,(a.y+e.y)/2,(a.z+e.z)/2);h=new d.Point3(p.x+h.x,p.y+h.y,p.z+h.z);var q=new d.Point3(p.x+m.x,p.y+m.y,p.z+m.z),r=new d.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z);m=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(c.origin,r,p,
h,q,m);this._positions[2].assign(m);new d.Point3(0,0,0);c=Math.abs(g.x)<=Math.abs(g.y)&&Math.abs(g.x)<=Math.abs(g.z)?new d.Point3(1,0,0):Math.abs(g.y)<=Math.abs(g.x)&&Math.abs(g.y)<=Math.abs(g.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);c=d.Point3.cross(c,g);p=d.Point3.cross(c,g);c.set(a.x+c.x,a.y+c.y,a.z+c.z);p.set(a.x+p.x,a.y+p.y,a.z+p.z);h=new d.Point3(m.x+1E4*g.x,m.y+1E4*g.y,m.z+1E4*g.z);g=new d.Point3(m.x-1E4*g.x,m.y-1E4*g.y,m.z-1E4*g.z);g=d.Util.intersectionPlaneLine(h,g,a,c,p,m);c=!isNaN(m.x)&&
!isNaN(m.y)&&!isNaN(m.z);g&&c||(m=e.copy());m=d.Point3.subtract(m,a);this._positions[3]=new d.Point3(a.x+m.x,a.y+m.y,a.z+m.z);this._positions[4]=new d.Point3(e.x+m.x,e.y+m.y,e.z+m.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var a=new d.Point3((this._positions[3].x+this._positions[4].x)/2,(this._positions[3].y+this._positions[4].y)/2,(this._positions[3].z+this._positions[4].z)/2),b=d.Point3.subtract(this._positions[4],this._positions[3]);
2*d.Point3.subtract(this._positions[2],a).length()>b.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype.update=function(){b.prototype.update.call(this);var a=this._viewer.view,c=Array(6);if(0<this._stage){this._behindView=!1;for(var e=0;e<this._positions.length;e++)0>=a.projectPoint(this._positions[e]).z&&(this._behindView=!0),c[e]=d.Point2.fromPoint3(a.projectPoint(this._positions[e]));this._firstPointShape.setCenter(c[0])}1<this._stage&&(this._textShape&&this._textShape.setPosition(c[2]),
this._secondPointShape.setCenter(c[1]),this._lineShapes[0].set(c[0],c[1]),this._lineShapes[1].set(c[3],c[4]),this._lineShapes[2].set(c[0],c[3]),this._lineShapes[3].set(c[1],c[4]),this._lineShapes[4].set(c[3],c[2]),this._lineShapes[5].set(c[3],c[4]),this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setEndcapsInverted(this._arrowsInvert))};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&
(this.update(),!this._behindView)){var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawCircle(this._firstPointShape);break;case 2:case 3:a.drawCircle(this._firstPointShape);a.drawCircle(this._secondPointShape);for(var b=0,c=this._lineShapes;b<c.length;b++)a.drawLine(c[b]);a.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),
leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b);b._name=a.name;b._positions[0]=d.Point3.fromJson(a.measurePoint1);b._positions[1]=d.Point3.fromJson(a.measurePoint2);b._positions[2]=d.Point3.fromJson(a.textPoint);
b._textShape.setTextString(a.text);b._positions[3]=d.Point3.fromJson(a.leaderPoint1);b._positions[4]=d.Point3.fromJson(a.leaderPoint2);b._measurementValue=a.measurementValue;b._unitMultiplier=a.unitMultiplier||1;b._updateArrowsInverted();b._stage=2;return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePointPointDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasurePointPointDistanceMarkup=b})(h.Measure||(h.Measure=
{}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c._polygon=new h.Shape.Polygon;c._plane=null;c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.pointRadius=2.5;c._viewer=a;a=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(a);
c._initialPoint.setStrokeColor(a);c._leaderLine.setStrokeColor(a);c._endpoints.setFillColor(a);c._endpoints.setStrokeColor(a);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());c._polygon.setFillColor(a);c._polygon.setFillOpacity(.4);return c}__extends(c,b);c.prototype._calculateArea=function(){var a=this._positions.length;if(3>a)return 0;for(var b=new Float32Array(3*a),c=0;c<a;c++){var e=this._positions[c];b[3*
c]=e.x;b[3*c+1]=e.y;b[3*c+2]=e.z}a=d.Point3.subtract(this._positions[1],this._positions[0]);c=d.Point3.subtract(this._positions[2],this._positions[0]);a=d.Point3.cross(a,c);b=this._viewer.model.triangulatePolygon(b,a);a=0;c=b.length/3/3;for(e=0;e<c;e++){for(var g=9*e,h=[],p=0;3>p;p++)h[p]=new d.Point3(b[g+3*p],b[g+3*p+1],b[g+3*p+2]);g=d.Point3.subtract(h[1],h[0]).length();p=d.Point3.subtract(h[2],h[0]).length();h=d.Point3.subtract(h[2],h[1]).length();a+=.25*Math.sqrt((g+p+h)*(-g+p+h)*(g-p+h)*(g+p-
h))}return a};c.prototype.addPoint=function(a){if(3<=this._positions.length&&(null===this._plane&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],this._positions[2])),1E-4<Math.abs(this._plane.distanceToPoint(a))))return!1;2===this._positions.length&&(this._plane=d.Plane.createFromPoints(this._positions[0],this._positions[1],a));this._positions.push(a.copy());a=this._calculateArea();var b=this.getUnitMultiplier();b=d.Util.formatWithUnit(a,b)+"\u00b2";this._setMeasurementValue(a);
this.setMeasurementText(b);return!0};c.prototype.getPoints=function(){return this._positions};c.prototype.getLast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(2<this._positions.length){var a=this._calculateArea(),b=this.getUnitMultiplier();b=d.Util.formatWithUnit(a,b)+"\u00b2";this._setMeasurementValue(a);this.setMeasurementText(b)}this._finalized=!0};c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=
a};c.prototype.isValid=function(){return 2<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var a=[];this._behindView=!1;for(var b=0,c=this._positions;b<c.length;b++){var e=this._viewer.view.projectPoint(c[b]);0>=e.z&&(this._behindView=!0);a.push(d.Point2.fromPoint3(e))}return a};c.prototype._updateTextBoxCorners=function(){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
b=this._textShape.getPosition();this._textboxCorners[0].assign(b);this._textboxCorners[1].set(b.x+a.x,b.y);this._textboxCorners[2].set(b.x+a.x,b.y+a.y);this._textboxCorners[3].set(b.x,b.y+a.y)};c.prototype._calculateLeaderEndpoint=function(a){this._updateTextBoxCorners();for(var b=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(a,h);p<c&&(b.assign(h),c=p)}return b};c.prototype.draw=function(){if(this._visibility){var a=this._updateProjectedPoints();
if(!this._behindView&&0!==a.length){var b=this._viewer.markupManager.getRenderer();if(1===a.length)this._initialPoint.set(a[0],this.pointRadius),b.drawCircle(this._initialPoint);else{this._polygon.clearPoints();for(var c=0;c<a.length;c++)this._polygon.pushPoint(a[c]);this._finalized&&this._polygon.pushPoint(a[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);b.drawPolygon(this._polygon);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);b.drawLine(this._leaderLine);b.drawTextBox(this._textShape);this._endpoints.clear();this._endpoints.addCircle(a[0],this.pointRadius);this._endpoints.addCircle(a[a.length-1],this.pointRadius);b.drawCircles(this._endpoints)}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var a=[],b=0,c=this._positions;b<c.length;b++)a.push(c[b].toJson());return{name:this._name,points:a,
textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(a,b){b=new c(b);b._name=a.name;b._positions=g.MeasureMarkup._constructPointArray(a.points);b.textPosition=d.Point3.fromJson(a.textPoint);b.leaderPosition=d.Point3.fromJson(a.leaderPoint);b._measurementValue=a.measurementValue;b._unitMultiplier=a.unitMultiplier||
1;b._textShape.setTextString(a.text);b._finalized=!0;return b};c.prototype.hit=function(a){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return a.x<c.x||a.x>c.x+b.x||a.y<c.y||a.y>c.y+b.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"};return c}(g.MeasureMarkup);g.MeasurePolygonAreaMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this,a)||this;c._polyline=new h.Shape.Polyline;c._initialPoint=new h.Shape.Circle;c._leaderLine=new h.Shape.Line;c._endpoints=new h.Shape.CircleCollection;c._textboxCorners=[d.Point2.zero(),d.Point2.zero(),d.Point2.zero(),d.Point2.zero()];c.textPosition=d.Point3.zero();c.leaderPosition=d.Point3.zero();c.isLoop=!1;c.pointRadius=2.5;c._viewer=a;a=c._viewer.measureManager.getMeasurementColor();c._initialPoint.setFillColor(a);
c._initialPoint.setStrokeColor(a);c._polyline.setStrokeColor(a);c._polyline.setStrokeWidth(2);c._leaderLine.setStrokeColor(a);c._endpoints.setFillColor(a);c._endpoints.setStrokeColor(a);c._endpoints.setFillOpacity(1);c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(d.Color.white());return c}__extends(c,b);c.prototype.addPoint=function(a){this._positions.push(a.copy());1<this._positions.length&&(a=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[this._positions.length-
2]).length(),this._setMeasurementValue(this._measurementValue+a))};c.prototype.getPoints=function(){return this._positions};c.prototype.getlast=function(){return 0===this._positions.length?null:this._positions[this._positions.length-1].copy()};c.prototype.finalize=function(){if(this.isLoop&&2<this._positions.length){var a=d.Point3.subtract(this._positions[this._positions.length-1],this._positions[0]).length();this._setMeasurementValue(this._measurementValue+a)}this._finalized=!0};c.prototype.setUnitMultiplier=
function(a){this._unitMultiplier=a};c.prototype.isValid=function(){return 1<this._positions.length};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._updateProjectedPoints=function(){var a=[];this._behindView=this._behindView=!1;for(var b=0,c=this._positions;b<c.length;b++){var e=this._viewer.view.projectPoint(c[b]);0>=e.z&&(this._behindView=!0);a.push(d.Point2.fromPoint3(e))}return a};c.prototype._updateTextBoxCorners=function(){var a=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),
b=this._textShape.getPosition();this._textboxCorners[0].assign(b);this._textboxCorners[1].set(b.x+a.x,b.y);this._textboxCorners[2].set(b.x+a.x,b.y+a.y);this._textboxCorners[3].set(b.x,b.y+a.y)};c.prototype._calculateLeaderEndpoint=function(a){this._updateTextBoxCorners();for(var b=d.Point2.zero(),c=Number.MAX_VALUE,e=0,g=this._textboxCorners;e<g.length;e++){var h=g[e],p=d.Point2.distance(a,h);p<c&&(b.assign(h),c=p)}return b};c.prototype.draw=function(){if(this._visibility){var a=this._updateProjectedPoints();
if(!this._behindView&&0!==a.length){var b=this._viewer.markupManager.getRenderer();if(1===a.length)this._initialPoint.set(a[0],this.pointRadius),b.drawCircle(this._initialPoint);else{this._polyline.clearPoints();for(var c=0;c<a.length;c++)this._polyline.pushPoint(a[c]);this._finalized&&this.isLoop&&this._polyline.pushPoint(a[0]);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.textPosition));this._textShape.setPosition(c);b.drawPolyline(this._polyline);c=d.Point2.fromPoint3(this._viewer.view.projectPoint(this.leaderPosition));
var e=this._calculateLeaderEndpoint(c);this._leaderLine.setP1(c);this._leaderLine.setP2(e);b.drawLine(this._leaderLine);b.drawTextBox(this._textShape);this._endpoints.clear();this.isLoop||(this._endpoints.addCircle(a[0],this.pointRadius),this._endpoints.addCircle(a[a.length-1],this.pointRadius),b.drawCircles(this._endpoints))}}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var a=[],b=0,c=this._positions;b<c.length;b++)a.push(c[b].toJson());return{name:this._name,
points:a,textPoint:this.textPosition.toJson(),leaderPoint:this.leaderPosition.toJson(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,isLoop:this.isLoop,text:this._textShape.getTextString(),className:this.getClassName()}};c.fromJson=function(a,b){b=new c(b);b._name=a.name;b._positions=g.MeasureMarkup._constructPointArray(a.points);b.textPosition=d.Point3.fromJson(a.textPoint);b.leaderPosition=d.Point3.fromJson(a.leaderPoint);b.isLoop=a.isLoop;b._measurementValue=a.measurementValue;
b._unitMultiplier=a.unitMultiplier||1;b._textShape.setTextString(a.text);b._finalized=!0;return b};c.prototype.hit=function(a){var b=this._viewer.markupManager.getRenderer().measureTextBox(this._textShape),c=this._textShape.getPosition();return a.x<c.x||a.x>c.x+b.x||a.y<c.y||a.y>c.y+b.y?!1:!0};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"};return c}(g.MeasureMarkup);g.MeasurePolylineDistanceMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup=
{}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a,c,e,g){a=b.call(this,a)||this;a._lineProperties=null;a._worldSpaceLength=0;a._arrowsInvert=!1;a._name="MeasureStraightEdgeLength";a._lineProperties=c;a._matrix=e.copy();a._matrix.setTranslationComponent(0,0,0);a._unitMultiplier=g;c=a._viewer.measureManager.getMeasurementColor();for(e=0;5>e;e++)g=new h.Shape.Line,g.setStrokeColor(c),g.setEndEndcapColor(c),g.setStartEndcapColor(c),a._lineShapes.push(g);c=a._textShape.getBoxPortion();
c.setFillOpacity(1);c.setFillColor(new d.Color(255,255,255));return a}__extends(c,b);c.prototype.setLineGeometry=function(a){b.prototype.setLineGeometry.call(this,a);this._positions[0]=this._linePositions[0];this._positions[2]=this._linePositions[0].copy();this._positions[1]=this._linePositions[this._linePositions.length-1];null!==this._lineProperties&&-1!==this._lineProperties.length?(a=new d.Point3(this._lineProperties.length,0,0),this._matrix.transform(a,a),a=this._worldSpaceLength=a.length()):
a=d.Point3.subtract(this._positions[1],this._positions[0]).length();this._setMeasurementValue(a)};c.prototype.adjust=function(a){b.prototype.adjust.call(this,a);var c=this._viewer.view,e=c.raycastFromPoint(a);if(null!==e){a=this._positions[0];var g=this._positions[1],h=new d.Point3(1,0,0);g.equals(a)||(h=d.Point3.subtract(g,a));var m=c.getCamera().getUp();c=d.Point3.cross(e.direction,m).normalize();var p=d.Point3.add(a,g).scale(.5);m=d.Point3.add(p,m);var q=d.Point3.add(p,c),r=d.Point3.add(d.Point3.scale(e.direction,
1E6),e.origin);c=new d.Point3(0,0,0);d.Util.intersectionPlaneLine(e.origin,r,p,m,q,c);this._positions[2].assign(c);new d.Point3(0,0,0);e=Math.abs(h.x)<=Math.abs(h.y)&&Math.abs(h.x)<=Math.abs(h.z)?new d.Point3(1,0,0):Math.abs(h.y)<=Math.abs(h.x)&&Math.abs(h.y)<=Math.abs(h.z)?new d.Point3(0,1,0):new d.Point3(0,0,1);e=d.Point3.cross(e,h);p=d.Point3.cross(e,h);e.add(a);p.add(a);m=d.Point3.add(d.Point3.scale(h,1E4),c);h=d.Point3.add(d.Point3.scale(h,-1E4),c);d.Util.intersectionPlaneLine(m,h,a,e,p,c);h=
d.Point3.subtract(c,a);this._positions[3]=d.Point3.add(a,h);this._positions[4]=d.Point3.add(g,h);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var a=d.Point3.add(this._positions[3],this._positions[4]).scale(.5),b=d.Point3.subtract(this._positions[4],this._positions[3]);this._arrowsInvert=2*d.Point3.subtract(this._positions[2],a).squaredLength()>b.squaredLength()};c.prototype.update=function(){b.prototype.update.call(this);var a=
this._viewer.view;this._behindView=!1;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=Array(this._linePositions.length),e=0;e<this._linePositions.length;e++)c[e]=a.projectPoint(this._linePositions[e]),0>=c[e].z&&(this._behindView=!0),this._lineEdgeShape.pushPoint(d.Point2.fromPoint3(c[e]))}if(1<this._stage){var g=Array(6);c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=a.projectPoint(this._positions[e]),0>=c[e].z&&(this._behindView=!0),g[e]=d.Point2.fromPoint3(c[e]);this._textShape&&
this._textShape.setPosition(g[2]);a=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].set(g[3],g[4]);this._lineShapes[1].set(g[0],g[3]);this._lineShapes[2].set(g[1],g[4]);this._lineShapes[3].set(g[3],g[2]);this._lineShapes[4].set(g[3],g[4]);this._lineShapes[4].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setEndcapsInverted(this._arrowsInvert);this._lineShapes[4].setEndEndcapColor(a);this._lineShapes[4].setStartEndcapColor(a)}};
c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var b=0,c=this._lineShapes;b<c.length;b++)a.drawLine(c[b]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{name:this._name,
measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName(),matrix:this._matrix.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){var f=d.Matrix.fromJson(a.matrix);b=new c(b,null,f,a.unitMultiplier||
1);b._name=a.name;b._positions[0]=d.Point3.fromJson(a.measurePoint1);b._positions[1]=d.Point3.fromJson(a.measurePoint2);b._positions[2]=d.Point3.fromJson(a.textPoint);b._textShape.setTextString(a.text);b._positions[3]=d.Point3.fromJson(a.leaderPoint1);b._positions[4]=d.Point3.fromJson(a.leaderPoint2);b._measurementValue=a.measurementValue;b._updateArrowsInverted();b._stage=2;return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureStraightEdgeLengthMarkup"};
return c}(g.MeasureLengthMarkup);g.MeasureStraightEdgeLengthMarkup=b})(h.Measure||(h.Measure={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a,c,e,g,h){var f=b.call(this)||this;f._uniqueId=d.UUID.create();f._noteElementId=null;f._position=d.Point3.zero();f._text="";f._color=d.Color.white();f._sphereRadius=.03;f._deleted=!1;f._active=!1;f._callbacks=null;f._viewer=a;f._noteTextManager=c;f._selectionPosition=e;f._selectionNormal=g;f._partId=h;f._noteTextManager.addNote(f);f._init();return f}__extends(c,b);c.prototype._init=function(){return __awaiter(this,void 0,void 0,
function(){var a,b,c,d,e=this;return __generator(this,function(f){switch(f.label){case 0:return a=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),[4,Promise.all([this._createPinStemInstance(a),this._createPinSphereInstance(a)])];case 1:return b=f.sent(),c=b[0],d=b[1],this._stemInstanceId=c,this._sphereInstanceId=d,[4,this._restore(!1)];case 2:return f.sent(),this._callbacks={visibilityChanged:function(){e._matchPartVisibility()}},this._viewer.setCallbacks(this._callbacks),
this._viewer.trigger("noteTextCreated",this),[2]}})})};c.prototype._matchPartVisibility=function(){if(void 0!==this._sphereInstanceId&&void 0!==this._stemInstanceId){var a=this._viewer.model,b=a.getNodeVisibility(this._partId),c=a.getNodeVisibility(this._sphereInstanceId);b===c||this._noteTextManager.getExplodeActive()||a.setNodesVisibility([this._stemInstanceId,this._sphereInstanceId],b);a=this._noteTextManager.getActiveItem();null===a||a.getStemInstanceId()!==this._stemInstanceId||b||this.hide()}};
c.prototype.updatePosition=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return void 0===this._sphereInstanceId?[2]:[4,this._viewer.model.getNodeRealBounding(this._sphereInstanceId)];case 1:return this._pinBoundingBox=a=b.sent(),this._position=this._pinBoundingBox.center(),this.setText(this._text),[2]}})})};c.prototype._restore=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._noteTextManager.setActiveItemHandle(this._viewer.markupManager.registerMarkup(this)),
this._noteTextManager.setActiveItem(this),this._show(a),this._updateColor(),[4,this.draw()];case 1:return b.sent(),[2]}})})};c.prototype.restore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._restore(!0)]})})};c.prototype.setText=function(a){this._text=a;this._noteTextManager.getNoteTextElement().setText(a)};c.prototype.saveTextValue=function(){this._text=this._noteTextManager.getNoteTextElement().getText()};c.prototype.draw=function(){return __awaiter(this,
void 0,void 0,function(){var a,b,c;return __generator(this,function(f){switch(f.label){case 0:if(this._deleted||!this._active)return[2];this._behindView=!1;return[4,this.updatePosition()];case 1:return f.sent(),a=this._viewer.view.projectPoint(this._position),0>=a.z&&(this._behindView=!0),this._behindView?null!==this._noteElementId&&null!==document.getElementById(this._noteElementId)&&(this._viewer.markupManager.removeMarkupElement(this._noteElementId),this._noteElementId=null):(b=new d.Point2(a.x,
a.y),c=this._noteTextManager.getNoteTextElement(),c.setPosition(b),null===this._noteElementId&&(this._noteElementId=this._viewer.markupManager.addMarkupElement(c.getHtmlContainer()))),[2]}})})};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,b){var c=this._noteTextManager.getNoteTextElement(),f=c.getPosition();c=c.getSize();return d.Util.isPointInRect2d(a,f,c,b)};c.prototype.getClassName=function(){return c.className};c.prototype.getUniqueId=
function(){return this._uniqueId};c.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};c.prototype.getStemInstanceId=function(){return this._stemInstanceId};c.prototype.onSelect=function(){this._noteTextManager.getNoteTextElement().focus()};c.prototype.onDeselect=function(){this._noteTextManager.getNoteTextElement().blur()};c.prototype.hide=function(){var a=this._noteTextManager.getNoteTextElement();a.hide();this.setText(a.getText());this._noteTextManager.setActiveItem(null);
this._active=!1;this._viewer.trigger("noteTextHidden",this)};c.prototype._show=function(a){this._noteTextManager.getNoteTextElement().show(this);this._active=!0;a&&this._viewer.trigger("noteTextShown",this)};c.prototype.show=function(){this._show(!0)};c.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(f){switch(f.label){case 0:if(!0===this.getRemoved())return[2];null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),
this._callbacks=null);a=this._viewer.model;c=[];void 0!==this._stemInstanceId&&c.push(a.deleteMeshInstances([this._stemInstanceId]));void 0!==this._sphereInstanceId&&c.push(a.deleteMeshInstances([this._sphereInstanceId]));this.hide();this._noteTextManager.removeNote(this);this._deleted=!0;return[4,d.Util.waitForAll(c)];case 1:return f.sent(),b.prototype.remove.call(this),[2]}})})};c.prototype.getRemoved=function(){return this._deleted};c.prototype.setColor=function(a){this._color=a;this._updateColor();
return Promise.resolve()};c.prototype.getColor=function(){return this._color};c.prototype.getPartId=function(){return this._partId};c.prototype._updateColor=function(){void 0!==this._sphereInstanceId&&this._viewer.model.setNodesFaceColor([this._sphereInstanceId],this._color)};c.prototype._createPinTransformationMatrix=function(a,b){var c=0,f=b.x;Math.abs(b.y)<Math.abs(f)&&(f=b.y,c=1);Math.abs(b.z)<Math.abs(f)&&(c=2);f=[0,0,0];f[c]=1;c=d.Point3.createFromArray(f);c=d.Point3.cross(b,c).normalize();
f=d.Point3.cross(b,c);var e=new d.Matrix;e.m=[b.x,b.y,b.z,0,c.x,c.y,c.z,0,f.x,f.y,f.z,0,0,0,0,1];e=d.Matrix.multiply(e,(new d.Matrix).setScaleComponent(this._sphereRadius,this._sphereRadius,this._sphereRadius));e.setTranslationComponent(a.x,a.y,a.z);return e};c.prototype._createPinStemInstance=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g;return __generator(this,function(f){b=this._noteTextManager.getPinStemMeshId();if(null===b)throw new d.CommunicatorError("stem mesh hasn't been created yet");
c=new d.MeshInstanceData(b,a,"pin-stem-instance",void 0,d.Color.black());c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype._createPinSphereInstance=
function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,g;return __generator(this,function(f){b=this._noteTextManager.getPinSphereMeshId();if(null===b)throw new d.CommunicatorError("sphere mesh hasn't been created yet");c=new d.MeshInstanceData(b,a,"pin-sphere-instance",d.Color.white(),void 0);c.setOpacity(1);e=d.MeshInstanceCreationFlags.SuppressCameraScale|d.MeshInstanceCreationFlags.DoNotCut|d.MeshInstanceCreationFlags.DoNotExplode|d.MeshInstanceCreationFlags.DoNotXRay|d.MeshInstanceCreationFlags.ExcludeBounding|
d.MeshInstanceCreationFlags.OverrideSceneVisibility|d.MeshInstanceCreationFlags.AlwaysDraw;c.setCreationFlags(e);g=this._viewer.model;return[2,g.createMeshInstance(c,void 0,!0,!0)]})})};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.toJson(),selectionNormal:this._selectionNormal.toJson(),text:this._text,color:this._color,partId:this._partId}};c.prototype.forJson=
function(){return this.toJson()};c._fromJson=function(a,b,e){if(!e.findById(a.uniqueId)){var f=d.Point3.fromJson(a.selectionPosition),g=d.Point3.fromJson(a.selectionNormal);b=new c(b,e,f,g,a.partId);b._uniqueId=a.uniqueId;b.setText(a.text);b.setColor(d.Color.fromJson(a.color));return b}return null};c.fromJson=function(a,b,d){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){f=c._fromJson(a,b,d);return[2,f]})})};c.className="Communicator.Markup.Note.NoteText";
return c}(h.MarkupItem);g.NoteText=b})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){var c=b.call(this)||this;c._pinSphereMeshId=null;c._pinStemMeshId=null;c._noteTextList=[];c._activeItemHandle=null;c._activeItem=null;c._explodeActive=!1;c._isolateActive=!1;c._stemLength=2;c._sphereIterations=2;c._viewer=a;c._noteTextElement=new g.NoteTextElement;c._noteTextElement.setPositionOffset(new d.Point2(12,-24));c._viewer.setCallbacks({sceneReady:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,
function(a){switch(a.label){case 0:return[4,this._init()];case 1:return a.sent(),[2]}})})}});return c}__extends(c,b);c.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d,e;return __generator(this,function(f){switch(f.label){case 0:return null===c._globalPinSphereMeshData&&(c._globalPinSphereMeshData=this._createPinSphereMeshData()),null===c._globalPinStemMeshData&&(c._globalPinStemMeshData=this._createPinStemMeshData()),a=this._viewer.model,b=a.createMesh(c._globalPinSphereMeshData),
d=a.createMesh(c._globalPinStemMeshData),[4,Promise.all([b,d])];case 1:return e=f.sent(),this._pinSphereMeshId=e[0],this._pinStemMeshId=e[1],[2]}})})};c.prototype._createPinStemMeshData=function(){var a=new d.MeshData;a.addPolyline([0,0,0,this._stemLength,0,0]);return a};c.prototype._createPinSphereMeshData=function(){var a=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/(4*a),c=b/2;a=b/(2*a);var e=[];e[0]=new d.Point3(-a,c,0);e[1]=new d.Point3(a,c,0);e[2]=new d.Point3(-a,-c,0);e[3]=new d.Point3(a,
-c,0);e[4]=new d.Point3(0,-a,c);e[5]=new d.Point3(0,a,c);e[6]=new d.Point3(0,-a,-c);e[7]=new d.Point3(0,a,-c);e[8]=new d.Point3(c,0,-a);e[9]=new d.Point3(c,0,a);e[10]=new d.Point3(-c,0,-a);e[11]=new d.Point3(-c,0,a);for(c=0;c<e.length;c++){var g=e[c];g.normalize()}var h=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],p=12;a=function(a){var b=[];h.map(function(a){var c=e[a[0]],
f=e[a[1]],g=e[a[2]];e[p++]=(new d.Point3(c.x+f.x,c.y+f.y,c.z+f.z)).scale(.5).normalize();e[p++]=(new d.Point3(f.x+g.x,f.y+g.y,f.z+g.z)).scale(.5).normalize();e[p++]=(new d.Point3(g.x+c.x,g.y+c.y,g.z+c.z)).scale(.5).normalize();b.push([a[0],p-3,p-1]);b.push([p-3,p-2,p-1]);b.push([p-3,a[1],p-2]);b.push([p-2,a[2],p-1])});h=b};for(c=0;c<this._sphereIterations;c++)a(c);a=[];b=[];for(var q=0,r=h;q<r.length;q++){var w=r[q];for(c=0;3>c;c++)g=e[w[c]],a.push(g.x+this._stemLength+1),a.push(g.y),a.push(g.z),
g=g.normalize(),b.push(g.x),b.push(g.y),b.push(g.z)}c=new d.MeshData;c.addFaces(a,b);c.setFaceWinding(d.FaceWinding.CounterClockwise);return c};c.prototype.getPinStemMeshId=function(){return this._pinStemMeshId};c.prototype.getPinSphereMeshId=function(){return this._pinSphereMeshId};c.prototype.getNoteTextElement=function(){return this._noteTextElement};c.prototype.setNoteTextElement=function(a){this._noteTextElement.hide();this._noteTextElement=a};c.prototype.getNoteTextList=function(){return this._noteTextList};
c.prototype.addNote=function(a){this._noteTextList.push(a);this._activeItem=a};c.prototype.removeNote=function(a){a=this._noteTextList.indexOf(a);this._noteTextList.splice(a,1)};c.prototype.updatePinVisibility=function(){return __awaiter(this,void 0,void 0,function(){var a,b,c,d,e,g,h;return __generator(this,function(f){if(0<this._noteTextList.length){a=[];b=0;for(c=this._noteTextList;b<c.length;b++)d=c[b],e=d.getSphereInstanceId(),g=d.getStemInstanceId(),void 0!==e&&a.push(e),void 0!==g&&a.push(g);
h=this._viewer.model.setNodesVisibility(a,!this._explodeActive);this._explodeActive&&this._noteTextElement.hide();return[2,h]}return[2]})})};c.prototype.explode=function(a){this._explodeActive=0<a;return this.updatePinVisibility()};c.prototype.getExplodeActive=function(){return this._explodeActive};c.prototype.setIsolateActive=function(a){this._isolateActive=a};c.prototype.getIsolateActive=function(){return this._isolateActive};c.prototype.getActiveItem=function(){return this._activeItem};c.prototype.setActiveItem=
function(a){this._activeItem=a};c.prototype.getActiveItemHandle=function(){return this._activeItemHandle};c.prototype.setActiveItemHandle=function(a){this._activeItemHandle=a};c.prototype.selectPin=function(a){this._activeItem&&this._activeItem.hide();a=a.getNodeId();return null!==a&&(a=this._getNoteTextFromNodeId(a),null!==a)?(a.restore(),!0):!1};c.prototype.checkPinInstance=function(a){return null!==this._getNoteTextFromNodeId(a)};c.prototype._getNoteTextFromNodeId=function(a){for(var b=0,c=this._noteTextList;b<
c.length;b++){var d=c[b];if(d.getSphereInstanceId()===a||d.getStemInstanceId()===a)return d}return null};c.prototype.findById=function(a){for(var b=0,c=this._noteTextList;b<c.length;b++)if(a===c[b].getUniqueId())return!0;return!1};c.prototype.loadData=function(a){for(var b=[],c=0;c<a.length;c++){var d=g.NoteText.fromJson(a[c],this._viewer,this).then(function(a){return null!==a});b.push(d)}return Promise.all(b)};c.prototype.exportMarkup=function(){for(var a=[],b=0,c=this._noteTextList;b<c.length;b++)a.push(c[b].toJson());
return a};c._globalPinSphereMeshData=null;c._globalPinStemMeshData=null;return c}(d.MarkupTypeManager);g.NoteTextManager=b})(h.Note||(h.Note={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){a=b.call(this,a)||this;a._uniqueId=d.UUID.create();a._centerPt=d.Point3.zero();a._radiusPt=d.Point3.zero();a._circleShape=new h.Shape.Circle;a._previousDragPlanePosition=d.Point3.zero();a._circleShape.setFillOpacity(0);a._circleShape.setStrokeColor(d.Color.red());a._circleShape.setStrokeWidth(2);return a}__extends(c,b);c.prototype.setCenter=function(a){this._centerPt.assign(a)};c.prototype.getCenter=function(){return this._centerPt.copy()};
c.prototype.setRadiusPoint=function(a){this._radiusPt.assign(a)};c.prototype.getRadiusPoint=function(){return this._radiusPt.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var a=this._viewer.view,b=d.Point2.fromPoint3(a.projectPoint(this._centerPt));a=d.Point2.fromPoint3(a.projectPoint(this._radiusPt));a=d.Point2.distance(b,a);this._circleShape.set(b,a)};c.prototype.draw=function(){this._update();this._viewer.markupManager.getRenderer().drawCircle(this._circleShape)};
c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,b){this._update();b=this._circleShape.getStrokeWidth()+b;a=d.Point2.distance(this._circleShape.getCenter(),a)-this._circleShape.getRadius();return Math.abs(a)<=b};c.prototype.onSelect=function(){this._circleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._circleShape.setStrokeWidth(2)};c.prototype.isValid=function(){return this._circleShape.getRadius()>c._validRadiusTolerance};c.prototype.onDragStart=
function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(b=d.Point3.subtract(a,this._previousDragPlanePosition),this._centerPt.add(b),this._radiusPt.add(b),this._previousDragPlanePosition.assign(a));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,
centerPoint:this._centerPt.toJson(),radiusPoint:this._radiusPt.toJson(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b);b._uniqueId=a.uniqueId;b.setCenter(d.Point3.fromJson(a.centerPoint));b.setRadiusPoint(d.Point3.fromJson(a.radiusPoint));return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineCircle"};c._validRadiusTolerance=1;return c}(g.RedlineItem);
g.RedlineCircle=b})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){a=b.call(this,a)||this;a._uniqueId=d.UUID.create();a._points=[];a._polylineShape=new h.Shape.Polyline;a._previousDragPlanePosition=d.Point3.zero();a._polylineShape.setStrokeWidth(2);a._polylineShape.setStrokeColor(d.Color.red());return a}__extends(c,b);c.prototype.addPoint=function(a){this._points.push(a.copy())};c.prototype.getPoints=function(){var a=[];this._points.forEach(function(b){a.push(b.copy())});return a};c.prototype._update=
function(){var a=this._viewer.view;this._polylineShape.clearPoints();for(var b=0,c=this._points;b<c.length;b++){var e=d.Point2.fromPoint3(a.projectPoint(c[b]));this._polylineShape.pushPoint(e)}};c.prototype.draw=function(){this._update();this.isValid()&&this._viewer.markupManager.getRenderer().drawPolyline(this._polylineShape)};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,b){this._update();b=this._polylineShape.getStrokeWidth()+b;var c=this._polylineShape.getPoints();
if(1<c.length)for(var f=1;f<c.length;f++)if(d.Util.isPointOnLineSegment2d(a,c[f-1],c[f],b))return!0;return!1};c.prototype.onSelect=function(){this._polylineShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._polylineShape.setStrokeWidth(2)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlinePolyline"};c.prototype.isValid=function(){return 1<this._points.length};c.prototype.onDragStart=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,
b);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);if(null!==a){b=d.Point3.subtract(a,this._previousDragPlanePosition);for(var c=0,e=this._points;c<e.length;c++)e[c].add(b);this._polylineShape.clearPoints();this._previousDragPlanePosition.assign(a)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){for(var a=[],b=0,c=this._points;b<
c.length;b++)a.push(c[b].toJson());return{uniqueId:this._uniqueId,points:a}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b);b._uniqueId=a.uniqueId;var f=0;for(a=a.points;f<a.length;f++)b.addPoint(d.Point3.fromJson(a[f]));return b};c.construct=function(a,b){return c.fromJson(a,b)};return c}(g.RedlineItem);g.RedlinePolyline=b})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a){a=b.call(this,a)||this;a._uniqueId=d.UUID.create();a._point1=d.Point3.zero();a._point2=d.Point3.zero();a._rectangleShape=new h.Shape.Rectangle;a._previousDragPlanePosition=d.Point3.zero();a._rectangleShape.setFillOpacity(0);a._rectangleShape.setStrokeColor(d.Color.red());a._rectangleShape.setStrokeWidth(2);return a}__extends(c,b);c.prototype.setPoint1=function(a){this._point1.assign(a)};c.prototype.getPoint1=function(){return this._point1.copy()};
c.prototype.setPoint2=function(a){this._point2.assign(a)};c.prototype.getPoint2=function(){return this._point2.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var a=this._viewer.view,b=a.projectPoint(this._point1),c=a.projectPoint(this._point2);a=new d.Point2(Math.min(b.x,c.x),Math.min(b.y,c.y));b=new d.Point2(Math.max(b.x,c.x),Math.max(b.y,c.y));b=d.Point2.subtract(b,a);this._rectangleShape.setPosition(a);this._rectangleShape.setSize(b)};c.prototype.draw=
function(){this._update();this._viewer.markupManager.getRenderer().drawRectangle(this._rectangleShape)};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,b){this._update();b=this._rectangleShape.getStrokeWidth()+b;var c=this._rectangleShape.getPosition(),f=this._rectangleShape.getSize(),e=new d.Point2(c.x+f.x,c.y),g=new d.Point2(c.x,c.y+f.y);f=new d.Point2(c.x+f.x,c.y+f.y);return d.Util.isPointOnLineSegment2d(a,c,e,b)||d.Util.isPointOnLineSegment2d(a,
e,f,b)||d.Util.isPointOnLineSegment2d(a,f,g,b)||d.Util.isPointOnLineSegment2d(a,g,c,b)?!0:!1};c.prototype.onSelect=function(){this._rectangleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._rectangleShape.setStrokeWidth(2)};c.prototype.isValid=function(){var a=this._rectangleShape.getSize();return a.x>c._validSizeTolerance.x&&a.y>c._validSizeTolerance.y};c.prototype.onDragStart=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._previousDragPlanePosition.assign(a);
return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(b=d.Point3.subtract(a,this._previousDragPlanePosition),this._point1.add(b),this._point2.add(b),this._previousDragPlanePosition.assign(a));return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),point1:this._point1.toJson(),point2:this._point2.toJson()}};c.prototype.forJson=
function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b);b._uniqueId=a.uniqueId;b.setPoint1(d.Point3.fromJson(a.point1));b.setPoint2(d.Point3.fromJson(a.point2));return b};c.construct=function(a,b){return c.fromJson(a,b)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineRectangle"};c._validSizeTolerance=new d.Point2(5,5);return c}(g.RedlineItem);g.RedlineRectangle=b})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(){function b(b,a){this._sizeChanged=!1;this._sizeUpdateCallback=b;this._textUpdateCallback=a;this._createTextBox()}b.prototype._createTextBox=function(){var c=this;this._currentSize=b._defaultSize.copy();this._textArea=document.createElement("textarea");this._textArea.style.position="absolute";this._textArea.style.width=b._defaultSize.x+"px";this._textArea.style.height=b._defaultSize.y+"px";this._textArea.style.zIndex="1";this._textArea.style.pointerEvents=
"none";this._textArea.style.resize="none";this.setBorderWidth(2);this._textArea.onmousemove=function(a){a.stopPropagation();a=new d.Point2(parseInt(c._textArea.style.width,10),parseInt(c._textArea.style.height,10));c.setSize(a)};this._textArea.onmouseup=function(a){a.stopPropagation();c._sizeChanged&&(c._sizeChanged=!1,c._sizeUpdateCallback(c._currentSize))};this._textArea.oninput=function(){c._textUpdateCallback(c._textArea.value)}};b.prototype.setPosition=function(b){this._textArea.style.left=b.x+
"px";this._textArea.style.top=b.y+"px"};b.prototype.setBorderWidth=function(b){this._textArea.style.outline=b+"px solid red"};b.prototype.setText=function(b){this._textArea.textContent=b};b.prototype.setSize=function(b){this._currentSize.equals(b)||(this._sizeChanged=!0,this._currentSize.assign(b),this._textArea.style.width=b.x+"px",this._textArea.style.height=b.y+"px")};b.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto";this._textArea.style.resize="both"};
b.prototype.blur=function(){this._textArea.blur();this._textArea.style.pointerEvents="none";this._textArea.style.resize="none"};b.prototype.getTextArea=function(){return this._textArea};b._defaultSize=new d.Point2(100,100);return b}();g.RedlineTextElement=b})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){var b=function(b){function c(a,f){void 0===f&&(f=c.defaultText);var e=b.call(this,a)||this;e._uniqueId=d.UUID.create();e._position=d.Point3.zero();e._size=new d.Point2(100,100);e._redlineElementId=null;e._previousDragPlanePosition=d.Point3.zero();e._text=f;e._redlineTextElement=new g.RedlineTextElement(function(a){e.setSize(a)},function(a){e.setText(a)});e._redlineTextElement.setText(e._text);e._callbacks={selectionArray:function(){e.onDeselect()}};e._viewer.setCallbacks(e._callbacks);
return e}__extends(c,b);c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(a){this._size.assign(a);this._redlineTextElement.setSize(a);this._viewer.trigger("redlineUpdated",this)};c.prototype.getSize=function(){return this._size.copy()};c.prototype.setText=function(a){this._text=a;this._redlineTextElement.setText(a);this._viewer.trigger("redlineUpdated",this)};c.prototype.getText=function(){return this._text};
c.prototype.draw=function(){var a=d.Point2.fromPoint3(this._viewer.view.projectPoint(this._position));this._redlineTextElement.setPosition(a);null===this._redlineElementId&&(this._redlineElementId=this._viewer.markupManager.addMarkupElement(this._redlineTextElement.getTextArea()))};c.prototype.hit=function(a){return this.hitWithTolerance(a,0)};c.prototype.hitWithTolerance=function(a,b){var c=this._redlineTextElement.getTextArea(),f=new d.Point2(parseFloat(c.style.left||"0"),parseFloat(c.style.top||
"0"));c=new d.Point2(parseFloat(c.style.width||"0"),parseFloat(c.style.height||"0"));return d.Util.isPointInRect2d(a,f,c,b)};c.prototype.getClassName=function(){return c.className};c.prototype.onSelect=function(){this._redlineTextElement.setBorderWidth(4);this._redlineTextElement.focus()};c.prototype.onDeselect=function(){this._redlineTextElement.setBorderWidth(2);this._redlineTextElement.blur()};c.prototype.isValid=function(){return 0<this._text.length};c.prototype.remove=function(){this._redlineElementId&&
(this._viewer.markupManager.removeMarkupElement(this._redlineElementId),this._redlineElementId=null);null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);b.prototype.remove.call(this)};c.prototype.onDragStart=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(a){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,
b);if(null!==a){b=d.Point3.subtract(a,this._previousDragPlanePosition);var c=this.getPosition();c.add(b);this.setPosition(c);this._previousDragPlanePosition.assign(a)}return!0};c.prototype.toJson=function(){return this._toJson()};c.prototype._toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),position:this._position.toJson(),size:this._size.toJson(),text:this._text}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,b){b=new c(b,a.text);b._uniqueId=
a.uniqueId;b.setPosition(d.Point3.fromJson(a.position));b.setSize(d.Point2.fromJson(a.size));return b};c.construct=function(a,b){return c.fromJson(a,b)};c.className="Communicator.Markup.Redline.RedlineText";c.defaultText="Type Here...";return c}(g.RedlineItem);g.RedlineText=b})(h.Redline||(h.Redline={}))})(d.Markup||(d.Markup={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){c=b.call(this,c)||this;c._moveSelectionAction=new d.Util.CurrentAction(!0);c._currentMoveHighlight=null;c._currentSelectHighlight=null;c._markup=null;c._measureManager=a;return c}__extends(e,b);e.prototype._unsetCurrentMoveHighlight=function(){null!==this._currentMoveHighlight&&(this._viewer.model.setNodesHighlighted([this._currentMoveHighlight.getNodeId()],!1),this._currentMoveHighlight=null)};e.prototype._unsetCurrentSelectionHighlight=
function(){null!==this._currentSelectHighlight&&(this._viewer.model.setNodesHighlighted([this._currentSelectHighlight.getNodeId()],!1),this._currentSelectHighlight=null)};e.prototype._performMoveSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isNodeSelection())return this._unsetCurrentMoveHighlight(),
[2];g=e.getNodeId();if(null===g||c.getNodeType(g)!==d.NodeType.BodyInstance||this._markup&&(h=this._markup.getFirstNode(),null!==h&&g===h))return[2];null!==this._currentMoveHighlight?e.equals(this._currentMoveHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentMoveHighlight():(this._unsetCurrentMoveHighlight(),this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0)):(this._currentMoveHighlight=e,c.setNodesHighlighted([g],!0));return[2]}})})};e.prototype._performUpSelection=
function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g;return __generator(this,function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];this._markup&&1===this._markup._getStage()&&this._viewer.trigger("measurementBegin");if(this._markup&&1<this._markup._getStage())return this._markup.finalize(),this._measureManager.finalizeMeasurement(this._markup),this._markup=null,[2];
g=e.getNodeId();if(null===g||c.getNodeType(g)!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage()))return[2];this._unsetCurrentMoveHighlight();if(this._markup)return[3,2];this._markup=new d.Markup.Measure.MeasureBodyBodyDistanceMarkup(this._viewer);this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(g));this._markup.setFirstNode(g);e.isNodeSelection()&&(this._unsetCurrentSelectionHighlight(),this._currentSelectHighlight=e,this._viewer.model.setNodesHighlighted([g],!0));this._measureManager.addMeasurement(this._markup);
return[3,4];case 2:return this._unsetCurrentSelectionHighlight(),[4,this._markup.setSecondNode(g)];case 3:f.sent(),this._markup.adjust(b),f.label=4;case 4:return[2]}})})};e.prototype.onMouseMove=function(c){var a=this;b.prototype.onMouseMove.call(this,c);var d=c.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return a._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};
e.prototype._onMouseUpImpl=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];a=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||a))return[2];c=b.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,
this._onMouseUpImpl(c)];case 1:return a.sent(),b.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.setDraggingEnabled=function(b){this._dragging=b};e.prototype.onKeyUp=function(b){};e.prototype.onKeyDown=function(b){b.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};e.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};e.prototype.onDeactivate=
function(){b.prototype.onDeactivate.call(this);this._unsetCurrentMoveHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup=null)};return e}(h.OperatorBase);h.MeasureBodyBodyDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){c=b.call(this,c)||this;c._pickConfig=new d.PickConfig(d.SelectionMask.Line);c._moveSelectionAction=new d.Util.CurrentAction(!0);c._lengthMarkup=null;c._edgeMarkup=null;c._measureManager=a;c._pickConfig.restrictLinesAndPointsToSelectedFaceInstances=!1;return c}__extends(e,b);e.prototype.onActivate=function(){null===this._edgeMarkup&&(this._edgeMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,null,new d.Matrix,1))};
e.prototype._unregisterEdgeMarkup=function(){if(null!==this._edgeMarkup){var b=this._edgeMarkup._getId();""!==b&&(this._viewer.markupManager.unregisterMarkup(b),this._edgeMarkup._setId(""))}};e.prototype._registerEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup._setId(this._viewer.markupManager.registerMarkup(this._edgeMarkup)))};e.prototype._resetEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup.reset())};e.prototype._performMoveSelection=
function(b,a){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:return c=this._viewer.view,[4,c.pickFromPoint(b,this._pickConfig)];case 1:return d=f.sent(),(e=d.getLineEntity())&&0===d.overlayIndex()&&0!==(e.getLineBits()&4)?(a.setLineGeometry(e.getPoints()),this._registerEdgeMarkup()):this._resetEdgeMarkup(),[2]}})})};e.prototype._performUpSelection=function(b){return __awaiter(this,void 0,void 0,function(){var a,c,e,g,h,m,p,q;return __generator(this,
function(f){switch(f.label){case 0:return a=this._viewer.view,c=this._viewer.model,[4,a.pickFromPoint(b,this._pickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._lengthMarkup&&2===this._lengthMarkup._getStage())return this._lengthMarkup._nextStage(),this._measureManager.finalizeMeasurement(this._lengthMarkup),this._lengthMarkup=null,[2];if(this._lengthMarkup||!e.isLineSelection())return[2];g=e.getLineEntity();if(0===(g.getLineBits()&4))return[2];h=e.getNodeId();m=c.getNodeUnitMultiplier(h);
return[4,c.getEdgeProperty(h,g.getLineId())];case 2:p=f.sent();this._viewer.trigger("measurementBegin");if(!p)return[2];p instanceof d.SubentityProperties.LineElement||p instanceof d.SubentityProperties.OtherEdgeElement?(q=c.getNodeNetMatrix(h),this._lengthMarkup=new d.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,p,q,m),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(g.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(b)):
p instanceof d.SubentityProperties.CircleElement&&(q=c.getNodeNetMatrix(h),this._lengthMarkup=new d.Markup.Measure.MeasureCircleEdgeLengthMarkup(this._viewer,p,q,m),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(g.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(b));2===this._lengthMarkup._getStage()&&this._viewer.trigger("measurementValueSet",this._lengthMarkup);return[2]}})})};e.prototype.onMouseMove=function(c){var a=this;b.prototype.onMouseMove.call(this,
c);var d=this._edgeMarkup;if(null!==d){var e=c.getPosition();this.isDragging()&&null===this._primaryTouchId?this._resetEdgeMarkup():(null===this._lengthMarkup&&this._moveSelectionAction.set(function(){return a._performMoveSelection(e,d)}),this._viewer.markupManager.refreshMarkup(),null!==this._lengthMarkup&&0<this._lengthMarkup._getStage()&&this._lengthMarkup.adjust(e))}};e.prototype._onMouseUpImpl=function(b){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];
a=null!==this._primaryTouchId&&null!==this._lengthMarkup;if(!(3>this._dragCount||a))return[2];c=b.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};e.prototype.onMouseUp=function(c){this._onMouseUpImpl(c);b.prototype.onMouseUp.call(this,c)};e.prototype.setDraggingEnabled=function(b){this._dragging=b};e.prototype.onKeyUp=function(b){};e.prototype.onKeyDown=function(b){b.getKeyCode()===d.KeyCode.Escape&&(null!==this._lengthMarkup?(this._measureManager.removeMeasurement(this._lengthMarkup),
this._lengthMarkup=null):this._measureManager.removeLastMeasurement(),null!==this._edgeMarkup&&this._resetEdgeMarkup())};e.prototype.setHandled=function(){return null!==this._lengthMarkup};e.prototype.onDeactivate=function(){null!==this._lengthMarkup&&(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null);null!==this._edgeMarkup&&this._resetEdgeMarkup()};return e}(h.OperatorBase);h.MeasureEdgeLengthOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator=
{}));
(function(d){(function(h){function g(b){return b.getSelectionType()!==d.SelectionType.None?(b=b.getFaceEntity().getCadFaceBits(),0!==(b&2)&&0!==(b&1)):!1}var b=function(b){function c(a,c){a=b.call(this,a)||this;a._moveSelectionAction=new d.Util.CurrentAction(!0);a._currentHighlight=null;a._markup=null;a._useAuthoredNormals=!0;a._measureManager=c;return a}__extends(c,b);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),
h===p.getNodeId()&&(q=p.getFaceEntity().getCadFaceIndex(),r=m.getCadFaceIndex(),q===r)))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):null===this._currentHighlight&&g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=
function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!e.isFaceSelection()||
c.getNodeType(e.getNodeId())!==d.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage())||!g(e))return[2];h=e.getFaceEntity();return[4,c.getFaceProperty(e.getNodeId(),h.getCadFaceIndex())];case 2:m=f.sent();if(!(m instanceof d.SubentityProperties.PlaneElement))return[2];this._unsetCurrentHighlight();if(null!==this._markup)return[3,4];this._markup=new d.Markup.Measure.MeasureFaceFaceAngleMarkup(this._viewer);this._markup.setUseAuthoredNormals(this._useAuthoredNormals);return[4,this._markup.setFirstFace(e)];
case 3:return f.sent(),this._measureManager.addMeasurement(this._markup),[3,6];case 4:return[4,this._markup.setSecondFace(e)];case 5:(p=f.sent())&&this._markup.adjust(a),f.label=6;case 6:return[2]}})})};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a);a=a.getPosition();(!this._markup||1>=this._markup._getStage())&&this._performMoveSelection(a);this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(a)};c.prototype._onMouseUpImpl=
function(a){var b=this;if(this.isActive()){var c=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||c){var d=a.getPosition();this._moveSelectionAction.set(function(){return b._performUpSelection(d)})}}};c.prototype.onMouseUp=function(a){this._onMouseUpImpl(a);b.prototype.onMouseUp.call(this,a)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&
(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};c.prototype.setUseAuthoredNormals=function(a){this._useAuthoredNormals=
a};c.prototype.getUseAuthoredNormals=function(){return this._useAuthoredNormals};return c}(h.OperatorBase);h.MeasureFaceFaceAngleOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){function g(b){return b.getSelectionType()!==d.SelectionType.None?0!==(b.getFaceEntity().getCadFaceBits()&1):!1}var b=function(b){function c(a,c){a=b.call(this,a)||this;a._moveSelectionAction=new d.Util.CurrentAction(!0);a._currentHighlight=null;a._markup=null;a._measureManager=c;return a}__extends(c,b);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,e,h,m,p;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(0!==e.overlayIndex()||!e.isFaceSelection())return[2];h=e.getNodeId();m=e.getFaceEntity();if(c.getNodeType(h)!==d.NodeType.BodyInstance||this._markup&&(p=this._markup.getFirstSelection(),null!==p&&
h===p.getNodeId()&&m.getCadFaceIndex()===p.getFaceEntity().getCadFaceIndex()))return[2];null!==this._currentHighlight?e.equals(this._currentHighlight)?e.getSelectionType()===d.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()))):g(e)&&(this._currentHighlight=e,c.setNodeFaceColor(h,m.getCadFaceIndex(),d.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c,e,h,m,p,q,r;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.view,c=this._viewer.model,[4,b.pickFromPoint(a,new d.PickConfig)];case 1:e=f.sent();if(e.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!e.isFaceSelection())return[2];h=
e.getNodeId();m=e.getFaceEntity();return g(e)&&c.getNodeType(h)===d.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,c.getFaceProperty(h,m.getCadFaceIndex())]:[2];case 2:p=f.sent();if(!p)return[2];q=c.getNodeNetMatrix(h);this._unsetCurrentHighlight();return p instanceof d.SubentityProperties.PlaneElement||p instanceof d.SubentityProperties.CylinderElement?[4,c.getNodesBounding([h])]:[3,6];case 3:r=f.sent();if(this._markup)return[3,4];this._markup=new d.Markup.Measure.MeasureFaceFaceDistanceMarkup(this._viewer);
this._markup.setUnitMultiplier(c.getNodeUnitMultiplier(h));this._markup.setFirstFace(e,p,q,r);this._measureManager.addMeasurement(this._markup);return[3,6];case 4:return[4,this._markup.setSecondFace(a,e,p,q,r)];case 5:f.sent(),f.label=6;case 6:return[2]}})})};c.prototype.onMouseMove=function(a){var c=this;b.prototype.onMouseMove.call(this,a);var d=a.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return c._performMoveSelection(d)});this._viewer.markupManager.refreshMarkup();
null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(d)};c.prototype._onMouseUpImpl=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];b=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(!(3>this._dragCount||b))return[2];c=a.getPosition();return[4,this._performUpSelection(c)];case 1:return d.sent(),[2]}})})};c.prototype.onMouseUp=function(a){this._onMouseUpImpl(a);
b.prototype.onMouseUp.call(this,a)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){b.prototype.onDeactivate.call(this);
this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceDistanceOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){var d=b.call(this,c)||this;d._markupItem=null;d._cameraInteractionActive=!1;d._measureManager=a;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,b);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=function(){this._cameraInteractionActive=
!1};e.prototype._useSnapping=function(b){return this._cursor.snappingConfig.enabled&&!b.altDown()};e.prototype._addPoint=function(b,a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(e){switch(e.label){case 0:return[4,this._cursor.getSelectionCursorPoints(b,a,null)];case 1:c=e.sent();if(null===c||null===c.worldPosition)return[2];null===this._markupItem&&(this._markupItem=new d.Markup.Measure.MeasureLineLineAngleMarkup(this._viewer),this._measureManager.addMeasurement(this._markupItem),
this._viewer.trigger("measurementBegin"));this._markupItem.addPoint(c.worldPosition);this._markupItem._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markupItem),this._markupItem=null);return[2]}})})};e.prototype._updateMarkupSelectionPosition=function(b,a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return null===this._markupItem?[2]:[4,this._cursor.getSelectionCursorPoints(b,a,null)];case 1:c=d.sent();if(null===
c)return[2];this._markupItem.setSelectionPosition(c.worldPosition);return[2]}})})};e.prototype.onMouseMove=function(c){return __awaiter(this,void 0,void 0,function(){var a,d;return __generator(this,function(e){switch(e.label){case 0:b.prototype.onMouseMove.call(this,c);if(this._cameraInteractionActive)return[2];a=c.getPosition();d=this._useSnapping(c);this._cursor.updateCursorSprite(a,d,null);return[4,this._updateMarkupSelectionPosition(a,d)];case 1:return e.sent(),this._viewer.markupManager.refreshMarkup(),
[2]}})})};e.prototype.onMouseUp=function(c){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:if(!this.isActive())return[2];a=c.getPosition();return this._ptFirst.equals(a)?[4,this._addPoint(a,this._useSnapping(c))]:[3,2];case 1:d.sent(),d.label=2;case 2:return b.prototype.onMouseUp.call(this,c),[2]}})})};e.prototype.onKeyDown=function(b){b.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype._clearMeasurement=function(){null!==
this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};e.prototype.setHandled=function(){return null!==this._markupItem&&1<this._markupItem._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();null!==this._markupItem&&(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null)};return e}(h.OperatorBase);
h.MeasureLineLineAngleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c,a){var d=b.call(this,c)||this;d._measureMarkup=null;d._cameraInteractionActive=!1;d._viewer=c;d._measureManager=a;d._cursor=new h.Common.PointCursor(d._viewer);d._viewer.setCallbacks({beginInteraction:function(){d._onBeginInteraction()},endInteraction:function(){d._onEndInteraction()}});return d}__extends(e,b);e.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};e.prototype._onEndInteraction=
function(){this._cameraInteractionActive=!1};e.prototype._getStage=function(){return null===this._measureMarkup?0:this._measureMarkup._getStage()};e.prototype._draw=function(){var b=!1;2>this._getStage()&&(this._cursor.draw(),b=!0);null!==this._measureMarkup&&(this._measureMarkup.draw(),b=!0);b&&this._viewer.markupManager.refreshMarkup()};e.prototype._finalizeMeasurement=function(b,a){return __awaiter(this,void 0,void 0,function(){var c,e,g;return __generator(this,function(f){switch(f.label){case 0:c=
this._measureMarkup;if(null===c)return console.assert(!1),[2];e=new d.PickConfig(a?d.SelectionMask.All:d.SelectionMask.Face);return[4,this._viewer.view.pickFromPoint(b,e)];case 1:g=f.sent();if(g.overlayIndex())return[2];this._measureMarkup.finalize();this._measureManager.finalizeMeasurement(this._measureMarkup);this._measureMarkup=null;return[2]}})})};e.prototype._getFirstPickPosition=function(){var b=null;null!==this._measureMarkup&&1<=this._getStage()&&(b=this._measureMarkup.getFirstPointPosition());
return b};e.prototype._updateMeasurementPoints=function(b,a){return __awaiter(this,void 0,void 0,function(){var c,e,g,h;return __generator(this,function(f){switch(f.label){case 0:return c=this._getStage(),console.assert(2>c),this._viewer.trigger("measurementBegin"),e=this._getFirstPickPosition(),[4,this._cursor.getSelectionCursorPoints(b,a,e)];case 1:g=f.sent();if(null===g||null===g.worldPosition)return this._cursor.activateCursorSprite(!1),[2];this._cursor.activateCursorSprite(!0);null===this._measureMarkup&&
(this._measureMarkup=new d.Markup.Measure.MeasurePointPointDistanceMarkup(this._viewer),this._measureManager.addMeasurement(this._measureMarkup));0===c?(this._measureMarkup.setFirstPointPosition(g.worldPosition),this._measureMarkup.setUnitMultiplier(g.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(g.selectionItem.getNodeId()):1)):1===c&&(h=this._getFirstPickPosition(),g.worldPosition.equalsWithTolerance(h,1E-7)||(this._measureMarkup.setSecondPointPosition(g.worldPosition),
this._measureMarkup.adjust(g.screenPosition)));return[2]}})})};e.prototype._useSnapping=function(b){return this._cursor.snappingConfig.enabled&&!b.altDown()};e.prototype.onMouseMove=function(c){b.prototype.onMouseMove.call(this,c);var a=this._getStage();if(2>a){if(!this._cameraInteractionActive){a=c.getPosition();var d=this._getFirstPickPosition();this._cursor.updateCursorSprite(a,this._useSnapping(c),d)}}else 2===a&&(this._measureMarkup.adjust(c.getPosition()),c.setHandled(!0));this._draw()};e.prototype.onMouseUp=
function(c){return __awaiter(this,void 0,void 0,function(){var a,d,e,g;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[3,4];a=this._getStage();d=null!==this._primaryTouchId&&null!==this._measureMarkup&&1<a;if(!(3>this._dragCount||d))return[3,4];e=this._useSnapping(c);g=c.getPosition();return 1>=a?[4,this._updateMeasurementPoints(g,e)]:[3,2];case 1:return f.sent(),[3,4];case 2:return[4,this._finalizeMeasurement(g,e)];case 3:f.sent(),f.label=4;case 4:return b.prototype.onMouseUp.call(this,
c),[2]}})})};e.prototype.onKeyUp=function(b){};e.prototype._clearMeasurement=function(){null!==this._measureMarkup?(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null):this._measureManager.removeLastMeasurement()};e.prototype.onKeyDown=function(b){b.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};e.prototype.setHandled=function(){return 1<this._getStage()};e.prototype.onActivate=function(){this._cursor.onOperatorActivate()};e.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate();
null!==this._measureMarkup&&(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null)};return e}(h.OperatorBase);h.MeasurePointPointDistanceOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(b){b[b.First=0]="First";b[b.Last=1]="Last";b[b.Midpoint=2]="Midpoint"})(g=h.MeasurePolygonAreaAnchor||(h.MeasurePolygonAreaAnchor={}));var b=function(b){function c(a,c){var e=b.call(this,a)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,b);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(a){this._anchor=a};c.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getLast():null};c.prototype._createNewMarkupItem=function(a){this._markupItem=new d.Markup.Measure.MeasurePolygonAreaMarkup(this._viewer);
this._markupItem.setUnitMultiplier(a.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(a.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolygonAreaMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(a.worldPosition)};c.prototype._updateMarkupItem=function(a,b){if(null!==this._markupItem&&null!=b.worldPosition){var c=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(c[0]));d.Point2.distance(e,
a)<this._markupItem.pointRadius?2<c.length&&this._finalizeMeasurement():this._markupItem.addPoint(b.worldPosition)&&this._updateAnchor(a,b.worldPosition)}};c.prototype._updateMeasurementItem=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(a,b,c)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(a,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a);if(!this._markupItem){var c=a.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),a.setHandled(!0))}};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,
a);if(this._isDraggingText())this._dragMarkupText(a),a.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(a.getPosition(),this._useSnapping(a),c);this._draw()}};c.prototype.onMouseUp=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=a.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(a);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return b.prototype.onMouseUp.call(this,a),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){this._markupItem&&(this._markupItem.isValid()?(this._markupItem.finalize(),this._measureManager.finalizeMeasurement(this._markupItem),this._markupItem=null):this._clearMeasurement())};c.prototype._updateAnchor=function(a,b){if(this._markupItem){var c=this._markupItem.getPoints();if(1!==c.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,b);break;case g.First:if(2!==c.length)break;b=this._viewer.view.projectPoint(c[0]);this._calculateAnchorPos(d.Point2.fromPoint3(b),
c[0]);break;case g.Midpoint:a=void 0;b=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<c.length;f++){var h=d.Point3.subtract(c[f],c[f-1]),p=h.length(),q=e+p;if(q>b){h.scale((b-e)/p);a=d.Point3.add(c[f-1],h);break}e=q}b=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(b),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,b){var c=this._viewer.view.getCamera();d.Point3.subtract(c.getPosition(),b).normalize();c=this._calculateSelectionPlane(b);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))c.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(b)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolygonAreaMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolygonAreaOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g;(function(b){b[b.First=0]="First";b[b.Last=1]="Last";b[b.Midpoint=2]="Midpoint"})(g=h.MeasurePolylineDistanceAnchor||(h.MeasurePolylineDistanceAnchor={}));var b=function(b){function c(a,c){var e=b.call(this,a)||this;e._markupItem=null;e._cameraInteractionActive=!1;e._textShapeOffset=new d.Point2(10,-25);e._anchor=g.Last;e._dragPlane=null;e._measureManager=c;e._cursor=new h.Common.PointCursor(e._viewer);e._viewer.setCallbacks({beginInteraction:function(){e._onBeginInteraction()},
endInteraction:function(){e._onEndInteraction()}});return e}__extends(c,b);c.prototype.getMarkupItem=function(){return this._markupItem};c.prototype.setAnchor=function(a){this._anchor=a};c.prototype._useSnapping=function(a){return this._cursor.snappingConfig.enabled&&!a.altDown()};c.prototype._getLastSelectedPoint=function(){return this._markupItem?this._markupItem.getlast():null};c.prototype._createNewMarkupItem=function(a){this._markupItem=new d.Markup.Measure.MeasurePolylineDistanceMarkup(this._viewer);
this._markupItem.setUnitMultiplier(a.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(a.selectionItem.getNodeId()):1);this._markupItem.setName("MeasurePolylineDistanceMarkup");this._measureManager.addMeasurement(this._markupItem);this._markupItem.addPoint(a.worldPosition)};c.prototype._updateMarkupItem=function(a,b){if(null!==this._markupItem&&null!=b.worldPosition){var c=this._markupItem.getPoints(),e=d.Point2.fromPoint3(this._viewer.view.projectPoint(c[0]));d.Point2.distance(e,
a)<this._markupItem.pointRadius?2<c.length&&(this._markupItem.isLoop=!0,this._finalizeMeasurement()):(this._markupItem.addPoint(b.worldPosition),this._updateAnchor(a,b.worldPosition))}};c.prototype._updateMeasurementItem=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=this._getLastSelectedPoint(),[4,this._cursor.getSelectionCursorPoints(a,b,c)];case 1:d=e.sent();if(null===d||null===d.worldPosition)return this._cursor.activateCursorSprite(!1),
[2];this._cursor.activateCursorSprite(!0);null===this._markupItem?this._createNewMarkupItem(d):this._updateMarkupItem(a,d);return[2]}})})};c.prototype._isDraggingText=function(){return null!==this._dragPlane};c.prototype.onMouseDown=function(a){b.prototype.onMouseDown.call(this,a);if(!this._markupItem){var c=a.getPosition();this._pickExisting(c)&&(this._dragPlane=this._calculateSelectionPlane(this._markupItem.leaderPosition),a.setHandled(!0))}};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,
a);if(this._isDraggingText())this._dragMarkupText(a),a.setHandled(!0);else if(!this._cameraInteractionActive){var c=this._getLastSelectedPoint();this._cursor.updateCursorSprite(a.getPosition(),this._useSnapping(a),c);this._draw()}};c.prototype.onMouseUp=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:if(!this.isActive())return[2];c=a.getPosition();if(!this._isDraggingText())return[3,1];this._dragPlane=this._markupItem=
null;return[3,3];case 1:if(!this._ptFirst.equals(c))return[3,3];d=this._useSnapping(a);e=c;return[4,this._updateMeasurementItem(e,d)];case 2:f.sent(),f.label=3;case 3:return b.prototype.onMouseUp.call(this,a),[2]}})})};c.prototype.onDoubleClick=function(a){this._finalizeMeasurement()};c.prototype._dragMarkupText=function(a){null!==this._markupItem&&null!==this._dragPlane&&(a=this._viewer.view.raycastFromPoint(a.getPosition()),this._dragPlane.intersectsRay(a,this._markupItem.textPosition),this._draw())};
c.prototype._finalizeMeasurement=function(){this._markupItem&&(this._markupItem.isValid()?(this._markupItem.finalize(),this._measureManager.finalizeMeasurement(this._markupItem),this._markupItem=null):this._clearMeasurement())};c.prototype._updateAnchor=function(a,b){if(this._markupItem){var c=this._markupItem.getPoints();if(1!==c.length)switch(this._anchor){case g.Last:this._calculateAnchorPos(a,b);break;case g.First:if(2!==c.length)break;b=this._viewer.view.projectPoint(c[0]);this._calculateAnchorPos(d.Point2.fromPoint3(b),
c[0]);break;case g.Midpoint:a=void 0;b=this._markupItem.getMeasurementValue()/2;for(var e=0,f=1;f<c.length;f++){var h=d.Point3.subtract(c[f],c[f-1]),p=h.length(),q=e+p;if(q>b){h.scale((b-e)/p);a=d.Point3.add(c[f-1],h);break}e=q}b=this._viewer.view.projectPoint(a);this._calculateAnchorPos(d.Point2.fromPoint3(b),a)}}};c.prototype._calculateSelectionPlane=function(a){var b=this._viewer.view.getCamera();b=d.Point3.subtract(b.getPosition(),a);b.normalize();return d.Plane.createFromPointAndNormal(a,b)};
c.prototype._calculateAnchorPos=function(a,b){var c=this._viewer.view.getCamera();d.Point3.subtract(c.getPosition(),b).normalize();c=this._calculateSelectionPlane(b);if(a=this._viewer.view.raycastFromPoint(d.Point2.add(a,this._textShapeOffset)))c.intersectsRay(a,this._markupItem.textPosition),this._markupItem.leaderPosition.assign(b)};c.prototype._clearMeasurement=function(){null!==this._markupItem?(this._measureManager.removeMeasurement(this._markupItem),this._markupItem=null):this._measureManager.removeLastMeasurement()};
c.prototype._draw=function(){this._viewer.markupManager.refreshMarkup()};c.prototype._pickExisting=function(a){return(a=this._viewer.markupManager.pickMarkupItem(a))&&"Communicator.Markup.Measure.MeasurePolylineDistanceMarkup"===a.getClassName()?(this._markupItem=a,!0):!1};c.prototype.onActivate=function(){this._cursor.onOperatorActivate()};c.prototype.onDeactivate=function(){this._cursor.onOperatorDeactivate()};c.prototype.onKeyDown=function(a){a.getKeyCode()===d.KeyCode.Escape&&this._clearMeasurement()};
c.prototype._onBeginInteraction=function(){this._cameraInteractionActive=!0;this._cursor.activateCursorSprite(!1)};c.prototype._onEndInteraction=function(){this._cameraInteractionActive=!1};return c}(h.OperatorBase);h.MeasurePolylineDistanceOperator=b})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){(function(g){function b(a,b){var c=new d.Point4(b.x,b.y,b.z,1);b=new d.Point4(0,0,0,0);a.view.getFullCameraMatrix().transform4(c,b);c=1/b.w;b=new d.Point2(b.x*c,b.y*c);c=a.model.getClientDimensions();a=c[0];c=c[1];b.x=.5*a*(b.x+1);b.y=.5*c*(b.y+1);b.x=Math.max(0,Math.min(b.x,a));b.y=c-Math.max(0,Math.min(b.y,c));return b}g.worldPointToScreenPoint=b;var e=function(){return function(a,b,c){this.worldPosition=a;this.screenPosition=b;this.selectionItem=c}}();g.SelectionPoints=
e;var c=function(a){function b(b){var c=a.call(this,b)||this;c._cursorSprite=new d.Markup.Shape.Circle;c._name="CursorMarkup";var e=b.measureManager.getMeasurementColor();c._cursorSprite.setFillColor(e);c._cursorSprite.setStrokeColor(e);c._markupId=b.markupManager.registerMarkup(c);return c}__extends(b,a);b.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawCircle(this._cursorSprite)};b.prototype.enable=function(a){this._cursorSprite.setRadius(a?2.5:0)};b.prototype.isEnabled=function(){return 0<
this._cursorSprite.getRadius()};b.prototype.setPosition=function(a){this._cursorSprite.setCenter(a)};b.prototype.destroy=function(){this._viewer.markupManager.unregisterMarkup(this._markupId)};return b}(d.Markup.Measure.MeasureMarkup),a=function(){function a(a){this._cursorMarkup=null;this._updateCursorSpriteAction=new d.Util.CurrentAction(!0);this._viewer=a;this.snappingConfig={enabled:!0,preferVertices:!0}}a.prototype.getSelectionCursorPoints=function(a,c,f){return __awaiter(this,void 0,void 0,
function(){var g,h,k,l,n,t,u;return __generator(this,function(m){switch(m.label){case 0:return g=new d.PickConfig(c?d.SelectionMask.All:d.SelectionMask.Face),[4,this._viewer.view.pickFromPoint(a,g)];case 1:h=m.sent();if(0!==h.overlayIndex())return[2,null];k=h.getPosition();l=a;this.snappingConfig.enabled&&(n=h.getLineEntity(),t=h.getPointEntity(),n||t)&&(u=null,null!==n?u=this._getLineSnapPoint(n,c,f):null!==t&&(u=t.getPosition()),null!==u&&(k=u,l=b(this._viewer,k)));return[2,new e(k,l,h)]}})})};
a.prototype.updateCursorSprite=function(a,b,c){var d=this;this._updateCursorSpriteAction.set(function(){return d._updateCursorSpriteImpl(a,b,c)})};a.prototype._updateCursorSpriteImpl=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return null===this._cursorMarkup?[3,3]:b?[4,this.getSelectionCursorPoints(a,b,c)]:[3,2];case 1:return d=e.sent(),null!==d?(this._cursorMarkup.setPosition(d.screenPosition),this.activateCursorSprite(!0)):
this.activateCursorSprite(!1),[3,3];case 2:this._cursorMarkup.setPosition(a),e.label=3;case 3:return[2]}})})};a.prototype.draw=function(){null!==this._cursorMarkup&&this._cursorMarkup.draw()};a.prototype.activateCursorSprite=function(a){null!==this._cursorMarkup&&this._cursorMarkup.enable(a)};a.prototype._getLineSnapPoint=function(a,c,e){var f=this.snappingConfig.preferVertices?a.getBestVertex():null;if(null!==f)return f;f=a.getPosition();if(!c||null==e)return f;a=a.getPoints();a:{for(c=0;c<a.length-
1;c++)if(d.Util.isPointOnLineSegment(a[c],a[c+1],f,1E-10))break a;c=0}e=d.Util.closestPointFromPointToSegment(a[c],a[c+1],e);a=b(this._viewer,e);c=b(this._viewer,f);a=d.Point2.subtract(a,c).squaredLength();c=this._viewer.selectionManager.getPickTolerance();return a<=c*c?e:f};a.prototype.onOperatorActivate=function(){this._cursorMarkup=new c(this._viewer);this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!0)};a.prototype.onOperatorDeactivate=
function(){null!==this._cursorMarkup&&(this._cursorMarkup.destroy(),this._cursorMarkup=null);this._viewer.sheetManager.isDrawingSheetActive()&&this._viewer.sheetManager.setBackgroundSelectionEnabled(!1)};return a}();g.PointCursor=a})(h.Common||(h.Common={}))})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){var h=function(g){function b(b){var c=g.call(this,b)||this;c._activeRedlineItem=null;c._newRedlineItem=null;c._viewer=b;return c}__extends(b,g);b.prototype.createRedlineItem=function(b){b;return null};b.prototype.updateRedlineItem=function(b){b};b.prototype.finalizeRedlineItem=function(b){b;return null};b.prototype.onMouseDown=function(b){g.prototype.onMouseDown.call(this,b);this.isActive()&&(b.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorStart(),b.setHandled(!0))};
b.prototype.onMouseMove=function(b){g.prototype.onMouseMove.call(this,b);this.isActive()&&(this._redlineOperatorMove(),b.setHandled(!0))};b.prototype.onMouseUp=function(b){this.isActive()&&(b.getButton()!==d.Button.Left&&null===this._primaryTouchId||this._redlineOperatorEnd(),b.setHandled(!0));g.prototype.onMouseUp.call(this,b)};b.prototype.onMousewheel=function(b){b.setHandled(!0)};b.prototype.setDraggingEnabled=function(b){this._dragging=b};b.prototype.setHandled=function(){return!0};b.prototype._isRedlineItem=
function(b){return Object.getPrototypeOf(b)instanceof d.Markup.Redline.RedlineItem};b.prototype.onKeyUp=function(b){b=b.getKeyCode();if(b===d.KeyCode.Backspace||b===d.KeyCode.Delete){b=this._viewer.markupManager;var c=b.getSelectedMarkup(),a=b.getActiveMarkupView();null!==c&&this._isRedlineItem(c)&&null!==a&&(a.removeMarkup(c),b.selectMarkup(null))}};b.prototype._removeRedlineTextIfInvalid=function(b){if(!b.isValid()){var c=this._viewer.markupManager.getActiveMarkupView();null!==c&&(c.removeMarkup(b),
this._viewer.trigger("redlineDeleted",b));b.remove()}};b.prototype._redlineOperatorStart=function(){var b=this._viewer.markupManager,c=b.pickMarkupItem(this._ptFirst),a=b.getSelectedMarkup();c?(this._activeRedlineItem=c,this._dragging&&this._activeRedlineItem.onDragStart(this._ptFirst)&&b.refreshMarkup()):(b.selectMarkup(null),this._markupIsTextArea(a)?this._removeRedlineTextIfInvalid(a):this._newRedlineItem=this.createRedlineItem(this._ptFirst))};b.prototype._redlineOperatorMove=function(){this._activeRedlineItem?
this._dragging&&this._activeRedlineItem.onDragMove(this._ptCurrent)&&this._viewer.markupManager.refreshMarkup():this.updateRedlineItem(this._ptCurrent)};b.prototype._redlineOperatorEnd=function(){var b=this._viewer.markupManager;this._activeRedlineItem?this._ptFirst.equals(this._ptCurrent)?b.selectMarkup(this._activeRedlineItem):(this._viewer.trigger("redlineUpdated",this._activeRedlineItem),this._dragging&&this._activeRedlineItem.onDragEnd(this._ptCurrent)&&b.refreshMarkup()):this._newRedlineItem&&
(b=this.finalizeRedlineItem(this._ptCurrent))&&this._attachNewMarkupToView(b);this._newRedlineItem=this._activeRedlineItem=null};b.prototype._attachNewMarkupToView=function(b){return __awaiter(this,void 0,void 0,function(){var c,a,e,g,h,n,m,p,q;return __generator(this,function(f){switch(f.label){case 0:c=this._viewer;a=c.model;e=c.markupManager;g=e.getActiveMarkupView();h=!1;if(null!==g)return[3,3];n=a.getAbsoluteRootNode();return[4,a.getVisibilityState(n)];case 1:return m=f.sent(),[4,a.getNodeColorMap(a.getAbsoluteRootNode(),
d.ElementType.Faces)];case 2:p=f.sent(),q=e.createMarkupView(void 0,!1,m,p,null),g=e.getMarkupView(q),h=!0,f.label=3;case 3:return null!==g&&(g.addMarkupItem(b),e.selectMarkup(b)),h&&null!==g&&this._viewer.trigger("viewCreated",g),this._viewer.trigger("redlineCreated",b),[2]}})})};b.prototype._markupIsTextArea=function(b){return b?b.getClassName()===d.Markup.Redline.RedlineText.className:!1};return b}(d.Operator.OperatorBase);d.RedlineOperator=h})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._redlineCircle=null;c._previewHandle=null;c._centerSet=!1;return c}__extends(e,b);e.prototype.createRedlineItem=function(b){var a=this._viewer.view;this._redlineCircle=new d.Markup.Redline.RedlineCircle(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineCircle);b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(this._centerSet=!0,this._redlineCircle.setCenter(b),this._redlineCircle.setRadiusPoint(b));
return this._redlineCircle};e.prototype.updateRedlineItem=function(b){var a=this._viewer.view;this._redlineCircle&&(b=a.getCamera().getCameraPlaneIntersectionPoint(b,a),null!==b&&(this._centerSet||(this._centerSet=!0,this._redlineCircle.setCenter(b)),this._redlineCircle.setRadiusPoint(b),this._viewer.markupManager.refreshMarkup()))};e.prototype.finalizeRedlineItem=function(b){b=this._viewer.markupManager;var a=null;this._redlineCircle&&(this._redlineCircle.isValid()&&(a=this._redlineCircle),this._redlineCircle=
null,null!==this._previewHandle&&(b.unregisterMarkup(this._previewHandle),this._previewHandle=null),b.refreshMarkup());return a};return e}(d.RedlineOperator);h.RedlineCircleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._redlinePolyline=null;c._previewHandle=null;return c}__extends(e,b);e.prototype.createRedlineItem=function(b){var a=this._viewer.view;this._redlinePolyline=new d.Markup.Redline.RedlinePolyline(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlinePolyline);b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._redlinePolyline.addPoint(b);return this._redlinePolyline};
e.prototype.updateRedlineItem=function(b){if(this._redlinePolyline){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&(this._redlinePolyline.addPoint(b),this._viewer.markupManager.refreshMarkup())}};e.prototype.finalizeRedlineItem=function(b){b=this._viewer.markupManager;var a=null;this._redlinePolyline&&(this._redlinePolyline.isValid()&&(a=this._redlinePolyline),this._redlinePolyline=null,null!==this._previewHandle&&(b.unregisterMarkup(this._previewHandle),this._previewHandle=
null),b.refreshMarkup());return a};return e}(d.RedlineOperator);h.RedlinePolylineOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._redlineRectangle=null;c._previewHandle=null;return c}__extends(e,b);e.prototype.createRedlineItem=function(b){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);this._redlineRectangle=new d.Markup.Redline.RedlineRectangle(this._viewer);null!==b&&(this._redlineRectangle.setPoint1(b),this._redlineRectangle.setPoint2(b));this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineRectangle);
return this._redlineRectangle};e.prototype.updateRedlineItem=function(b){if(this._redlineRectangle){var a=this._viewer.view;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&this._redlineRectangle.setPoint2(b);this._viewer.markupManager.refreshMarkup()}};e.prototype.finalizeRedlineItem=function(b){b=null;if(this._redlineRectangle&&this._previewHandle){var a=this._viewer.markupManager;this._redlineRectangle.isValid()&&(b=this._redlineRectangle);a.unregisterMarkup(this._previewHandle);
this._redlineRectangle=this._previewHandle=null;a.refreshMarkup()}return b};return e}(d.RedlineOperator);h.RedlineRectangleOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));
(function(d){(function(h){var g=function(b){function e(c){c=b.call(this,c)||this;c._redlineText=null;return c}__extends(e,b);e.prototype.createRedlineItem=function(b){return this._redlineText=new d.Markup.Redline.RedlineText(this._viewer)};e.prototype.finalizeRedlineItem=function(b){if(null===this._redlineText)return null;var a=this._viewer.view,c=this._redlineText;b=a.getCamera().getCameraPlaneIntersectionPoint(b,a);null!==b&&c.setPosition(b);this._redlineText=null;return c};return e}(d.RedlineOperator);
h.RedlineTextOperator=g})(d.Operator||(d.Operator={}))})(Communicator||(Communicator={}));

var _SC = {
	_deferredInstances: [],

	_loadEngine: function (enginePath, onError) {
		if (this._engineLoaded) {
			return;
		}
		this._engineLoaded = true;
		this._enginePath = enginePath;

		var hasWebAssembly = (function () {
			try {
				if (typeof WebAssembly === "object" && typeof WebAssembly.instantiate === "function") {
					var module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
					if (module instanceof WebAssembly.Module) {
						return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
					}
				}
			} catch (e) {
				//
			}
			return false;
		})();

		var engineJs = hasWebAssembly ? "engine-wasm.js" : "engine-asmjs.js";
		if (enginePath) {
			engineJs = enginePath + "/" + engineJs;
		}

		var engineScript = document.createElement("script");
		engineScript.type = "text/javascript";

		if (typeof onError === "function") {
			engineScript.onerror = function (e) {
				onError("failed to load " + e.target.src);
			};
		}

		document.head.appendChild(engineScript);
		engineScript.src = engineJs;
	},

	_defaultEnginePath: (function () {
		// paths are normally relative to HTML, but we want a path relative to current JS file
		var scriptElements = document.getElementsByTagName("script");
		var path = scriptElements[scriptElements.length - 1].src; // URL of current script
		path = path.split("?")[0]; // remove query string
		path = path.split("/").slice(0, -1).join("/"); // remove filename
		return path;
	})(),

	// store instance arguments and return empty base object that will
	// be populated asynchronously
	createInstance: function (instanceArgs) {
		var enginePath = instanceArgs.enginePath;
		if (typeof enginePath !== "string") { // allow empty string, which means relative to HTML
			enginePath = this._defaultEnginePath;
		}

		this._loadEngine(enginePath, instanceArgs.onError);

		var argWrapper = {
			isWrapper: true,
			base: {},
			args: instanceArgs,
			enginePath: enginePath
		};

		this._deferredInstances.push (argWrapper);
		return argWrapper.base;
	}
};
(function(m,r,R,S,E,L){function Ka(a,b,c,d,e){return ha(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){q("Document cloned");var g="data-html2canvas-node"+e,h="["+g+"='"+e+"']";a.querySelector(h).removeAttribute(g);var g=f.contentWindow,k=g.document.querySelector(h);return("function"===typeof b.onclone?Promise.resolve(b.onclone(g.document)):Promise.resolve(!0)).then(function(){return ia(k,f,b,c,d)})})}function ia(a,b,c,d,e){var f=b.contentWindow,g=new T(f.document),
h=new u(c,g),k=U(a);d="view"===c.type?d:La(f.document);e="view"===c.type?e:Ma(f.document);var F=new c.renderer(d,e,h,c,r);return(new n(a,F,g,h,c)).ready.then(function(){q("Finished rendering");var d;d="view"===c.type?ja(F.canvas,{width:F.canvas.width,height:F.canvas.height,top:0,left:0,x:0,y:0}):a===f.document.body||a===f.document.documentElement||null!=c.canvas?F.canvas:ja(F.canvas,{width:null!=c.width?c.width:k.width,height:null!=c.height?c.height:k.height,top:k.top,left:k.left,x:f.pageXOffset,
y:f.pageYOffset});c.removeContainer&&(b.parentNode.removeChild(b),q("Cleaned up container"));return d})}function ja(a,b){var c=r.createElement("canvas"),d=Math.min(a.width-1,Math.max(0,b.left)),e=Math.min(a.width,Math.max(1,b.left+b.width)),f=Math.min(a.height-1,Math.max(0,b.top)),g=Math.min(a.height,Math.max(1,b.top+b.height));c.width=b.width;c.height=b.height;q("Cropping canvas at:","left:",b.left,"top:",b.top,"width:",e-d,"height:",g-f);q("Resulting crop with width",b.width,"and height",b.height,
" with x",d,"and y",f);c.getContext("2d").drawImage(a,d,f,e-d,g-f,b.x,b.y,e-d,g-f);return c}function La(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ma(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function ka(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function la(a,b){for(var c=3===a.nodeType?r.createTextNode(a.nodeValue):a.cloneNode(!1),d=a.firstChild;d;)!0!==b&&1===d.nodeType&&"SCRIPT"===d.nodeName||c.appendChild(la(d,b)),d=d.nextSibling;return c}function ha(a,b,c,d,e,f,g){Na(a);var h=r.documentMode&&9>=r.documentMode?la(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),k=b.createElement("iframe");k.className="html2canvas-container";
k.style.visibility="hidden";k.style.position="fixed";k.style.left="-10000px";k.style.top="0px";k.style.border="0";k.width=c;k.height=d;k.scrolling="no";b.body.appendChild(k);return new Promise(function(b){var c=k.contentWindow.document;ma(a.documentElement,h,"textarea");ma(a.documentElement,h,"select");k.contentWindow.onload=k.onload=function(){var d=setInterval(function(){0<c.body.childNodes.length&&(Oa(a,c),clearInterval(d),"view"===e.type&&k.contentWindow.scrollTo(f,g),b(k))},50)};c.open();c.write("<!DOCTYPE html><html></html>");
!a.defaultView||f===a.defaultView.pageXOffset&&g===a.defaultView.pageYOffset||a.defaultView.scrollTo(f,g);c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):na(c.adoptNode(h)),c.documentElement);c.close()})}function ma(a,b,c){a=a.getElementsByTagName(c);b=b.getElementsByTagName(c);c=a.length;for(var d=0;d<c;d++)b[d].value=a[d].value}function oa(a,b,c,d,e,f){return(new Pa(a,b,m.document)).then(Qa(a)).then(function(a){return ha(a,c,d,e,f,0,0)})}function Qa(a){return function(b){var c=new DOMParser,
d;try{d=c.parseFromString(b,"text/html")}catch(e){q("DOMParser not supported, falling back to createHTMLDocument");d=r.implementation.createHTMLDocument("");try{d.open(),d.write(b),d.close()}catch(f){q("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=b}}b=d.querySelector("base");b&&b.href.host||(b=d.createElement("base"),b.href=a,d.head.insertBefore(b,d.head.firstChild));return d}}function Na(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute("data-html2canvas-canvas-clone",
"canvas-"+Ra++)})}function Oa(a,b){[].slice.call(a.querySelectorAll("[data-html2canvas-canvas-clone]"),0).forEach(function(a){try{var d=b.querySelector('[data-html2canvas-canvas-clone="'+a.getAttribute("data-html2canvas-canvas-clone")+'"]');d&&(d.width=a.width,d.height=a.height,d.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(e){q("Unable to copy canvas content from",a,e)}a.removeAttribute("data-html2canvas-canvas-clone")})}function na(a){[].slice.call(a.childNodes,
0).filter(Sa).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):na(b)});return a}function Sa(a){return a.nodeType===Node.ELEMENT_NODE}function Ta(a){var b=r.createElement("a");b.href=a;b.href=b.href;return b}function t(a){this.b=this.g=this.r=0;this.a=null;this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function M(a){this.src=a;q("DummyImageContainer for",a);if(!this.promise||!this.image){q("Initiating DummyImageContainer");M.prototype.image=new Image;
var b=this.image;M.prototype.promise=new Promise(function(a,d){b.onload=a;b.onerror=d;b.src=ka();!0===b.complete&&a(b)})}}function Ua(a,b){var c=r.createElement("div"),d=r.createElement("img"),e=r.createElement("span"),f;c.style.visibility="hidden";c.style.fontFamily=a;c.style.fontSize=b;c.style.margin=0;c.style.padding=0;r.body.appendChild(c);d.src=ka();d.width=1;d.height=1;d.style.margin=0;d.style.padding=0;d.style.verticalAlign="baseline";e.style.fontFamily=a;e.style.fontSize=b;e.style.margin=
0;e.style.padding=0;e.appendChild(r.createTextNode("Hidden Text"));c.appendChild(e);c.appendChild(d);f=d.offsetTop-e.offsetTop+1;c.removeChild(e);c.appendChild(r.createTextNode("Hidden Text"));c.style.lineHeight="normal";d.style.verticalAlign="super";d=d.offsetTop-c.offsetTop+1;r.body.removeChild(c);this.baseline=f;this.lineWidth=1;this.middle=d}function pa(){this.data={}}function qa(a,b,c){this.image=null;this.src=a;var d=this,e=U(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||
null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function N(a){this.src=a.value;this.colorStops=[];this.type=null;this.y1=
this.x1=this.y0=this.x0=.5;this.promise=Promise.resolve(!0)}function ba(a,b){this.src=a;this.image=new Image;var c=this;this.tainted=null;this.promise=new Promise(function(d,e){c.image.onload=d;c.image.onerror=e;b&&(c.image.crossOrigin="anonymous");c.image.src=a;!0===c.image.complete&&d(c.image)})}function u(a,b){this.link=null;this.options=a;this.support=b;this.origin=this.getOrigin(m.location.href)}function V(a){N.apply(this,arguments);this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);
b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case "left":this.x0=0;this.x1=1;break;case "top":this.y0=0;this.y1=1;break;case "right":this.x0=1;this.x1=0;break;case "bottom":this.y0=1;this.y1=0;break;case "to":a=this.y0;var b=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=b;this.y1=a}},this):(this.y0=0,this.y1=1);this.colorStops=a.args.slice(b?1:0).map(function(a){a=a.match(this.stepRegExp);return{color:new t(a[1]),stop:"%"===a[3]?a[2]/100:null}},this);null===this.colorStops[0].stop&&
(this.colorStops[0].stop=0);null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1);this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(e,f){return null!==e.stop?(a.stop=(e.stop-this.colorStops[b-1].stop)/(f+1)+this.colorStops[b-1].stop,!0):!1},this)},this)}function q(){m.html2canvas.logging&&m.console&&m.console.log&&Function.prototype.bind.call(m.console.log,m.console).apply(m.console,[Date.now()-m.html2canvas.start+
"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function l(a,b){this.node=a;this.parent=b;this.borders=this.bounds=this.stack=null;this.clip=[];this.backgroundClip=[];this.computedStyles=this.visible=this.offsetBounds=null;this.colors={};this.styles={};this.transformMatrix=this.transformData=this.backgroundImages=null;this.isPseudoElement=!1;this.opacity=null}function Va(a){if(a&&"matrix"===a[1])return a[2].split(",").map(function(a){return parseFloat(a.trim())})}function W(a){return-1!==
a.toString().indexOf("%")}function ra(a){var b,c,d,e,f,g=[],h=0,k=0,l,m,q=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&m.push(c),"-"===b.substr(0,1)&&0<(e=b.indexOf("-",1)+1)&&(d=b.substr(0,e),b=b.substr(e)),g.push({prefix:d,method:b.toLowerCase(),value:f,args:m,image:null}));m=[];b=d=c=f=""};m=[];b=d=c=f="";a.split("").forEach(function(a){if(!(0===h&&-1<" \r\n\t".indexOf(a))){switch(a){case '"':l?l===a&&(l=null):l=a;break;case "(":if(!l){if(0===h){h=1;f+=a;return}k++}break;case ")":if(!l&&
1===h){if(0===k){h=0;f+=a;q();return}k--}break;case ",":if(!l){if(0===h){q();return}if(1===h&&0===k&&!b.match(/^url$/i)){m.push(c);c="";f+=a;return}}}f+=a;0===h?b+=a:c+=a}});q();return g}function Wa(a){return a.replace("px","")}function Xa(a){return parseFloat(a)}function U(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:
a.offsetHeight}}return{}}function ca(a){var b=a.offsetParent?ca(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function n(a,b,c,d,e){q("Starting NodeParser");this.renderer=b;this.options=e;this.range=null;this.support=c;this.renderQueue=[];this.stack=new G(!0,1,a.ownerDocument,null);c=new l(a,null);e.background&&b.rectangle(0,0,b.width,b.height,
new t(e.background));if(a===a.ownerDocument.documentElement){var f=new l(c.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,f.color("backgroundColor"))}c.visibile=c.isElementVisible();this.createPseudoHideStyles(a.ownerDocument);this.disableAnimations(a.ownerDocument);this.nodes=[].concat.apply([],[c].concat(this.getChildren(c)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,
this));this.fontMetrics=new pa;q("Fetched nodes, total:",this.nodes.length);q("Calculate overflow clips");this.calculateOverflowClips();q("Start fetching images");this.images=d.fetch(this.nodes.filter(O));this.ready=this.images.ready.then(X(function(){q("Images loaded, starting parsing");q("Creating stacking contexts");this.createStackingContexts();q("Sorting stacking contexts");this.sortStackingContexts(this.stack);this.parse(this.stack);q("Render queue created with "+this.renderQueue.length+" items");
return new Promise(X(function(a){e.async?"function"===typeof e.async?e.async.call(this,this.renderQueue,a):0<this.renderQueue.length?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function Ya(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function sa(){}function ta(a,b,c,d){return a.map(function(e,f){if(0<e.width){var g=b.left,h=b.top,k=b.width,l=b.height-a[2].width;switch(f){case 0:l=
a[0].width;e.args=Y({c1:[g,h],c2:[g+k,h],c3:[g+k-a[1].width,h+l],c4:[g+a[3].width,h+l]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width;k=a[1].width;e.args=Y({c1:[g+k,h],c2:[g+k,h+l+a[2].width],c3:[g,h+l],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width;l=a[2].width;e.args=Y({c1:[g+k,h+l],c2:[g,h+l],c3:[g+a[3].width,h],c4:[g+k-a[3].width,h]},d[2],
d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:k=a[3].width,e.args=Y({c1:[g,h+l+a[2].width],c2:[g,h],c3:[g+k,h+a[0].width],c4:[g+k,h+l]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function C(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,e=d*e;c=a+c;d=b+d;return{topLeft:H({x:a,y:d},{x:a,y:d-e},{x:c-f,y:b},{x:c,y:b}),topRight:H({x:a,y:b},{x:a+f,y:b},{x:c,y:d-e},{x:c,y:d}),bottomRight:H({x:c,y:b},{x:c,y:b+e},{x:a+
f,y:d},{x:a,y:d}),bottomLeft:H({x:c,y:d},{x:c-f,y:d},{x:a,y:b+e},{x:a,y:b})}}function ua(a,b,c){var d=a.left,e=a.top,f=a.width;a=a.height;var g=b[0][0],h=b[0][1],k=b[1][0],l=b[1][1],m=b[2][0],q=b[2][1],r=b[3][0];b=b[3][1];var n=f-k,t=a-q,p=f-m,u=a-b;return{topLeftOuter:C(d,e,g,h).topLeft.subdivide(.5),topLeftInner:C(d+c[3].width,e+c[0].width,Math.max(0,g-c[3].width),Math.max(0,h-c[0].width)).topLeft.subdivide(.5),topRightOuter:C(d+n,e,k,l).topRight.subdivide(.5),topRightInner:C(d+Math.min(n,f+c[3].width),
e+c[0].width,n>f+c[3].width?0:k-c[3].width,l-c[0].width).topRight.subdivide(.5),bottomRightOuter:C(d+p,e+t,m,q).bottomRight.subdivide(.5),bottomRightInner:C(d+Math.min(p,f-c[3].width),e+Math.min(t,a+c[0].width),Math.max(0,m-c[1].width),q-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:C(d,e+u,r,b).bottomLeft.subdivide(.5),bottomLeftInner:C(d+c[3].width,e+u,Math.max(0,r-c[3].width),b-c[2].width).bottomLeft.subdivide(.5)}}function H(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+
(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),k=e(c,d,f),l=e(g,h,f),h=e(h,k,f);f=e(l,h,f);return[H(a,g,l,f),H(f,h,k,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function Y(a,b,c,d,e,f,g){var h=[];0<b[0]||0<b[1]?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);0<c[0]||0<c[1]?(h.push(["line",
f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));0<b[0]||0<b[1]?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]);return h}function D(a,b,c,d,e,f,g){0<b[0]||0<b[1]?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]);(0<c[0]||0<c[1])&&a.push(["line",e[0].start.x,e[0].start.y])}function Za(a){return 0>
a.cssInt("zIndex")}function $a(a){return 0<a.cssInt("zIndex")}function va(a){return 0===a.cssInt("zIndex")}function wa(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ab(a){return 0<a.node.data.trim().length}function bb(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){b=a.css("border"+b+"Radius").split(" ");1>=b.length&&(b[1]=b[0]);return b.map(cb)})}function db(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}
function P(a){return"static"!==a.css("position")}function da(a){return"none"!==a.css("float")}function Q(a){var b=this;return function(){return!a.apply(b,arguments)}}function O(a){return a.node.nodeType===Node.ELEMENT_NODE}function ea(a){return a.node.nodeType===Node.TEXT_NODE}function eb(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function X(a,b){return function(){return a.apply(b,arguments)}}function cb(a){return parseInt(a,
10)}function fb(a){return a.width}function gb(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1==="SCRIPT HEAD TITLE OBJECT BR OPTION".split(" ").indexOf(a.node.nodeName)}function hb(a){for(var b=[],c=0,d=!1,e;a.length;)-1!==[32,13,10,9,45].indexOf(a[c])===d?(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)),d=!d,c=0):c++,c>=a.length&&(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)));return b}function Pa(a,b,c){if(!b)return Promise.reject("No proxy configured");
var d=xa(ya);a=za(b,a,d);return ya?Aa(a):Ba(c,a,d).then(function(a){return Ca(a.content)})}function ib(a,b,c){var d=xa(Da);a=za(b,a,d);return Da?Promise.resolve(a):Ba(c,a,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ba(a,b,c){return new Promise(function(d,e){var f=a.createElement("script"),g=function(){delete m.html2canvas.proxy[c];a.body.removeChild(f)};m.html2canvas.proxy[c]=function(a){g();d(a)};f.src=b;f.onerror=function(a){g();e(a)};a.body.appendChild(f)})}function xa(a){return a?
"":"html2canvas_"+Date.now()+"_"+ ++jb+"_"+Math.round(1E5*Math.random())}function za(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function kb(a,b){r.createElement("script");var c=r.createElement("a");c.href=a;this.src=a=c.href;this.image=new Image;var d=this;this.promise=new Promise(function(c,f){d.image.crossOrigin="Anonymous";d.image.onload=c;d.image.onerror=f;(new ib(a,b,r)).then(function(a){d.image.src=a})["catch"](f)})}function v(a,b,c){l.call(this,
a,b);this.isPseudoElement=!0;this.before=":before"===c}function x(a,b,c,d,e){this.width=a;this.height=b;this.images=c;this.options=d;this.document=e}function G(a,b,c,d){l.call(this,c,d);this.ownStacking=a;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function T(a){this.rangeBounds=this.testRangeBounds(a);this.cors=this.testCORS();this.svg=this.testSVG()}function A(a){this.src=a;this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?
Promise.resolve(b.inlineFormatting(a)):Aa(a)}).then(function(a){return new Promise(function(d){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,d))})})}function Ca(a){var b=a.length,c,d,e,f,g,h,k="";for(c=0;c<b;c+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c]),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+2]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+
3]),d=d<<2|e>>4,e=(e&15)<<4|f>>2,h=(f&3)<<6|g,k=64===f?k+String.fromCharCode(d):64===g||-1===g?k+String.fromCharCode(d,e):k+String.fromCharCode(d,e,h);return k}function Ea(a,b){this.src=a;this.image=null;var c=this;this.promise=b?new Promise(function(b,e){c.image=new Image;c.image.onload=b;c.image.onerror=e;c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a);!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,
c.createCanvas.call(c,b))})})}function I(a,b){l.call(this,a,b)}function lb(a,b,c){if(0<a.length)return b+c.toUpperCase()}function Fa(a){N.apply(this,arguments);this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Aa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200===d.status?b(d.responseText):c(Error(d.statusText))};d.onerror=function(){c(Error("Network Error"))};d.send()})}function p(a,b){x.apply(this,arguments);this.canvas=
this.options.canvas||this.document.createElement("canvas");this.options.canvas||(this.canvas.width=a,this.canvas.height=b);this.ctx=this.canvas.getContext("2d");this.taintCtx=this.document.createElement("canvas").getContext("2d");this.ctx.textBaseline="bottom";this.variables={};q("Initialized CanvasRenderer with size",a,"x",b)}function mb(a){return 0<a.length}(function(){function a(a,b){J[K]=a;J[K+1]=b;K+=2;2===K&&Ga()}function b(a){return"function"===typeof a}function c(){return function(){process.nextTick(g)}}
function d(){var a=0,b=new Ha(g),c=r.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;a.port1.onmessage=g;return function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<K;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;K=0}function h(){}function k(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function l(b,c,d){a(function(a){var b=!1,e=k(d,c,function(d){b||(b=!0,c!==d?n(a,
d):p(a,d))},function(c){b||(b=!0,w(a,c))});!b&&e&&(b=!0,w(a,e))},b)}function q(a,b){1===b.a?p(a,b.b):2===a.a?w(a,b.b):u(b,void 0,function(b){n(a,b)},function(b){w(a,b)})}function n(a,c){if(a===c)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof c||"object"===typeof c&&null!==c)if(c.constructor===a.constructor)q(a,c);else{var d;try{d=c.then}catch(e){Z.error=e,d=Z}d===Z?w(a,Z.error):void 0===d?p(a,c):b(d)?l(a,c,d):p(a,c)}else p(a,c)}function t(a){a.f&&a.f(a.b);
v(a)}function p(b,c){void 0===b.a&&(b.b=c,b.a=1,0!==b.e.length&&a(v,b))}function w(b,c){void 0===b.a&&(b.a=2,b.b=c,a(t,b))}function u(b,c,d,e){var f=b.e,g=f.length;b.f=null;f[g]=c;f[g+1]=d;f[g+2]=e;0===g&&b.a&&a(v,b)}function v(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a.e.length=0}}function x(){this.error=null}function z(a,c,d,e){var f=b(d),g,h,k,l;if(f){try{g=d(e)}catch(B){fa.error=B,g=fa}g===fa?(l=!0,h=g.error,g=null):k=!0;if(c===
g){w(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e,k=!0;void 0===c.a&&(f&&k?n(c,g):l?w(c,h):1===a?p(c,g):2===a&&w(c,g))}function A(a,b){try{b(function(b){n(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function y(a,b,c,d){this.n=a;this.c=new a(h,d);this.i=c;this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?p(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&p(this.c,this.b))):w(this.c,this.p())}function B(a){nb++;this.b=
this.a=void 0;this.e=[];if(h!==a){if(!b(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");A(this,a)}}var Ia=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},K=0,aa="undefined"!==typeof m?m:{},Ha=aa.MutationObserver||aa.WebKitMutationObserver,
aa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),Ga;Ga="undefined"!==typeof process&&"[object process]"==={}.toString.call(process)?c():Ha?d():aa?e():f();var Z=new x,fa=new x;y.prototype.o=function(a){return Ia(a)};y.prototype.p=function(){return Error("Array Methods must be provided an Array")};y.prototype.l=function(){this.b=Array(this.length)};y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===
b.a&&d<a;d++)this.j(c[d],d)};y.prototype.j=function(a,b){var c=this.n;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))};y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?w(d,c):this.b[b]=this.h(c));0===this.d&&p(d,this.b)};y.prototype.h=function(a){return a};y.prototype.q=function(a,b){var c=this;u(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var nb=0;B.all=
function(a,b){return(new y(this,a,!0,b)).c};B.race=function(a,b){function c(a){n(e,a)}function d(a){w(e,a)}var e=new this(h,b);if(!Ia(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&g<f;g++)u(this.resolve(a[g]),void 0,c,d);return e};B.resolve=function(a,b){if(a&&"object"===typeof a&&a.constructor===this)return a;var c=new this(h,b);n(c,a);return c};B.reject=function(a,b){var c=new this(h,b);w(c,a);return c};B.prototype={constructor:B,then:function(b,
c){var d=this.a;if(1===d&&!b||2===d&&!c)return this;var e=new this.constructor(h),f=this.b;if(d){var g=arguments[d-1];a(function(){z(d,e,g,f)})}else u(this,e,b,c);return e},"catch":function(a){return this.then(null,a)}};var ga={Promise:B,polyfill:function(){var a;a="undefined"!==typeof S?S:"undefined"!==typeof m&&m.document?m:self;"Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;new a.Promise(function(a){c=a});return b(c)}()||(a.Promise=
B)}};"function"===typeof E&&E.amd?E(function(){return ga}):"undefined"!==typeof module&&module.exports?module.exports=ga:"undefined"!==typeof this&&(this.ES6Promise=ga)}).call(m);m&&m.ES6Promise.polyfill();if("undefined"===typeof r||"function"!==typeof Object.create||"function"!==typeof r.createElement("canvas").getContext)(m||module.exports).html2canvas=function(){return Promise.reject("No canvas support")};else{(function(a){function b(a){throw RangeError(v[a]);}function c(a,b){for(var c=a.length,
d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";1<d.length&&(e=d[0]+"@",a=d[1]);d=a.split(u);d=c(d,b).join(".");return e+d}function e(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function f(a){return c(a,function(a){var b="";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join("")}function g(a,b){return a+
22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function k(a){var c=[],d=a.length,e,g=0,k=128,l=72,m,n,q,p,r;m=a.lastIndexOf("-");0>m&&(m=0);for(n=0;n<m;++n)128<=a.charCodeAt(n)&&b("not-basic"),c.push(a.charCodeAt(n));for(m=0<m?m+1:0;m<d;){n=g;e=1;for(q=36;;q+=36){m>=d&&b("invalid-input");p=a.charCodeAt(m++);p=10>p-48?p-22:26>p-65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/e))&&b("overflow");g+=p*e;r=q<=l?1:q>=l+
26?26:q-l;if(p<r)break;p=36-r;e>z(2147483647/p)&&b("overflow");e*=p}e=c.length+1;l=h(g-n,e,0==n);z(g/e)>2147483647-k&&b("overflow");k+=z(g/e);g%=e;c.splice(g++,0,k)}return f(c)}function l(a){var c,d,f,k,p,m,n,q,r,t=[],u,v,w;a=e(a);u=a.length;c=128;d=0;p=72;for(m=0;m<u;++m)r=a[m],128>r&&t.push(x(r));for((f=k=t.length)&&t.push("-");f<u;){n=2147483647;for(m=0;m<u;++m)r=a[m],r>=c&&r<n&&(n=r);v=f+1;n-c>z((2147483647-d)/v)&&b("overflow");d+=(n-c)*v;c=n;for(m=0;m<u;++m)if(r=a[m],r<c&&2147483647<++d&&b("overflow"),
r==c){q=d;for(n=36;;n+=36){r=n<=p?1:n>=p+26?26:n-p;if(q<r)break;w=q-r;q=36-r;t.push(x(g(r+w%q,0)));q=z(w/q)}t.push(x(g(q,0)));p=h(d,v,f==k);d=0;++f}++d;++c}return t.join("")}var m="object"==typeof R&&R&&!R.nodeType&&R,q="object"==typeof module&&module&&!module.nodeType&&module,n="object"==typeof S&&S;if(n.global===n||n.window===n||n.self===n)a=n;var p,r=/^xn--/,t=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},z=Math.floor,x=String.fromCharCode,y;p={version:"1.3.1",ucs2:{decode:e,encode:f},decode:k,encode:l,toASCII:function(a){return d(a,function(a){return t.test(a)?"xn--"+l(a):a})},toUnicode:function(a){return d(a,function(a){return r.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof E&&"object"==typeof E.amd&&E.amd)E("punycode",function(){return p});else if(m&&q)if(module.exports==m)q.exports=p;else for(y in p)p.hasOwnProperty(y)&&(m[y]=p[y]);else a.punycode=
p})(this);var Ra=0,ob=0;m.html2canvas=function(a,b){var c=ob++;b=b||{};b.logging&&(m.html2canvas.logging=!0,m.html2canvas.start=Date.now());b.async="undefined"===typeof b.async?!0:b.async;b.allowTaint="undefined"===typeof b.allowTaint?!1:b.allowTaint;b.removeContainer="undefined"===typeof b.removeContainer?!0:b.removeContainer;b.javascriptEnabled="undefined"===typeof b.javascriptEnabled?!1:b.javascriptEnabled;b.imageTimeout="undefined"===typeof b.imageTimeout?1E4:b.imageTimeout;b.renderer="function"===
typeof b.renderer?b.renderer:p;b.strict=!!b.strict;if("string"===typeof a){if("string"!==typeof b.proxy)return Promise.reject("Proxy must be used when rendering url");var d=null!=b.width?b.width:m.innerWidth,e=null!=b.height?b.height:m.innerHeight;return oa(Ta(a),b.proxy,r,d,e,b).then(function(a){return ia(a.contentWindow.document.documentElement,a,b,d,e)})}var f=(a===L?[r.documentElement]:a.length?a:[a])[0];f.setAttribute("data-html2canvas-node"+c,c);return Ka(f.ownerDocument,b,f.ownerDocument.defaultView.innerWidth,
f.ownerDocument.defaultView.innerHeight,c).then(function(a){"function"===typeof b.onrendered&&(q("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),b.onrendered(a));return a})};m.html2canvas.punycode=this.punycode;m.html2canvas.proxy={};t.prototype.darken=function(a){a=1-a;return new t([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a])};t.prototype.isTransparent=function(){return 0===this.a};t.prototype.isBlack=function(){return 0===this.r&&
0===this.g&&0===this.b};t.prototype.fromArray=function(a){Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),3<a.length&&(this.a=a[3]));return Array.isArray(a)};var pb=/^#([a-f0-9]{3})$/i;t.prototype.hex3=function(a){null!==(a=a.match(pb))&&(this.r=parseInt(a[1][0]+a[1][0],16),this.g=parseInt(a[1][1]+a[1][1],16),this.b=parseInt(a[1][2]+a[1][2],16));return null!==a};var qb=/^#([a-f0-9]{6})$/i;t.prototype.hex6=function(a){null!==(a=a.match(qb))&&(this.r=
parseInt(a[1].substring(0,2),16),this.g=parseInt(a[1].substring(2,4),16),this.b=parseInt(a[1].substring(4,6),16));return null!==a};var rb=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;t.prototype.rgb=function(a){null!==(a=a.match(rb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]));return null!==a};var sb=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;t.prototype.rgba=function(a){null!==(a=a.match(sb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]),
this.a=Number(a[4]));return null!==a};t.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join()+")":"rgb("+[this.r,this.g,this.b].join()+")"};t.prototype.namedColor=function(a){var b=tb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b};t.prototype.isColor=!0;var tb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,
255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],
darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],
fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,
250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,
255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};pa.prototype.getMetrics=function(a,b){this.data[a+"-"+b]===L&&(this.data[a+"-"+b]=new Ua(a,b));return this.data[a+"-"+b]};qa.prototype.proxyLoad=function(a,b,c){var d=this.src;return oa(d.src,a,d.ownerDocument,b.width,b.height,c)};N.prototype.TYPES=
{LINEAR:1,RADIAL:2};u.prototype.findImages=function(a){var b=[];a.reduce(function(a,b){switch(b.node.nodeName){case "IMG":return a.concat([{args:[b.node.src],method:"url"}]);case "svg":case "IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this);return b};u.prototype.findBackgroundImage=function(a,b){b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this);return a};u.prototype.addImage=
function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),q("Added image #"+a.length,"string"===typeof d?d.substring(0,100):d))},this)}};u.prototype.hasImageBackground=function(a){return"none"!==a.method};u.prototype.loadImage=function(a){return"url"===a.method?(a=a.args[0],!this.isSVG(a)||this.support.svg||this.options.allowTaint?a.match(/data:image\/.*;base64,/i)?new ba(a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(a)||!0===
this.options.allowTaint||this.isSVG(a)?new ba(a,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ba(a,!0):this.options.proxy?new kb(a,this.options.proxy):new M(a):new A(a)):"linear-gradient"===a.method?new V(a):"gradient"===a.method?new Fa(a):"svg"===a.method?new Ea(a.args[0],this.support.svg):"IFRAME"===a.method?new qa(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new M(a)};u.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||A.prototype.isInline(a)};
u.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})};u.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin};u.prototype.getOrigin=function(a){var b=this.link||(this.link=r.createElement("a"));b.href=a;b.href=b.href;return b.protocol+b.hostname+b.port};u.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout)["catch"](function(){return(new M(a.src)).promise.then(function(b){a.image=b})})};u.prototype.get=function(a){var b=
null;return this.images.some(function(c){return(b=c).src===a})?b:null};u.prototype.fetch=function(a){this.images=a.reduce(X(this.findBackgroundImage,this),this.findImages(a));this.images.forEach(function(a,c){a.promise.then(function(){q("Succesfully loaded image #"+(c+1),a)},function(d){q("Failed loading image #"+(c+1),a,d)})});this.ready=Promise.all(this.images.map(this.getPromise,this));q("Finished searching images");return this};u.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,
new Promise(function(d,f){c=setTimeout(function(){q("Timed out loading image",a);f(a)},b)})]).then(function(a){clearTimeout(c);return a});d["catch"](function(){clearTimeout(c)});return d};V.prototype=Object.create(N.prototype);V.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;l.prototype.cloneTo=function(a){a.visible=this.visible;a.borders=this.borders;a.bounds=this.bounds;a.clip=this.clip;a.backgroundClip=this.backgroundClip;a.computedStyles=
this.computedStyles;a.styles=this.styles;a.backgroundImages=this.backgroundImages;a.opacity=this.opacity};l.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity};l.prototype.assignStack=function(a){this.stack=a;a.children.push(this)};l.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&
("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))};l.prototype.css=function(a){this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null));return this.styles[a]||(this.styles[a]=this.computedStyles[a])};l.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);c===L&&b.some(function(b){c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1));return c!==L},this);return c===
L?null:c};l.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)};l.prototype.cssInt=function(a){a=parseInt(this.css(a),10);return isNaN(a)?0:a};l.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new t(this.css(a)))};l.prototype.cssFloat=function(a){a=parseFloat(this.css(a));return isNaN(a)?0:a};l.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a};
l.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null};l.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=ra(this.css("backgroundImage")))};l.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(","),c=c[b||0]||c[0]||"auto",c=c.trim().split(" ");1===c.length&&(c=[c[0],c[0]]);return c};l.prototype.parseBackgroundSize=
function(a,b,c){c=this.cssList("backgroundSize",c);var d;if(W(c[0]))d=a.width*parseFloat(c[0])/100;else{if(/contain|cover/.test(c[0]))return b=b.width/b.height,a.width/a.height<b^"contain"===c[0]?{width:a.height*b,height:a.height}:{width:a.width,height:a.width/b};d=parseInt(c[0],10)}a="auto"===c[0]&&"auto"===c[1]?b.height:"auto"===c[1]?d/b.width*b.height:W(c[1])?a.height*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(d=a/b.height*b.width);return{width:d,height:a}};l.prototype.parseBackgroundPosition=
function(a,b,c,d){c=this.cssList("backgroundPosition",c);var e;e=W(c[0])?(a.width-(d||b).width)*(parseFloat(c[0])/100):parseInt(c[0],10);a="auto"===c[1]?e/b.width*b.height:W(c[1])?(a.height-(d||b).height)*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(e=a/b.height*b.width);return{left:e,top:a}};l.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]};l.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var a=a.match(this.TEXT_SHADOW_PROPERTY),
c=0;a&&c<a.length;c++){var d=a[c].match(this.TEXT_SHADOW_VALUES);b.push({color:new t(d[0]),offsetX:d[1]?parseFloat(d[1].replace("px","")):0,offsetY:d[2]?parseFloat(d[2].replace("px","")):0,blur:d[3]?d[3].replace("px",""):0})}return b};l.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(Wa).map(Xa);b[0]+=a.left;b[1]+=a.top;this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData=
{origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData};l.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform");this.transformMatrix=(a=a?Va(a.match(this.MATRIX_PROPERTY)):null)?a:[1,0,0,1,0,0]}return this.transformMatrix};l.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?ca(this.node):U(this.node))};l.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&
this.parent.hasTransform()};l.prototype.getValue=function(){var a=this.node.value||"";"SELECT"===this.node.tagName?(a=this.node,a=(a=a.options[a.selectedIndex||0])?a.text||"":""):"password"===this.node.type&&(a=Array(a.length+1).join("\u2022"));return 0===a.length?this.node.placeholder||"":a};l.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/;l.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;l.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.prototype.CLIP=
/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(O(a)){!0===a.isPseudoElement&&a.appendToDOM();a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]);a.clip=a.parent&&a.parent.clip.length?a.parent.clip.concat(b):b;a.backgroundClip=
"hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip;!0===a.isPseudoElement&&a.cleanDOM()}else ea(a)&&(a.clip=a.parent&&a.parent.clip.length?a.parent.clip:[]);!0!==a.isPseudoElement&&(a.bounds=null)},this)};n.prototype.asyncRenderer=function(a,b,c){c=c||Date.now();this.paint(a[this.renderIndex++]);a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(X(function(){this.asyncRenderer(a,b)},this),0)};n.prototype.createPseudoHideStyles=function(a){this.createStyles(a,
"."+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')};n.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")};
n.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b;a.body.appendChild(c)};n.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before");a=this.getPseudoElement(a,":after");c&&b.push(c);a&&b.push(a)}return[].concat.apply([],b)};n.prototype.getPseudoElement=function(a,b){var c=a.computedStyle(b);if(!c||!c.content||"none"===c.content||"-moz-alt-content"===c.content||"none"===c.display)return null;
var d,e=c.content,f=e.substr(0,1);d=f===e.substr(e.length-1)&&f.match(/'|"/)?e.substr(1,e.length-2):e;for(var g="url"===d.substr(0,3),e=r.createElement(g?"img":"html2canvaspseudoelement"),f=new v(e,a,b),h=c.length-1;0<=h;h--){var k=Ya(c.item(h));e.style[k]=c[k]}e.className=v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(g)return e.src=ra(d)[0].args[0],[f];c=r.createTextNode(d);e.appendChild(c);return[f,new I(c,f)]};n.prototype.getChildren=function(a){return[].concat.apply([],
[].filter.call(a.node.childNodes,db).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new I(b,a):new l(b,a)].filter(gb);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))};n.prototype.newStackingContext=function(a,b){var c=new G(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c);(b?c.getParentStack(this):c.parent.stack).contexts.push(c);a.stack=c};n.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){var b;
if(b=O(a))(b=this.isRootElement(a)||1>a.getOpacity())||(b=a.css("position"),b="auto"!==(-1!==["absolute","relative","fixed"].indexOf(b)?a.css("zIndex"):"auto")),b=b||this.isBodyWithTransparentRoot(a)||a.hasTransform();b?this.newStackingContext(a,!0):O(a)&&(P(a)&&va(a)||-1!==["inline-block","inline-table"].indexOf(a.css("display"))||da(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)};n.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()};
n.prototype.isRootElement=function(a){return null===a.parent};n.prototype.sortStackingContexts=function(a){a.contexts.sort(eb(a.contexts.slice(0)));a.contexts.forEach(this.sortStackingContexts,this)};n.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform())return c=d.slice(0,c).join("").length,this.getRangeBounds(a.node,c,b.length);if(a.node&&"string"===typeof a.node.data)return b=
a.node.splitText(b.length),c=this.getWrapperBounds(a.node,a.parent.hasTransform()),a.node=b,c}else if(!this.support.rangeBounds||a.parent.hasTransform())a.node=a.node.splitText(b.length);return{}}};n.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0));d.replaceChild(c,a);var f=b?ca(c):U(c);d.replaceChild(e,c);return f};n.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=
a.ownerDocument.createRange());d.setStart(a,b);d.setEnd(a,b+c);return d.getBoundingClientRect()};n.prototype.parse=function(a){var b=a.contexts.filter(Za),c=a.children.filter(O),d=c.filter(Q(da)),e=d.filter(Q(P)).filter(Q(wa)),c=c.filter(Q(P)).filter(da),f=d.filter(Q(P)).filter(wa),d=a.contexts.concat(d.filter(P)).filter(va),g=a.children.filter(ea).filter(ab);a=a.contexts.filter($a);b.concat(e).concat(c).concat(f).concat(d).concat(g).concat(a).forEach(function(a){this.renderQueue.push(a);a instanceof
G&&(this.parse(a),this.renderQueue.push(new sa))},this)};n.prototype.paint=function(a){try{a instanceof sa?this.renderer.ctx.restore():ea(a)?(!0===a.parent.isPseudoElement&&a.parent.appendToDOM(),this.paintText(a),!0===a.parent.isPseudoElement&&a.parent.cleanDOM()):this.paintNode(a)}catch(b){if(q(b),this.options.strict)throw b;}};n.prototype.paintNode=function(a){a instanceof G&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform()));
"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)};n.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(fb))},this);this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this);this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case "svg":case "IFRAME":var c=
this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <"+a.node.nodeName+">",a.node);break;case "IMG":(c=this.images.get(a.node.src))?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <img>",a.node.src);break;case "CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case "SELECT":case "INPUT":case "TEXTAREA":this.paintFormValue(a)}},this)};n.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-
1,height:c-1,top:b.top,left:b.left},b=[3,3],e=[b,b,b,b],f=[1,1,1,1].map(function(a){return{color:new t("#A5A5A5"),width:a}}),g=ua(d,e,f);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new t("#DEDEDE"));this.renderer.renderBorders(ta(f,d,g,e));a.node.checked&&(this.renderer.font(new t("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("\u2714",d.left+c/6,d.top+c-1))},this)};n.prototype.paintRadio=function(a){var b=
a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new t("#DEDEDE"),1,new t("#A5A5A5"));a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new t("#424242"))},this)};n.prototype.paintFormValue=function(a){var b=a.getValue();if(0<b.length){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");"lineHeight textAlign fontFamily fontWeight fontSize color paddingLeft paddingTop paddingRight paddingBottom width height borderLeftStyle borderTopStyle borderLeftWidth borderTopWidth boxSizing whiteSpace wordWrap".split(" ").forEach(function(b){try{d.style[b]=
a.css(b)}catch(c){q("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});var e=a.parseBounds();d.style.position="fixed";d.style.left=e.left+"px";d.style.top=e.top+"px";d.textContent=b;c.body.appendChild(d);this.paintText(new I(d.firstChild,a));c.body.removeChild(d)}};n.prototype.paintText=function(a){a.applyTextTransform();var b=m.html2canvas.punycode.ucs2.decode(a.node.data),c=this.options.letterRendering&&!/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))||/[^\u0000-\u00ff]/.test(a.node.data)?
b.map(function(a){return m.html2canvas.punycode.ucs2.encode([a])}):hb(b),b=a.parent.fontWeight(),d=a.parent.css("fontSize"),e=a.parent.css("fontFamily"),f=a.parent.parseTextShadows();this.renderer.font(a.parent.color("color"),a.parent.css("fontStyle"),a.parent.css("fontVariant"),b,d,e);f.length?this.renderer.fontShadow(f[0].color,f[0].offsetX,f[0].offsetY,f[0].blur):this.renderer.clearShadow();this.renderer.clip(a.parent.clip,function(){c.map(this.parseTextBounds(a),this).forEach(function(b,f){b&&
(this.renderer.text(c[f],b.left,b.bottom),this.renderTextDecoration(a.parent,b,this.fontMetrics.getMetrics(e,d)))},this)},this)};n.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case "underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case "overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case "line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+
c.middle+c.lineWidth),b.width,1,a.color("color"))}};var Ja={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(a){var b=a.parseBounds(),c=bb(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new t([255,255,255,e.a]));d=Ja[d]?Ja[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:d?e[d[0]](d[1]):e,args:null}}),e=ua(b,c,d);return{clip:this.parseBackgroundClip(a,
e,d,c,b),borders:ta(d,b,e,c)}};n.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=[];switch(a.css("backgroundClip")){case "content-box":case "padding-box":D(f,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width);D(f,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width);D(f,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width);D(f,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,
e.top+e.height-c[2].width);break;default:D(f,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),D(f,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),D(f,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),D(f,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return f};var jb=0,ya="withCredentials"in new XMLHttpRequest,Da="crossOrigin"in new Image;v.prototype.cloneTo=function(a){v.prototype.cloneTo.call(this,a);a.isPseudoElement=!0;a.before=
this.before};v.prototype=Object.create(l.prototype);v.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node);this.parent.node.className+=" "+this.getHideClass()};v.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")};v.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+
(this.before?"BEFORE":"AFTER")]};v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before";v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after";x.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight");a=a.cssInt("paddingBottom");c=c.borders;g=b.width-(c[1].width+c[3].width+e+g);a=b.height-(c[0].width+c[2].width+f+a);this.drawImage(d,0,0,d.image.width||g,d.image.height||a,b.left+
e+c[3].width,b.top+f+c[0].width,g,a)};x.prototype.renderBackground=function(a,b,c){0<b.height&&0<b.width&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))};x.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)};x.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)};x.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)};
x.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case "url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):q("Error loading background-image",d.args[0]);break;case "linear-gradient":case "gradient":(e=this.images.get(d.value))?this.renderBackgroundGradient(e,b,c):q("Error loading background-image",d.args[0]);break;case "none":break;default:q("Unknown background-image type",d.args[0])}},
this)};x.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case "repeat-x":case "repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case "repeat-y":case "no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case "no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+
e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}};G.prototype=Object.create(l.prototype);G.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack};T.prototype.testRangeBounds=function(a){var b,c,d=!1;a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),
b.selectNode(c),b=b.getBoundingClientRect(),b=b.height,123===b&&(d=!0),a.body.removeChild(c)));return d};T.prototype.testCORS=function(){return"undefined"!==typeof(new Image).crossOrigin};T.prototype.testSVG=function(){var a=new Image,b=r.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}return!0};A.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(Error("html2canvas.svg.js is not loaded, cannot render svg"))};
A.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)};A.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")};A.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)};A.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl;e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,
d)).renderAll();a(e.lowerCanvasEl)}};A.prototype.decode64=function(a){return"function"===typeof m.atob?m.atob(a):Ca(a)};Ea.prototype=Object.create(A.prototype);I.prototype=Object.create(l.prototype);I.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))};I.prototype.transform=function(a){var b=this.node.data;switch(a){case "lowercase":return b.toLowerCase();case "capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,lb);case "uppercase":return b.toUpperCase();
default:return b}};Fa.prototype=Object.create(N.prototype);p.prototype=Object.create(x.prototype);p.prototype.setFillStyle=function(a){this.ctx.fillStyle="object"===typeof a&&a.isColor?a.toString():a;return this.ctx};p.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)};p.prototype.circle=function(a,b,c,d){this.setFillStyle(d);this.ctx.beginPath();this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0);this.ctx.closePath();this.ctx.fill()};p.prototype.circleStroke=function(a,b,c,
d,e,f){this.circle(a,b,c,d);this.ctx.strokeStyle=f.toString();this.ctx.stroke()};p.prototype.drawShape=function(a,b){this.shape(a);this.setFillStyle(b).fill()};p.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(b){this.taintCtx=r.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted};p.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){this.taints(a)&&!this.options.allowTaint||this.ctx.drawImage(a.image,
b,c,d,e,f,g,h,k)};p.prototype.clip=function(a,b,c){this.ctx.save();a.filter(mb).forEach(function(a){this.shape(a).clip()},this);b.call(c);this.ctx.restore()};p.prototype.shape=function(a){this.ctx.beginPath();a.forEach(function(a,c){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===c?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this);this.ctx.closePath();return this.ctx};p.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]};p.prototype.fontShadow=
function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)};p.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")};p.prototype.setOpacity=function(a){this.ctx.globalAlpha=a};p.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]);this.ctx.transform.apply(this.ctx,a.matrix);this.ctx.translate(-a.origin[0],-a.origin[1])};p.prototype.setVariable=function(a,
b){this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b);return this};p.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)};p.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,k){this.clip([[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]]],function(){this.renderBackgroundRepeat(a,b,c,d,k[3],k[0])},this)};p.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){e=Math.round(d.left+
b.left+e);b=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat"));this.ctx.translate(e,b);this.ctx.fill();this.ctx.translate(-e,-b)};p.prototype.renderBackgroundGradient=function(a,b){if(a instanceof V){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())});this.rectangle(b.left,b.top,b.width,b.height,c)}};p.prototype.resizeImage=
function(a,b){var c=a.image;if(c.width===b.width&&c.height===b.height)return c;var d=r.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,b.width,b.height);return d}}}).call({},"undefined"!==typeof window?window:void 0,"undefined"!==typeof document?document:void 0);

/*
 Use it if you like it
*/
(function(A){function E(K){this.ok=!1;"#"==K.charAt(0)&&(K=K.substr(1,6));K=K.replace(/ /g,"");K=K.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},O;for(O in A)K==O&&(K=A[O]);var L=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];for(O=0;O<L.length;O++){var W=L[O].process,M=L[O].re.exec(K);M&&(channels=W(M),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var u=this.r.toString(16),B=this.g.toString(16),p=this.b.toString(16);1==u.length&&(u="0"+u);1==B.length&&(B="0"+B);1==p.length&&(p="0"+p);return"#"+u+B+p};this.getHelpXML=function(){for(var u=[],B=0;B<L.length;B++)for(var p=L[B].example,C=0;C<p.length;C++)u[u.length]=p[C];for(var w in A)u[u.length]=w;p=document.createElement("ul");
p.setAttribute("id","rgbcolor-examples");for(B=0;B<u.length;B++)try{var h=document.createElement("li"),a=new E(u[B]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+u[B]+" -> "+a.toRGB()+" -> "+a.toHex());h.appendChild(l);h.appendChild(c);p.appendChild(h)}catch(b){}return p}}"undefined"!==typeof define&&define.amd?define(function(){return E}):
"undefined"!==typeof module&&module.exports&&(module.exports=E);A.RGBColor=E})("undefined"!==typeof window?window:this);
(function(A){function E(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(A){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(K){throw alert("Cannot access local image"),Error("unable to access local image data: "+K);}}}catch(A){throw alert("Cannot access image"),Error("unable to access image data: "+A);}for(var a=h.data,l=h.width*h.height*4,c=0;c<l;c+=4){var b=
a[c+3]/255;a[c]*=b;a[c+1]*=b;a[c+2]*=b}var a=h.data,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N,P,S,y,I,J,t,E;e=w+w+1;var R=p-1,l=C-1,c=w+1,b=c*(c+1)/2,Q=new X,x=Q;for(k=1;k<e;k++)if(x=x.next=new X,k==c)var T=x;x.next=Q;n=g=0;var U=O[w],V=L[w];for(d=0;d<C;d++){D=N=P=S=m=v=z=H=0;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;for(k=1;k<c;k++)f=g+((R<k?R:k)<<2),m+=(x.r=y=a[f])*(E=c-k),v+=(x.g=I=a[f+1])*E,z+=(x.b=J=a[f+2])*
E,H+=(x.a=t=a[f+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next;k=Q;x=T;for(e=0;e<p;e++)a[g]=m*U>>V,a[g+1]=v*U>>V,a[g+2]=z*U>>V,a[g+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=n+((f=e+w+1)<R?f:R)<<2,D+=k.r=a[f],N+=k.g=a[f+1],P+=k.b=a[f+2],S+=k.a=a[f+3],m+=D,v+=N,z+=P,H+=S,k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=4;n+=p}for(e=0;e<p;e++){N=P=S=D=v=z=H=m=0;g=e<<2;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<
c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;f=p;for(k=1;k<=w;k++)g=f+e<<2,m+=(x.r=y=a[g])*(E=c-k),v+=(x.g=I=a[g+1])*E,z+=(x.b=J=a[g+2])*E,H+=(x.a=t=a[g+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next,k<l&&(f+=p);g=e;k=Q;x=T;for(d=0;d<C;d++)f=g<<2,a[f]=m*U>>V,a[f+1]=v*U>>V,a[f+2]=z*U>>V,a[f+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=e+((f=d+c)<l?f:l)*p<<2,m+=D+=k.r=a[f],v+=N+=k.g=a[f+1],z+=P+=k.b=a[f+2],H+=S+=k.a=a[f+3],k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=p}p=
h.data;C=h.width*h.height*4;for(w=0;w<C;w+=4)T=p[w+3],0!=T&&(T=255/T,p[w]*=T,p[w+1]*=T,p[w+2]*=T);M.putImageData(h,u,B)}}function K(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(x){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(E){throw alert("Cannot access local image"),Error("unable to access local image data: "+E);}}}catch(x){throw alert("Cannot access image"),
Error("unable to access image data: "+x);}var a=h.data,l,c,b,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N;l=w+w+1;var P=p-1,A=C-1,y=w+1,I=y*(y+1)/2,J=new X,t=J;for(b=1;b<l;b++)if(t=t.next=new X,b==y)var K=t;t.next=J;k=d=0;var R=O[w],Q=L[w];for(c=0;c<C;c++){H=q=F=f=g=n=0;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;for(b=1;b<y;b++)e=d+((P<b?P:b)<<2),f+=(t.r=r=a[e])*(N=y-b),g+=(t.g=G=a[e+1])*N,n+=(t.b=D=a[e+2])*N,H+=r,q+=G,F+=D,t=t.next;b=J;t=K;for(l=
0;l<p;l++)a[d]=f*R>>Q,a[d+1]=g*R>>Q,a[d+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=k+((e=l+w+1)<P?e:P)<<2,H+=b.r=a[e],q+=b.g=a[e+1],F+=b.b=a[e+2],f+=H,g+=q,n+=F,b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=4;k+=p}for(l=0;l<p;l++){q=F=H=g=n=f=0;d=l<<2;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;e=p;for(b=1;b<=w;b++)d=e+l<<2,f+=(t.r=r=a[d])*(N=y-b),g+=(t.g=G=a[d+1])*N,n+=(t.b=D=a[d+2])*N,H+=r,q+=G,F+=D,t=t.next,
b<A&&(e+=p);d=l;b=J;t=K;for(c=0;c<C;c++)e=d<<2,a[e]=f*R>>Q,a[e+1]=g*R>>Q,a[e+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=l+((e=c+y)<A?e:A)*p<<2,f+=H+=b.r=a[e],g+=q+=b.g=a[e+1],n+=F+=b.b=a[e+2],b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=p}M.putImageData(h,u,B)}}function X(){this.a=this.b=this.g=this.r=0;this.next=null}var O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,
345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,
309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],W={image:function(A,u,B,p){A=document.getElementById(A);var C=A.naturalWidth,w=A.naturalHeight,h=document.getElementById(u);h.style.width=C+"px";h.style.height=w+"px";h.width=C;h.height=w;h=h.getContext("2d");h.clearRect(0,0,C,w);h.drawImage(A,0,0);isNaN(B)||1>B||(p?E(u,0,0,C,w,B):K(u,0,0,C,w,B))},canvasRGBA:E,canvasRGB:K};"undefined"!==typeof define&&define.amd?define(function(){return W}):
"undefined"!==typeof module&&module.exports&&(module.exports=W);A.stackBlur=W})("undefined"!==typeof window?window:this);
(function(A,E){A.canvg=E(A.RGBColor,A.stackBlur)})("undefined"!==typeof window?window:this,function(A,E){function K(h){var a=[0,0,0],l=function(c,b){var e=h.match(c);null!=e&&(a[b]+=e.length,h=h.replace(c," "))};h=h.replace(/:not\(([^\)]*)\)/g,"     $1 ");h=h.replace(/{[\s\S]*/gm," ");l(W,1);l(M,0);l(u,1);l(B,2);l(p,1);l(C,1);h=h.replace(/[\*\s\+>~]/g," ");h=h.replace(/[#\.]/g," ");l(w,2);return a.join("")}function X(h){var a={opts:h,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3E4,log:function(a){}};1==a.opts.log&&
"undefined"!=typeof console&&(a.log=function(a){console.log(a)});a.init=function(c){var b=0;a.UniqueId=function(){b++;return"canvg"+b};a.Definitions={};a.Styles={};a.StylesSpecificity={};a.Animations=[];a.Images=[];a.ctx=c;a.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};
this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};a.init();a.ImagesLoaded=function(){for(var c=0;c<a.Images.length;c++)if(!a.Images[c].loaded)return!1;return!0};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm,
" ")};a.ajax=function(a){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText};a.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,e=new Windows.Data.Xml.Dom.XmlLoadSettings;e.prohibitDtd=!1;b.loadXml(a,e);return b}if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");a=a.replace(/<!DOCTYPE svg[^>]*>/,
"");b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};a.Property=function(a,b){this.name=a;this.value=b};a.Property.prototype.getValue=function(){return this.value};a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value};a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);(this.value+"").match(/%$/)&&(a/=100);return a};a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:
a};a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};a.Property.prototype.addOpacity=function(c){var b=this.value;if(null!=c.value&&""!=c.value&&"string"==typeof this.value){var e=new A(this.value);e.ok&&(b="rgba("+e.r+", "+e.g+", "+e.b+", "+c.numValue()+")")}return new a.Property(this.name,b)};a.Property.prototype.getDefinition=function(){var c=this.value.match(/#([^\)'"]+)/);c&&(c=c[1]);c||(c=this.value);return a.Definitions[c]};a.Property.prototype.isUrlDefinition=
function(){return 0==this.value.indexOf("url(")};a.Property.prototype.getFillStyleDefinition=function(c,b){var e=this.getDefinition();if(null!=e&&e.createGradient)return e.createGradient(a.ctx,c,b);if(null!=e&&e.createPattern){if(e.getHrefAttribute().hasValue()){var d=e.attribute("patternTransform"),e=e.getHrefAttribute().getDefinition();d.hasValue()&&(e.attribute("patternTransform",!0).value=d.value)}return e.createPattern(a.ctx,c)}return null};a.Property.prototype.getDPI=function(a){return 96};
a.Property.prototype.getEM=function(c){var b=12,e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);e.hasValue()&&(b=e.toPixels(c));return b};a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")};a.Property.prototype.toPixels=function(c,b){if(!this.hasValue())return 0;var e=this.value+"";if(e.match(/em$/))return this.numValue()*this.getEM(c);if(e.match(/ex$/))return this.numValue()*this.getEM(c)/2;if(e.match(/px$/))return this.numValue();if(e.match(/pt$/))return this.numValue()*
this.getDPI(c)*(1/72);if(e.match(/pc$/))return 15*this.numValue();if(e.match(/cm$/))return this.numValue()*this.getDPI(c)/2.54;if(e.match(/mm$/))return this.numValue()*this.getDPI(c)/25.4;if(e.match(/in$/))return this.numValue()*this.getDPI(c);if(e.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(c);e=this.numValue();return b&&1>e?e*a.ViewPort.ComputeSize(c):e};a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/s$/))return 1E3*this.numValue();
a.match(/ms$/);return this.numValue()};a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var l={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",
mathematical:"alphabetic"};a.Property.prototype.toTextBaseline=function(){return this.hasValue()?l[this.value]:null};a.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(b,e,d,c,f,g){g=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||g.fontFamily,fontSize:c||g.fontSize,fontStyle:b||g.fontStyle,fontWeight:d||
g.fontWeight,fontVariant:e||g.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var c=this;this.Parse=function(b){var e={};b=a.trim(a.compressSpaces(b||"")).split(" ");for(var d=!1,k=!1,f=!1,g=!1,n="",m=0;m<b.length;m++)k||-1==c.Styles.indexOf(b[m])?g||-1==c.Variants.indexOf(b[m])?f||-1==c.Weights.indexOf(b[m])?d?"inherit"!=b[m]&&(n+=b[m]):("inherit"!=b[m]&&(e.fontSize=b[m].split("/")[0]),k=g=f=d=!0):("inherit"!=b[m]&&
(e.fontWeight=b[m]),k=g=f=!0):("inherit"!=b[m]&&(e.fontVariant=b[m]),k=g=!0):("inherit"!=b[m]&&(e.fontStyle=b[m]),k=!0);""!=n&&(e.fontFamily=n);return e}};a.ToNumberArray=function(c){c=a.trim(a.compressSpaces((c||"").replace(/,/g," "))).split(" ");for(var b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return c};a.Point=function(a,b){this.x=a;this.y=b};a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.Point.prototype.applyTransform=function(a){var b=this.x*a[1]+this.y*a[3]+
a[5];this.x=this.x*a[0]+this.y*a[2]+a[4];this.y=b};a.CreatePoint=function(c){c=a.ToNumberArray(c);return new a.Point(c[0],c[1])};a.CreatePath=function(c){c=a.ToNumberArray(c);for(var b=[],e=0;e<c.length;e+=2)b.push(new a.Point(c[e],c[e+1]));return b};a.BoundingBox=function(a,b,e,d){this.y2=this.x2=this.y1=this.x1=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=
function(a,b){if(null!=a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if(null!=b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};this.addX=function(a){this.addPoint(a,null)};this.addY=function(a){this.addPoint(null,a)};this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1);this.addPoint(a.x2,a.y2)};this.addQuadraticCurve=function(a,b,e,d,c,v){e=a+2/3*(e-a);d=b+2/3*(d-b);this.addBezierCurve(a,
b,e,e+1/3*(c-a),d,d+1/3*(v-b),c,v)};this.addBezierCurve=function(a,b,e,d,c,v,z,h){var q=[a,b],F=[e,d],r=[c,v],l=[z,h];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;1>=i;i++)a=function(a){return Math.pow(1-a,3)*q[i]+3*Math.pow(1-a,2)*a*F[i]+3*(1-a)*Math.pow(a,2)*r[i]+Math.pow(a,3)*l[i]},b=6*q[i]-12*F[i]+6*r[i],e=-3*q[i]+9*F[i]-9*r[i]+3*l[i],d=3*F[i]-3*q[i],0==e?0!=b&&(b=-d/b,0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))):(d=Math.pow(b,2)-4*d*e,0>d||(c=(-b+Math.sqrt(d))/(2*e),
0<c&&1>c&&(0==i&&this.addX(a(c)),1==i&&this.addY(a(c))),b=(-b-Math.sqrt(d))/(2*e),0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))))};this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2};this.addPoint(a,b);this.addPoint(e,d)};a.Transform=function(c){var b=this;this.Type={};this.Type.translate=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)};this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)};
this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(b){b=a.ToNumberArray(b);this.angle=new a.Property("angle",b[0]);this.cx=b[1]||0;this.cy=b[2]||0;this.apply=function(a){a.translate(this.cx,this.cy);a.rotate(this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.unapply=function(a){a.translate(this.cx,this.cy);a.rotate(-1*this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.applyToPoint=function(a){var b=this.angle.toRadians();
a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]);a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(b){this.m=a.ToNumberArray(b);
this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(a){var b=this.m[0],e=this.m[2],d=this.m[4],c=this.m[1],f=this.m[3],g=this.m[5],k=1/(b*(1*f-0*g)-e*(1*c-0*g)+d*(0*c-0*f));a.transform(k*(1*f-0*g),k*(0*g-1*c),k*(0*d-1*e),k*(1*b-0*d),k*(e*g-d*f),k*(d*c-b*g))};this.applyToPoint=function(a){a.applyTransform(this.m)}};this.Type.SkewBase=function(e){this.base=b.Type.matrix;this.base(e);this.angle=new a.Property("angle",e)};this.Type.SkewBase.prototype=
new this.Type.matrix;this.Type.skewX=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)};this.unapply=function(a){for(var b=
this.transforms.length-1;0<=b;b--)this.transforms[b].unapply(a)};this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};c=a.trim(a.compressSpaces(c)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var e=0;e<c.length;e++){var d=a.trim(c[e].split("(")[0]),k=c[e].split("(")[1].replace(")",""),f=this.Type[d];"undefined"!=typeof f&&(k=new f(k),k.type=d,this.transforms.push(k))}};a.AspectRatio=function(c,b,e,d,k,
f,g,n,m,v){b=a.compressSpaces(b);b=b.replace(/^defer\s/,"");var z=b.split(" ")[0]||"xMidYMid";b=b.split(" ")[1]||"meet";var h=e/d,q=k/f,l=Math.min(h,q),r=Math.max(h,q);"meet"==b&&(d*=l,f*=l);"slice"==b&&(d*=r,f*=r);m=new a.Property("refX",m);v=new a.Property("refY",v);m.hasValue()&&v.hasValue()?c.translate(-l*m.toPixels("x"),-l*v.toPixels("y")):(z.match(/^xMid/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e/2-d/2,0),z.match(/YMid$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k/2-f/
2),z.match(/^xMax/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e-d,0),z.match(/YMax$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k-f));"none"==z?c.scale(h,q):"meet"==b?c.scale(l,l):"slice"==b&&c.scale(r,r);c.translate(null==g?0:-g,null==n?0:-n)};a.Element={};a.EmptyProperty=new a.Property("EMPTY","");a.Element.ElementBase=function(c){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(b,e){var d=this.attributes[b];if(null!=d)return d;
1==e&&(d=new a.Property(b,""),this.attributes[b]=d);return d||a.EmptyProperty};this.getHrefAttribute=function(){for(var b in this.attributes)if("href"==b||b.match(/:href$/))return this.attributes[b];return a.EmptyProperty};this.style=function(b,e,d){var c=this.styles[b];if(null!=c)return c;var f=this.attribute(b);if(null!=f&&f.hasValue())return this.styles[b]=f;if(1!=d&&(d=this.parent,null!=d&&(d=d.style(b),null!=d&&d.hasValue())))return d;1==e&&(c=new a.Property(b,""),this.styles[b]=c);return c||
a.EmptyProperty};this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){a.save();if(this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else this.style("filter").hasValue()?(b=this.style("filter").getDefinition(),null!=b&&b.apply(a,this)):(this.setContext(a),this.renderChildren(a),this.clearContext(a));a.restore()}};this.setContext=function(a){};this.clearContext=function(a){};this.renderChildren=function(a){for(var b=
0;b<this.children.length;b++)this.children[b].render(a)};this.addChild=function(b,e){var d=b;e&&(d=a.CreateElement(b));d.parent=this;"title"!=d.type&&this.children.push(d)};this.addStylesFromStyleDefinition=function(){for(var b in a.Styles)if("@"!=b[0]&&L(c,b)){var e=a.Styles[b],d=a.StylesSpecificity[b];if(null!=e)for(var f in e){var k=this.stylesSpecificity[f];"undefined"==typeof k&&(k="000");d>k&&(this.styles[f]=e[f],this.stylesSpecificity[f]=d)}}};var b=/^[A-Z-]+$/,e=function(a){return b.test(a)?
a.toLowerCase():a};if(null!=c&&1==c.nodeType){for(var d=0;d<c.attributes.length;d++){var k=c.attributes[d],f=e(k.nodeName);this.attributes[f]=new a.Property(f,k.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue())for(e=this.attribute("style").value.split(";"),d=0;d<e.length;d++)""!=a.trim(e[d])&&(f=e[d].split(":"),k=a.trim(f[0]),f=a.trim(f[1]),this.styles[k]=new a.Property(k,f));this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=
this);for(d=0;d<c.childNodes.length;d++)e=c.childNodes[d],1==e.nodeType&&this.addChild(e,!0),!this.captureTextNodes||3!=e.nodeType&&4!=e.nodeType||""!=a.compressSpaces(e.value||e.text||e.textContent||"")&&this.addChild(new a.Element.tspan(e),!1)}};a.Element.RenderedElementBase=function(c){this.base=a.Element.ElementBase;this.base(c);this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(b.fillStyle=
e)}else this.style("fill").hasValue()&&(e=this.style("fill"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.fillStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("fill-opacity").hasValue()&&(e=new a.Property("fill",b.fillStyle),e=e.addOpacity(this.style("fill-opacity")),b.fillStyle=e.value);this.style("stroke").isUrlDefinition()?(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")),null!=e&&(b.strokeStyle=e)):this.style("stroke").hasValue()&&
(e=this.style("stroke"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("stroke-opacity").hasValue()&&(e=new a.Property("stroke",b.strokeStyle),e=e.addOpacity(this.style("stroke-opacity")),b.strokeStyle=e.value);this.style("stroke-width").hasValue()&&(e=this.style("stroke-width").toPixels(),b.lineWidth=0==e?.001:e);this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value);
this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value);this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value);this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=a.ToNumberArray(this.style("stroke-dasharray").value),"undefined"!=typeof b.setLineDash?b.setLineDash(e):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=e:"undefined"==typeof b.mozDash||1==e.length&&0==e[0]||(b.mozDash=
e),e=this.style("stroke-dashoffset").numValueOrDefault(1),"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=e:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=e:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=e));"undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString());
this.style("transform",!1,!0).hasValue()&&(new a.Transform(this.style("transform",!1,!0).value)).apply(b);this.style("clip-path",!1,!0).hasValue()&&(e=this.style("clip-path",!1,!0).getDefinition(),null!=e&&e.apply(b));this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}};a.Element.RenderedElementBase.prototype=new a.Element.ElementBase;a.Element.PathElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.path=function(b){null!=b&&b.beginPath();
return new a.BoundingBox};this.renderChildren=function(b){this.path(b);a.Mouse.checkPath(this,b);""!=b.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?b.fill(this.style("fill-rule").value):b.fill());""!=b.strokeStyle&&b.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),
c=1;c<e.length-1;c++)d.render(b,e[c][0],e[c][1]);this.style("marker-end").isUrlDefinition()&&(d=this.style("marker-end").getDefinition(),d.render(b,e[e.length-1][0],e[e.length-1][1]))}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase;a.Element.svg=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseClearContext=this.clearContext;this.clearContext=function(b){this.baseClearContext(b);
a.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)";b.lineCap="butt";b.lineJoin="miter";b.miterLimit=4;"undefined"!=typeof b.font&&"undefined"!=typeof window.getComputedStyle&&(b.font=window.getComputedStyle(b.canvas).getPropertyValue("font"));this.baseSetContext(b);this.attribute("x").hasValue()||(this.attribute("x",!0).value=0);this.attribute("y").hasValue()||(this.attribute("y",!0).value=0);b.translate(this.attribute("x").toPixels("x"),
this.attribute("y").toPixels("y"));var e=a.ViewPort.width(),d=a.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%");this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if("undefined"==typeof this.root){var e=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y"),c=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(c=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y"));
"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(b.beginPath(),b.moveTo(c,f),b.lineTo(e,f),b.lineTo(e,d),b.lineTo(c,d),b.closePath(),b.clip())}a.ViewPort.SetCurrent(e,d);if(this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),f=c[0],g=c[1],e=c[2],d=c[3];a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),e,a.ViewPort.height(),d,f,g,this.attribute("refX").value,this.attribute("refY").value);a.ViewPort.RemoveCurrent();
a.ViewPort.SetCurrent(c[2],c[3])}}};a.Element.svg.prototype=new a.Element.RenderedElementBase;a.Element.rect=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y");this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(n=g);this.attribute("ry").hasValue()&&
!this.attribute("rx").hasValue()&&(g=n);g=Math.min(g,c/2);n=Math.min(n,f/2);null!=b&&(b.beginPath(),b.moveTo(e+g,d),b.lineTo(e+c-g,d),b.quadraticCurveTo(e+c,d,e+c,d+n),b.lineTo(e+c,d+f-n),b.quadraticCurveTo(e+c,d+f,e+c-g,d+f),b.lineTo(e+g,d+f),b.quadraticCurveTo(e,d+f,e,d+f-n),b.lineTo(e,d+n),b.quadraticCurveTo(e,d,e+g,d),b.closePath());return new a.BoundingBox(e,d,e+c,d+f)}};a.Element.rect.prototype=new a.Element.PathElementBase;a.Element.circle=function(c){this.base=a.Element.PathElementBase;this.base(c);
this.path=function(b){var e=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),c=this.attribute("r").toPixels();null!=b&&(b.beginPath(),b.arc(e,d,c,0,2*Math.PI,!0),b.closePath());return new a.BoundingBox(e-c,d-c,e+c,d+c)}};a.Element.circle.prototype=new a.Element.PathElementBase;a.Element.ellipse=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=(Math.sqrt(2)-1)/3*4,d=this.attribute("rx").toPixels("x"),c=this.attribute("ry").toPixels("y"),
f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");null!=b&&(b.beginPath(),b.moveTo(f,g-c),b.bezierCurveTo(f+e*d,g-c,f+d,g-e*c,f+d,g),b.bezierCurveTo(f+d,g+e*c,f+e*d,g+c,f,g+c),b.bezierCurveTo(f-e*d,g+c,f-d,g+e*c,f-d,g),b.bezierCurveTo(f-d,g-e*c,f-e*d,g-c,f,g-c),b.closePath());return new a.BoundingBox(f-d,g-c,f+d,g+c)}};a.Element.ellipse.prototype=new a.Element.PathElementBase;a.Element.line=function(c){this.base=a.Element.PathElementBase;this.base(c);this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),
this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(b){var e=this.getPoints();null!=b&&(b.beginPath(),b.moveTo(e[0].x,e[0].y),b.lineTo(e[1].x,e[1].y));return new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)};this.getMarkers=function(){var a=this.getPoints(),e=a[0].angleTo(a[1]);return[[a[0],e],[a[1],e]]}};a.Element.line.prototype=new a.Element.PathElementBase;a.Element.polyline=function(c){this.base=a.Element.PathElementBase;
this.base(c);this.points=a.CreatePath(this.attribute("points").value);this.path=function(b){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)e.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return e};this.getMarkers=function(){for(var a=[],e=0;e<this.points.length-1;e++)a.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);
0<a.length&&a.push([this.points[this.points.length-1],a[a.length-1][1]]);return a}};a.Element.polyline.prototype=new a.Element.PathElementBase;a.Element.polygon=function(c){this.base=a.Element.polyline;this.base(c);this.basePath=this.path;this.path=function(a){var e=this.basePath(a);null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath());return e}};a.Element.polygon.prototype=new a.Element.polyline;a.Element.path=function(c){this.base=a.Element.PathElementBase;this.base(c);c=this.attribute("d").value;
c=c.replace(/,/gm," ");for(var b=0;2>b;b++)c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");c=c.replace(/([0-9])([+\-])/gm,"$1 $2");for(b=0;2>b;b++)c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");c=a.compressSpaces(c);c=a.trim(c);this.PathParser=new function(b){this.tokens=b.split(" ");this.reset=function(){this.i=-1;this.previousCommand=this.command="";this.start=new a.Point(0,
0);this.control=new a.Point(0,0);this.current=new a.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)};this.isRelativeCommand=function(){switch(this.command){case "m":case "l":case "h":case "v":case "c":case "s":case "q":case "t":case "a":case "z":return!0}return!1};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};
this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)};this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a};this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a};this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&
"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};this.makeAbsolute=function(a){this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y);return a};this.addMarker=function(a,b,e){null!=e&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(e));this.addMarkerAngle(a,null==b?null:b.angleTo(a))};this.addMarkerAngle=function(a,
b){this.points.push(a);this.angles.push(b)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c);this.path=function(b){var d=this.PathParser;d.reset();var c=new a.BoundingBox;for(null!=b&&b.beginPath();!d.isEnd();)switch(d.nextCommand(),d.command){case "M":case "m":var f=d.getAsCurrentPoint();
d.addMarker(f);c.addPoint(f.x,f.y);null!=b&&b.moveTo(f.x,f.y);for(d.start=d.current;!d.isCommandOrEnd();)f=d.getAsCurrentPoint(),d.addMarker(f,d.start),c.addPoint(f.x,f.y),null!=b&&b.lineTo(f.x,f.y);break;case "L":case "l":for(;!d.isCommandOrEnd();){var g=d.current,f=d.getAsCurrentPoint();d.addMarker(f,g);c.addPoint(f.x,f.y);null!=b&&b.lineTo(f.x,f.y)}break;case "H":case "h":for(;!d.isCommandOrEnd();)f=new a.Point((d.isRelativeCommand()?d.current.x:0)+d.getScalar(),d.current.y),d.addMarker(f,d.current),
d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "V":case "v":for(;!d.isCommandOrEnd();)f=new a.Point(d.current.x,(d.isRelativeCommand()?d.current.y:0)+d.getScalar()),d.addMarker(f,d.current),d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "C":case "c":for(;!d.isCommandOrEnd();){var n=d.current,g=d.getPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint();d.addMarker(f,m,g);c.addBezierCurve(n.x,
n.y,g.x,g.y,m.x,m.y,f.x,f.y);null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y)}break;case "S":case "s":for(;!d.isCommandOrEnd();)n=d.current,g=d.getReflectedControlPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,g),c.addBezierCurve(n.x,n.y,g.x,g.y,m.x,m.y,f.x,f.y),null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y);break;case "Q":case "q":for(;!d.isCommandOrEnd();)n=d.current,m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,
f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "T":case "t":for(;!d.isCommandOrEnd();)n=d.current,m=d.getReflectedControlPoint(),d.control=m,f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "A":case "a":for(;!d.isCommandOrEnd();){var n=d.current,v=d.getScalar(),h=d.getScalar(),g=d.getScalar()*(Math.PI/180),l=d.getScalar(),m=d.getScalar(),f=d.getAsCurrentPoint(),q=new a.Point(Math.cos(g)*
(n.x-f.x)/2+Math.sin(g)*(n.y-f.y)/2,-Math.sin(g)*(n.x-f.x)/2+Math.cos(g)*(n.y-f.y)/2),p=Math.pow(q.x,2)/Math.pow(v,2)+Math.pow(q.y,2)/Math.pow(h,2);1<p&&(v*=Math.sqrt(p),h*=Math.sqrt(p));l=(l==m?-1:1)*Math.sqrt((Math.pow(v,2)*Math.pow(h,2)-Math.pow(v,2)*Math.pow(q.y,2)-Math.pow(h,2)*Math.pow(q.x,2))/(Math.pow(v,2)*Math.pow(q.y,2)+Math.pow(h,2)*Math.pow(q.x,2)));isNaN(l)&&(l=0);var r=new a.Point(l*v*q.y/h,l*-h*q.x/v),n=new a.Point((n.x+f.x)/2+Math.cos(g)*r.x-Math.sin(g)*r.y,(n.y+f.y)/2+Math.sin(g)*
r.x+Math.cos(g)*r.y),u=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},w=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(u(a,b))},l=w([1,0],[(q.x-r.x)/v,(q.y-r.y)/h]),p=[(q.x-r.x)/v,(q.y-r.y)/h],r=[(-q.x-r.x)/v,(-q.y-r.y)/h],q=w(p,r);-1>=u(p,r)&&(q=Math.PI);1<=u(p,r)&&(q=0);p=1-m?1:-1;r=l+q/2*p;w=new a.Point(n.x+v*Math.cos(r),n.y+h*Math.sin(r));d.addMarkerAngle(w,r-p*Math.PI/2);d.addMarkerAngle(f,r-p*Math.PI);
c.addPoint(f.x,f.y);null!=b&&(u=v>h?v:h,f=v>h?1:v/h,v=v>h?h/v:1,b.translate(n.x,n.y),b.rotate(g),b.scale(f,v),b.arc(0,0,u,l,l+q,1-m),b.scale(1/f,1/v),b.rotate(-g),b.translate(-n.x,-n.y))}break;case "Z":case "z":null!=b&&b.closePath(),d.current=d.start}return c};this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],f=0;f<a.length;f++)c.push([a[f],b[f]]);return c}};a.Element.path.prototype=new a.Element.PathElementBase;a.Element.pattern=function(c){this.base=
a.Element.ElementBase;this.base(c);this.createPattern=function(b,e){var d=this.attribute("width").toPixels("x",!0),c=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);f.attributes.width=new a.Property("width",d+"px");f.attributes.height=new a.Property("height",c+"px");f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value);f.children=this.children;var g=document.createElement("canvas");
g.width=d;g.height=c;d=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&d.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(c=-1;1>=c;c++)for(var n=-1;1>=n;n++)d.save(),f.attributes.x=new a.Property("x",c*g.width),f.attributes.y=new a.Property("y",n*g.height),f.render(d),d.restore();return b.createPattern(g,"repeat")}};a.Element.pattern.prototype=new a.Element.ElementBase;a.Element.marker=function(c){this.base=a.Element.ElementBase;
this.base(c);this.baseRender=this.render;this.render=function(b,e,d){b.translate(e.x,e.y);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d);"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth);b.save();var c=new a.Element.svg;c.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);c.attributes.refX=new a.Property("refX",this.attribute("refX").value);c.attributes.refY=new a.Property("refY",this.attribute("refY").value);
c.attributes.width=new a.Property("width",this.attribute("markerWidth").value);c.attributes.height=new a.Property("height",this.attribute("markerHeight").value);c.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black"));c.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none"));c.children=this.children;var f=0,g=0;this.attribute("refX").hasValue()&&(f=-parseFloat(this.attribute("refX").value));this.attribute("refY").hasValue()&&(g=-parseFloat(this.attribute("refY").value));
b.translate(f,g);c.render(b);b.restore();"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d);b.translate(-e.x,-e.y)}};a.Element.marker.prototype=new a.Element.ElementBase;a.Element.defs=function(c){this.base=a.Element.ElementBase;this.base(c);this.render=function(a){}};a.Element.defs.prototype=new a.Element.ElementBase;a.Element.GradientBase=function(c){this.base=a.Element.ElementBase;
this.base(c);this.stops=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"stop"==b.type&&this.stops.push(b)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=
a.attribute(c).value)}};this.createGradient=function(b,d,c){var f=this;this.getHrefAttribute().hasValue()&&(f=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(f));var g=function(b){return c.hasValue()?(new a.Property("color",b)).addOpacity(c).value:b};b=this.getGradient(b,d);if(null==b)return g(f.stops[f.stops.length-1].color);for(d=0;d<f.stops.length;d++)b.addColorStop(f.stops[d].offset,g(f.stops[d].color));return this.attribute("gradientTransform").hasValue()?(f=a.ViewPort.viewPorts[0],
g=new a.Element.rect,g.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),g.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS),d=new a.Element.g,d.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),d.children=[g],g=new a.Element.svg,g.attributes.x=new a.Property("x",0),g.attributes.y=new a.Property("y",0),g.attributes.width=
new a.Property("width",f.width),g.attributes.height=new a.Property("height",f.height),g.children=[d],d=document.createElement("canvas"),d.width=f.width,d.height=f.height,f=d.getContext("2d"),f.fillStyle=b,g.render(f),f.createPattern(d,"no-repeat")):b}};a.Element.GradientBase.prototype=new a.Element.ElementBase;a.Element.linearGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");
this.attributesToInherit.push("y2");this.getGradient=function(a,e){var c="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var k="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),
f="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),g="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),c="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return k==g&&f==c?null:a.createLinearGradient(k,f,g,c)}};a.Element.linearGradient.prototype=new a.Element.GradientBase;
a.Element.radialGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(a,c){var d=c.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%");this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%");this.attribute("r").hasValue()||(this.attribute("r",
!0).value="50%");var k="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),f="objectBoundingBox"==this.gradientUnits()?d.y()+d.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),g=k,n=f;this.attribute("fx").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));this.attribute("fy").hasValue()&&(n="objectBoundingBox"==
this.gradientUnits()?d.y()+d.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));d="objectBoundingBox"==this.gradientUnits()?(d.width()+d.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(g,n,0,k,f,d)}};a.Element.radialGradient.prototype=new a.Element.GradientBase;a.Element.stop=function(c){this.base=a.Element.ElementBase;this.base(c);this.offset=this.attribute("offset").numValue();0>this.offset&&(this.offset=0);1<this.offset&&
(this.offset=1);c=this.style("stop-color",!0);""===c.value&&(c.value="#000");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity")));this.color=c.value};a.Element.stop.prototype=new a.Element.ElementBase;a.Element.AnimateBase=function(c){this.base=a.Element.ElementBase;this.base(c);a.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var a=
this.attribute("attributeType").value,c=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(c,!0):this.parent.attribute(c,!0)};this.initialValue=null;this.initialUnits="";this.removed=!1;this.calcValue=function(){return""};this.update=function(a){null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits());if(this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=
0;else if("freeze"==this.attribute("fill").valueOrDefault("remove")&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration+=a;a=!1;this.begin<this.duration&&(a=this.calcValue(),this.attribute("type").hasValue()&&
(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,a=!0);return a};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");this.values.hasValue()&&(this.values.value=this.values.value.split(";"));this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),k=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d]));
b.to=new a.Property("to",parseFloat(this.values.value[k]));b.progress=(c-d)/(k-d)}else b.from=this.from,b.to=this.to;return b}};a.Element.AnimateBase.prototype=new a.Element.ElementBase;a.Element.animate=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}};a.Element.animate.prototype=new a.Element.AnimateBase;a.Element.animateColor=function(c){this.base=a.Element.AnimateBase;
this.base(c);this.calcValue=function(){var a=this.progress(),c=new A(a.from.value),d=new A(a.to.value);if(c.ok&&d.ok){var k=c.g+(d.g-c.g)*a.progress,f=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(c.r+(d.r-c.r)*a.progress,10)+","+parseInt(k,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}};a.Element.animateColor.prototype=new a.Element.AnimateBase;a.Element.animateTransform=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){for(var b=this.progress(),
c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),k="",f=0;f<c.length;f++)k+=c[f]+(d[f]-c[f])*b.progress+" ";return k}};a.Element.animateTransform.prototype=new a.Element.animate;a.Element.font=function(c){this.base=a.Element.ElementBase;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isArabic=this.isRTL=!1;this.missingGlyph=this.fontFace=null;this.glyphs=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"font-face"==b.type?(this.fontFace=b,b.style("font-family").hasValue()&&
(a.Definitions[b.style("font-family").value]=this)):"missing-glyph"==b.type?this.missingGlyph=b:"glyph"==b.type&&(""!=b.arabicForm?(this.isArabic=this.isRTL=!0,"undefined"==typeof this.glyphs[b.unicode]&&(this.glyphs[b.unicode]=[]),this.glyphs[b.unicode][b.arabicForm]=b):this.glyphs[b.unicode]=b)}};a.Element.font.prototype=new a.Element.ElementBase;a.Element.fontface=function(c){this.base=a.Element.ElementBase;this.base(c);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;
this.unitsPerEm=this.attribute("units-per-em").numValue()};a.Element.fontface.prototype=new a.Element.ElementBase;a.Element.missingglyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=0};a.Element.missingglyph.prototype=new a.Element.path;a.Element.glyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};a.Element.glyph.prototype=
new a.Element.path;a.Element.text=function(c){this.captureTextNodes=!0;this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);var c=this.style("dominant-baseline").toTextBaseline();null==c&&(c=this.style("alignment-baseline").toTextBaseline());null!=c&&(a.textBaseline=c)};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);
return new a.BoundingBox(b,c-d,b+Math.floor(2*d/3)*this.children[0].getText().length,c)};this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x"));this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y"));this.x+=this.getAnchorDelta(a,this,0);for(var c=0;c<this.children.length;c++)this.renderChild(a,this,this,c)};this.getAnchorDelta=function(a,c,
d){var k=this.style("text-anchor").valueOrDefault("start");if("start"!=k){for(var f=0,g=d;g<c.children.length;g++){var n=c.children[g];if(g>d&&n.attribute("x").hasValue())break;f+=n.measureTextRecursive(a)}return-1*("end"==k?f:f/2)}return 0};this.renderChild=function(a,c,d,k){var f=d.children[k];f.attribute("x").hasValue()?(f.x=f.attribute("x").toPixels("x")+c.getAnchorDelta(a,d,k),f.attribute("dx").hasValue()&&(f.x+=f.attribute("dx").toPixels("x"))):(f.attribute("dx").hasValue()&&(c.x+=f.attribute("dx").toPixels("x")),
f.x=c.x);c.x=f.x+f.measureText(a);f.attribute("y").hasValue()?(f.y=f.attribute("y").toPixels("y"),f.attribute("dy").hasValue()&&(f.y+=f.attribute("dy").toPixels("y"))):(f.attribute("dy").hasValue()&&(c.y+=f.attribute("dy").toPixels("y")),f.y=c.y);c.y=f.y;f.render(a);for(k=0;k<f.children.length;k++)c.renderChild(a,c,f,k)}};a.Element.text.prototype=new a.Element.RenderedElementBase;a.Element.TextElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getGlyph=function(a,c,
d){var k=c[d],f=null;if(a.isArabic){var g="isolated";(0==d||" "==c[d-1])&&d<c.length-2&&" "!=c[d+1]&&(g="terminal");0<d&&" "!=c[d-1]&&d<c.length-2&&" "!=c[d+1]&&(g="medial");0<d&&" "!=c[d-1]&&(d==c.length-1||" "==c[d+1])&&(g="initial");"undefined"!=typeof a.glyphs[k]&&(f=a.glyphs[k][g],null==f&&"glyph"==a.glyphs[k].type&&(f=a.glyphs[k]))}else f=a.glyphs[k];null==f&&(f=a.missingGlyph);return f};this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=
this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),k=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),n=0;n<f.length;n++){var m=this.getGlyph(c,f,n),h=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y);b.scale(h,-h);var l=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d;"italic"==k&&b.transform(1,0,.4,
1,0,0);m.render(b);"italic"==k&&b.transform(1,0,-.4,1,0,0);b.lineWidth=l;b.scale(1/h,-1/h);b.translate(-this.x,-this.y);this.x+=d*(m.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm;"undefined"==typeof g[n]||isNaN(g[n])||(this.x+=g[n])}}else""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y)};this.getText=function(){};this.measureTextRecursive=function(a){for(var c=this.measureText(a),d=0;d<this.children.length;d++)c+=
this.children[d].measureTextRecursive(a);return c};this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){b=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);var d=0,k=this.getText();c.isRTL&&(k=k.split("").reverse().join(""));for(var f=a.ToNumberArray(this.parent.attribute("dx").value),g=0;g<k.length;g++){var n=this.getGlyph(c,k,g),d=d+(n.horizAdvX||c.horizAdvX)*b/c.fontFace.unitsPerEm;"undefined"==typeof f[g]||isNaN(f[g])||
(d+=f[g])}return d}c=a.compressSpaces(this.getText());if(!b.measureText)return 10*c.length;b.save();this.setContext(b);c=b.measureText(c).width;b.restore();return c}};a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase;a.Element.tspan=function(c){this.captureTextNodes=!0;this.base=a.Element.TextElementBase;this.base(c);this.text=a.compressSpaces(c.value||c.text||c.textContent||"");this.getText=function(){return 0<this.children.length?"":this.text}};a.Element.tspan.prototype=new a.Element.TextElementBase;
a.Element.tref=function(c){this.base=a.Element.TextElementBase;this.base(c);this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}};a.Element.tref.prototype=new a.Element.TextElementBase;a.Element.a=function(c){this.base=a.Element.TextElementBase;this.base(c);this.hasText=0<c.childNodes.length;for(var b=0;b<c.childNodes.length;b++)3!=c.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?c.childNodes[0].value:"";this.getText=function(){return this.text};
this.baseRenderChildren=this.renderChildren;this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else 0<this.children.length&&(c=new a.Element.g,c.children=this.children,c.parent=this,c.render(b))};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){a.ctx.canvas.style.cursor=
"pointer"}};a.Element.a.prototype=new a.Element.TextElementBase;a.Element.image=function(c){this.base=a.Element.RenderedElementBase;this.base(c);var b=this.getHrefAttribute().value;if(""!=b){var e=b.match(/\.svg$/);a.Images.push(this);this.loaded=!1;if(e)this.img=a.ajax(b),this.loaded=!0;else{this.img=document.createElement("img");1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0};this.img.onerror=function(){a.log('ERROR: image "'+b+'" not found');
d.loaded=!0};this.img.src=b}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),m=this.attribute("height").toPixels("y");0!=n&&0!=m&&(b.save(),e?b.drawSvg(this.img,c,d,n,m):(b.translate(c,d),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,n,this.img.width,m,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=
this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}}};a.Element.image.prototype=new a.Element.RenderedElementBase;a.Element.g=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}};a.Element.g.prototype=new a.Element.RenderedElementBase;
a.Element.symbol=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.render=function(a){}};a.Element.symbol.prototype=new a.Element.RenderedElementBase;a.Element.style=function(c){this.base=a.Element.ElementBase;this.base(c);for(var b="",e=0;e<c.childNodes.length;e++)b+=c.childNodes[e].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");b=a.compressSpaces(b);c=b.split("}");for(e=0;e<c.length;e++)if(""!=a.trim(c[e]))for(var d=c[e].split("{"),b=d[0].split(","),
d=d[1].split(";"),k=0;k<b.length;k++){var f=a.trim(b[k]);if(""!=f){for(var g=a.Styles[f]||{},n=0;n<d.length;n++){var m=d[n].indexOf(":"),h=d[n].substr(0,m),m=d[n].substr(m+1,d[n].length-m);null!=h&&null!=m&&(g[a.trim(h)]=new a.Property(a.trim(h),a.trim(m)))}a.Styles[f]=g;a.StylesSpecificity[f]=K(f);if("@font-face"==f)for(f=g["font-family"].value.replace(/"/g,""),g=g.src.value.split(","),n=0;n<g.length;n++)if(0<g[n].indexOf('format("svg")'))for(h=g[n].indexOf("url"),m=g[n].indexOf(")",h),h=g[n].substr(h+
5,m-h-6),h=a.parseXml(a.ajax(h)).getElementsByTagName("font"),m=0;m<h.length;m++){var l=a.CreateElement(h[m]);a.Definitions[f]=l}}}};a.Element.style.prototype=new a.Element.ElementBase;a.Element.use=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0);this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};
var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)};this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()};this.renderChildren=function(c){if(null!=b){var d=b;"symbol"==b.type&&(d=new a.Element.svg,d.type="svg",d.attributes.viewBox=new a.Property("viewBox",b.attribute("viewBox").value),d.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),d.attributes.overflow=new a.Property("overflow",b.attribute("overflow").value),
d.children=b.children);"svg"==d.type&&(this.attribute("width").hasValue()&&(d.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(d.attributes.height=new a.Property("height",this.attribute("height").value)));var k=d.parent;d.parent=null;d.render(c);d.parent=k}}};a.Element.use.prototype=new a.Element.RenderedElementBase;a.Element.mask=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),
k=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){g=new a.BoundingBox;for(d=0;d<this.children.length;d++)g.addBoundingBox(this.children[d].getBoundingBox());d=Math.floor(g.x1);k=Math.floor(g.y1);f=Math.floor(g.width());g=Math.floor(g.height())}var n=c.attribute("mask").value;c.attribute("mask").value="";var m=document.createElement("canvas");m.width=d+f;m.height=k+g;var h=m.getContext("2d");this.renderChildren(h);var l=
document.createElement("canvas");l.width=d+f;l.height=k+g;var p=l.getContext("2d");c.render(p);p.globalCompositeOperation="destination-in";p.fillStyle=h.createPattern(m,"no-repeat");p.fillRect(0,0,d+f,k+g);b.fillStyle=p.createPattern(l,"no-repeat");b.fillRect(0,0,d+f,k+g);c.attribute("mask").value=n};this.render=function(a){}};a.Element.mask.prototype=new a.Element.ElementBase;a.Element.clipPath=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b){var c=CanvasRenderingContext2D.prototype.beginPath;
CanvasRenderingContext2D.prototype.beginPath=function(){};var d=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};c.call(b);for(var k=0;k<this.children.length;k++){var f=this.children[k];if("undefined"!=typeof f.path){var g=null;f.style("transform",!1,!0).hasValue()&&(g=new a.Transform(f.style("transform",!1,!0).value),g.apply(b));f.path(b);CanvasRenderingContext2D.prototype.closePath=d;g&&g.unapply(b)}}d.call(b);b.clip();CanvasRenderingContext2D.prototype.beginPath=
c;CanvasRenderingContext2D.prototype.closePath=d};this.render=function(a){}};a.Element.clipPath.prototype=new a.Element.ElementBase;a.Element.filter=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c){var d=c.getBoundingBox(),k=Math.floor(d.x1),f=Math.floor(d.y1),g=Math.floor(d.width()),d=Math.floor(d.height()),n=c.style("filter").value;c.style("filter").value="";for(var m=0,h=0,l=0;l<this.children.length;l++)var p=this.children[l].extraFilterDistance||0,m=Math.max(m,
p),h=Math.max(h,p);p=document.createElement("canvas");p.width=g+2*m;p.height=d+2*h;var q=p.getContext("2d");q.translate(-k+m,-f+h);c.render(q);for(l=0;l<this.children.length;l++)"function"==typeof this.children[l].apply&&this.children[l].apply(q,0,0,g+2*m,d+2*h);a.drawImage(p,0,0,g+2*m,d+2*h,k-m,f-h,g+2*m,d+2*h);c.style("filter",!0).value=n};this.render=function(a){}};a.Element.filter.prototype=new a.Element.ElementBase;a.Element.feMorphology=function(c){this.base=a.Element.ElementBase;this.base(c);
this.apply=function(a,c,d,k,f){}};a.Element.feMorphology.prototype=new a.Element.ElementBase;a.Element.feComposite=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c,d,k,f){}};a.Element.feComposite.prototype=new a.Element.ElementBase;a.Element.feColorMatrix=function(c){function b(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=a.Element.ElementBase;this.base(c);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case "saturate":c=
e[0];e=[.213+.787*c,.715-.715*c,.072-.072*c,0,0,.213-.213*c,.715+.285*c,.072-.072*c,0,0,.213-.213*c,.715-.715*c,.072+.928*c,0,0,0,0,0,1,0,0,0,0,0,1];break;case "hueRotate":var d=e[0]*Math.PI/180;c=function(a,b,c){return a+Math.cos(d)*b+Math.sin(d)*c};e=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case "luminanceToAlpha":e=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,c,d,e,h){var l=a.getImageData(0,0,e,h);for(d=0;d<h;d++)for(c=0;c<e;c++){var p=l.data[d*e*4+4*c+0],u=l.data[d*e*4+4*c+1],q=l.data[d*e*4+4*c+2],w=l.data[d*e*4+4*c+3],r=b(0,p)+b(1,u)+b(2,q)+b(3,w)+b(4,1);l.data[d*e*4+4*c+0]=r;r=b(5,p)+b(6,u)+b(7,q)+b(8,w)+b(9,1);l.data[d*e*4+4*c+1]=r;r=b(10,p)+b(11,u)+b(12,q)+b(13,w)+b(14,1);l.data[d*e*4+4*c+2]=r;p=b(15,p)+b(16,u)+b(17,q)+b(18,w)+b(19,1);l.data[d*e*4+4*c+3]=p}a.clearRect(0,0,
e,h);a.putImageData(l,0,0)}};a.Element.feColorMatrix.prototype=new a.Element.ElementBase;a.Element.feGaussianBlur=function(c){this.base=a.Element.ElementBase;this.base(c);this.extraFilterDistance=this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.apply=function(b,c,d,k,f){"undefined"==typeof E.canvasRGBA?a.log("ERROR: StackBlur.js must be included for blur to work"):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),E.canvasRGBA(b.canvas.id,
c,d,k,f,this.blurRadius),document.body.removeChild(b.canvas))}};a.Element.feGaussianBlur.prototype=new a.Element.ElementBase;a.Element.title=function(a){};a.Element.title.prototype=new a.Element.ElementBase;a.Element.desc=function(a){};a.Element.desc.prototype=new a.Element.ElementBase;a.Element.MISSING=function(c){a.log("ERROR: Element '"+c.nodeName+"' not yet implemented.")};a.Element.MISSING.prototype=new a.Element.ElementBase;a.CreateElement=function(c){var b=c.nodeName.replace(/^[^:]+:/,""),
b=b.replace(/\-/g,""),b="undefined"!=typeof a.Element[b]?new a.Element[b](c):new a.Element.MISSING(c);b.type=c.nodeName;return b};a.load=function(c,b){a.loadXml(c,a.ajax(b))};a.loadXml=function(c,b){a.loadXmlDoc(c,a.parseXml(b))};a.loadXmlDoc=function(c,b){a.init(c);var e=function(a){for(var b=c.canvas;b;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;window.scrollX&&(a.x+=window.scrollX);window.scrollY&&(a.y+=window.scrollY);return a};1!=a.opts.ignoreMouse&&(c.canvas.onclick=function(b){b=e(new a.Point(null!=
b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(b.x,b.y)},c.canvas.onmousemove=function(b){b=e(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(b.x,b.y)});var d=a.CreateElement(b.documentElement);d.root=!0;d.addStylesFromStyleDefinition();var k=!0,f=function(){a.ViewPort.Clear();c.canvas.parentNode&&a.ViewPort.SetCurrent(c.canvas.parentNode.clientWidth,c.canvas.parentNode.clientHeight);1!=a.opts.ignoreDimensions&&(d.style("width").hasValue()&&
(c.canvas.width=d.style("width").toPixels("x"),c.canvas.style.width=c.canvas.width+"px"),d.style("height").hasValue()&&(c.canvas.height=d.style("height").toPixels("y"),c.canvas.style.height=c.canvas.height+"px"));var e=c.canvas.clientWidth||c.canvas.width,f=c.canvas.clientHeight||c.canvas.height;1==a.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(e=d.style("width").toPixels("x"),f=d.style("height").toPixels("y"));a.ViewPort.SetCurrent(e,f);null!=a.opts.offsetX&&
(d.attribute("x",!0).value=a.opts.offsetX);null!=a.opts.offsetY&&(d.attribute("y",!0).value=a.opts.offsetY);if(null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var g=null,h=null,l=a.ToNumberArray(d.attribute("viewBox").value);null!=a.opts.scaleWidth&&(d.attribute("width").hasValue()?g=d.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(l[2])||(g=l[2]/a.opts.scaleWidth));null!=a.opts.scaleHeight&&(d.attribute("height").hasValue()?h=d.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(l[3])||
(h=l[3]/a.opts.scaleHeight));null==g&&(g=h);null==h&&(h=g);d.attribute("width",!0).value=a.opts.scaleWidth;d.attribute("height",!0).value=a.opts.scaleHeight;d.style("transform",!0,!0).value+=" scale("+1/g+","+1/h+")"}1!=a.opts.ignoreClear&&c.clearRect(0,0,e,f);d.render(c);k&&(k=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(b))},g=!0;a.ImagesLoaded()&&(g=!1,f());a.intervalID=setInterval(function(){var b=!1;g&&a.ImagesLoaded()&&(g=!1,b=!0);1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents());
if(1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1E3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0);b&&(f(),a.Mouse.runEvents())},1E3/a.FRAMERATE)};a.stop=function(){a.intervalID&&clearInterval(a.intervalID)};a.Mouse=new function(){this.events=[];this.hasEvents=function(){return 0!=this.events.length};this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){if(a.onclick)a.onclick()}})};this.onmousemove=
function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){if(a.onmousemove)a.onmousemove()}})};this.eventElements=[];this.checkPath=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[e]=a)}};this.checkBoundingBox=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInBox(d.x,d.y)&&(this.eventElements[e]=a)}};this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var c=
0;c<this.events.length;c++)for(var b=this.events[c],e=this.eventElements[c];e;)b.run(e),e=e.parent;this.events=[];this.eventElements=[]}};return a}var O=function(h,a,l){if(null==h&&null==a&&null==l)for(a=document.querySelectorAll("svg"),h=0;h<a.length;h++){l=a[h];var c=document.createElement("canvas");c.width=l.clientWidth;c.height=l.clientHeight;l.parentNode.insertBefore(c,l);l.parentNode.removeChild(l);var b=document.createElement("div");b.appendChild(l);O(c,b.innerHTML)}else{"string"==typeof h&&
(h=document.getElementById(h));null!=h.svg&&h.svg.stop();l=X(l||{});if(1!=h.childNodes.length||"OBJECT"!=h.childNodes[0].nodeName)h.svg=l;h=h.getContext("2d");"undefined"!=typeof a.documentElement?l.loadXmlDoc(h,a):"<"==a.substr(0,1)?l.loadXml(h,a):l.load(h,a)}},L;if("undefined"!=typeof Element.prototype.matches)L=function(h,a){return h.matches(a)};else if("undefined"!=typeof Element.prototype.webkitMatchesSelector)L=function(h,a){return h.webkitMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.mozMatchesSelector)L=
function(h,a){return h.mozMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.msMatchesSelector)L=function(h,a){return h.msMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.oMatchesSelector)L=function(h,a){return h.oMatchesSelector(a)};else{if("function"===typeof jQuery||"function"===typeof Zepto)L=function(h,a){return $(h).is(a)};"undefined"===typeof L&&(L=Sizzle.matchesSelector)}var W=/(\[[^\]]+\])/g,M=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,B=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
p=/(:[\w-]+\([^\)]*\))/gi,C=/(:[^\s\+>~\.\[:]+)/g,w=/([^\s\+>~\.\[:]+)/g;"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(h,a,l,c,b,e){a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:a,offsetY:l,scaleWidth:c,scaleHeight:b};for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);O(this.canvas,h,a)});return O});

/*!

JSZip v3.1.5 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error("Invalid base64 input, bad content length.");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{"./support":30,"./utils":32}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":32}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){"use strict";var d=null;d="undefined"!=typeof Promise?Promise:a("lie"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,null===this._pako&&this._createPako(),this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.version="3.1.5",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,b,c){"use strict";function d(a,b){f.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a("../utils"),f=a("../stream/GenericWorker");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,b,c){"use strict";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on("data",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on("error",function(a){d.emit("error",a)}).on("end",function(){d.push(null)})}var e=a("readable-stream").Readable,f=a("../utils");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{"../utils":32,"readable-stream":16}],14:[function(a,b,c){"use strict";b.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(a,b){return new Buffer(a,b)},allocBuffer:function(a){return Buffer.alloc?Buffer.alloc(a):new Buffer(a)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}},{}],15:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l="string"===e&&h.binary===!1&&h.base64===!1;c&&"undefined"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b="",h.compression="STORE",e="string");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==c.platform&&"freebsd"!==c.platform&&"linux"!==c.platform&&"sunos"!==c.platform||(c.platform="UNIX"),"win32"===c.platform&&(c.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(i){b=new g("error"),b.error(i)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,b,c){b.exports=a("stream")},{stream:void 0}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],18:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":32}],19:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],21:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],24:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],29:[function(a,b,c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j("error"),this._worker.error(e)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../support"),m=a("../external"),n=null;if(l.nodestream)try{n=a("../nodejs/NodejsStreamOutputAdapter")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new n(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,b,c){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof Buffer,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(e){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob("application/zip").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a("readable-stream").Readable}catch(e){c.nodestream=!1}},{"readable-stream":16}],31:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBufferFrom(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];
return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("core-js/library/fn/set-immediate"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.allocBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.allocBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBufferFrom(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&"undefined"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=null,c="string";try{if(!a)throw new Error("No output type specified.");c=a.toLowerCase();var e="string"===c||"text"===c;"binarystring"!==c&&"text"!==c||(c="string"),b=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(b=b.pipe(new f.Utf8EncodeWorker)),!g&&e&&(b=b.pipe(new f.Utf8DecodeWorker))}catch(i){b=new h("error"),b.error(i)}return new d(b,c,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,b,c){a("../modules/web.immediate"),b.exports=a("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],38:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:"2.3.0"};"number"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":37}],42:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":46,"./_is-object":51}],44:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":46}],49:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],52:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r="onreadystatechange",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h("function"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d=r in j("script")?function(a){i.appendChild(j("script"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(a,b,c){var d=a("./_export"),e=a("./_task");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{"./_export":44,"./_task":54}],57:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":62}],64:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0;
}b.exports=d},{}],65:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":62}],72:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,
c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":62}],74:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});
/*!

JSZipUtils - A collection of cross-browser utilities to go along with JSZip.
<http://stuk.github.io/jszip-utils>

(c) 2014 Stuart Knightley, David Duponchel
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.

*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});
var _global="object"===typeof window&&window.window===window?window:"object"===typeof self&&self.self===self?self:"object"===typeof global&&global.global===global?global:this;
function bom(a,b){"undefined"===typeof b?b={autoBom:!1}:"object"!==typeof b&&(console.warn("Depricated: Expected third argument to be a object"),b={autoBom:!b});return b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a}
function download(a,b,e){var c=new XMLHttpRequest;c.open("GET",a);c.responseType="blob";c.onload=function(){saveAs(c.response,b,e)};c.onerror=function(){console.error("could not download file")};c.send()}function corsEnabled(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);b.send();return 200<=b.status&&299>=b.status}
function click(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(e){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);a.dispatchEvent(b)}}
var saveAs=_global.saveAs||"object"!==typeof window||window!==_global?function(){}:"download"in HTMLAnchorElement.prototype?function(a,b,e){var c=_global.URL||_global.webkitURL,d=document.createElement("a");b=b||a.name||"download";d.download=b;d.rel="noopener";"string"===typeof a?(d.href=a,d.origin!==location.origin?corsEnabled(d.href)?download(a,b,e):click(d,d.target="_blank"):click(d)):(d.href=c.createObjectURL(a),setTimeout(function(){c.revokeObjectURL(d.href)},4E4),setTimeout(function(){click(d)},
0))}:"msSaveOrOpenBlob"in navigator?function(a,b,e){b=b||a.name||"download";if("string"===typeof a)if(corsEnabled(a))download(a,b,e);else{var c=document.createElement("a");c.href=a;c.target="_blank";setTimeout(function(){click(c)})}else navigator.msSaveOrOpenBlob(bom(a,e),b)}:function(a,b,e,c){if(c=c||open("","_blank"))c.document.title=c.document.body.innerText="downloading...";if("string"===typeof a)return download(a,b,e);b="application/octet-stream"===a.type;e=/constructor/i.test(_global.HTMLElement)||
_global.safari;var d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||b&&e)&&"object"===typeof FileReader){var f=new FileReader;f.onloadend=function(){var a=f.result;a=d?a:a.replace(/^data:[^;]*;/,"data:attachment/file;");c?c.location.href=a:location=a;c=null};f.readAsDataURL(a)}else{var h=_global.URL||_global.webkitURL,g=h.createObjectURL(a);c?c.location=g:location.href=g;c=null;setTimeout(function(){h.revokeObjectURL(g)},4E4)}};_global.saveAs=saveAs.saveAs=saveAs;
"undefined"!==typeof module&&(module.exports=saveAs);
